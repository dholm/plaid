From news@gmane.org Tue Mar 04 03:33:20 2003
From: Vitor Sessak <vitor1001-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>
Subject: Re: [PATCH] Fix an infinite loop when RoQ encoded
Date: Tue, 22 Mar 2011 21:00:09 +0100
Lines: 4
Message-ID: <4D88FFC9.8060801@gmail.com>
References: <4D863A58.8090706@gmail.com>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"; Format="flowed"
Content-Transfer-Encoding: 7bit
To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Tue Mar 22 21:00:18 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q27kY-00010K-A7
	for gcvld-libav-devel@m.gmane.org; Tue, 22 Mar 2011 21:00:18 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 171073C084;
	Tue, 22 Mar 2011 21:00:18 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 711CA3C084
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Tue, 22 Mar 2011 21:00:15 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id iyGTsUdjRgYs for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Tue, 22 Mar 2011 21:00:15 +0100 (CET)
Received: from mail-bw0-f54.google.com (mail-bw0-f54.google.com
	[209.85.214.54])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 4D8953B163
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Tue, 22 Mar 2011 21:00:15 +0100 (CET)
Received: by bwz12 with SMTP id 12so9806960bwz.27
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Tue, 22 Mar 2011 13:00:14 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=gamma;
	h=domainkey-signature:message-id:date:from:user-agent:mime-version:to
	:subject:references:in-reply-to:content-type
	:content-transfer-encoding;
	bh=jT7QbfgD2yUHAn1Pd2WFgCTwp8dGsQsWaz9m4jK43ts=;
	b=e3PsLnkzoVCtr6D3vJ24lhaUEqgH3qy0RK00+aOw54kb1v6LPc7r3rwVjO0rHngV+s
	x4fI/c8GR2JsVk9cNzSVq3+1b8UJiDKLH0uTowXmhEDpsw+wN8ZrN4VbqytGEDSlgYxy
	fWiRCypaI9UNnEHv5U6J4fZJN+lXhlREoFet8=
DomainKey-Signature: a=rsa-sha1; c=nofws; d=gmail.com; s=gamma;
	h=message-id:date:from:user-agent:mime-version:to:subject:references
	:in-reply-to:content-type:content-transfer-encoding;
	b=avS71dPypYgCaNUdWP/gesd9a5l4vbZSR/mOwAbIevigv3Yd3G2plnmXGKy6x0qwee
	mR8tFl0i6CkCMJhNkEhWZ4Q/eN11HtldrAvCtyiEoN+NvDn02BOwk9Fan/rZm5gz6b3A
	lf6Z/h6P8/TQztoI7kb/INwfW9dmXL8XJFI/w=
Received: by 10.204.20.65 with SMTP id e1mr5532375bkb.149.1300824014793;
	Tue, 22 Mar 2011 13:00:14 -0700 (PDT)
Received: from [192.168.1.60] (AMontsouris-755-1-12-27.w90-46.abo.wanadoo.fr
	[90.46.11.27])
	by mx.google.com with ESMTPS id z18sm5398407bkf.20.2011.03.22.13.00.11
	(version=SSLv3 cipher=OTHER); Tue, 22 Mar 2011 13:00:13 -0700 (PDT)
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US;
	rv:1.9.2.14) Gecko/20110223 Thunderbird/3.1.8
In-Reply-To: <4D863A58.8090706-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/1>

On 03/20/2011 06:33 PM, Vitor Sessak wrote:
> $subj

ping


From news@gmane.org Tue Mar 04 03:33:20 2003
From: Luca Barbato <lu_zero-aBrp7R+bbdUdnm+yROfE0A@public.gmane.org>
Subject: [PATCH] doc: update build system documentation
Date: Tue, 22 Mar 2011 21:17:04 +0100
Lines: 117
Message-ID: <1300825024-5373-1-git-send-email-lu_zero@gentoo.org>
References: <1300757510-6899-1-git-send-email-lu_zero@gentoo.org>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Tue Mar 22 21:17:10 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q280r-0002R2-Ro
	for gcvld-libav-devel@m.gmane.org; Tue, 22 Mar 2011 21:17:09 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id A5ECC3B160;
	Tue, 22 Mar 2011 21:17:09 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id C6FF73B160
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Tue, 22 Mar 2011 21:17:07 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id gXsekryzRBzk for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Tue, 22 Mar 2011 21:17:07 +0100 (CET)
Received: from mail.axantweb.com (mail.axantweb.com [81.31.150.140])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id A32753B157
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Tue, 22 Mar 2011 21:17:07 +0100 (CET)
Received: (qmail 20353 invoked by uid 210); 22 Mar 2011 20:16:46 -0000
Received: from dynamic-adsl-84-223-248-146.clienti.tiscali.it
	(luca.barbato-kwzOvpj7wpdWk0Htik3J/w@public.gmane.org@dynamic-adsl-84-223-248-146.clienti.tiscali.it)
	by mail.axantweb.com (envelope-from <lu_zero-aBrp7R+bbdUdnm+yROfE0A@public.gmane.org>,
	uid 201) with qmail-scanner-2.05st 
	(spamassassin: 3.2.1. perlscan: 2.05st.  
	Clear:RC:1(84.223.248.146):. 
	Processed in 0.048065 secs); 22 Mar 2011 20:16:46 -0000
Received: from dynamic-adsl-84-223-248-146.clienti.tiscali.it (HELO nyx)
	(luca.barbato-kwzOvpj7wpdWk0Htik3J/w@public.gmane.org@84.223.248.146)
	by mail.axantweb.com with ESMTPA; 22 Mar 2011 20:16:45 -0000
Received: by nyx (sSMTP sendmail emulation); Tue, 22 Mar 2011 21:17:05 +0100
X-Mailer: git-send-email 1.7.4.1
In-Reply-To: <1300757510-6899-1-git-send-email-lu_zero-aBrp7R+bbdUdnm+yROfE0A@public.gmane.org>
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/2>

Split normal build system documentation and the fate one.

Document THREADS make variable and provide an introduction to fate.
Document DESTDIR make variable and add some generic targets.
---
 doc/build_system.txt |   43 ++++++++++++++++++-------------------------
 doc/fate.txt         |   39 +++++++++++++++++++++++++++++++++++++++
 2 files changed, 57 insertions(+), 25 deletions(-)
 create mode 100644 doc/fate.txt

diff --git a/doc/build_system.txt b/doc/build_system.txt
index 5a59f35..c834c56 100644
--- a/doc/build_system.txt
+++ b/doc/build_system.txt
@@ -1,37 +1,30 @@
 Libav currently uses a custom build system, this text attempts to document
 some of its obscure features and options.
 
-Options to make:
-make V=1 <target>
-    Build target with verbosity 1, instead of 1, 2 can be used too
-make SAMPLES=<path to the fate samples> <target>
-    specify the path to the fate samples at make time
+Makefile variables:
 
+V
+    Disable the default terse mode, the full command issued by make and their
+    output will be shown on screen
 
-Useful standard make commands:
-make -t <target>
-    Touch all files that otherwise would be build, this is useful to reduce
-    unneeded rebuilding when changing headers, but note you must force rebuilds
-    of files that actually need it by hand then.
+DESTDIR
+    Destination directory for the install targets, useful to prepare packages
+    or install Libav in cross-environments.
 
-make -j<num>
-    rebuild with multiple jobs at the same time. Faster on multi processor systems
+Makefile targets:
 
-make -k
-    continue build in case of errors, this is useful for the regression tests
-    sometimes but note it will still not run all reg tests.
+all
+    Default target, builds all the libraries and the executables
 
+install
+    Install headers, libraries and programs
 
-Targets to make:
-fate-list
-    Will list all fate/regression test targets
+libavformat/output-example
+    Build the libavformat basic example
 
-fate
-    Run the fate test suite, note you must have installed it
+libavcodec/api-example
+    Build the libavcodec basic example
 
+libswscale/swscale-test
+    Build the swscale self-test (useful also as example)
 
-Setting up local fate:
-use the following command to get the fate test samples
-rsync -aL rsync://rsync.mplayerhq.hu:/samples/fate-suite/ fate/fate-suite
-pass --samples=<path to the samples> to configure or pass the path with the
-SAMPLES variable to make
diff --git a/doc/fate.txt b/doc/fate.txt
new file mode 100644
index 0000000..30807bb
--- /dev/null
+++ b/doc/fate.txt
@@ -0,0 +1,39 @@
+Fate Automated Testing Environment
+
+Fate provides a regression testsuite that can be run locally or configured
+to send reports to fate.libav.org.
+In order to run it needs a large amount of data (samples and references) that
+is provided separately from the actual source distribution.
+
+Use the following command to get the fate test samples
+rsync -aL rsync://rsync.mplayerhq.hu:/samples/fate-suite/ fate/fate-suite
+pass --samples=<path to the samples> to configure or pass the path with the
+SAMPLES variable to make.
+
+For information on how to set a reporting fate please refer to the following
+wiki page:
+http://wiki.multimedia.cx/index.php?title=FATE
+
+Fate Makefile targets:
+
+fate-list
+    Will list all fate/regression test targets
+
+fate
+    Run the fate test suite, note you must have installed it
+
+Fate Makefile variables:
+
+V
+    Verbosity level, can be set to 0, 1 or 2
+
+SAMPLES
+    Specify or override the path to the fate samples at make time, it has a
+    meaning only while running the regression tests.
+
+THREADS
+    Specify how many threads to use while running regression tests, it is
+    quite useful to detect thread-related regression.
+
+Example:
+    make V=1 SAMPLES=/var/fate/samples THREADS=2 fate
-- 
1.7.4.1


From news@gmane.org Tue Mar 04 03:33:20 2003
From: Benjamin Larsson <banan-LVe2Dp0Iy+4wFerOooGFRg@public.gmane.org>
Subject: Re: [PATCH] Fix an infinite loop when RoQ encoded
Date: Tue, 22 Mar 2011 21:34:12 +0100
Lines: 8
Message-ID: <4D8907C4.4010400@ludd.ltu.se>
References: <4D863A58.8090706@gmail.com>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Tue Mar 22 21:34:39 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q28Hm-0003pF-Re
	for gcvld-libav-devel@m.gmane.org; Tue, 22 Mar 2011 21:34:38 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 4CC5B3C09A;
	Tue, 22 Mar 2011 21:34:38 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 708E83C09A
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Tue, 22 Mar 2011 21:34:35 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id rohGvB+b7DgQ for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Tue, 22 Mar 2011 21:34:35 +0100 (CET)
Received: from smtp.bredband2.com (smtp.bredband2.com [83.219.192.166])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 501423C099
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Tue, 22 Mar 2011 21:34:35 +0100 (CET)
Received: from [192.168.1.12] (c-62-220-165-78.cust.bredband2.com
	[62.220.165.78]) (Authenticated sender: ed8153)
	by smtp.bredband2.com (Postfix) with ESMTPSA id A853FD7FD8
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Tue, 22 Mar 2011 21:34:34 +0100 (CET)
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US;
	rv:1.9.2.13) Gecko/20101208 Thunderbird/3.1.7
In-Reply-To: <4D863A58.8090706-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>
X-Enigmail-Version: 1.1.1
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/3>

On 03/20/2011 06:33 PM, Vitor Sessak wrote:
> $subj
> 

Patch ok.

MvH
Benjamin Larsson


From news@gmane.org Tue Mar 04 03:33:20 2003
From: Kieran Kunhya <kieran-D4uoQviSJUDQT0dZR+AlfA@public.gmane.org>
Subject: [PATCH] Add kbdwin.o to AC3 decoder.
Date: Tue, 22 Mar 2011 15:21:05 -0700 (PDT)
Lines: 51
Message-ID: <657172.81321.qm@web120712.mail.ne1.yahoo.com>
Reply-To: kieran-D4uoQviSJUDQT0dZR+AlfA@public.gmane.org, libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: multipart/mixed; boundary="0-1016150791-1300832465=:81321"
To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Tue Mar 22 23:21:16 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q29ww-0000UK-PW
	for gcvld-libav-devel@m.gmane.org; Tue, 22 Mar 2011 23:21:14 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 662BC3B11A;
	Tue, 22 Mar 2011 23:21:14 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 8AF713B11A
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Tue, 22 Mar 2011 23:21:11 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id fG0wk2s70KRF for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Tue, 22 Mar 2011 23:21:11 +0100 (CET)
Received: from nm11-vm0.bullet.mail.ne1.yahoo.com
	(nm11-vm0.bullet.mail.ne1.yahoo.com [98.138.90.58])
	by natsuki.mplayerhq.hu (Postfix) with SMTP id 085AC3B0E3
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Tue, 22 Mar 2011 23:21:06 +0100 (CET)
Received: from [98.138.90.53] by nm11.bullet.mail.ne1.yahoo.com with NNFMP;
	22 Mar 2011 22:21:05 -0000
Received: from [98.138.88.239] by tm6.bullet.mail.ne1.yahoo.com with NNFMP;
	22 Mar 2011 22:21:05 -0000
Received: from [127.0.0.1] by omp1039.mail.ne1.yahoo.com with NNFMP;
	22 Mar 2011 22:21:05 -0000
X-Yahoo-Newman-Property: ymail-3
X-Yahoo-Newman-Id: 740392.74348.bm-CQUmAfxd4CQNRsd/ldd0Fr9FW6kBwFPk0E9HWUfgJXw@public.gmane.org
Received: (qmail 88009 invoked by uid 60001); 22 Mar 2011 22:21:05 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.com; s=s1024;
	t=1300832465; bh=rSZcz5kArGs8XioyS+jwYCyZ4sAknogh1CyZgzhu27k=;
	h=Message-ID:X-YMail-OSG:Received:X-RocketYMMF:X-Mailer:Date:From:Reply-To:Subject:To:MIME-Version:Content-Type;
	b=51QxKy2QpqOe/mlPq5Tx3eIRQPjopHGTtNpYeCq52mFoMmCMT6kF40Jfm0xUiuYiXzxsv6N35dRALdhMUlj6lYlVdm0oKZC2iNKka2fr3a7zCz5rRlp+DKHIRAVeWjNW4iQl7/yT0IAaOrEM6idPKeYgzfaryYMVFGAQX9GtRh4=
X-YMail-OSG: pT7l4iwVM1lU713iO4ANznMktemk0bpaR8QzD7CjhA6b2Y3
	HcV29V6VBoQb4b06RnUB3Pw.rGZwiXh5HrLGQAqSC4oozIbbva1GHC1Mbrj5
	N5YJVjuz_j1oIhNaxYwx3XlXOnODqtkG.NbZHdkOH4sDCyXJFHgNMgNWL07R
	tPpyEWRbrG_5RJBZP27InLpsCNljICJ1W8CdFMO_8lrcwwGNBA4X4zTKeXR8
	V0F2cyIFC85EZGg5uzbmldolW7ybgsFQhUGozw53WvQWKfGo2cvsMzCx9269
	R9McJX.g8PJMNnP064nCWx24_ktj48316LziRhdV2BuoTIrRR90eGJ.nhTXn
	dnbX4Xva0FMCXU2zf
Received: from [78.105.80.74] by web120712.mail.ne1.yahoo.com via HTTP;
	Tue, 22 Mar 2011 15:21:05 PDT
X-RocketYMMF: bkunhya
X-Mailer: YahooMailClassic/11.4.20 YahooMailWebService/0.8.109.295617
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/4>

--0-1016150791-1300832465=:81321
Content-Type: text/plain; charset=utf-8
Content-Transfer-Encoding: quoted-printable

$subj

Fixes --disable-everything --enable-decoder=3Dac3
--0-1016150791-1300832465=:81321
Content-Type: text/x-patch; name="0001-Add-kbdwin.o-to-AC3-decoder.-Fixes-disable-everythin.patch"
Content-Transfer-Encoding: base64
Content-Disposition: attachment; filename="0001-Add-kbdwin.o-to-AC3-decoder.-Fixes-disable-everythin.patch"

RnJvbSBjOTVlNDFhZjYzMjgxYzQ3MTBjZmZhY2VkYWJmMWNjNmY1NDE2MmQ5
IE1vbiBTZXAgMTcgMDA6MDA6MDAgMjAwMQpGcm9tOiBLaWVyYW4gS3VuaHlh
IDxraWVyYW5Aa3VuaHlhLmNvbT4KRGF0ZTogVHVlLCAyMiBNYXIgMjAxMSAy
MjoxNzo0MSArMDAwMApTdWJqZWN0OiBbUEFUQ0hdIEFkZCBrYmR3aW4ubyB0
byBBQzMgZGVjb2Rlci4gRml4ZXMgLS1kaXNhYmxlLWV2ZXJ5dGhpbmcgLS1l
bmFibGUtZGVjb2Rlcj1hYzMKCi0tLQogbGliYXZjb2RlYy9NYWtlZmlsZSB8
ICAgIDIgKy0KIDEgZmlsZXMgY2hhbmdlZCwgMSBpbnNlcnRpb25zKCspLCAx
IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2xpYmF2Y29kZWMvTWFrZWZp
bGUgYi9saWJhdmNvZGVjL01ha2VmaWxlCmluZGV4IDA0ZTM1YTEuLjkxZGNk
YmUgMTAwNjQ0Ci0tLSBhL2xpYmF2Y29kZWMvTWFrZWZpbGUKKysrIGIvbGli
YXZjb2RlYy9NYWtlZmlsZQpAQCAtNTYsNyArNTYsNyBAQCBPQkpTLSQoQ09O
RklHX0FBQ19FTkNPREVSKSAgICAgICAgICAgICArPSBhYWNlbmMubyBhYWNj
b2Rlci5vICAgIFwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIHBzeW1vZGVsLm8gaWlyZmlsdGVyLm8gXAogICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXBlZzRhdWRpby5v
IGtiZHdpbi5vCiBPQkpTLSQoQ09ORklHX0FBU0NfREVDT0RFUikgICAgICAg
ICAgICArPSBhYXNjLm8gbXNybGVkZWMubwotT0JKUy0kKENPTkZJR19BQzNf
REVDT0RFUikgICAgICAgICAgICAgKz0gYWMzZGVjLm8gYWMzZGVjX2RhdGEu
byBhYzMubworT0JKUy0kKENPTkZJR19BQzNfREVDT0RFUikgICAgICAgICAg
ICAgKz0gYWMzZGVjLm8gYWMzZGVjX2RhdGEubyBhYzMubyBrYmR3aW4ubwog
T0JKUy0kKENPTkZJR19BQzNfRU5DT0RFUikgICAgICAgICAgICAgKz0gYWMz
ZW5jX2Zsb2F0Lm8gYWMzdGFiLm8gYWMzLm8ga2Jkd2luLm8KIE9CSlMtJChD
T05GSUdfQUMzX0ZJWEVEX0VOQ09ERVIpICAgICAgICs9IGFjM2VuY19maXhl
ZC5vIGFjM3RhYi5vIGFjMy5vCiBPQkpTLSQoQ09ORklHX0FMQUNfREVDT0RF
UikgICAgICAgICAgICArPSBhbGFjLm8KLS0gCjEuNy40Cgo=

--0-1016150791-1300832465=:81321
Content-Type: text/plain; charset="us-ascii"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
Content-Disposition: inline

_______________________________________________
libav-devel mailing list
libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
https://lists.libav.org/mailman/listinfo/libav-devel

--0-1016150791-1300832465=:81321--



From news@gmane.org Tue Mar 04 03:33:20 2003
From: Justin Ruggles <justin.ruggles-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>
Subject: Re: [PATCH] Add kbdwin.o to AC3 decoder.
Date: Tue, 22 Mar 2011 18:25:20 -0400
Lines: 8
Message-ID: <4D8921D0.9080807@gmail.com>
References: <657172.81321.qm@web120712.mail.ne1.yahoo.com>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Tue Mar 22 23:24:36 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2A0C-0002Wm-Ah
	for gcvld-libav-devel@m.gmane.org; Tue, 22 Mar 2011 23:24:36 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 1043C3C07F;
	Tue, 22 Mar 2011 23:24:36 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id A8E1B3C07F
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Tue, 22 Mar 2011 23:24:34 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id b8dp9jIdNVsg for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Tue, 22 Mar 2011 23:24:34 +0100 (CET)
Received: from mail-yi0-f54.google.com (mail-yi0-f54.google.com
	[209.85.218.54])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 482463C07E
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Tue, 22 Mar 2011 23:24:34 +0100 (CET)
Received: by yie12 with SMTP id 12so4326815yie.27
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Tue, 22 Mar 2011 15:24:33 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=gamma;
	h=domainkey-signature:message-id:date:from:user-agent:mime-version:to
	:subject:references:in-reply-to:x-enigmail-version:content-type
	:content-transfer-encoding;
	bh=rGIJ79B5w6zoEEAy4tLRTABV6+4GwyqLh4oE10GzzO8=;
	b=ufehfs/Izjj48AeqS09HqPp8LR26OMd8Ev+d1YXbLAxH7ilDj1woc8QdSAp65WNFlw
	Vq+5vKdMUzyVqlvo5BiGglKQ2ZaBC5JAdVkJJphHQywfSTF8XRSTU4upjTxaHNNy8dIW
	TxjIeIhjTtBXGESnm8TR2UNAK+8dM+pdXaVlA=
DomainKey-Signature: a=rsa-sha1; c=nofws; d=gmail.com; s=gamma;
	h=message-id:date:from:user-agent:mime-version:to:subject:references
	:in-reply-to:x-enigmail-version:content-type
	:content-transfer-encoding;
	b=QpjTzxb071rAo2fRsj3VoiaVCzxoHpPnW/1PjmhuTGwRrb8hZzpOI5fjJ++UC063Xm
	afyalh1HCXgd3cBza5cVT58B7hZSiEy2zVyZXPvJ536iX1v/6Af7J8IroOHRGkoCzECr
	cKxJhbGQdgBtX1KkPLu+tg5eIGwMk5yRyCBPg=
Received: by 10.236.79.6 with SMTP id h6mr7914080yhe.322.1300832673061;
	Tue, 22 Mar 2011 15:24:33 -0700 (PDT)
Received: from [192.168.1.3] (cpe-098-026-033-204.nc.res.rr.com [98.26.33.204])
	by mx.google.com with ESMTPS id p31sm1970008yhm.93.2011.03.22.15.24.32
	(version=TLSv1/SSLv3 cipher=OTHER);
	Tue, 22 Mar 2011 15:24:32 -0700 (PDT)
User-Agent: Mozilla/5.0 (X11; U; Linux x86_64; en-US;
	rv:1.9.2.14) Gecko/20110223 Thunderbird/3.1.8
In-Reply-To: <657172.81321.qm-r4oNW0mRqZ62Y7dhQGSVAJOW+3bF1jUfVpNB7YpNyf8@public.gmane.org>
X-Enigmail-Version: 1.1.2
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/5>

On 03/22/2011 06:21 PM, Kieran Kunhya wrote:

> $subj
> 
> Fixes --disable-everything --enable-decoder=ac3


queued.


From news@gmane.org Tue Mar 04 03:33:20 2003
From: =?iso-8859-1?Q?M=E5ns_Rullg=E5rd?= <mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org>
Subject: Re: [PATCH] Add kbdwin.o to AC3 decoder.
Date: Tue, 22 Mar 2011 22:25:01 +0000
Lines: 22
Message-ID: <yw1xaagmu72a.fsf@unicorn.mansr.com>
References: <657172.81321.qm@web120712.mail.ne1.yahoo.com>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
Cc: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
To: kieran-D4uoQviSJUDQT0dZR+AlfA@public.gmane.org
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Tue Mar 22 23:25:03 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2A0d-0002kU-Nu
	for gcvld-libav-devel@m.gmane.org; Tue, 22 Mar 2011 23:25:03 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 850673C08B;
	Tue, 22 Mar 2011 23:25:03 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id AADC43C087
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Tue, 22 Mar 2011 23:25:01 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id 1tFi1Y6uTkO3 for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Tue, 22 Mar 2011 23:25:01 +0100 (CET)
Received: from unicorn.mansr.com (unicorn.mansr.com [78.86.181.103])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 82B4B3C07E
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Tue, 22 Mar 2011 23:25:01 +0100 (CET)
Received: by unicorn.mansr.com (Postfix, from userid 51770)
	id 18CFD1713A; Tue, 22 Mar 2011 22:25:01 +0000 (GMT)
In-Reply-To: <657172.81321.qm-r4oNW0mRqZ62Y7dhQGSVAJOW+3bF1jUfVpNB7YpNyf8@public.gmane.org> (Kieran Kunhya's
	message of "Tue, 22 Mar 2011 15:21:05 -0700 (PDT)")
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/23.2 (gnu/linux)
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/6>

Kieran Kunhya <kieran-D4uoQviSJUDQT0dZR+AlfA@public.gmane.org> writes:

> $subj
>
> Fixes --disable-everything --enable-decoder=3Dac3
>
> From c95e41af63281c4710cffacedabf1cc6f54162d9 Mon Sep 17 00:00:00 2001
> From: Kieran Kunhya <kieran-D4uoQviSJUDQT0dZR+AlfA@public.gmane.org>
> Date: Tue, 22 Mar 2011 22:17:41 +0000
> Subject: [PATCH] Add kbdwin.o to AC3 decoder. Fixes --disable-everything =
--enable-decoder=3Dac3
>
> ---
>  libavcodec/Makefile |    2 +-
>  1 files changed, 1 insertions(+), 1 deletions(-)

Thanks, queued.

-- =

M=E5ns Rullg=E5rd
mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org


From news@gmane.org Tue Mar 04 03:33:20 2003
From: "Ronald S. Bultje" <rsbultje-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>
Subject: Re: [PATCH] Fix an infinite loop when RoQ encoded
Date: Tue, 22 Mar 2011 18:31:10 -0400
Lines: 11
Message-ID: <AANLkTinR4GBC5-n9j-OsC2F0S7Uthwi2AbYgzuE9S_Rc@mail.gmail.com>
References: <4D863A58.8090706@gmail.com>
	<4D8907C4.4010400@ludd.ltu.se>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Tue Mar 22 23:31:14 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2A6c-0005sW-P7
	for gcvld-libav-devel@m.gmane.org; Tue, 22 Mar 2011 23:31:14 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 912A13B11C;
	Tue, 22 Mar 2011 23:31:14 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id EB2ED3B111
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Tue, 22 Mar 2011 23:31:12 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id raHIcglqg6vk for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Tue, 22 Mar 2011 23:31:12 +0100 (CET)
Received: from mail-iy0-f182.google.com (mail-iy0-f182.google.com
	[209.85.210.182])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 948413B10E
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Tue, 22 Mar 2011 23:31:12 +0100 (CET)
Received: by iyj12 with SMTP id 12so12841935iyj.27
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Tue, 22 Mar 2011 15:31:11 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=gamma;
	h=domainkey-signature:mime-version:in-reply-to:references:date
	:message-id:subject:from:to:cc:content-type;
	bh=wZtre4j/JhLkunb7HDSNmO3LEdSSLDlA1PyPwB0G/Pk=;
	b=oZIDtTeoR2dArjlxtC9uULx73HsnZwn62r6Ns+129zUTWwF/LDh27OEihHwG/ZwmNC
	UR+eNa59q65j+u4kJ/jWgKKWUDsIdp6y9Kx/REmJPojb7ps4Uj9mPLxXHc9J4huonWl3
	omBLoRP5jhJWDbE7bgwjmhL3Fepf/iI4Mdfmc=
DomainKey-Signature: a=rsa-sha1; c=nofws; d=gmail.com; s=gamma;
	h=mime-version:in-reply-to:references:date:message-id:subject:from:to
	:cc:content-type;
	b=N5XZ+dx5pv0mGVl7YTKXdr7XUOdpjtfzYn5f14WQ2X1FnWI3vBwuoJlrRq+VRX+7J7
	PVl/qay+WN8HAQrRirPJxGB5IYtLRcjRwjmFROU2oVOTm11OGbLaIYg1ZEMHIFqlWHEb
	FhROLMFOl9Rb4eSdiYTsT3xPgTw13T271dibk=
Received: by 10.43.65.146 with SMTP id xm18mr460483icb.356.1300833070926; Tue,
	22 Mar 2011 15:31:10 -0700 (PDT)
Received: by 10.42.75.133 with HTTP; Tue, 22 Mar 2011 15:31:10 -0700 (PDT)
In-Reply-To: <4D8907C4.4010400-LVe2Dp0Iy+4wFerOooGFRg@public.gmane.org>
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/7>

Hi,

On Tue, Mar 22, 2011 at 4:34 PM, Benjamin Larsson <banan-LVe2Dp0Iy+4wFerOooGFRg@public.gmane.org> wrote:
> On 03/20/2011 06:33 PM, Vitor Sessak wrote:
>> $subj
>
> Patch ok.

Pushed, sorry for the slight delay, Vitor.

Ronald


From news@gmane.org Tue Mar 04 03:33:20 2003
From: Justin Ruggles <justin.ruggles-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>
Subject: Re: [PATCH] Add kbdwin.o to AC3 decoder.
Date: Tue, 22 Mar 2011 18:32:57 -0400
Lines: 28
Message-ID: <4D892399.6020704@gmail.com>
References: <657172.81321.qm@web120712.mail.ne1.yahoo.com>
	<yw1xaagmu72a.fsf@unicorn.mansr.com>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Tue Mar 22 23:32:13 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2A7Z-0006NI-2L
	for gcvld-libav-devel@m.gmane.org; Tue, 22 Mar 2011 23:32:13 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id DBE8E3B11B;
	Tue, 22 Mar 2011 23:32:12 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id F08E63B11B
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Tue, 22 Mar 2011 23:32:10 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id Nrm0H1xNXGaM for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Tue, 22 Mar 2011 23:32:10 +0100 (CET)
Received: from mail-gw0-f54.google.com (mail-gw0-f54.google.com [74.125.83.54])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id A191C3B118
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Tue, 22 Mar 2011 23:32:10 +0100 (CET)
Received: by gwb15 with SMTP id 15so4317740gwb.27
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Tue, 22 Mar 2011 15:32:09 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=gamma;
	h=domainkey-signature:message-id:date:from:user-agent:mime-version:to
	:subject:references:in-reply-to:x-enigmail-version:content-type
	:content-transfer-encoding;
	bh=63j3esR83NCc0eqRiacGqXCb0Moe4MdzPVaOGn7Mj6I=;
	b=JfolK32k5Z8S8XO+egCGpMWGpMUmRmoZXDv/bg3UZOzfXI1eSLjy/V47m6K6mPO+du
	5Ii3gm4Ougrrr6aZJapDyhzx4nuGjZTeA9Y6SqmPKZPcH8dwk7JSpRGUIDywtzZWm9CV
	kkSsRhDBphiRC/gI3wCgTZR8xlvck1ZWETDyM=
DomainKey-Signature: a=rsa-sha1; c=nofws; d=gmail.com; s=gamma;
	h=message-id:date:from:user-agent:mime-version:to:subject:references
	:in-reply-to:x-enigmail-version:content-type
	:content-transfer-encoding;
	b=PTZLfaHZWnqmOMF6fMUm42lfpsTzaWKZzOOSGSplNrNk1fe7sdQuC5uxoXSX4heMSb
	YwbuQdZCT+maL/W9CTzyvH5j9UtsrhUwXf6/r+OLS5Sg5C9cr6EcEd8CfZighjAFMjRP
	eZvPbRhdRtX0uXVZkqJDupindpvhf0GJBG/ZA=
Received: by 10.236.191.10 with SMTP id f10mr7863738yhn.180.1300833129609;
	Tue, 22 Mar 2011 15:32:09 -0700 (PDT)
Received: from [192.168.1.3] (cpe-098-026-033-204.nc.res.rr.com [98.26.33.204])
	by mx.google.com with ESMTPS id h44sm237190yhm.63.2011.03.22.15.32.08
	(version=TLSv1/SSLv3 cipher=OTHER);
	Tue, 22 Mar 2011 15:32:09 -0700 (PDT)
User-Agent: Mozilla/5.0 (X11; U; Linux x86_64; en-US;
	rv:1.9.2.14) Gecko/20110223 Thunderbird/3.1.8
In-Reply-To: <yw1xaagmu72a.fsf-OEaqT8BN2ezZK2NkWkPsZwC/G2K4zDHf@public.gmane.org>
X-Enigmail-Version: 1.1.2
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/8>

On 03/22/2011 06:25 PM, M=E5ns Rullg=E5rd wrote:

> Kieran Kunhya <kieran-D4uoQviSJUDQT0dZR+AlfA@public.gmane.org> writes:
> =

>> $subj
>>
>> Fixes --disable-everything --enable-decoder=3Dac3
>>
>> From c95e41af63281c4710cffacedabf1cc6f54162d9 Mon Sep 17 00:00:00 2001
>> From: Kieran Kunhya <kieran-D4uoQviSJUDQT0dZR+AlfA@public.gmane.org>
>> Date: Tue, 22 Mar 2011 22:17:41 +0000
>> Subject: [PATCH] Add kbdwin.o to AC3 decoder. Fixes --disable-everything=
 --enable-decoder=3Dac3
>>
>> ---
>>  libavcodec/Makefile |    2 +-
>>  1 files changed, 1 insertions(+), 1 deletions(-)
> =

> Thanks, queued.


you beat me to it

unqueued...

-Justin


From news@gmane.org Tue Mar 04 03:33:20 2003
From: Loren Merritt <lorenm@u.washington.edu>
Subject: Re: [PATCH] Add apply_window_int16() to DSPContext
 with x86-optimized versions and use it in the ac3_fixed encoder.
Date: Wed, 23 Mar 2011 00:00:58 +0000 (UTC)
Lines: 21
Message-ID: <Pine.LNX.4.64.1103222359370.1861@akuvian.org>
References: <Pine.LNX.4.64.1103221051370.1861@akuvian.org>
	<1300810681-31402-1-git-send-email-justin.ruggles@gmail.com>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"; Format="flowed"
Content-Transfer-Encoding: 7bit
To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 01:01:04 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2BVW-00007t-IE
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 01:01:02 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 1DD1D3C081;
	Wed, 23 Mar 2011 01:01:02 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 772BC3C081
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 01:01:00 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id 7okD3NopQ7n7 for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 01:01:00 +0100 (CET)
Received: from akuvian.org (akuvian.org [72.14.178.63])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 443253C07E
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 01:01:00 +0100 (CET)
Received: by akuvian.org (Postfix, from userid 1000)
	id AB0755D1E; Wed, 23 Mar 2011 00:00:58 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
	by akuvian.org (Postfix) with ESMTP id A8B1B49E1
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 00:00:58 +0000 (UTC)
X-X-Sender: loren-OOFs7hxk4OlAfugRpC6u6w@public.gmane.org
In-Reply-To: <1300810681-31402-1-git-send-email-justin.ruggles-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/9>

On Tue, 22 Mar 2011, Justin Ruggles wrote:

> ---
> Includes changes based on Loren's patch and updated to use AV_CPU_FLAG_ATOM.
>
> libavcodec/ac3enc.c             |    2 +-
> libavcodec/ac3enc_fixed.c       |   10 +---
> libavcodec/ac3enc_float.c       |    4 +-
> libavcodec/ac3tab.c             |    2 +-
> libavcodec/dsputil.c            |   14 ++++
> libavcodec/dsputil.h            |   14 ++++
> libavcodec/x86/dsputil_mmx.c    |   40 ++++++++++++-
> libavcodec/x86/dsputil_yasm.asm |  126 +++++++++++++++++++++++++++++++++++++++
> tests/ref/acodec/ac3_fixed      |    2 +-
> tests/ref/lavf/rm               |    2 +-
> tests/ref/seek/ac3_rm           |   30 +++------
> 11 files changed, 210 insertions(+), 36 deletions(-)

x86 part ok.

--Loren Merritt


From news@gmane.org Tue Mar 04 03:33:20 2003
From: Luca Barbato <lu_zero-aBrp7R+bbdUdnm+yROfE0A@public.gmane.org>
Subject: Re: [PATCH 1/3] fate: add support for multithread
	testing
Date: Wed, 23 Mar 2011 01:19:35 +0100
Lines: 20
Message-ID: <4D893C97.7070202@gentoo.org>
References: <1300749861-31049-1-git-send-email-lu_zero@gentoo.org>
	<yw1x1v20xcnz.fsf@unicorn.mansr.com>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 01:19:47 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2Bne-0008Uc-6Q
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 01:19:46 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id EE9833B154;
	Wed, 23 Mar 2011 01:19:45 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id BF2D13B154
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 01:19:43 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id MlzgllT0CelO for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 01:19:43 +0100 (CET)
Received: from smtp.gentoo.org (smtp.gentoo.org [140.211.166.183])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 744BC3B14F
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 01:19:43 +0100 (CET)
Received: from [192.168.1.116] (dynamic-adsl-84-223-248-146.clienti.tiscali.it
	[84.223.248.146])
	(using TLSv1 with cipher DHE-RSA-CAMELLIA256-SHA (256/256 bits))
	(No client certificate requested) (Authenticated sender: lu_zero)
	by smtp.gentoo.org (Postfix) with ESMTPSA id B1C7F1B408D
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 00:19:39 +0000 (UTC)
User-Agent: Mozilla/5.0 (X11; Linux x86_64;
	rv:2.0b10pre) Gecko/20110314 Thunderbird/3.3a2
In-Reply-To: <yw1x1v20xcnz.fsf-OEaqT8BN2ezZK2NkWkPsZwC/G2K4zDHf@public.gmane.org>
X-Enigmail-Version: 1.2a1pre
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/10>

T24gMDMvMjIvMjAxMSAxMjo0MyBBTSwgTcOlbnMgUnVsbGfDpXJkIHdyb3RlOgo+IEx1Y2EgQmFy
YmF0byA8bHVfemVyb0BnZW50b28ub3JnPiB3cml0ZXM6Cj4gCj4+IEFkZCBhIFRIUkVBRFMgdmFy
aWFibGUgdG8gZmF0ZSBjYWxscy4KPj4gLS0tCj4+ICBNYWtlZmlsZSAgICAgICAgICAgICAgICAg
IHwgICAgMiArLQo+PiAgdGVzdHMvZmF0ZS1ydW4uc2ggICAgICAgICB8ICAgIDUgKysrLS0KPj4g
IHRlc3RzL3JlZ3Jlc3Npb24tZnVuY3Muc2ggfCAgICAzICsrLQo+PiAgMyBmaWxlcyBjaGFuZ2Vk
LCA2IGluc2VydGlvbnMoKyksIDQgZGVsZXRpb25zKC0pCj4+Cj4gCj4gWy4uLl0KPiAKPj4gZGlm
ZiAtLWdpdCBhL3Rlc3RzL3JlZ3Jlc3Npb24tZnVuY3Muc2ggYi90ZXN0cy9yZWdyZXNzaW9uLWZ1
bmNzLnNoCj4+IGluZGV4IDNjYTNjOWMuLjhhOTgwMGMgMTAwNzU1Cj4+IC0tLSBhL3Rlc3RzL3Jl
Z3Jlc3Npb24tZnVuY3Muc2gKPj4gKysrIGIvdGVzdHMvcmVncmVzc2lvbi1mdW5jcy5zaAo+PiBA
QCAtOSw2ICs5LDcgQEAgdGVzdF9yZWY9JDIKPj4gIHJhd19zcmNfZGlyPSQzCj4+ICB0YXJnZXRf
ZXhlYz0kNAo+PiAgdGFyZ2V0X3BhdGg9JDUKPj4gK3RocmVhZHM9JDYKPiAKPiB0aHJlYWRzPSR7
NjotMX0KPiAKPiBUaGlzIGlzbid0IGFsd2F5cyBjYWxsZWQgdGhyb3VnaCBmYXRlLXJ1bi5zaC4g
IEEgY2xlYW4gcnVuIChhZnRlcgo+IG1ha2UgdGVzdGNsZWFuKSBzaG91bGQgc2hvdyB0aGUgcHJv
YmxlbS4KPiAKPiBPSyBvdGhlcndpc2UuCj4gCgoxIGFuZCAyIHB1c2hlZCwgZG9jdW1lbnRhdGlv
biBwZW5kaW5nIGlucHV0CgpsdQoKLS0gCgpMdWNhIEJhcmJhdG8KR2VudG9vL2xpbnV4Cmh0dHA6
Ly9kZXYuZ2VudG9vLm9yZy9+bHVfemVybwoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX18KbGliYXYtZGV2ZWwgbWFpbGluZyBsaXN0CmxpYmF2LWRldmVsQGxp
YmF2Lm9yZwpodHRwczovL2xpc3RzLmxpYmF2Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL2xpYmF2LWRl
dmVsCg==



From news@gmane.org Tue Mar 04 03:33:20 2003
From: Luca Barbato <lu_zero-aBrp7R+bbdUdnm+yROfE0A@public.gmane.org>
Subject: Re: [PATCH] configure: Set the correct lib target for
 arm/wince dlltool
Date: Wed, 23 Mar 2011 01:23:04 +0100
Lines: 39
Message-ID: <4D893D68.7060705@gentoo.org>
References: <1300798147-45262-1-git-send-email-martin@martin.st>
	<yw1xtyevuxlp.fsf@unicorn.mansr.com>
	<alpine.DEB.2.00.1103221454130.3794@cone.home.martin.st>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 01:23:14 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2Bqz-0001Z8-UM
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 01:23:14 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id ADE7C3B183;
	Wed, 23 Mar 2011 01:23:13 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 276923B183
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 01:23:12 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id G-BBqPsBp-oJ for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 01:23:12 +0100 (CET)
Received: from smtp.gentoo.org (smtp.gentoo.org [140.211.166.183])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id D20933B175
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 01:23:11 +0100 (CET)
Received: from [192.168.1.116] (dynamic-adsl-84-223-248-146.clienti.tiscali.it
	[84.223.248.146])
	(using TLSv1 with cipher DHE-RSA-CAMELLIA256-SHA (256/256 bits))
	(No client certificate requested) (Authenticated sender: lu_zero)
	by smtp.gentoo.org (Postfix) with ESMTPSA id 40FBA1B4083
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 00:23:08 +0000 (UTC)
User-Agent: Mozilla/5.0 (X11; Linux x86_64;
	rv:2.0b10pre) Gecko/20110314 Thunderbird/3.3a2
In-Reply-To: <alpine.DEB.2.00.1103221454130.3794-bySdwzmfsd4wFlGVRAW2/FdQdH8mP9S6@public.gmane.org>
X-Enigmail-Version: 1.2a1pre
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/11>

T24gMDMvMjIvMjAxMSAwMjowNiBQTSwgTWFydGluIFN0b3JzasO2IHdyb3RlOgo+IE9uIFR1ZSwg
MjIgTWFyIDIwMTEsIE3DpW5zIFJ1bGxnw6VyZCB3cm90ZToKPiAKPj4gTWFydGluIFN0b3JzasO2
IDxtYXJ0aW5AbWFydGluLnN0PiB3cml0ZXM6Cj4+Cj4+PiBXaGVuIGxpbmtpbmcgdG8gdGhlIC5s
aWIgZmlsZXMgY3JlYXRlZCBieSBkbGx0b29sIGZvciB3aW5jZSwKPj4+IHRoZSBsaW5rZXIgb3B0
aW1pemF0aW9uIG9wdGlvbiBzaG91bGQgYmUgc2V0IHRvCj4+PiAiUmVmZXJlbmNlczogS2VlcCBV
bnJlZmVyZW5jZWQgRGF0YSAoL09QVDpOT1JFRikiLCBvdGhlcndpc2UKPj4+IHRoZSByZXN1bHRp
bmcgYmluYXJpZXMgd2lsbCBmYWlsIGR1cmluZyBydW50aW1lLiBUaGlzIHdhc24ndAo+Pj4gcmVx
dWlyZWQgd2hlbiB1c2luZyAubGliIGZpbGVzIGdlbmVyYXRlZCBieSBsaWIuZXhlLgo+Pj4gLS0t
Cj4+PiAgY29uZmlndXJlIHwgICAgMiArLQo+Pj4gIDEgZmlsZXMgY2hhbmdlZCwgMSBpbnNlcnRp
b25zKCspLCAxIGRlbGV0aW9ucygtKQo+Pj4KPj4+IGRpZmYgLS1naXQgYS9jb25maWd1cmUgYi9j
b25maWd1cmUKPj4+IGluZGV4IGUzOGYyMGIuLjZhZTVlYmMgMTAwNzU1Cj4+PiAtLS0gYS9jb25m
aWd1cmUKPj4+ICsrKyBiL2NvbmZpZ3VyZQo+Pj4gQEAgLTI0MDcsNyArMjQwNyw3IEBAIGNhc2Ug
JHRhcmdldF9vcyBpbgo+Pj4gICAgICAgICAgICAgIGVuYWJsZSBtYWxsb2NfYWxpZ25lZAo+Pj4g
ICAgICAgICAgICAgIExJQlRBUkdFVD0iaTM4Njp4ODYtNjQiCj4+PiAgICAgICAgICBlbGlmIGVu
YWJsZWQgYXJtOyB0aGVuCj4+PiAtICAgICAgICAgICAgTElCVEFSR0VUPWFybQo+Pj4gKyAgICAg
ICAgICAgIExJQlRBUkdFVD1hcm0td2luY2UKPj4+ICAgICAgICAgIGZpCj4+PiAgICAgICAgICBz
aGxpYmRpcl9kZWZhdWx0PSIkYmluZGlyX2RlZmF1bHQiCj4+PiAgICAgICAgICBkaXNhYmxlIGZm
c2VydmVyCj4+Cj4+IEkgZG9uJ3Qgc2VlIHRoZSBjb25uZWN0aW9uIGJldHdlZW4gdGhlIGRlc2Ny
aXB0aW9uIGFuZCB0aGUgcGF0Y2guCj4gCj4gV2hlbiB1c2luZyBkbGx0b29sIGluc3RlYWQgb2Yg
bGliLmV4ZSBmb3IgY3JlYXRpbmcgTVNWQyBpbXBvcnQgbGlicmFyaWVzLCAKPiB0aGUgYXJjaGl0
ZWN0dXJlIG5hbWVzIGFjY2VwdGVkIGJ5IHRoZSB0b29sIGNoYW5nZWQsIHNvIHdoYXQgd2FzICJh
cm0iIAo+IG5lZWRzIHRvIGJlIGNoYW5nZWQgaW50byAiYXJtLXdpbmNlIiwganVzdCBhcyB4NjQg
d2FzIGNoYW5nZWQgdG8gCj4gaTM4Njp4ODYtNjQgYSBmZXcgY29tbWl0cyBlYXJsaWVyLgo+IAo+
IFRoZSByZXN0IG9mIHRoZSBjb21taXQgZGVzY3JpcHRpb24gaXMgYSBub3RlIHRvIGFueW9uZSB1
c2luZyB0aGVzZSBpbXBvcnQgCj4gbGlicmFyaWVzLCBzYXlpbmcgd2hhdCB0aGUgdXNlciBvZiB0
aGUgaW1wb3J0IGxpYnJhcmllcyBoYXMgdG8gY2hhbmdlIGluIAo+IGhpcyBNU1ZDIGVudmlyb25t
ZW50IGluIG9yZGVyIHRvIHVzZSB0aGVtLCBzaW5jZSB0aGV5IGFyZW4ndCBhIHRvdGFsIAo+IGRy
b3AtaW4gcmVwbGFjZW1lbnQgZm9yIHdoYXQuIFRoYXQgY29tbWVudCBpcyBnZW5lcmFsIHRvIHRo
ZSB0aGUgd2hvbGUgCj4gbGliLmV4ZSAtPiBkbGx0b29sIHN3aXRjaCB0aG91Z2ggKGl0IGluaXRp
YWxseSBzZWVtZWQgdG8gYmUgbmVlZGVkIG9ubHkgb24gCj4gYXJtLCBidXQgSSBoYWRuJ3QgdGVz
dGVkIHRoZSBkZXNrdG9wIHdpbmRvd3MgdmFyaWFudCBmdWxseSwgaXQgaXMgbmVlZGVkIAo+IHRo
ZXJlLCB0b28pLgo+IAo+IFNpbmNlIGl0IGFwcGVhcnMgdG8gYmUgYSBnZW5lcmFsIGlzc3VlIHRo
b3VnaCBub3QgbGltaXRlZCB0byB3aW5jZSwgSSdsbCAKPiBtb3ZlIGl0IHRvIHRoZSBkb2NzLiBO
ZXcgcGF0Y2hlcyBjb21pbmcgdXAuCgpCb3RoIHF1ZXVlZCwgd2lsbCBiZSBwdXNoZWQgd2l0aGlu
IHRoZSBkYXkuCgpsdQoKCi0tIAoKTHVjYSBCYXJiYXRvCkdlbnRvby9saW51eApodHRwOi8vZGV2
LmdlbnRvby5vcmcvfmx1X3plcm8KCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fCmxpYmF2LWRldmVsIG1haWxpbmcgbGlzdApsaWJhdi1kZXZlbEBsaWJhdi5v
cmcKaHR0cHM6Ly9saXN0cy5saWJhdi5vcmcvbWFpbG1hbi9saXN0aW5mby9saWJhdi1kZXZlbAo=



From news@gmane.org Tue Mar 04 03:33:20 2003
From: Brad <brad-BUbV6I797GxWk0Htik3J/w@public.gmane.org>
Subject: Re: [PATCH] Add support for sndio to libavdevice
Date: Tue, 22 Mar 2011 20:24:44 -0400
Lines: 558
Message-ID: <20110323002443.GA3649@rox.home.comstyle.com>
References: <20110321021443.GA10122@rox.home.comstyle.com>
	<20110321082030.0dfa2883@bfouet-dev1.eng.vmware.com>
	<20110322011328.GA15626@rox.home.comstyle.com>
	<AANLkTin_guqntW2=D=qODfi8D8VeoPA0rzcgdEq80m8g@mail.gmail.com>
	<20110322020934.GA8887@rox.home.comstyle.com>
	<4D885571.60304@free.fr>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 01:26:41 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2BuL-0002xs-Fp
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 01:26:41 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 4A1BB3B1AA;
	Wed, 23 Mar 2011 01:26:41 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 2721D3B1AA
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 01:26:38 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id gozaLWl7f+Jf for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 01:26:38 +0100 (CET)
Received: from mail.comstyle.com (speedy.comstyle.com [206.51.28.2])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 9ABB63B1A9
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 01:26:37 +0100 (CET)
Received: from rox.home.comstyle.com (rox.home.comstyle.com
	[IPv6:2001:470:b01e:3:ca0a:a9ff:fe93:42c9])
	(using TLSv1 with cipher ECDHE-RSA-AES256-SHA (256/256 bits))
	(No client certificate requested) (Authenticated sender: brad)
	by mail.comstyle.com (Postfix) with ESMTPSA id 37C7498479
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Tue, 22 Mar 2011 20:24:46 -0400 (EDT)
Content-Disposition: inline
In-Reply-To: <4D885571.60304-GANU6spQydw@public.gmane.org>
User-Agent: Mutt/1.5.21 (2010-09-15)
X-comstyle-MailScanner-Information: Please contact the ISP for more information
X-comstyle-MailScanner-ID: 37C7498479.A4F96
X-comstyle-MailScanner: Found to be clean
X-comstyle-MailScanner-SpamCheck: not spam (whitelisted),
	SpamAssassin (not cached, score=-2.9, required 6, autolearn=not spam,
	ALL_TRUSTED -1.00, BAYES_00 -1.90)
X-comstyle-MailScanner-From: brad-BUbV6I797GxWk0Htik3J/w@public.gmane.org
X-Spam-Status: No
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/12>

On Tue, Mar 22, 2011 at 08:53:21AM +0100, Benoit Fouet wrote:
> The usage is wrong, it should be av_freep(&s->buffer)
> No other remarks from me.

Updated diff.


>From 48f569b1091f26b5e9e83886771016faa7a6b0c3 Mon Sep 17 00:00:00 2001
From: Brad Smith <brad-BUbV6I797GxWk0Htik3J/w@public.gmane.org>
Date: Tue, 22 Mar 2011 20:21:35 -0400
Subject: [PATCH] sndio support for playback and record

---
 Changelog                  |    1 +
 configure                  |    6 ++
 doc/indevs.texi            |   17 +++++++
 doc/outdevs.texi           |    4 ++
 libavdevice/Makefile       |    3 +
 libavdevice/alldevices.c   |    1 +
 libavdevice/avdevice.h     |    4 +-
 libavdevice/sndio_common.c |  114 ++++++++++++++++++++++++++++++++++++++++++++
 libavdevice/sndio_common.h |   45 +++++++++++++++++
 libavdevice/sndio_dec.c    |  106 ++++++++++++++++++++++++++++++++++++++++
 libavdevice/sndio_enc.c    |   95 ++++++++++++++++++++++++++++++++++++
 11 files changed, 394 insertions(+), 2 deletions(-)
 create mode 100644 libavdevice/sndio_common.c
 create mode 100644 libavdevice/sndio_common.h
 create mode 100644 libavdevice/sndio_dec.c
 create mode 100644 libavdevice/sndio_enc.c

diff --git a/Changelog b/Changelog
index 4a7fd6f..f417d7c 100644
--- a/Changelog
+++ b/Changelog
@@ -79,6 +79,7 @@ version <next>:
 - Bink version 'b' audio and video decoder
 - Bitmap Brothers JV playback system
 - Apple HTTP Live Streaming protocol handler
+- sndio support for playback and record
 
 
 version 0.6:
diff --git a/configure b/configure
index 19b9f98..6453295 100755
--- a/configure
+++ b/configure
@@ -1096,6 +1096,7 @@ HAVE_LIST="
     setmode
     socklen_t
     soundcard_h
+    sndio_h
     poll_h
     setrlimit
     strerror_r
@@ -1433,6 +1434,8 @@ jack_indev_deps="jack_jack_h"
 libdc1394_indev_deps="libdc1394"
 oss_indev_deps_any="soundcard_h sys_soundcard_h"
 oss_outdev_deps_any="soundcard_h sys_soundcard_h"
+sndio_indev_deps="sndio_h"
+sndio_outdev_deps="sndio_h"
 v4l_indev_deps="linux_videodev_h"
 v4l2_indev_deps_any="linux_videodev2_h sys_videoio_h"
 vfwcap_indev_deps="capCreateCaptureWindow vfwcap_defines"
@@ -2914,11 +2917,14 @@ check_header dev/ic/bt8xx.h
 
 check_header sys/soundcard.h
 check_header soundcard.h
+check_header sndio.h
 
 enabled_any alsa_indev alsa_outdev && check_lib2 alsa/asoundlib.h snd_pcm_htimestamp -lasound
 
 enabled jack_indev && check_lib2 jack/jack.h jack_client_open -ljack
 
+enabled_any sndio_indev sndio_outdev && check_lib2 sndio.h sio_open -lsndio
+
 enabled x11grab                         &&
 check_header X11/Xlib.h                 &&
 check_header X11/extensions/XShm.h      &&
diff --git a/doc/indevs.texi b/doc/indevs.texi
index 6533284..2d66033 100644
--- a/doc/indevs.texi
+++ b/doc/indevs.texi
@@ -129,6 +129,23 @@ ffmpeg -f oss -i /dev/dsp /tmp/oss.wav
 For more information about OSS see:
 @url{http://manuals.opensound.com/usersguide/dsp.html}
 
+@section sndio
+
+sndio input device.
+
+To enable this input device during configuration you need libsndio
+installed on your system.
+
+The filename to provide to the input device is the device node
+representing the sndio input device, and is usually set to
+@file{/dev/audio0}.
+
+For example to grab from @file{/dev/audio0} using @file{ffmpeg} use the
+command:
+@example
+ffmpeg -f sndio -i /dev/audio0 /tmp/oss.wav
+@end example
+
 @section video4linux and video4linux2
 
 Video4Linux and Video4Linux2 input video devices.
diff --git a/doc/outdevs.texi b/doc/outdevs.texi
index 8658202..938909c 100644
--- a/doc/outdevs.texi
+++ b/doc/outdevs.texi
@@ -26,4 +26,8 @@ ALSA (Advanced Linux Sound Architecture) output device.
 
 OSS (Open Sound System) output device.
 
+@section sndio
+
+sndio audio output device.
+
 @c man end OUTPUT DEVICES
diff --git a/libavdevice/Makefile b/libavdevice/Makefile
index be28f4a..efc18cb 100644
--- a/libavdevice/Makefile
+++ b/libavdevice/Makefile
@@ -17,6 +17,8 @@ OBJS-$(CONFIG_DV1394_INDEV)              += dv1394.o
 OBJS-$(CONFIG_JACK_INDEV)                += jack_audio.o
 OBJS-$(CONFIG_OSS_INDEV)                 += oss_audio.o
 OBJS-$(CONFIG_OSS_OUTDEV)                += oss_audio.o
+OBJS-$(CONFIG_SNDIO_INDEV)               += sndio_common.o sndio_dec.o
+OBJS-$(CONFIG_SNDIO_OUTDEV)              += sndio_common.o sndio_enc.o
 OBJS-$(CONFIG_V4L2_INDEV)                += v4l2.o
 OBJS-$(CONFIG_V4L_INDEV)                 += v4l.o
 OBJS-$(CONFIG_VFWCAP_INDEV)              += vfwcap.o
@@ -26,5 +28,6 @@ OBJS-$(CONFIG_X11_GRAB_DEVICE_INDEV)     += x11grab.o
 OBJS-$(CONFIG_LIBDC1394_INDEV)           += libdc1394.o
 
 SKIPHEADERS-$(HAVE_ALSA_ASOUNDLIB_H)     += alsa-audio.h
+SKIPHEADERS-$(HAVE_SNDIO_H)              += sndio_common.h
 
 include $(SUBDIR)../subdir.mak
diff --git a/libavdevice/alldevices.c b/libavdevice/alldevices.c
index d839e24..9cbb977 100644
--- a/libavdevice/alldevices.c
+++ b/libavdevice/alldevices.c
@@ -44,6 +44,7 @@ void avdevice_register_all(void)
     REGISTER_INDEV    (DV1394, dv1394);
     REGISTER_INDEV    (JACK, jack);
     REGISTER_INOUTDEV (OSS, oss);
+    REGISTER_INOUTDEV (SNDIO, sndio);
     REGISTER_INDEV    (V4L2, v4l2);
     REGISTER_INDEV    (V4L, v4l);
     REGISTER_INDEV    (VFWCAP, vfwcap);
diff --git a/libavdevice/avdevice.h b/libavdevice/avdevice.h
index 683725c..28c12f2 100644
--- a/libavdevice/avdevice.h
+++ b/libavdevice/avdevice.h
@@ -22,8 +22,8 @@
 #include "libavutil/avutil.h"
 
 #define LIBAVDEVICE_VERSION_MAJOR 52
-#define LIBAVDEVICE_VERSION_MINOR  2
-#define LIBAVDEVICE_VERSION_MICRO  3
+#define LIBAVDEVICE_VERSION_MINOR  3
+#define LIBAVDEVICE_VERSION_MICRO  0
 
 #define LIBAVDEVICE_VERSION_INT AV_VERSION_INT(LIBAVDEVICE_VERSION_MAJOR, \
                                                LIBAVDEVICE_VERSION_MINOR, \
diff --git a/libavdevice/sndio_common.c b/libavdevice/sndio_common.c
new file mode 100644
index 0000000..51b96a2
--- /dev/null
+++ b/libavdevice/sndio_common.c
@@ -0,0 +1,114 @@
+/*
+ * sndio play and grab interface
+ * Copyright (c) 2010 Jacob Meuser
+ *
+ * This file is part of Libav.
+ *
+ * Libav is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Lesser General Public
+ * License as published by the Free Software Foundation; either
+ * version 2.1 of the License, or (at your option) any later version.
+ *
+ * Libav is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with Libav; if not, write to the Free Software
+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
+ */
+
+#include <sndio.h>
+#include "libavformat/avformat.h"
+
+#include "sndio_common.h"
+
+static void movecb(void *addr, int delta)
+{
+    AudioData *s = addr;
+
+    s->hwpos += delta * s->channels * s->bps;
+}
+
+av_cold int ff_sndio_open(AVFormatContext *s1, int is_output,
+                          const char *audio_device)
+{
+    AudioData *s = s1->priv_data;
+    struct sio_hdl *hdl;
+    struct sio_par par;
+
+    hdl = sio_open(audio_device, is_output ? SIO_PLAY : SIO_REC, 0);
+    if (!hdl) {
+        av_log(s1, AV_LOG_ERROR, "Could not open sndio device\n");
+        return AVERROR(EIO);
+    }
+
+    sio_initpar(&par);
+
+    par.bits = 16;
+    par.sig  = 1;
+    par.le   = SIO_LE_NATIVE;
+
+    if (is_output)
+        par.pchan = s->channels;
+    else
+        par.rchan = s->channels;
+    par.rate = s->sample_rate;
+
+    if (!sio_setpar(hdl, &par) || !sio_getpar(hdl, &par)) {
+        av_log(s1, AV_LOG_ERROR, "Impossible to set sndio parameters\n");
+        goto fail;
+    }
+
+    if (par.bits != 16 || par.sig != 1 || par.le != SIO_LE_NATIVE ||
+        (is_output  && (par.pchan != s->channels)) ||
+        (!is_output && (par.rchan != s->channels)) ||
+        (par.rate != s->sample_rate)) {
+        av_log(s1, AV_LOG_ERROR, "Could not set appropriate sndio parameters\n");
+        goto fail;
+    }
+
+    s->buffer_size = par.round * par.bps *
+                     (is_output ? par.pchan : par.rchan);
+
+    s->buffer = av_malloc(s->buffer_size);
+    if (!s->buffer) {
+        av_log(s1, AV_LOG_ERROR, "Could not allocate buffer\n");
+        goto fail;
+    }
+
+    s->codec_id    = par.le ? CODEC_ID_PCM_S16LE : CODEC_ID_PCM_S16BE;
+    s->channels    = is_output ? par.pchan : par.rchan;
+    s->sample_rate = par.rate;
+    s->bps         = par.bps;
+
+    sio_onmove(hdl, movecb, s);
+
+    if (!sio_start(hdl)) {
+        av_log(s1, AV_LOG_ERROR, "Could not start sndio\n");
+        goto fail;
+    }
+
+    s->hdl = hdl;
+
+    return 0;
+
+fail:
+    av_freep(&s->buffer);
+
+    if (hdl)
+        sio_close(hdl);
+
+    return AVERROR(EIO);
+}
+
+int ff_sndio_close(AudioData *s)
+{
+    av_freep(&s->buffer);
+
+    if (s->hdl)
+        sio_close(s->hdl);
+
+    return 0;
+}
diff --git a/libavdevice/sndio_common.h b/libavdevice/sndio_common.h
new file mode 100644
index 0000000..109ae59
--- /dev/null
+++ b/libavdevice/sndio_common.h
@@ -0,0 +1,45 @@
+/*
+ * sndio play and grab interface
+ * Copyright (c) 2010 Jacob Meuser
+ *
+ * This file is part of Libav.
+ *
+ * Libav is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Lesser General Public
+ * License as published by the Free Software Foundation; either
+ * version 2.1 of the License, or (at your option) any later version.
+ *
+ * Libav is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with Libav; if not, write to the Free Software
+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
+ */
+
+#ifndef AVDEVICE_SNDIO_COMMON_H
+#define AVDEVICE_SNDIO_COMMON_H
+
+#include <sndio.h>
+#include "config.h"
+#include "libavformat/avformat.h"
+
+typedef struct {
+    struct sio_hdl *hdl;
+    int sample_rate;
+    int channels;
+    int bps;
+    enum CodecID codec_id;
+    int buffer_size;
+    uint8_t *buffer;
+    int buffer_offset;
+    long long hwpos;
+    long long softpos;
+} AudioData;
+
+int ff_sndio_open(AVFormatContext *, int, const char *);
+int ff_sndio_close(AudioData *);
+
+#endif /* AVDEVICE_SNDIO_COMMON_H */
diff --git a/libavdevice/sndio_dec.c b/libavdevice/sndio_dec.c
new file mode 100644
index 0000000..fb6d79a
--- /dev/null
+++ b/libavdevice/sndio_dec.c
@@ -0,0 +1,106 @@
+/*
+ * sndio play and grab interface
+ * Copyright (c) 2010 Jacob Meuser
+ *
+ * This file is part of Libav.
+ *
+ * Libav is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Lesser General Public
+ * License as published by the Free Software Foundation; either
+ * version 2.1 of the License, or (at your option) any later version.
+ *
+ * Libav is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with Libav; if not, write to the Free Software
+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
+ */
+
+#include <sndio.h>
+#include "libavformat/avformat.h"
+
+#include "sndio_common.h"
+
+static av_cold int audio_read_header(AVFormatContext *s1,
+                                     AVFormatParameters *ap)
+{
+    AudioData *s = s1->priv_data;
+    AVStream *st;
+    int ret;
+
+    if (ap->sample_rate <= 0 || ap->channels <= 0)
+        return AVERROR(EINVAL);
+
+    st = av_new_stream(s1, 0);
+    if (!st)
+        return AVERROR(ENOMEM);
+
+    s->sample_rate = ap->sample_rate;
+    s->channels    = ap->channels;
+
+    ret = ff_sndio_open(s1, 0, s1->filename);
+    if (ret < 0)
+        return AVERROR(EIO);
+
+    /* take real parameters */
+    st->codec->codec_type  = AVMEDIA_TYPE_AUDIO;
+    st->codec->codec_id    = s->codec_id;
+    st->codec->sample_rate = s->sample_rate;
+    st->codec->channels    = s->channels;
+
+    av_set_pts_info(st, 64, 1, 1000000);  /* 64 bits pts in us */
+
+    return 0;
+}
+
+static int audio_read_packet(AVFormatContext *s1, AVPacket *pkt)
+{
+    AudioData *s = s1->priv_data;
+    int ret;
+    int64_t cur_time, bdelay;
+
+    if ((ret = av_new_packet(pkt, s->buffer_size)) < 0)
+        return ret;
+
+    ret = sio_read(s->hdl, pkt->data, pkt->size);
+    if (ret == 0 || sio_eof(s->hdl)) {
+        av_free_packet(pkt);
+        return AVERROR_EOF;
+    }
+
+    pkt->size   = ret;
+    s->softpos += ret;
+
+    /* compute pts of the start of the packet */
+    cur_time = av_gettime();
+
+    bdelay = ret + s->hwpos - s->softpos;
+
+    /* convert to pts */
+    pkt->pts = cur_time - ((bdelay * 1000000) /
+        (s->bps * s->channels * s->sample_rate));
+
+    return 0;
+}
+
+static av_cold int audio_read_close(AVFormatContext *s1)
+{
+    AudioData *s = s1->priv_data;
+
+    ff_sndio_close(s);
+
+    return 0;
+}
+
+AVInputFormat ff_sndio_demuxer = {
+    .name           = "sndio",
+    .long_name      = NULL_IF_CONFIG_SMALL("sndio audio capture"),
+    .priv_data_size = sizeof(AudioData),
+    .read_header    = audio_read_header,
+    .read_packet    = audio_read_packet,
+    .read_close     = audio_read_close,
+    .flags          = AVFMT_NOFILE,
+};
diff --git a/libavdevice/sndio_enc.c b/libavdevice/sndio_enc.c
new file mode 100644
index 0000000..95ad234
--- /dev/null
+++ b/libavdevice/sndio_enc.c
@@ -0,0 +1,95 @@
+/*
+ * sndio play and grab interface
+ * Copyright (c) 2010 Jacob Meuser
+ *
+ * This file is part of Libav.
+ *
+ * Libav is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Lesser General Public
+ * License as published by the Free Software Foundation; either
+ * version 2.1 of the License, or (at your option) any later version.
+ *
+ * Libav is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with Libav; if not, write to the Free Software
+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
+ */
+
+#include <sndio.h>
+#include "libavformat/avformat.h"
+
+#include "sndio_common.h"
+
+static av_cold int audio_write_header(AVFormatContext *s1)
+{
+    AudioData *s = s1->priv_data;
+    AVStream *st;
+    int ret;
+
+    st             = s1->streams[0];
+    s->sample_rate = st->codec->sample_rate;
+    s->channels    = st->codec->channels;
+
+    ret = ff_sndio_open(s1, 1, s1->filename);
+    if (ret < 0)
+        return AVERROR(EIO);
+
+    return ret;
+}
+
+static int audio_write_packet(AVFormatContext *s1, AVPacket *pkt)
+{
+    AudioData *s = s1->priv_data;
+    int len, ret;
+    int size = pkt->size;
+    uint8_t *buf= pkt->data;
+
+    while (size > 0) {
+        len = s->buffer_size - s->buffer_offset;
+        if (len > size)
+            len = size;
+        memcpy(s->buffer + s->buffer_offset, buf, len);
+        buf += len;
+        size -= len;
+        s->buffer_offset += len;
+        if (s->buffer_offset >= s->buffer_size) {
+            ret = sio_write(s->hdl, s->buffer, s->buffer_size);
+            if (ret == 0 || sio_eof(s->hdl))
+                return AVERROR(EIO);
+            s->softpos += ret;
+            s->buffer_offset = 0;
+        }
+    }
+
+    return 0;
+}
+
+static int audio_write_trailer(AVFormatContext *s1)
+{
+    AudioData *s = s1->priv_data;
+
+    sio_write(s->hdl, s->buffer, s->buffer_offset);
+
+    ff_sndio_close(s);
+
+    return 0;
+}
+
+AVOutputFormat ff_sndio_muxer = {
+    .name           = "sndio",
+    .long_name      = NULL_IF_CONFIG_SMALL("sndio audio playback"),
+    .priv_data_size = sizeof(AudioData),
+    /* XXX: we make the assumption that the soundcard accepts this format */
+    /* XXX: find better solution with "preinit" method, needed also in
+       other formats */
+    .audio_codec    = AV_NE(CODEC_ID_PCM_S16BE, CODEC_ID_PCM_S16LE),
+    .video_codec    = CODEC_ID_NONE,
+    .write_header   = audio_write_header,
+    .write_packet   = audio_write_packet,
+    .write_trailer  = audio_write_trailer,
+    .flags          = AVFMT_NOFILE,
+};
-- 
1.7.3.5


-- 
This message has been scanned for viruses and
dangerous content by MailScanner, and is
believed to be clean.


From news@gmane.org Tue Mar 04 03:33:20 2003
From: "Ronald S. Bultje" <rsbultje-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>
Subject: [PATCH] Do not use format string "%0.3f" for RTSP
	Range field.
Date: Tue, 22 Mar 2011 21:23:29 -0400
Lines: 27
Message-ID: <1300843409-76038-1-git-send-email-rsbultje@gmail.com>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 02:26:31 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2CqF-0004CX-Jd
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 02:26:31 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 5D5EA3B1B7;
	Wed, 23 Mar 2011 02:26:31 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 7AB653B1B7
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 02:26:29 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id w1NzRn66iBFH for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 02:26:29 +0100 (CET)
Received: from mail-qw0-f54.google.com (mail-qw0-f54.google.com
	[209.85.216.54])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 2FD7B3B1A1
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 02:26:29 +0100 (CET)
Received: by qwc9 with SMTP id 9so8687789qwc.27
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Tue, 22 Mar 2011 18:26:27 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=gamma;
	h=domainkey-signature:from:to:cc:subject:date:message-id:x-mailer;
	bh=cp+1deqkYPNFqUHiMTXphxQb+n6q36Kky3AeGEw/fxQ=;
	b=iGnNCiPSqE5xM7Ip/yqK97ATAAVa9b4ASKYLSaUm0ZECDCaF1bJUsz66zKfIzedJIh
	4WWBqdiLknvkIBHsVNm6RGMM3rSYSMLn0QuTG0qJUTv0fo3oJdhDFDQT5ra76mfiyBzr
	nPSRdUJsowZ2dc/+6S78Ey8TD9lZWQmT0tMDA=
DomainKey-Signature: a=rsa-sha1; c=nofws; d=gmail.com; s=gamma;
	h=from:to:cc:subject:date:message-id:x-mailer;
	b=oG9LipHbWiq1qhKyiEh44obKNFaEW0/YO6HQJuDaV03uwuW7s+PE2K4O2RJ6+5lQ1S
	H7kbHqwwAnhw0w0E0zvqBVUxFc4jlhjT6gOP3IaqJWQEfsdeRX/QXk0DYWu0cZarVWIF
	1/jqJPMxvNs4JVA0XpBiMJ0YWZ9sCM2knK6V4=
Received: by 10.229.10.12 with SMTP id n12mr5319028qcn.219.1300843587657;
	Tue, 22 Mar 2011 18:26:27 -0700 (PDT)
Received: from localhost.localdomain (cpe-74-68-112-85.nyc.res.rr.com
	[74.68.112.85])
	by mx.google.com with ESMTPS id m7sm2258748qcg.41.2011.03.22.18.26.26
	(version=TLSv1/SSLv3 cipher=OTHER);
	Tue, 22 Mar 2011 18:26:27 -0700 (PDT)
X-Mailer: git-send-email 1.7.2.1
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/13>

From: Carl Eugen Hoyos <cehoyos-iVVjmtzCFAg@public.gmane.org>

The format string was locale-depending.

Signed-off-by: Ronald S. Bultje <rsbultje-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>
---
 libavformat/rtspdec.c |    5 +++--
 1 files changed, 3 insertions(+), 2 deletions(-)

diff --git a/libavformat/rtspdec.c b/libavformat/rtspdec.c
index ac1f220..571e76d 100644
--- a/libavformat/rtspdec.c
+++ b/libavformat/rtspdec.c
@@ -60,8 +60,9 @@ static int rtsp_read_play(AVFormatContext *s)
             cmd[0] = 0;
         } else {
             snprintf(cmd, sizeof(cmd),
-                     "Range: npt=%0.3f-\r\n",
-                     (double)rt->seek_timestamp / AV_TIME_BASE);
+                     "Range: npt=%"PRId64".%03"PRId64"-\r\n",
+                     rt->seek_timestamp / AV_TIME_BASE,
+                     rt->seek_timestamp / (AV_TIME_BASE / 1000) % 1000);
         }
         ff_rtsp_send_cmd(s, "PLAY", rt->control_uri, cmd, reply, NULL);
         if (reply->status_code != RTSP_STATUS_OK) {
-- 
1.7.2.1


From news@gmane.org Tue Mar 04 03:33:20 2003
From: Luca Barbato <lu_zero-aBrp7R+bbdUdnm+yROfE0A@public.gmane.org>
Subject: Re: [PATCH] Do not use format string "%0.3f" for RTSP
 Range field.
Date: Wed, 23 Mar 2011 02:27:52 +0100
Lines: 12
Message-ID: <4D894C98.30806@gentoo.org>
References: <1300843409-76038-1-git-send-email-rsbultje@gmail.com>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 02:28:01 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2Crf-0004l2-VX
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 02:28:00 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id C32AD3B1BB;
	Wed, 23 Mar 2011 02:27:59 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 87FF13B1BB
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 02:27:58 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id 5WvehjJBiy9s for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 02:27:58 +0100 (CET)
Received: from smtp.gentoo.org (smtp.gentoo.org [140.211.166.183])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 423F73B1BA
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 02:27:58 +0100 (CET)
Received: from [192.168.1.116] (dynamic-adsl-84-223-248-146.clienti.tiscali.it
	[84.223.248.146])
	(using TLSv1 with cipher DHE-RSA-CAMELLIA256-SHA (256/256 bits))
	(No client certificate requested) (Authenticated sender: lu_zero)
	by smtp.gentoo.org (Postfix) with ESMTPSA id D2E1D1B405E
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 01:27:56 +0000 (UTC)
User-Agent: Mozilla/5.0 (X11; Linux x86_64;
	rv:2.0b10pre) Gecko/20110314 Thunderbird/3.3a2
In-Reply-To: <1300843409-76038-1-git-send-email-rsbultje-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>
X-Enigmail-Version: 1.2a1pre
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/14>

On 03/23/2011 02:23 AM, Ronald S. Bultje wrote:
> The format string was locale-depending.

Patch ok, shame on me for not noticing before...

lu

-- 

Luca Barbato
Gentoo/linux
http://dev.gentoo.org/~lu_zero


From news@gmane.org Tue Mar 04 03:33:20 2003
From: "Ronald S. Bultje" <rsbultje-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>
Subject: Re: [PATCH] Do not use format string "%0.3f" for RTSP
 Range field.
Date: Tue, 22 Mar 2011 21:31:08 -0400
Lines: 11
Message-ID: <AANLkTintHU3TVoS0uGE7F34-=21wxg0yM1po_jdX=ZEt@mail.gmail.com>
References: <1300843409-76038-1-git-send-email-rsbultje@gmail.com>
	<4D894C98.30806@gentoo.org>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 02:31:12 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2Cul-00064L-Ly
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 02:31:11 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 780B33B17F;
	Wed, 23 Mar 2011 02:31:11 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id EB55D3B17F
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 02:31:09 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id khx1kR7hvF4Y for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 02:31:09 +0100 (CET)
Received: from mail-iw0-f182.google.com (mail-iw0-f182.google.com
	[209.85.214.182])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 9653D3B17C
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 02:31:09 +0100 (CET)
Received: by iwn33 with SMTP id 33so12996325iwn.27
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Tue, 22 Mar 2011 18:31:08 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=gamma;
	h=domainkey-signature:mime-version:in-reply-to:references:date
	:message-id:subject:from:to:cc:content-type;
	bh=MR5IBmHWGnkgF3I2Q05LCph43OTmU4bOmrD5vpZGWro=;
	b=ExKxdxMUj7TX1NU9B856LZ1Wf4UhAWDRqiSvPX+M8MLDKpDmK1XSUKkoUrWPgD88g2
	x/QyteC3i1K5B2oYG9wiXxtRslwX1duYKs3TQu5Qgml2nyDIz9mFN8A6bS+I3lcWkY63
	o71MNmfYAtYr9yn/lm/nRU5ZKTlxlOn6M+nx8=
DomainKey-Signature: a=rsa-sha1; c=nofws; d=gmail.com; s=gamma;
	h=mime-version:in-reply-to:references:date:message-id:subject:from:to
	:cc:content-type;
	b=fmr1h2yac/CAySwGgoOoKn+O/4wM47eV+2JOVvjhYgKMFyir53Qe4y1SLDd9vAPGV9
	SX0Um3IJtj0EK2lI/52HFRCPQNpDRy9r8zjeZYi8AUPCrBC1Qo3ykwEoDrhgEy8kBCB3
	pqe/E5G9V/pFoc819UYcwpx+NCrBfOx+Mrvlc=
Received: by 10.42.230.134 with SMTP id jm6mr9901844icb.289.1300843868179;
	Tue, 22 Mar 2011 18:31:08 -0700 (PDT)
Received: by 10.42.75.133 with HTTP; Tue, 22 Mar 2011 18:31:08 -0700 (PDT)
In-Reply-To: <4D894C98.30806-aBrp7R+bbdUdnm+yROfE0A@public.gmane.org>
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/15>

Hi,

On Tue, Mar 22, 2011 at 9:27 PM, Luca Barbato <lu_zero-aBrp7R+bbdUdnm+yROfE0A@public.gmane.org> wrote:
> On 03/23/2011 02:23 AM, Ronald S. Bultje wrote:
>> The format string was locale-depending.
>
> Patch ok, shame on me for not noticing before...

Pushed, thanks.

Ronald


From news@gmane.org Tue Mar 04 03:33:20 2003
From: "Ronald S. Bultje" <rsbultje-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>
Subject: Re: [PATCH 2/2] cosmetics: indentation
Date: Tue, 22 Mar 2011 21:34:22 -0400
Lines: 11
Message-ID: <AANLkTindHh7D58qwETf5OviTqOD7EOh_ovLmuJcuRKZ7@mail.gmail.com>
References: <1300764142-8643-1-git-send-email-justin.ruggles@gmail.com>
	<1300764142-8643-2-git-send-email-justin.ruggles@gmail.com>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
Cc: Justin Ruggles <justin.ruggles-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>
To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 02:34:25 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2Cxt-0007OM-Cn
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 02:34:25 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 1A61D3B1C3;
	Wed, 23 Mar 2011 02:34:25 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 443293B1C3
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 02:34:24 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id RkJSM5IsfJXZ for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 02:34:24 +0100 (CET)
Received: from mail-iw0-f182.google.com (mail-iw0-f182.google.com
	[209.85.214.182])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id DCC293B1BC
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 02:34:23 +0100 (CET)
Received: by iwn33 with SMTP id 33so13000258iwn.27
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Tue, 22 Mar 2011 18:34:23 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=gamma;
	h=domainkey-signature:mime-version:in-reply-to:references:date
	:message-id:subject:from:to:cc:content-type
	:content-transfer-encoding;
	bh=P453EAovHRVizaagmshricIW8vduprDtNn1K47eOcEI=;
	b=Vo0r57eNsdAGicByiwXsnOP7BebA7Ovt3CiW+uAKz4bVZfRxPP8U40Myruq3kdnbbS
	tlw0Es9iX5Q7VesneHZ3ct4ZGOx0sx94tJF3wxdev6FGPOedgiWT+7pbVnYMm9KR+MJ+
	ZdPLrGtJC5Wzu6RgiEzEVOjaw0dzV+6dqzuOs=
DomainKey-Signature: a=rsa-sha1; c=nofws; d=gmail.com; s=gamma;
	h=mime-version:in-reply-to:references:date:message-id:subject:from:to
	:cc:content-type:content-transfer-encoding;
	b=B+eYBVkzPGPQT4sTt8V4Tvtn5W2sVnhdROLFfyvmYsSxRAdZc1oZVf3uNjQzLP4Jn3
	4eXylx/keLAJc9V9FVz6UDu2urAQNrm3YjvZFpfxsbFWfIuI7aG73qKYvwmHsvRTaWQy
	CJPiM4z4rPaIpZ5Bm++9Ly8WvKhMC9qOYmCAU=
Received: by 10.43.59.130 with SMTP id wo2mr10306049icb.88.1300844062992; Tue,
	22 Mar 2011 18:34:22 -0700 (PDT)
Received: by 10.42.75.133 with HTTP; Tue, 22 Mar 2011 18:34:22 -0700 (PDT)
In-Reply-To: <1300764142-8643-2-git-send-email-justin.ruggles-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/16>

Hi,

On Mon, Mar 21, 2011 at 11:22 PM, Justin Ruggles
<justin.ruggles-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org> wrote:
> ---
> =A0libavutil/x86/cpu.c | =A0 16 ++++++++--------
> =A01 files changed, 8 insertions(+), 8 deletions(-)

OK of course.

Ronald


From news@gmane.org Tue Mar 04 03:33:20 2003
From: "Ronald S. Bultje" <rsbultje-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>
Subject: Re: [PATCH] matroskaenc: simplify
 get_aac_sample_rates by using ff_mpeg4audio_get_config
Date: Tue, 22 Mar 2011 21:40:06 -0400
Lines: 23
Message-ID: <AANLkTikCbRiczbP400AkjDOVkeuLscL39sZdK6iD=JYJ@mail.gmail.com>
References: <1300694736-646-1-git-send-email-anton@khirnov.net>
	<AANLkTinUt9E83jHxRTM80zOkmdDqo7rHA6sgQN9SYC9y@mail.gmail.com>
	<4D88F22B.40109@gmail.com>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 02:40:10 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2D3R-0001EE-6E
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 02:40:09 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id F03F93B10B;
	Wed, 23 Mar 2011 02:40:08 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id B827D3B10B
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 02:40:07 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id rg7EHd6EE+vL for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 02:40:07 +0100 (CET)
Received: from mail-iy0-f182.google.com (mail-iy0-f182.google.com
	[209.85.210.182])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 64C5F3B0FF
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 02:40:07 +0100 (CET)
Received: by iyj12 with SMTP id 12so13076539iyj.27
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Tue, 22 Mar 2011 18:40:06 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=gamma;
	h=domainkey-signature:mime-version:in-reply-to:references:date
	:message-id:subject:from:to:content-type:content-transfer-encoding;
	bh=yHB9QWCPOIP7gxCN43qGszlSBq/S0byJcgCf0hcCryk=;
	b=A6if0PBfC7OTum/qvrp3PWAcmjRJXaocCjYwDPkcUSojcKnzMGPXpWhDfBMc8e2njU
	mEHIT8vsfhljsw+UejLAaHThSq0TaJxLrWbPgi4+wbk/WZsw8WgdsGarG9rTi8t49Kgq
	fxOdQFI58069DFjw6GQQ2tHC7IruVVyQTEIhc=
DomainKey-Signature: a=rsa-sha1; c=nofws; d=gmail.com; s=gamma;
	h=mime-version:in-reply-to:references:date:message-id:subject:from:to
	:content-type:content-transfer-encoding;
	b=e+f6OOUMLV0sK4cW6H9IHUT7/4Vtq2IHc8QuDxibXr0sOvpBjUmzAHcoWzsMiBrbmb
	GIBDoY0l+829ngWLNenrVCg5H+75dZv7sXespU2ncNPZIxPFGWzNxYjzl2XjBV4AwRkg
	e8xzpq1hFjQ1M5rShNU8lRCScldlRBqiec37w=
Received: by 10.43.70.203 with SMTP id yh11mr1684835icb.222.1300844406521;
	Tue, 22 Mar 2011 18:40:06 -0700 (PDT)
Received: by 10.42.75.133 with HTTP; Tue, 22 Mar 2011 18:40:06 -0700 (PDT)
In-Reply-To: <4D88F22B.40109-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/17>

Hi,

On Tue, Mar 22, 2011 at 3:02 PM, Justin Ruggles
<justin.ruggles-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org> wrote:
> On 03/21/2011 10:44 AM, Alex Converse wrote:
>
>> On Mon, Mar 21, 2011 at 1:05 AM, Anton Khirnov <anton-5jV5EzyPuF3R7s880joybQ@public.gmane.org> wrote:
>>> This also fixes broken SBR detection, which produced files with double
>>> sample rate since 8ae0fa2.
>>> ---
>>> =A0libavformat/matroskaenc.c | =A0 23 +++++------------------
>>> =A01 files changed, 5 insertions(+), 18 deletions(-)
>>>
>>
>> AAC part looks OK but I'd like to hear from an MKV expert.
>
>
> I'm not an MKV expert, but the code appears to do the same thing with
> respect to MKV before and after the patch.

Queued then.

Ronald


From news@gmane.org Tue Mar 04 03:33:20 2003
From: "Ronald S. Bultje" <rsbultje-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>
Subject: Re: [PATCH 1/8] lavc: move the version macros to a
 new installed header.
Date: Tue, 22 Mar 2011 21:48:58 -0400
Lines: 22
Message-ID: <AANLkTik2zNL7V0Sf8_8O6Cpt3pMegqp4P8n1nnKoWjhU@mail.gmail.com>
References: <1300136301-5437-1-git-send-email-anton@khirnov.net>
	<20110315231818.GB31020@pool.informatik.RWTH-Aachen.DE>
	<20110316202717.GD3302@zohar.khirnov.net>
	<20110316204509.GB29471@pool.informatik.RWTH-Aachen.DE>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 02:49:02 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2DC1-0004pY-97
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 02:49:01 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 055EC3B1CB;
	Wed, 23 Mar 2011 02:49:01 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 11FD23B1CB
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 02:49:00 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id 1Ft+xQTRVzyr for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 02:49:00 +0100 (CET)
Received: from mail-iy0-f182.google.com (mail-iy0-f182.google.com
	[209.85.210.182])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id B07F23B13C
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 02:48:59 +0100 (CET)
Received: by iyj12 with SMTP id 12so13087340iyj.27
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Tue, 22 Mar 2011 18:48:58 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=gamma;
	h=domainkey-signature:mime-version:in-reply-to:references:date
	:message-id:subject:from:to:cc:content-type
	:content-transfer-encoding;
	bh=yR8S7nKfLCPN0E0AUSmOmuhNnvB8zy82ytjwBv+paPM=;
	b=Ozg9N42En8YI2JUYVSJOJMDh62W+nYg81xEM18x8qAMoF4+M0NTj5rqMQrkoGA8buc
	c3+ow3xNsbbn0JtcoM230vYs5WZQpCXc7UpzoEN2z2UO4NX5Fa5Ae8tPyThvg5Oa1q1S
	grmid8qVOAuXv3NeaKoyDlVm3KViH19vMRkD8=
DomainKey-Signature: a=rsa-sha1; c=nofws; d=gmail.com; s=gamma;
	h=mime-version:in-reply-to:references:date:message-id:subject:from:to
	:cc:content-type:content-transfer-encoding;
	b=NXfwo1gPDJy0Ic/yuL2NRC7SK6a+CiKn5MrY54s9eOwWkypTUtHO2IlgTiXYg5weQT
	opfe4wl5R4TxFbHMsk27Gh9shBjJMgKbEA+oe7aXgBxlYI55YSK0FxAcKllAfUGDRG60
	WF5mq2m916A9xVa2bLUYYUDt8R/ZiyTNzXWeU=
Received: by 10.43.59.130 with SMTP id wo2mr10325432icb.88.1300844938640; Tue,
	22 Mar 2011 18:48:58 -0700 (PDT)
Received: by 10.42.75.133 with HTTP; Tue, 22 Mar 2011 18:48:58 -0700 (PDT)
In-Reply-To: <20110316204509.GB29471-C+EoYKesnrCVdxy9aTz+TbLZb8cQPPy3S7qENs8ugTg@public.gmane.org>
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/18>

Hi,

On Wed, Mar 16, 2011 at 4:45 PM, Diego Biurrun <diego-NvuzD6AdJSiELgA04lAiVw@public.gmane.org> wrote:
> On Wed, Mar 16, 2011 at 09:27:17PM +0100, Anton Khirnov wrote:
>> On Wed, Mar 16, 2011 at 12:18:18AM +0100, Diego Biurrun wrote:
>> > On Mon, Mar 14, 2011 at 09:58:13PM +0100, Anton Khirnov wrote:
>> > > [...]
>> >
>> > Why not do this for all libs instead of just libavcodec?
>>
>> Already done in lavf, will be somewhat nontrivial in lavu (the
>> versioning macros depend on stringifying macros, which would have to be
>> split out too) and probably pointless in lavfi.
>>
>> And not related to this patchset :)
>
> OK, patch fine with me then. =A0If you feel like it, go ahead with
> other libs or remind me when I'm back from vacation.

Patch queued.

Ronald


From news@gmane.org Tue Mar 04 03:33:20 2003
From: Mans Rullgard <mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org>
Subject: [PATCH] ARM: NEON optimised apply_window_int16()
Date: Wed, 23 Mar 2011 01:55:41 +0000
Lines: 60
Message-ID: <1300845341-26428-1-git-send-email-mans@mansr.com>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 02:55:45 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2DIX-0007Os-Iu
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 02:55:45 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 267833B1C9;
	Wed, 23 Mar 2011 02:55:45 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id C8B603B19D
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 02:55:43 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id CG+Qh21nkCEI for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 02:55:43 +0100 (CET)
Received: from unicorn.mansr.com (unicorn.mansr.com [78.86.181.103])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id A2A403B19C
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 02:55:43 +0100 (CET)
Received: by unicorn.mansr.com (Postfix, from userid 51770)
	id 7049D17B42; Wed, 23 Mar 2011 01:55:43 +0000 (GMT)
X-Mailer: git-send-email 1.7.4.1
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/19>

Signed-off-by: Mans Rullgard <mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org>
---
 libavcodec/arm/dsputil_init_neon.c |    5 +++++
 libavcodec/arm/dsputil_neon.S      |   23 +++++++++++++++++++++++
 2 files changed, 28 insertions(+), 0 deletions(-)

diff --git a/libavcodec/arm/dsputil_init_neon.c b/libavcodec/arm/dsputil_init_neon.c
index 2b283c4..eb0bc57 100644
--- a/libavcodec/arm/dsputil_init_neon.c
+++ b/libavcodec/arm/dsputil_init_neon.c
@@ -168,6 +168,9 @@ int32_t ff_scalarproduct_int16_neon(const int16_t *v1, const int16_t *v2, int le
 int32_t ff_scalarproduct_and_madd_int16_neon(int16_t *v1, const int16_t *v2,
                                              const int16_t *v3, int len, int mul);
 
+void ff_apply_window_int16_neon(int16_t *dst, const int16_t *src,
+                                const int16_t *window, int n);
+
 void ff_dsputil_init_neon(DSPContext *c, AVCodecContext *avctx)
 {
     if (!avctx->lowres) {
@@ -319,4 +322,6 @@ void ff_dsputil_init_neon(DSPContext *c, AVCodecContext *avctx)
 
     c->scalarproduct_int16 = ff_scalarproduct_int16_neon;
     c->scalarproduct_and_madd_int16 = ff_scalarproduct_and_madd_int16_neon;
+
+    c->apply_window_int16 = ff_apply_window_int16_neon;
 }
diff --git a/libavcodec/arm/dsputil_neon.S b/libavcodec/arm/dsputil_neon.S
index 140f5a0..5b80e40 100644
--- a/libavcodec/arm/dsputil_neon.S
+++ b/libavcodec/arm/dsputil_neon.S
@@ -789,3 +789,26 @@ NOVFP   ldr             r2,  [sp]
         vst1.f32        {q9},[r0,:128]!
         bx              lr
 endfunc
+
+function ff_apply_window_int16_neon, export=1
+        push            {r4,lr}
+        add             r4,  r1,  r3,  lsl #1
+        add             lr,  r0,  r3,  lsl #1
+        sub             r4,  r4,  #16
+        sub             lr,  lr,  #16
+        mov             r12, #-16
+1:
+        vld1.16         {q0},     [r1,:128]!
+        vld1.16         {q2},     [r2,:128]!
+        vld1.16         {q1},     [r4,:128], r12
+        vrev64.16       q3,  q2
+        vqrdmulh.s16    q0,  q0,  q2
+        vqrdmulh.s16    d2,  d2,  d7
+        vqrdmulh.s16    d3,  d3,  d6
+        vst1.16         {q0},     [r0,:128]!
+        vst1.16         {q1},     [lr,:128], r12
+        subs            r3,  r3,  #16
+        bgt             1b
+
+        pop             {r4,pc}
+endfunc
-- 
1.7.4.1


From news@gmane.org Tue Mar 04 03:33:20 2003
From: "Ronald S. Bultje" <rsbultje-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>
Subject: [PATCH] Use macro __INTEL_COMPILER instead of __ICC.
Date: Tue, 22 Mar 2011 22:05:42 -0400
Lines: 90
Message-ID: <1300845942-4218-1-git-send-email-rsbultje@gmail.com>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 03:07:32 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2DTw-0005ee-IR
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 03:07:32 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 55A993B1D3;
	Wed, 23 Mar 2011 03:07:32 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 25F923B1D3
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 03:07:29 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id Y3EVYK2erjyt for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 03:07:22 +0100 (CET)
Received: from mail-vw0-f54.google.com (mail-vw0-f54.google.com
	[209.85.212.54])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 894C43B1D2
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 03:07:22 +0100 (CET)
Received: by vws18 with SMTP id 18so8997141vws.27
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Tue, 22 Mar 2011 19:07:21 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=gamma;
	h=domainkey-signature:from:to:cc:subject:date:message-id:x-mailer;
	bh=NdGxlVp+4IXElFy8bgddbY2QxZjbHXOdurtj1inknH8=;
	b=nW2XKz9CgdOcTo1T7T88zRTRf7ZQOE1p7piTaFPTT50gM01i3K6uSInZ7LohZOIjLT
	8tXPws/Tken+AGexL83fE23ZZaIhxiH9ddMu9N6xvKPm4llvBSmerXA426KR6RV86W2V
	qiTq7vn+mHTg0Z/nxfrqFX9cqs/Hc4lqs+kA4=
DomainKey-Signature: a=rsa-sha1; c=nofws; d=gmail.com; s=gamma;
	h=from:to:cc:subject:date:message-id:x-mailer;
	b=RwpakydTK7gltedZJUi38PJY8GNoNO22ORNnu3rq9A6f91gJmZUnd99HSnwMHx5RNx
	Buth4M/a1YHFNLmOGsFywb89GhTEg1kLTwgthLzPEDJkxoZdYSHXdDYJ2ZH5tJuKkQgD
	ewT/HqX8A/SYra6ZT9uyCS+IIfnilRS0LMYZo=
Received: by 10.52.90.171 with SMTP id bx11mr6241981vdb.36.1300846041279;
	Tue, 22 Mar 2011 19:07:21 -0700 (PDT)
Received: from localhost.localdomain (cpe-74-68-112-85.nyc.res.rr.com
	[74.68.112.85])
	by mx.google.com with ESMTPS id n32sm2156469vba.22.2011.03.22.19.07.19
	(version=TLSv1/SSLv3 cipher=OTHER);
	Tue, 22 Mar 2011 19:07:20 -0700 (PDT)
X-Mailer: git-send-email 1.7.2.1
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/20>

From: Carl Eugen Hoyos <cehoyos-iVVjmtzCFAg@public.gmane.org>

__ICC is not supported on all platforms, this is an Intel documentation
bug that is supposed to be fixed in a future release.
(Intel issue 612289)

Signed-off-by: Ronald S. Bultje <rsbultje-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>
---
 libavutil/attributes.h |    8 ++++----
 libavutil/internal.h   |    2 +-
 libavutil/mem.h        |    4 ++--
 3 files changed, 7 insertions(+), 7 deletions(-)

diff --git a/libavutil/attributes.h b/libavutil/attributes.h
index 4ee0dde..266317e 100644
--- a/libavutil/attributes.h
+++ b/libavutil/attributes.h
@@ -65,7 +65,7 @@
 #endif
 
 #ifndef av_cold
-#if (!defined(__ICC) || __ICC > 1110) && AV_GCC_VERSION_AT_LEAST(4,3)
+#if (!defined(__INTEL_COMPILER) || __INTEL_COMPILER > 1110) && AV_GCC_VERSION_AT_LEAST(4,3)
 #    define av_cold __attribute__((cold))
 #else
 #    define av_cold
@@ -73,7 +73,7 @@
 #endif
 
 #ifndef av_flatten
-#if (!defined(__ICC) || __ICC > 1110) && AV_GCC_VERSION_AT_LEAST(4,1)
+#if (!defined(__INTEL_COMPILER) || __INTEL_COMPILER > 1110) && AV_GCC_VERSION_AT_LEAST(4,1)
 #    define av_flatten __attribute__((flatten))
 #else
 #    define av_flatten
@@ -110,7 +110,7 @@
 #endif
 
 #ifndef av_alias
-#if (!defined(__ICC) || __ICC > 1200) && AV_GCC_VERSION_AT_LEAST(3,3)
+#if (!defined(__INTEL_COMPILER) || __INTEL_COMPILER > 1200) && AV_GCC_VERSION_AT_LEAST(3,3)
 #   define av_alias __attribute__((may_alias))
 #else
 #   define av_alias
@@ -118,7 +118,7 @@
 #endif
 
 #ifndef av_uninit
-#if defined(__GNUC__) && !defined(__ICC)
+#if defined(__GNUC__) && !defined(__INTEL_COMPILER)
 #    define av_uninit(x) x=x
 #else
 #    define av_uninit(x) x
diff --git a/libavutil/internal.h b/libavutil/internal.h
index ac2ad17..2c1070d 100644
--- a/libavutil/internal.h
+++ b/libavutil/internal.h
@@ -39,7 +39,7 @@
 #include "timer.h"
 
 #ifndef attribute_align_arg
-#if ARCH_X86_32 && (!defined(__ICC) || __ICC > 1200) && AV_GCC_VERSION_AT_LEAST(4,2)
+#if ARCH_X86_32 && (!defined(__INTEL_COMPILER) || __INTEL_COMPILER > 1200) && AV_GCC_VERSION_AT_LEAST(4,2)
 #    define attribute_align_arg __attribute__((force_align_arg_pointer))
 #else
 #    define attribute_align_arg
diff --git a/libavutil/mem.h b/libavutil/mem.h
index da8ad89..1ef7f6b 100644
--- a/libavutil/mem.h
+++ b/libavutil/mem.h
@@ -29,7 +29,7 @@
 #include "attributes.h"
 #include "avutil.h"
 
-#if defined(__ICC) && _ICC < 1200 || defined(__SUNPRO_C)
+#if defined(__INTEL_COMPILER) && __INTEL_COMPILER < 1200 || defined(__SUNPRO_C)
     #define DECLARE_ALIGNED(n,t,v)      t __attribute__ ((aligned (n))) v
     #define DECLARE_ASM_CONST(n,t,v)    const t __attribute__ ((aligned (n))) v
 #elif defined(__TI_COMPILER_VERSION__)
@@ -56,7 +56,7 @@
     #define av_malloc_attrib
 #endif
 
-#if (!defined(__ICC) || __ICC > 1200) && AV_GCC_VERSION_AT_LEAST(4,3)
+#if (!defined(__INTEL_COMPILER) || __INTEL_COMPILER > 1200) && AV_GCC_VERSION_AT_LEAST(4,3)
     #define av_alloc_size(n) __attribute__((alloc_size(n)))
 #else
     #define av_alloc_size(n)
-- 
1.7.2.1


From news@gmane.org Tue Mar 04 03:33:20 2003
From: "Ronald S. Bultje" <rsbultje-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>
Subject: [PATCH] Add xd55 codec tag for XDCAM HD422 720p25 CBR
	files.
Date: Tue, 22 Mar 2011 22:11:23 -0400
Lines: 22
Message-ID: <1300846283-6336-1-git-send-email-rsbultje@gmail.com>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 03:12:04 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2DYI-0007LC-Jp
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 03:12:02 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 213353B1D4;
	Wed, 23 Mar 2011 03:12:02 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 9D2C33B1D4
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 03:12:00 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id PeIFXX2cPOWE for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 03:12:00 +0100 (CET)
Received: from mail-vx0-f182.google.com (mail-vx0-f182.google.com
	[209.85.220.182])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 53E663B020
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 03:12:00 +0100 (CET)
Received: by vxc34 with SMTP id 34so9923815vxc.27
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Tue, 22 Mar 2011 19:11:59 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=gamma;
	h=domainkey-signature:from:to:cc:subject:date:message-id:x-mailer
	:mime-version:content-type:content-transfer-encoding;
	bh=DqRStObKrkMhamPwY2X01lydVKCkYuxrBZvOCg1PztU=;
	b=GnXPYe9g0FEe6tXcHimNZ79RWruA5LeXxpCKc6NdPvfc5VLicfPKZpmLBZnwpYgUre
	ANNTTVl7XD6/0AqidoRuxOZx9/4fS12uIXRHXKKJ/pIcjHx8Q/pcn8iOkxP0c/zOk6Ew
	VwIM22HrY9heLKWhBWwR80zdy21UpXXh8JPXQ=
DomainKey-Signature: a=rsa-sha1; c=nofws; d=gmail.com; s=gamma;
	h=from:to:cc:subject:date:message-id:x-mailer:mime-version
	:content-type:content-transfer-encoding;
	b=rjfRCMvFfIOrAKUjVBgITe10Lk47lx2HVXtFMXE5/kI90voSbPpLf1vBd6uZ9EW2jZ
	VHYRbzpWrRWKg63Ln68vHf68VLHHPdP9ZYcRLmr9LavBdjbiQ1JTli3+8c7u0LdtDlid
	ef2nODxtI36SlS8WV68v4GTj2GgyjpBqKgyFI=
Received: by 10.52.167.230 with SMTP id zr6mr6300396vdb.6.1300846319605;
	Tue, 22 Mar 2011 19:11:59 -0700 (PDT)
Received: from localhost.localdomain (cpe-74-68-112-85.nyc.res.rr.com
	[74.68.112.85])
	by mx.google.com with ESMTPS id s6sm1666905vch.47.2011.03.22.19.11.57
	(version=TLSv1/SSLv3 cipher=OTHER);
	Tue, 22 Mar 2011 19:11:58 -0700 (PDT)
X-Mailer: git-send-email 1.7.2.1
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/21>

RnJvbTogVG9tYXMgSMOkcmRpbiA8dG9tYXMuaGFyZGluQGNvZGVtaWxsLnNlPgoKU2lnbmVkLW9m
Zi1ieTogUm9uYWxkIFMuIEJ1bHRqZSA8cnNidWx0amVAZ21haWwuY29tPgotLS0KIGxpYmF2Zm9y
bWF0L2lzb20uYyB8ICAgIDEgKwogMSBmaWxlcyBjaGFuZ2VkLCAxIGluc2VydGlvbnMoKyksIDAg
ZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvbGliYXZmb3JtYXQvaXNvbS5jIGIvbGliYXZmb3Jt
YXQvaXNvbS5jCmluZGV4IDZjMzgwYzEuLmM2NWY5MzEgMTAwNjQ0Ci0tLSBhL2xpYmF2Zm9ybWF0
L2lzb20uYworKysgYi9saWJhdmZvcm1hdC9pc29tLmMKQEAgLTE1Nyw2ICsxNTcsNyBAQCBjb25z
dCBBVkNvZGVjVGFnIGNvZGVjX21vdnZpZGVvX3RhZ3NbXSA9IHsKICAgICB7IENPREVDX0lEX01Q
RUcyVklERU8sIE1LVEFHKCdtJywgJ3gnLCAnMycsICduJykgfSwgLyogTVBFRzIgSU1YIE5UU0Mg
NTI1LzYwIDMwbWIvcyBwcm9kdWNlZCBieSBGQ1AgKi8KICAgICB7IENPREVDX0lEX01QRUcyVklE
RU8sIE1LVEFHKCdtJywgJ3gnLCAnMycsICdwJykgfSwgLyogTVBFRzIgSU1YIFBBTCA2MjUvNTAg
MzBtYi9zIHByb2R1Y2VkIGJ5IEZDUCAqLwogICAgIHsgQ09ERUNfSURfTVBFRzJWSURFTywgTUtU
QUcoJ3gnLCAnZCcsICc1JywgJzQnKSB9LCAvKiBYRENBTSBIRDQyMiA3MjBwMjQgQ0JSICovCisg
ICAgeyBDT0RFQ19JRF9NUEVHMlZJREVPLCBNS1RBRygneCcsICdkJywgJzUnLCAnNScpIH0sIC8q
IFhEQ0FNIEhENDIyIDcyMHAyNSBDQlIgKi8KICAgICB7IENPREVDX0lEX01QRUcyVklERU8sIE1L
VEFHKCd4JywgJ2QnLCAnNScsICc5JykgfSwgLyogWERDQU0gSEQ0MjIgNzIwcDYwIENCUiAqLwog
ICAgIHsgQ09ERUNfSURfTVBFRzJWSURFTywgTUtUQUcoJ3gnLCAnZCcsICc1JywgJ2EnKSB9LCAv
KiBYRENBTSBIRDQyMiA3MjBwNTAgQ0JSICovCiAgICAgeyBDT0RFQ19JRF9NUEVHMlZJREVPLCBN
S1RBRygneCcsICdkJywgJzUnLCAnYicpIH0sIC8qIFhEQ0FNIEhENDIyIDEwODBpNjAgQ0JSICov
Ci0tIAoxLjcuMi4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fXwpsaWJhdi1kZXZlbCBtYWlsaW5nIGxpc3QKbGliYXYtZGV2ZWxAbGliYXYub3JnCmh0dHBz
Oi8vbGlzdHMubGliYXYub3JnL21haWxtYW4vbGlzdGluZm8vbGliYXYtZGV2ZWwK



From news@gmane.org Tue Mar 04 03:33:20 2003
From: =?iso-8859-1?Q?M=E5ns_Rullg=E5rd?= <mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org>
Subject: Re: [PATCH] Use macro __INTEL_COMPILER instead of
	__ICC.
Date: Wed, 23 Mar 2011 02:17:43 +0000
Lines: 34
Message-ID: <yw1x62ratwag.fsf@unicorn.mansr.com>
References: <1300845942-4218-1-git-send-email-rsbultje@gmail.com>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 03:17:46 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2Ddq-0001Bx-5c
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 03:17:46 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id E93463B1D8;
	Wed, 23 Mar 2011 03:17:45 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id EA0EE3B1D8
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 03:17:43 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id CNCCSrhG+1ao for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 03:17:43 +0100 (CET)
Received: from unicorn.mansr.com (unicorn.mansr.com [78.86.181.103])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id C8E183B1D6
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 03:17:43 +0100 (CET)
Received: by unicorn.mansr.com (Postfix, from userid 51770)
	id 9FB9F17B42; Wed, 23 Mar 2011 02:17:43 +0000 (GMT)
In-Reply-To: <1300845942-4218-1-git-send-email-rsbultje-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org> (Ronald
	S. Bultje's message of "Tue, 22 Mar 2011 22:05:42 -0400")
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/23.2 (gnu/linux)
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/22>

"Ronald S. Bultje" <rsbultje-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org> writes:

> From: Carl Eugen Hoyos <cehoyos-iVVjmtzCFAg@public.gmane.org>
>
> __ICC is not supported on all platforms, this is an Intel documentation
> bug that is supposed to be fixed in a future release.
> (Intel issue 612289)
>
> Signed-off-by: Ronald S. Bultje <rsbultje-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>
> ---
>  libavutil/attributes.h |    8 ++++----
>  libavutil/internal.h   |    2 +-
>  libavutil/mem.h        |    4 ++--
>  3 files changed, 7 insertions(+), 7 deletions(-)
>
> diff --git a/libavutil/attributes.h b/libavutil/attributes.h
> index 4ee0dde..266317e 100644
> --- a/libavutil/attributes.h
> +++ b/libavutil/attributes.h
> @@ -65,7 +65,7 @@
>  #endif
>  =

>  #ifndef av_cold
> -#if (!defined(__ICC) || __ICC > 1110) && AV_GCC_VERSION_AT_LEAST(4,3)
> +#if (!defined(__INTEL_COMPILER) || __INTEL_COMPILER > 1110) && AV_GCC_VE=
RSION_AT_LEAST(4,3)

The way these macros are used is a mess and should be fixed properly.

-- =

M=E5ns Rullg=E5rd
mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org


From news@gmane.org Tue Mar 04 03:33:20 2003
From: "Ronald S. Bultje" <rsbultje-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>
Subject: [PATCH] matroskadec: set a default duration also for
	packets comming from a simple block
Date: Tue, 22 Mar 2011 22:18:03 -0400
Lines: 31
Message-ID: <1300846683-6511-1-git-send-email-rsbultje@gmail.com>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 03:18:53 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2Deu-0001cl-KO
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 03:18:52 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 66ED13B1DE;
	Wed, 23 Mar 2011 03:18:52 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 306F83B1DE
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 03:18:50 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id gzJxoy9nnn3n for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 03:18:50 +0100 (CET)
Received: from mail-vx0-f182.google.com (mail-vx0-f182.google.com
	[209.85.220.182])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id D8CC33B1DB
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 03:18:49 +0100 (CET)
Received: by vxc34 with SMTP id 34so9929527vxc.27
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Tue, 22 Mar 2011 19:18:49 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=gamma;
	h=domainkey-signature:from:to:cc:subject:date:message-id:x-mailer;
	bh=Qh5wi8FlIZPRN0h1X4WyH6skSE7xBS8m9TT8hTlJmDc=;
	b=bYYIOjSAsmT79ShBpRmqIqNi34rO2iPRJoE3IwbChnlg02BmD2LbmakvbyAogeQwFY
	efBPIXMIJTe3OJ+7yli2Myx5mEWbEPtYcpZjSdUXwTfxWXwq4qNbK5u5QU/wIPuRCIVs
	iEQkp2VV3y/PyoCZVCiy/A9NAdYs+7Addhgf4=
DomainKey-Signature: a=rsa-sha1; c=nofws; d=gmail.com; s=gamma;
	h=from:to:cc:subject:date:message-id:x-mailer;
	b=Kd/+3jB2v7Hh6DjQV9ELz+7UQcxd9gHxsmgbK4hyz45IvlzMgrdEUfV7ok79r8+Qxq
	fUYm6PvEbn339x7PT9d81snGylGCdh98uFRVVmnpf/DwoMUIkEvE6J5xem6JsxMf3XY5
	SCAh3xydaKco59HzpANDb6JpiE0MPng7Lh/10=
Received: by 10.52.179.36 with SMTP id dd4mr6206505vdc.56.1300846729185;
	Tue, 22 Mar 2011 19:18:49 -0700 (PDT)
Received: from localhost.localdomain (cpe-74-68-112-85.nyc.res.rr.com
	[74.68.112.85])
	by mx.google.com with ESMTPS id cd8sm1609558vdb.32.2011.03.22.19.18.47
	(version=TLSv1/SSLv3 cipher=OTHER);
	Tue, 22 Mar 2011 19:18:48 -0700 (PDT)
X-Mailer: git-send-email 1.7.2.1
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/23>

From: Aurelien Jacobs <aurel-U/apLSaFET4dnm+yROfE0A@public.gmane.org>

Signed-off-by: Ronald S. Bultje <rsbultje-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>
---
 libavformat/matroskadec.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/libavformat/matroskadec.c b/libavformat/matroskadec.c
index 828d578..2bb1771 100644
--- a/libavformat/matroskadec.c
+++ b/libavformat/matroskadec.c
@@ -485,7 +485,7 @@ static EbmlSyntax matroska_segments[] = {
 static EbmlSyntax matroska_blockgroup[] = {
     { MATROSKA_ID_BLOCK,          EBML_BIN,  0, offsetof(MatroskaBlock,bin) },
     { MATROSKA_ID_SIMPLEBLOCK,    EBML_BIN,  0, offsetof(MatroskaBlock,bin) },
-    { MATROSKA_ID_BLOCKDURATION,  EBML_UINT, 0, offsetof(MatroskaBlock,duration), {.u=AV_NOPTS_VALUE} },
+    { MATROSKA_ID_BLOCKDURATION,  EBML_UINT, 0, offsetof(MatroskaBlock,duration) },
     { MATROSKA_ID_BLOCKREFERENCE, EBML_UINT, 0, offsetof(MatroskaBlock,reference) },
     { 1,                          EBML_UINT, 0, offsetof(MatroskaBlock,non_simple), {.u=1} },
     { 0 }
@@ -1621,7 +1621,7 @@ static int matroska_parse_block(MatroskaDemuxContext *matroska, uint8_t *data,
     st = track->stream;
     if (st->discard >= AVDISCARD_ALL)
         return res;
-    if (duration == AV_NOPTS_VALUE)
+    if (!duration)
         duration = track->default_duration / matroska->time_scale;
 
     block_time = AV_RB16(data);
-- 
1.7.2.1


From news@gmane.org Tue Mar 04 03:33:20 2003
From: "Ronald S. Bultje" <rsbultje-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>
Subject: Re: [PATCH] matroskadec: set a default duration also
 for packets comming from a simple block
Date: Tue, 22 Mar 2011 22:20:54 -0400
Lines: 14
Message-ID: <AANLkTikJGn08D8R1FKM3sNUOZUVu_Uy=MZkuoJTBzsUK@mail.gmail.com>
References: <1300846683-6511-1-git-send-email-rsbultje@gmail.com>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 03:20:58 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2Dgw-0002QZ-47
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 03:20:58 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id E4F543B1B6;
	Wed, 23 Mar 2011 03:20:57 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 81C333B1B6
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 03:20:56 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id tN3q2k5UPV0U for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 03:20:56 +0100 (CET)
Received: from mail-iw0-f182.google.com (mail-iw0-f182.google.com
	[209.85.214.182])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 2BCB03B1B5
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 03:20:56 +0100 (CET)
Received: by iwn33 with SMTP id 33so13057008iwn.27
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Tue, 22 Mar 2011 19:20:55 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=gamma;
	h=domainkey-signature:mime-version:in-reply-to:references:date
	:message-id:subject:from:to:cc:content-type
	:content-transfer-encoding;
	bh=q5q6IVKk+R3deynK9hA8sdEt7d0336ssktRQf5gd5Yw=;
	b=xFnCJkng3zEeiun4+WSNF/+jHK9GZfouM1tLXbfcG4xbCW8EjaJFAAhTOSCZnvNxdX
	Zms2XpPNjIzcSmznZU+QvTzuwPOXqSTbGS+6usAyQPct3wcFg0Mimzn5EXmD8i3TNHhE
	WCp++CtDsb8uLJX1eKBWxaxAteapJeu21/PyM=
DomainKey-Signature: a=rsa-sha1; c=nofws; d=gmail.com; s=gamma;
	h=mime-version:in-reply-to:references:date:message-id:subject:from:to
	:cc:content-type:content-transfer-encoding;
	b=PLcWasDkbOeQxg5Uou4IPoRoFDkx4S6ZhAKOtLzKTay/ST7OTXvrR5PwFUxsM3JfOj
	R9dQ6dg39eU2/5WUml9yBTDnd+w8KL9rrUHEg2oqn7L4dW7XOld2q+uqvw0t7cIKE1El
	BEh2/2mwmhjYsQymVfNF7U+zsPOCx2pif1kJ0=
Received: by 10.43.70.203 with SMTP id yh11mr1738662icb.222.1300846854588;
	Tue, 22 Mar 2011 19:20:54 -0700 (PDT)
Received: by 10.42.75.133 with HTTP; Tue, 22 Mar 2011 19:20:54 -0700 (PDT)
In-Reply-To: <1300846683-6511-1-git-send-email-rsbultje-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/24>

Hi,

On Tue, Mar 22, 2011 at 10:18 PM, Ronald S. Bultje <rsbultje-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org> wro=
te:
> From: Aurelien Jacobs <aurel-U/apLSaFET4dnm+yROfE0A@public.gmane.org>
>
> Signed-off-by: Ronald S. Bultje <rsbultje-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>
> ---
> =A0libavformat/matroskadec.c | =A0 =A04 ++--
> =A01 files changed, 2 insertions(+), 2 deletions(-)

Please ignore, Luca already cherry-picked this.

Ronald


From news@gmane.org Tue Mar 04 03:33:20 2003
From: "Ronald S. Bultje" <rsbultje-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>
Subject: Re: [PATCH] matroskadec: set a default duration also
 for packets comming from a simple block
Date: Tue, 22 Mar 2011 22:25:36 -0400
Lines: 46
Message-ID: <AANLkTiny_1XuGhHWQWhW+41_x2vu69g4gJd5hAVvAfeh@mail.gmail.com>
References: <4D850D5B.4050000@jetheaddev.com>
	<1300655467-7260-1-git-send-email-lu_zero@gentoo.org>
	<4D86705F.60406@gentoo.org>
	<0F5DA216-71C1-49C5-A2C8-4577C564A6CA@ithinksw.com>
	<4D868CFF.7090600@gentoo.org>
	<assp.006168c448.4D86974A.1020202@jetheaddev.com>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 03:25:39 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2DlT-0004KN-Mh
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 03:25:39 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 77D393B1A3;
	Wed, 23 Mar 2011 03:25:39 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id F21153B1A3
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 03:25:37 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id VZWnnCH-mwOr for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 03:25:37 +0100 (CET)
Received: from mail-iy0-f182.google.com (mail-iy0-f182.google.com
	[209.85.210.182])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 9B4453B19D
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 03:25:37 +0100 (CET)
Received: by iyj12 with SMTP id 12so13133227iyj.27
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Tue, 22 Mar 2011 19:25:36 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=gamma;
	h=domainkey-signature:mime-version:in-reply-to:references:date
	:message-id:subject:from:to:cc:content-type
	:content-transfer-encoding;
	bh=Xo1Z/snzTqfPfIzjl4S4bJE22Uu8AP68CV6zbeymJ5c=;
	b=rwdENX6BY7qbrSxvxZAt6rOvo5sLx5WWMh4kmT8hE8yk8zNvKXF2yWBzXlNdVZBMIe
	CmDjLBoWU1mKqzdvXqwISbWnRlGkakma/HC4pdvOzvTL1CasDhs54EDp93d1tom3q1bL
	0uyCMX0rFXqkPzuz6PQaresnZld95NAw/uVQ4=
DomainKey-Signature: a=rsa-sha1; c=nofws; d=gmail.com; s=gamma;
	h=mime-version:in-reply-to:references:date:message-id:subject:from:to
	:cc:content-type:content-transfer-encoding;
	b=YBxKXHPo09YBpn+ws5Vm9hO8tkCUgaf+bCJYbTCk29hsuVdoGVA+xqkkDhplsDA7sy
	a0cKCJI0zwcphMlCJ0BcQ3olhDdvYSlymBagI5j7w6YeoehmW5ecx6CWi0xzJnla7fVB
	TQ3bmFTGMwMS6vCj/rpHofvBLVp+EsQlElnZ4=
Received: by 10.42.230.134 with SMTP id jm6mr9972196icb.289.1300847136717;
	Tue, 22 Mar 2011 19:25:36 -0700 (PDT)
Received: by 10.42.75.133 with HTTP; Tue, 22 Mar 2011 19:25:36 -0700 (PDT)
In-Reply-To: <assp.006168c448.4D86974A.1020202-XmeOCtL31rpmIUNP22KzKQ@public.gmane.org>
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/25>

Hi,

On Sun, Mar 20, 2011 at 8:09 PM, John Stebbins <stebbins-XmeOCtL31rpmIUNP22KzKQ@public.gmane.org> wr=
ote:
> On 03/20/2011 04:25 PM, Luca Barbato wrote:
>>
>> On 03/20/2011 11:42 PM, Alexander Strange wrote:
>>>
>>> On Mar 20, 2011, at 5:23 PM, Luca Barbato wrote:
>>>
>>>> On 03/20/2011 10:11 PM, Luca Barbato wrote:
>>>>>
>>>>> From: Aurelien Jacobs<aurel-U/apLSaFET4dnm+yROfE0A@public.gmane.org>
>>>>>
>>>>> Signed-off-by: Luca Barbato<lu_zero-aBrp7R+bbdUdnm+yROfE0A@public.gmane.org>
>>>>
>>>> The comment should be amended for sure, could somebody tell me if there
>>>> is a way to set items with 0 duration on purpose in mkv?
>>>>
>>>> lu
>>>
>>> Duration must be>0 according to
>>> http://matroska.org/technical/specs/index.html.
>>>
>>> I have MKV files where subsequent frames have the same timestamp. That's
>>> either
>>> invalid (apparent mkvmerge bug) or valid (DTS-HD frames where the
>>> duration is less
>>> than the precision of the timestamp). The last case is the only one whe=
re
>>> it could
>>> have been done on purpose. There is no guidance about what to do with
>>> Duration in this case.
>>
>> I was trying to figure out if wouldn't be better setting the duration by
>> default to AV_NOPTS_VALUE for everything. Not sure what's best.
>>
>
> That's what my original patch did. =A0But whoever committed the fix to ff=
mpeg
> decided to change it. =A0My original patch attached.

This patch seems more correct to me, to be honest. Luca, up to you to
push either one.

Ronald


From news@gmane.org Tue Mar 04 03:33:20 2003
From: John Stebbins <stebbins-XmeOCtL31rpmIUNP22KzKQ@public.gmane.org>
Subject: Re: [PATCH] matroskadec: set a default duration also
 for packets comming from a simple block
Date: Tue, 22 Mar 2011 19:31:21 -0700
Lines: 47
Message-ID: <assp.00635fb0c3.4D895B79.8030704@jetheaddev.com>
References: <4D850D5B.4050000@jetheaddev.com>	<1300655467-7260-1-git-send-email-lu_zero@gentoo.org>	<4D86705F.60406@gentoo.org>	<0F5DA216-71C1-49C5-A2C8-4577C564A6CA@ithinksw.com>	<4D868CFF.7090600@gentoo.org>	<assp.006168c448.4D86974A.1020202@jetheaddev.com>
	<AANLkTiny_1XuGhHWQWhW+41_x2vu69g4gJd5hAVvAfeh@mail.gmail.com>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"; Format="flowed"
Content-Transfer-Encoding: 7bit
To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 03:31:42 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2DrI-0006oV-DJ
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 03:31:40 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 302983B1B3;
	Wed, 23 Mar 2011 03:31:40 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id AE08B3B1B3
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 03:31:38 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id EsKdIYT-Ks8Z for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 03:31:38 +0100 (CET)
Received: from eastrmfepo202.cox.net (eastrmfepo202.cox.net [68.230.241.217])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 47AC63B1A8
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 03:31:38 +0100 (CET)
Received: from eastrmimpo02.cox.net ([68.1.16.120]) by eastrmfepo202.cox.net
	(InterMail vM.8.01.04.00 201-2260-137-20101110) with ESMTP id
	<20110323023131.SYUK32466.eastrmfepo202.cox.net-jOUDVclVbkyrBH45IYTTKuTW4wlIGRCZ@public.gmane.org>
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Tue, 22 Mar 2011 22:31:31 -0400
Received: from franklin.jetheaddev.com ([70.164.99.62])
	by eastrmimpo02.cox.net with bizsmtp
	id NSXU1g00q1Llurq02SXVSK; Tue, 22 Mar 2011 22:31:31 -0400
X-VR-Score: -150.00
X-Authority-Analysis: v=1.1 cv=7pnWggiXOXQ2QAfmW6m14qCrZ7JR9LVvc7C/OcPmZyA=
	c=1 sm=1 a=dlutpJqdQxcA:10 a=03cWxs-v1AsA:10 a=8nJEP1OIZ-IA:10
	a=WqMsSZAZr7Y7IwfB86vPXQ==:17 a=Hb0zQVPLAAAA:8 a=N3qFITptAAAA:8
	a=7mOBRU54AAAA:8 a=0Sny1v0mAAAA:8 a=6pKqFJ7yGiaTFpMmL20A:9
	a=auTg7yClt3KRrCJzbBmHqf9xAkkA:4 a=wPNLvfGTeEIA:10 a=kemztZQ_iqQA:10
	a=xRlcMwIcyNoA:10 a=WeOa-AV5lc8A:10 a=WqMsSZAZr7Y7IwfB86vPXQ==:117
X-CM-Score: 0.00
Authentication-Results: cox.net; none
Received: from franklin.jetheaddev.com ([192.168.13.15]
	helo=franklin.jetheaddev.com)
	with IPv4:25 by assp.jetheaddev.com; 22 Mar 2011 19:31:28 -0700
Received: from franklin.jetheaddev.com ([192.168.13.15]) by
	franklin.jetheaddev.com with Microsoft SMTPSVC(6.0.3790.4675); 
	Tue, 22 Mar 2011 19:31:28 -0700
Received: from [192.168.1.245] ([10.13.49.14]) by franklin.jetheaddev.com over
	TLS secured channel with Microsoft SMTPSVC(6.0.3790.4675); 
	Tue, 22 Mar 2011 19:31:28 -0700
User-Agent: Mozilla/5.0 (X11; U; Linux x86_64; en-US;
	rv:1.9.2.14) Gecko/20110223 Thunderbird/3.1.8
In-Reply-To: <AANLkTiny_1XuGhHWQWhW+41_x2vu69g4gJd5hAVvAfeh-JsoAwUIsXosN+BqQ9rBEUg@public.gmane.org>
X-OriginalArrivalTime: 23 Mar 2011 02:31:28.0776 (UTC)
	FILETIME=[69FFA880:01CBE902]
X-Assp-Passing: relayPort
X-Assp-ID: assp.jetheaddev.com (m-30084-41526)
X-Assp-Version: 1.8.5.3(1.0.01)
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/26>

On 03/22/2011 07:25 PM, Ronald S. Bultje wrote:
> Hi,
>
> On Sun, Mar 20, 2011 at 8:09 PM, John Stebbins<stebbins-XmeOCtL31rpmIUNP22KzKQ@public.gmane.org>  wrote:
>> On 03/20/2011 04:25 PM, Luca Barbato wrote:
>>>
>>> On 03/20/2011 11:42 PM, Alexander Strange wrote:
>>>>
>>>> On Mar 20, 2011, at 5:23 PM, Luca Barbato wrote:
>>>>
>>>>> On 03/20/2011 10:11 PM, Luca Barbato wrote:
>>>>>>
>>>>>> From: Aurelien Jacobs<aurel-U/apLSaFET4dnm+yROfE0A@public.gmane.org>
>>>>>>
>>>>>> Signed-off-by: Luca Barbato<lu_zero-aBrp7R+bbdUdnm+yROfE0A@public.gmane.org>
>>>>>
>>>>> The comment should be amended for sure, could somebody tell me if there
>>>>> is a way to set items with 0 duration on purpose in mkv?
>>>>>
>>>>> lu
>>>>
>>>> Duration must be>0 according to
>>>> http://matroska.org/technical/specs/index.html.
>>>>
>>>> I have MKV files where subsequent frames have the same timestamp. That's
>>>> either
>>>> invalid (apparent mkvmerge bug) or valid (DTS-HD frames where the
>>>> duration is less
>>>> than the precision of the timestamp). The last case is the only one where
>>>> it could
>>>> have been done on purpose. There is no guidance about what to do with
>>>> Duration in this case.
>>>
>>> I was trying to figure out if wouldn't be better setting the duration by
>>> default to AV_NOPTS_VALUE for everything. Not sure what's best.
>>>
>>
>> That's what my original patch did.  But whoever committed the fix to ffmpeg
>> decided to change it.  My original patch attached.
>
> This patch seems more correct to me, to be honest. Luca, up to you to
> push either one.
>

fwiw, I've verified that both patches solve the original problem I had.

John


From news@gmane.org Tue Mar 04 03:33:20 2003
From: Luca Barbato <lu_zero-aBrp7R+bbdUdnm+yROfE0A@public.gmane.org>
Subject: Re: [PATCH] matroskadec: set a default duration also
 for packets comming from a simple block
Date: Wed, 23 Mar 2011 03:40:50 +0100
Lines: 12
Message-ID: <4D895DB2.2030302@gentoo.org>
References: <4D850D5B.4050000@jetheaddev.com>	<1300655467-7260-1-git-send-email-lu_zero@gentoo.org>	<4D86705F.60406@gentoo.org>	<0F5DA216-71C1-49C5-A2C8-4577C564A6CA@ithinksw.com>	<4D868CFF.7090600@gentoo.org>	<assp.006168c448.4D86974A.1020202@jetheaddev.com>
	<AANLkTiny_1XuGhHWQWhW+41_x2vu69g4gJd5hAVvAfeh@mail.gmail.com>
	<assp.00635fb0c3.4D895B79.8030704@jetheaddev.com>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 03:41:01 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2E0K-0001sU-D7
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 03:41:00 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 361563B1EE;
	Wed, 23 Mar 2011 03:41:00 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id EF16F3B1EE
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 03:40:57 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id T7MkHECYfv-Y for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 03:40:57 +0100 (CET)
Received: from smtp.gentoo.org (smtp.gentoo.org [140.211.166.183])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id A75573B1E8
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 03:40:57 +0100 (CET)
Received: from [192.168.1.116] (dynamic-adsl-84-223-248-146.clienti.tiscali.it
	[84.223.248.146])
	(using TLSv1 with cipher DHE-RSA-CAMELLIA256-SHA (256/256 bits))
	(No client certificate requested) (Authenticated sender: lu_zero)
	by smtp.gentoo.org (Postfix) with ESMTPSA id F3D5F1B401C
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 02:40:54 +0000 (UTC)
User-Agent: Mozilla/5.0 (X11; Linux x86_64;
	rv:2.0b10pre) Gecko/20110314 Thunderbird/3.3a2
In-Reply-To: <assp.00635fb0c3.4D895B79.8030704-XmeOCtL31rpmIUNP22KzKQ@public.gmane.org>
X-Enigmail-Version: 1.2a1pre
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/27>

On 03/23/2011 03:31 AM, John Stebbins wrote:
> fwiw, I've verified that both patches solve the original problem I had.

I'd pick your since I expect to have 0 duration frames sooner or later.

lu

-- 

Luca Barbato
Gentoo/linux
http://dev.gentoo.org/~lu_zero


From news@gmane.org Tue Mar 04 03:33:20 2003
From: Luca Barbato <lu_zero-aBrp7R+bbdUdnm+yROfE0A@public.gmane.org>
Subject: Re: [PATCH 1/2] On MinGW32 don't use full-versioned
 libraries.
Date: Wed, 23 Mar 2011 03:45:24 +0100
Lines: 14
Message-ID: <4D895EC4.2030303@gentoo.org>
References: <1300800758-32626-1-git-send-email-flameeyes@gmail.com>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 03:45:34 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2E4k-0003aR-7S
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 03:45:34 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id F322C3B167;
	Wed, 23 Mar 2011 03:45:33 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id E0B653B167
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 03:45:31 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id UUKQBvqFvX93 for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 03:45:31 +0100 (CET)
Received: from smtp.gentoo.org (smtp.gentoo.org [140.211.166.183])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 9750C3B127
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 03:45:31 +0100 (CET)
Received: from [192.168.1.116] (dynamic-adsl-84-223-248-146.clienti.tiscali.it
	[84.223.248.146])
	(using TLSv1 with cipher DHE-RSA-CAMELLIA256-SHA (256/256 bits))
	(No client certificate requested) (Authenticated sender: lu_zero)
	by smtp.gentoo.org (Postfix) with ESMTPSA id E276F1B4005
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 02:45:28 +0000 (UTC)
User-Agent: Mozilla/5.0 (X11; Linux x86_64;
	rv:2.0b10pre) Gecko/20110314 Thunderbird/3.3a2
In-Reply-To: <1300800758-32626-1-git-send-email-flameeyes-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>
X-Enigmail-Version: 1.2a1pre
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/28>

T24gMDMvMjIvMjAxMSAwMjozMiBQTSwgRGllZ28gRWxpbyBQZXR0ZW7DsiB3cm90ZToKPiBTaW5j
ZSBXaW5kb3dzIGxhY2tzIHRoZSBjb25jZXB0IG9mIHNvbmFtZXMgYW5kIG11bHRpcGxlIGFsaWFz
ZXMgZm9yIGR5bmFtaWMKPiBsaWJyYXJpZXMgdGhlcmUgaXMgbm8gcmVhc29uIHRvIHVzZSB0aGUg
c3BsaXQgZnVsbC12ZXJzaW9uL21ham9yIGFsaWFzZXMKPiBmb3IgdGhlIERMTCBmaWxlcy4KCkJl
Y2F1c2Ugb2YgaG93IG91ciBidWlsZCBzeXN0ZW0gd29ya3MgdGhpcyBwYXRjaCBjb3VsZCBjb21w
bGljYXRlIGEKX2xvdF8gZml4aW5nIHRoZSBpc3N1ZSBhdCBoYW5kLgoKSSdkIGp1c3Qgc2V0IGxu
X3M9ImNwIC1mIiBhcyB0aGUgb3MyIHRhcmdldCBkb2VzIGFuZCByZWNvbnNpZGVyIGNsZWFuaW5n
CnVwIG9uIGEgbGF0ZXIgdGltZS4gKEknbSB0ZW1wdGVkIGFkZGluZyBhIHBvc3QgaW5zdGFsbCBy
bSAtZiBmb3IgdGhlCmRpc3RyaWJ1dGlvbiBhbnl3YXkpCgpsdQoKLS0gCgpMdWNhIEJhcmJhdG8K
R2VudG9vL2xpbnV4Cmh0dHA6Ly9kZXYuZ2VudG9vLm9yZy9+bHVfemVybwoKX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KbGliYXYtZGV2ZWwgbWFpbGluZyBs
aXN0CmxpYmF2LWRldmVsQGxpYmF2Lm9yZwpodHRwczovL2xpc3RzLmxpYmF2Lm9yZy9tYWlsbWFu
L2xpc3RpbmZvL2xpYmF2LWRldmVsCg==



From news@gmane.org Tue Mar 04 03:33:20 2003
From: Anton Khirnov <anton-5jV5EzyPuF3R7s880joybQ@public.gmane.org>
Subject: [PATCH 03/10] Simplify chroma blend in the drawtext
	filter
Date: Wed, 23 Mar 2011 06:30:54 +0100
Lines: 24
Message-ID: <1300858261-30193-3-git-send-email-anton@khirnov.net>
References: <1300858261-30193-1-git-send-email-anton@khirnov.net>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 06:31:17 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2Gf7-0008U3-Gx
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 06:31:17 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 416AD3B1F9;
	Wed, 23 Mar 2011 06:31:17 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 01AF23C06C
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 06:31:14 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id yNme0sqwZNMh for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 06:31:13 +0100 (CET)
Received: from smtp1.kolej.mff.cuni.cz (smtp1.kolej.mff.cuni.cz
	[78.128.192.10])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id BADC53B1FC
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 06:31:13 +0100 (CET)
X-Envelope-From: anton-5jV5EzyPuF3R7s880joybQ@public.gmane.org
Received: from zohar.localdomain (zohar.kolej.mff.cuni.cz [78.128.198.199])
	by smtp1.kolej.mff.cuni.cz (8.14.4/8.14.4) with ESMTP id p2N5VBW3058386
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 06:31:13 +0100 (CET)
	(envelope-from anton-5jV5EzyPuF3R7s880joybQ@public.gmane.org)
Received: by zohar.localdomain (Postfix, from userid 1000)
	id D74607F456; Wed, 23 Mar 2011 06:31:11 +0100 (CET)
X-Mailer: git-send-email 1.7.4.1
In-Reply-To: <1300858261-30193-1-git-send-email-anton-5jV5EzyPuF3R7s880joybQ@public.gmane.org>
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/29>

From: Michael Niedermayer <michaelni-RbZlAiThDcE@public.gmane.org>

Signed-off-by: Michael Niedermayer <michaelni-RbZlAiThDcE@public.gmane.org>
---
 libavfilter/vf_drawtext.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/libavfilter/vf_drawtext.c b/libavfilter/vf_drawtext.c
index 9fe6def..d470c89 100644
--- a/libavfilter/vf_drawtext.c
+++ b/libavfilter/vf_drawtext.c
@@ -376,8 +376,8 @@ static int config_input(AVFilterLink *inlink)
     alpha = (yuva_color[3] * (val)) / 255;                               \
     picref->data[0][luma_pos] = (alpha * yuva_color[0] + (255 - alpha) * picref->data[0][luma_pos]) >> 8; \
     alpha = (yuva_color[3] * (val)) / 224;                               \
-    picref->data[1][chroma_pos1] = 16 + (alpha * (yuva_color[1]-16) + (224 - alpha) * (picref->data[1][chroma_pos1]-16)) / 224; \
-    picref->data[2][chroma_pos2] = 16 + (alpha * (yuva_color[2]-16) + (224 - alpha) * (picref->data[2][chroma_pos2]-16)) / 224; \
+    picref->data[1][chroma_pos1] = (alpha * yuva_color[1] + (224 - alpha) * picref->data[1][chroma_pos1]) / 224; \
+    picref->data[2][chroma_pos2] = (alpha * yuva_color[2] + (224 - alpha) * picref->data[2][chroma_pos2]) / 224; \
 }
 
 static inline int draw_glyph_yuv(AVFilterBufferRef *picref, FT_Bitmap *bitmap, unsigned int x,
-- 
1.7.4.1


From news@gmane.org Tue Mar 04 03:33:20 2003
From: Anton Khirnov <anton-5jV5EzyPuF3R7s880joybQ@public.gmane.org>
Subject: [PATCH 04/10] fix chroma alpha in the drawtext filter
Date: Wed, 23 Mar 2011 06:30:55 +0100
Lines: 25
Message-ID: <1300858261-30193-4-git-send-email-anton@khirnov.net>
References: <1300858261-30193-1-git-send-email-anton@khirnov.net>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 06:31:19 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2Gf8-0008Un-Uk
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 06:31:18 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id ECB033B201;
	Wed, 23 Mar 2011 06:31:17 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id E8F0A3B200
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 06:31:13 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id IdL60NIUEH1T for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 06:31:13 +0100 (CET)
Received: from smtp1.kolej.mff.cuni.cz (smtp1.kolej.mff.cuni.cz
	[78.128.192.10])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id A9B873B1F8
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 06:31:13 +0100 (CET)
X-Envelope-From: anton-5jV5EzyPuF3R7s880joybQ@public.gmane.org
Received: from zohar.localdomain (zohar.kolej.mff.cuni.cz [78.128.198.199])
	by smtp1.kolej.mff.cuni.cz (8.14.4/8.14.4) with ESMTP id p2N5VC41058387
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 06:31:13 +0100 (CET)
	(envelope-from anton-5jV5EzyPuF3R7s880joybQ@public.gmane.org)
Received: by zohar.localdomain (Postfix, from userid 1000)
	id 043BE7F471; Wed, 23 Mar 2011 06:31:11 +0100 (CET)
X-Mailer: git-send-email 1.7.4.1
In-Reply-To: <1300858261-30193-1-git-send-email-anton-5jV5EzyPuF3R7s880joybQ@public.gmane.org>
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/30>

From: Michael Niedermayer <michaelni-RbZlAiThDcE@public.gmane.org>

Signed-off-by: Michael Niedermayer <michaelni-RbZlAiThDcE@public.gmane.org>
---
 libavfilter/vf_drawtext.c |    5 ++---
 1 files changed, 2 insertions(+), 3 deletions(-)

diff --git a/libavfilter/vf_drawtext.c b/libavfilter/vf_drawtext.c
index d470c89..ec83ac0 100644
--- a/libavfilter/vf_drawtext.c
+++ b/libavfilter/vf_drawtext.c
@@ -375,9 +375,8 @@ static int config_input(AVFilterLink *inlink)
     chroma_pos2 = ((x) >> (hsub)) + ((y) >> (vsub)) * picref->linesize[2]; \
     alpha = (yuva_color[3] * (val)) / 255;                               \
     picref->data[0][luma_pos] = (alpha * yuva_color[0] + (255 - alpha) * picref->data[0][luma_pos]) >> 8; \
-    alpha = (yuva_color[3] * (val)) / 224;                               \
-    picref->data[1][chroma_pos1] = (alpha * yuva_color[1] + (224 - alpha) * picref->data[1][chroma_pos1]) / 224; \
-    picref->data[2][chroma_pos2] = (alpha * yuva_color[2] + (224 - alpha) * picref->data[2][chroma_pos2]) / 224; \
+    picref->data[1][chroma_pos1] = (alpha * yuva_color[1] + (255 - alpha) * picref->data[1][chroma_pos1]) >> 8; \
+    picref->data[2][chroma_pos2] = (alpha * yuva_color[2] + (255 - alpha) * picref->data[2][chroma_pos2]) >> 8; \
 }
 
 static inline int draw_glyph_yuv(AVFilterBufferRef *picref, FT_Bitmap *bitmap, unsigned int x,
-- 
1.7.4.1


From news@gmane.org Tue Mar 04 03:33:20 2003
From: Anton Khirnov <anton-5jV5EzyPuF3R7s880joybQ@public.gmane.org>
Subject: [PATCH 05/10] get rid of divisions in the inner loop
	of the drawtext filter
Date: Wed, 23 Mar 2011 06:30:56 +0100
Lines: 43
Message-ID: <1300858261-30193-5-git-send-email-anton@khirnov.net>
References: <1300858261-30193-1-git-send-email-anton@khirnov.net>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 06:31:21 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2Gf9-0008V5-VW
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 06:31:20 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 856CA3C070;
	Wed, 23 Mar 2011 06:31:19 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 33EB53B1F8
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 06:31:14 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id 3rCd5q3RvybM for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 06:31:14 +0100 (CET)
Received: from smtp1.kolej.mff.cuni.cz (smtp1.kolej.mff.cuni.cz
	[78.128.192.10])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id C82BD3B1FF
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 06:31:13 +0100 (CET)
X-Envelope-From: anton-5jV5EzyPuF3R7s880joybQ@public.gmane.org
Received: from zohar.localdomain (zohar.kolej.mff.cuni.cz [78.128.198.199])
	by smtp1.kolej.mff.cuni.cz (8.14.4/8.14.4) with ESMTP id p2N5VCep058388
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 06:31:13 +0100 (CET)
	(envelope-from anton-5jV5EzyPuF3R7s880joybQ@public.gmane.org)
Received: by zohar.localdomain (Postfix, from userid 1000)
	id 2797F7F484; Wed, 23 Mar 2011 06:31:11 +0100 (CET)
X-Mailer: git-send-email 1.7.4.1
In-Reply-To: <1300858261-30193-1-git-send-email-anton-5jV5EzyPuF3R7s880joybQ@public.gmane.org>
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/31>

From: Michael Niedermayer <michaelni-RbZlAiThDcE@public.gmane.org>

Signed-off-by: Michael Niedermayer <michaelni-RbZlAiThDcE@public.gmane.org>
---
 libavfilter/vf_drawtext.c |   16 ++++++++--------
 1 files changed, 8 insertions(+), 8 deletions(-)

diff --git a/libavfilter/vf_drawtext.c b/libavfilter/vf_drawtext.c
index ec83ac0..08ed818 100644
--- a/libavfilter/vf_drawtext.c
+++ b/libavfilter/vf_drawtext.c
@@ -373,10 +373,10 @@ static int config_input(AVFilterLink *inlink)
     luma_pos    = ((x)          ) + ((y)          ) * picref->linesize[0]; \
     chroma_pos1 = ((x) >> (hsub)) + ((y) >> (vsub)) * picref->linesize[1]; \
     chroma_pos2 = ((x) >> (hsub)) + ((y) >> (vsub)) * picref->linesize[2]; \
-    alpha = (yuva_color[3] * (val)) / 255;                               \
-    picref->data[0][luma_pos] = (alpha * yuva_color[0] + (255 - alpha) * picref->data[0][luma_pos]) >> 8; \
-    picref->data[1][chroma_pos1] = (alpha * yuva_color[1] + (255 - alpha) * picref->data[1][chroma_pos1]) >> 8; \
-    picref->data[2][chroma_pos2] = (alpha * yuva_color[2] + (255 - alpha) * picref->data[2][chroma_pos2]) >> 8; \
+    alpha = yuva_color[3] * (val) * 129;                               \
+    picref->data[0][luma_pos]    = (alpha * yuva_color[0] + (255*255*129 - alpha) * picref->data[0][luma_pos]   ) >> 23; \
+    picref->data[1][chroma_pos1] = (alpha * yuva_color[1] + (255*255*129 - alpha) * picref->data[1][chroma_pos1]) >> 23; \
+    picref->data[2][chroma_pos2] = (alpha * yuva_color[2] + (255*255*129 - alpha) * picref->data[2][chroma_pos2]) >> 23; \
 }
 
 static inline int draw_glyph_yuv(AVFilterBufferRef *picref, FT_Bitmap *bitmap, unsigned int x,
@@ -408,10 +408,10 @@ static inline int draw_glyph_yuv(AVFilterBufferRef *picref, FT_Bitmap *bitmap, u
 
 #define SET_PIXEL_RGB(picref, rgba_color, val, x, y, pixel_step, r_off, g_off, b_off, a_off) { \
     p   = picref->data[0] + (x) * pixel_step + ((y) * picref->linesize[0]); \
-    alpha = (rgba_color[3] * (val)) / 255;                              \
-    *(p+r_off) = (alpha * rgba_color[0] + (255 - alpha) * *(p+r_off)) >> 8; \
-    *(p+g_off) = (alpha * rgba_color[1] + (255 - alpha) * *(p+g_off)) >> 8; \
-    *(p+b_off) = (alpha * rgba_color[2] + (255 - alpha) * *(p+b_off)) >> 8; \
+    alpha = rgba_color[3] * (val) * 129;                              \
+    *(p+r_off) = (alpha * rgba_color[0] + (255*255*129 - alpha) * *(p+r_off)) >> 23; \
+    *(p+g_off) = (alpha * rgba_color[1] + (255*255*129 - alpha) * *(p+g_off)) >> 23; \
+    *(p+b_off) = (alpha * rgba_color[2] + (255*255*129 - alpha) * *(p+b_off)) >> 23; \
 }
 
 static inline int draw_glyph_rgb(AVFilterBufferRef *picref, FT_Bitmap *bitmap,
-- 
1.7.4.1


From news@gmane.org Tue Mar 04 03:33:20 2003
From: Anton Khirnov <anton-5jV5EzyPuF3R7s880joybQ@public.gmane.org>
Subject: [PATCH 01/10] lavfi: add fade filter
Date: Wed, 23 Mar 2011 06:30:52 +0100
Lines: 260
Message-ID: <1300858261-30193-1-git-send-email-anton@khirnov.net>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 06:31:22 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2GfC-0008Vi-3G
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 06:31:22 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id DA4213C091;
	Wed, 23 Mar 2011 06:31:21 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 5BD923B1FF
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 06:31:14 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id RLNIWM6NcaFU for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 06:31:14 +0100 (CET)
Received: from smtp1.kolej.mff.cuni.cz (smtp1.kolej.mff.cuni.cz
	[78.128.192.10])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id B95983B1F9
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 06:31:13 +0100 (CET)
X-Envelope-From: anton-5jV5EzyPuF3R7s880joybQ@public.gmane.org
Received: from zohar.localdomain (zohar.kolej.mff.cuni.cz [78.128.198.199])
	by smtp1.kolej.mff.cuni.cz (8.14.4/8.14.4) with ESMTP id p2N5VBak058384
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 06:31:13 +0100 (CET)
	(envelope-from anton-5jV5EzyPuF3R7s880joybQ@public.gmane.org)
Received: by zohar.localdomain (Postfix, from userid 1000)
	id A4B3D7F455; Wed, 23 Mar 2011 06:31:11 +0100 (CET)
X-Mailer: git-send-email 1.7.4.1
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/32>

From: Brandon Mintern <bmintern-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>

Port fade filter from libavfilter soc repo, with minor fixes by
Stefano.

Signed-off-by: Michael Niedermayer <michaelni-RbZlAiThDcE@public.gmane.org>
---
 doc/filters.texi         |   33 +++++++++
 libavfilter/Makefile     |    1 +
 libavfilter/allfilters.c |    1 +
 libavfilter/vf_fade.c    |  170 ++++++++++++++++++++++++++++++++++++++++++++++
 4 files changed, 205 insertions(+), 0 deletions(-)
 create mode 100644 libavfilter/vf_fade.c

diff --git a/doc/filters.texi b/doc/filters.texi
index 2bd7bf5..872afc6 100644
--- a/doc/filters.texi
+++ b/doc/filters.texi
@@ -353,6 +353,39 @@ drawbox
 drawbox=10:20:200:60:red@@0.5"
 @end example
 
+@section fade
+
+Apply fade-in/out effect to input video.
+
+It accepts the parameters:
+@var{type}:@var{start_frame}:@var{nb_frames}
+
+@var{type} specifies if the effect type, can be either "in" for
+fade-in, or "out" for a fade-out effect.
+
+@var{start_frame} specifies the number of the start frame for starting
+to apply the fade effect.
+
+@var{nb_frames} specifies the number of frames for which the fade
+effect has to last. At the end of the fade-in effect the output video
+will have the same intensity as the input video, at the end of the
+fade-out transition the output video will be completely black.
+
+A few usage examples follow, usable too as test scenarios.
+@example
+# fade in first 30 frames of video
+fade=in:0:30
+
+# fade out last 45 frames of a 200-frame video
+fade=out:155:45
+
+# fade in first 25 frames and fade out last 25 frames of a 1000-frame video
+fade=in:0:25, fade=out:975:25
+
+# make first 5 frames black, then fade in from frame 5-24
+fade=in:5:20
+@end example
+
 @section fifo
 
 Buffer input images and send them when they are requested.
diff --git a/libavfilter/Makefile b/libavfilter/Makefile
index bbd8202..f7bc98d 100644
--- a/libavfilter/Makefile
+++ b/libavfilter/Makefile
@@ -26,6 +26,7 @@ OBJS-$(CONFIG_COPY_FILTER)                   += vf_copy.o
 OBJS-$(CONFIG_CROP_FILTER)                   += vf_crop.o
 OBJS-$(CONFIG_CROPDETECT_FILTER)             += vf_cropdetect.o
 OBJS-$(CONFIG_DRAWBOX_FILTER)                += vf_drawbox.o
+OBJS-$(CONFIG_FADE_FILTER)                   += vf_fade.o
 OBJS-$(CONFIG_FIFO_FILTER)                   += vf_fifo.o
 OBJS-$(CONFIG_FORMAT_FILTER)                 += vf_format.o
 OBJS-$(CONFIG_FREI0R_FILTER)                 += vf_frei0r.o
diff --git a/libavfilter/allfilters.c b/libavfilter/allfilters.c
index 6afd1d7..34e87f5 100644
--- a/libavfilter/allfilters.c
+++ b/libavfilter/allfilters.c
@@ -45,6 +45,7 @@ void avfilter_register_all(void)
     REGISTER_FILTER (CROP,        crop,        vf);
     REGISTER_FILTER (CROPDETECT,  cropdetect,  vf);
     REGISTER_FILTER (DRAWBOX,     drawbox,     vf);
+    REGISTER_FILTER (FADE,        fade,        vf);
     REGISTER_FILTER (FIFO,        fifo,        vf);
     REGISTER_FILTER (FORMAT,      format,      vf);
     REGISTER_FILTER (FREI0R,      frei0r,      vf);
diff --git a/libavfilter/vf_fade.c b/libavfilter/vf_fade.c
new file mode 100644
index 0000000..203a186
--- /dev/null
+++ b/libavfilter/vf_fade.c
@@ -0,0 +1,170 @@
+/*
+ * Copyright (c) 2010 Brandon Mintern
+ * Copyright (c) 2007 Bobby Bingham
+ *
+ * This file is part of FFmpeg.
+ *
+ * FFmpeg is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Lesser General Public
+ * License as published by the Free Software Foundation; either
+ * version 2.1 of the License, or (at your option) any later version.
+ *
+ * FFmpeg is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with FFmpeg; if not, write to the Free Software
+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
+ */
+
+/**
+ * @file
+ * video fade filter
+ * based heavily on vf_negate.c by Bobby Bingham
+ */
+
+#include "libavutil/pixdesc.h"
+#include "avfilter.h"
+
+typedef struct {
+    int factor, fade_per_frame;
+    unsigned int frame_index, start_frame, stop_frame;
+    int hsub, vsub, bpp;
+} FadeContext;
+
+static av_cold int init(AVFilterContext *ctx, const char *args, void *opaque)
+{
+    FadeContext *fade = ctx->priv;
+    unsigned int nb_frames;
+    char in_out[4];
+
+    if (!args ||
+        sscanf(args, " %3[^:]:%u:%u", in_out, &fade->start_frame, &nb_frames) != 3) {
+        av_log(ctx, AV_LOG_ERROR,
+               "Expected 3 arguments '(in|out):#:#':'%s'\n", args);
+        return AVERROR(EINVAL);
+    }
+
+    nb_frames = nb_frames ? nb_frames : 1;
+    fade->fade_per_frame = (1 << 16) / nb_frames;
+    if (!strcmp(in_out, "in"))
+        fade->factor = 0;
+    else if (!strcmp(in_out, "out")) {
+        fade->fade_per_frame = -fade->fade_per_frame;
+        fade->factor = (1 << 16);
+    } else {
+        av_log(ctx, AV_LOG_ERROR,
+               "first argument must be 'in' or 'out':'%s'\n", in_out);
+        return AVERROR(EINVAL);
+    }
+    fade->stop_frame = fade->start_frame + nb_frames;
+
+    av_log(ctx, AV_LOG_INFO,
+           "type:%s start_frame:%d nb_frames:%d\n",
+           in_out, fade->start_frame, nb_frames);
+    return 0;
+}
+
+static int query_formats(AVFilterContext *ctx)
+{
+    const static enum PixelFormat pix_fmts[] = {
+        PIX_FMT_YUV444P,  PIX_FMT_YUV422P,  PIX_FMT_YUV420P,
+        PIX_FMT_YUV411P,  PIX_FMT_YUV410P,
+        PIX_FMT_YUVJ444P, PIX_FMT_YUVJ422P, PIX_FMT_YUVJ420P,
+        PIX_FMT_YUV440P,  PIX_FMT_YUVJ440P,
+        PIX_FMT_RGB24,    PIX_FMT_BGR24,
+        PIX_FMT_NONE
+    };
+
+    avfilter_set_common_formats(ctx, avfilter_make_format_list(pix_fmts));
+    return 0;
+}
+
+static int config_props(AVFilterLink *inlink)
+{
+    FadeContext *fade = inlink->dst->priv;
+    const AVPixFmtDescriptor *pixdesc = &av_pix_fmt_descriptors[inlink->format];
+
+    fade->hsub = pixdesc->log2_chroma_w;
+    fade->vsub = pixdesc->log2_chroma_h;
+
+    fade->bpp = av_get_bits_per_pixel(pixdesc) >> 3;
+    return 0;
+}
+
+static void draw_slice(AVFilterLink *inlink, int y, int h, int slice_dir)
+{
+    FadeContext *fade = inlink->dst->priv;
+    AVFilterBufferRef *outpic = inlink->cur_buf;
+    uint8_t *p;
+    int i, j, plane;
+
+    if (fade->factor < 65536) {
+        /* luma or rgb plane */
+        for (i = 0; i < h; i++) {
+            p = outpic->data[0] + (y+i) * outpic->linesize[0];
+            for (j = 0; j < inlink->w * fade->bpp; j++) {
+                /* fade->factor is using 16 lower-order bits for decimal
+                 * places. 32768 = 1 << 15, it is an integer representation
+                 * of 0.5 and is for rounding. */
+                *p = (*p * fade->factor + 32768) >> 16;
+                p++;
+            }
+        }
+
+        if (outpic->data[0] && outpic->data[1]) {
+            /* chroma planes */
+            for (plane = 1; plane < 3; plane++) {
+                for (i = 0; i < h; i++) {
+                    p = outpic->data[plane] + ((y+i) >> fade->vsub) * outpic->linesize[plane];
+                    for (j = 0; j < inlink->w >> fade->hsub; j++) {
+                        /* 8421367 = ((128 << 1) + 1) << 15. It is an integer
+                         * representation of 128.5. The .5 is for rounding
+                         * purposes. */
+                        *p = ((*p - 128) * fade->factor + 8421367) >> 16;
+                        p++;
+                    }
+                }
+            }
+        }
+    }
+
+    avfilter_draw_slice(inlink->dst->outputs[0], y, h, slice_dir);
+}
+
+static void end_frame(AVFilterLink *inlink)
+{
+    FadeContext *fade = inlink->dst->priv;
+
+    avfilter_end_frame(inlink->dst->outputs[0]);
+
+    if (fade->frame_index >= fade->start_frame &&
+        fade->frame_index <= fade->stop_frame)
+        fade->factor += fade->fade_per_frame;
+    fade->factor = av_clip_uint16(fade->factor);
+    fade->frame_index++;
+}
+
+AVFilter avfilter_vf_fade = {
+    .name          = "fade",
+    .description   = NULL_IF_CONFIG_SMALL("Fade in/out input video"),
+    .init          = init,
+    .priv_size     = sizeof(FadeContext),
+    .query_formats = query_formats,
+
+    .inputs    = (AVFilterPad[]) {{ .name            = "default",
+                                    .type            = AVMEDIA_TYPE_VIDEO,
+                                    .config_props    = config_props,
+                                    .get_video_buffer = avfilter_null_get_video_buffer,
+                                    .start_frame      = avfilter_null_start_frame,
+                                    .draw_slice      = draw_slice,
+                                    .end_frame       = end_frame,
+                                    .min_perms       = AV_PERM_READ | AV_PERM_WRITE,
+                                    .rej_perms       = AV_PERM_PRESERVE, },
+                                  { .name = NULL}},
+    .outputs   = (AVFilterPad[]) {{ .name            = "default",
+                                    .type            = AVMEDIA_TYPE_VIDEO, },
+                                  { .name = NULL}},
+};
-- 
1.7.4.1


From news@gmane.org Tue Mar 04 03:33:20 2003
From: Anton Khirnov <anton-5jV5EzyPuF3R7s880joybQ@public.gmane.org>
Subject: [PATCH 06/10] Fix and optimize yuv blend in the
	drawtext filter
Date: Wed, 23 Mar 2011 06:30:57 +0100
Lines: 32
Message-ID: <1300858261-30193-6-git-send-email-anton@khirnov.net>
References: <1300858261-30193-1-git-send-email-anton@khirnov.net>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 06:31:22 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2GfC-0008WK-Mo
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 06:31:22 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 5808C3C095;
	Wed, 23 Mar 2011 06:31:22 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 9ADD23B201
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 06:31:14 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id 96O80H1wky63 for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 06:31:14 +0100 (CET)
Received: from smtp1.kolej.mff.cuni.cz (smtp1.kolej.mff.cuni.cz
	[78.128.192.10])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 5B61E3B1FC
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 06:31:14 +0100 (CET)
X-Envelope-From: anton-5jV5EzyPuF3R7s880joybQ@public.gmane.org
Received: from zohar.localdomain (zohar.kolej.mff.cuni.cz [78.128.198.199])
	by smtp1.kolej.mff.cuni.cz (8.14.4/8.14.4) with ESMTP id p2N5VDmG058397
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 06:31:14 +0100 (CET)
	(envelope-from anton-5jV5EzyPuF3R7s880joybQ@public.gmane.org)
Received: by zohar.localdomain (Postfix, from userid 1000)
	id 42AB77F49C; Wed, 23 Mar 2011 06:31:12 +0100 (CET)
X-Mailer: git-send-email 1.7.4.1
In-Reply-To: <1300858261-30193-1-git-send-email-anton-5jV5EzyPuF3R7s880joybQ@public.gmane.org>
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/33>

From: Michael Niedermayer <michaelni-RbZlAiThDcE@public.gmane.org>

Signed-off-by: Michael Niedermayer <michaelni-RbZlAiThDcE@public.gmane.org>
---
 libavfilter/vf_drawtext.c |   10 ++++++----
 1 files changed, 6 insertions(+), 4 deletions(-)

diff --git a/libavfilter/vf_drawtext.c b/libavfilter/vf_drawtext.c
index 08ed818..95ee5e8 100644
--- a/libavfilter/vf_drawtext.c
+++ b/libavfilter/vf_drawtext.c
@@ -371,12 +371,14 @@ static int config_input(AVFilterLink *inlink)
 
 #define SET_PIXEL_YUV(picref, yuva_color, val, x, y, hsub, vsub) {           \
     luma_pos    = ((x)          ) + ((y)          ) * picref->linesize[0]; \
-    chroma_pos1 = ((x) >> (hsub)) + ((y) >> (vsub)) * picref->linesize[1]; \
-    chroma_pos2 = ((x) >> (hsub)) + ((y) >> (vsub)) * picref->linesize[2]; \
     alpha = yuva_color[3] * (val) * 129;                               \
     picref->data[0][luma_pos]    = (alpha * yuva_color[0] + (255*255*129 - alpha) * picref->data[0][luma_pos]   ) >> 23; \
-    picref->data[1][chroma_pos1] = (alpha * yuva_color[1] + (255*255*129 - alpha) * picref->data[1][chroma_pos1]) >> 23; \
-    picref->data[2][chroma_pos2] = (alpha * yuva_color[2] + (255*255*129 - alpha) * picref->data[2][chroma_pos2]) >> 23; \
+    if(((x) & ((1<<(hsub))-1))==0 && ((y) & ((1<<(vsub))-1))==0){\
+        chroma_pos1 = ((x) >> (hsub)) + ((y) >> (vsub)) * picref->linesize[1]; \
+        chroma_pos2 = ((x) >> (hsub)) + ((y) >> (vsub)) * picref->linesize[2]; \
+        picref->data[1][chroma_pos1] = (alpha * yuva_color[1] + (255*255*129 - alpha) * picref->data[1][chroma_pos1]) >> 23; \
+        picref->data[2][chroma_pos2] = (alpha * yuva_color[2] + (255*255*129 - alpha) * picref->data[2][chroma_pos2]) >> 23; \
+    }\
 }
 
 static inline int draw_glyph_yuv(AVFilterBufferRef *picref, FT_Bitmap *bitmap, unsigned int x,
-- 
1.7.4.1


From news@gmane.org Tue Mar 04 03:33:20 2003
From: Anton Khirnov <anton-5jV5EzyPuF3R7s880joybQ@public.gmane.org>
Subject: [PATCH 02/10] Port drawtext filter by Hemanth from
	the libavfilter soc repo,
	with the following additions: * support to anti-aliased glyph
	rendering * support to UTF-8 text and Unicode chars rendering
	* support for RGB packed formats
Date: Wed, 23 Mar 2011 06:30:53 +0100
Lines: 869
Message-ID: <1300858261-30193-2-git-send-email-anton@khirnov.net>
References: <1300858261-30193-1-git-send-email-anton@khirnov.net>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 06:31:28 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2GfI-00007b-0O
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 06:31:28 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id C91093C094;
	Wed, 23 Mar 2011 06:31:27 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 9D0B73B202
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 06:31:14 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id KuKtA-67qqVX for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 06:31:14 +0100 (CET)
Received: from smtp1.kolej.mff.cuni.cz (smtp1.kolej.mff.cuni.cz
	[78.128.192.10])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id C29733B1FE
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 06:31:13 +0100 (CET)
X-Envelope-From: anton-5jV5EzyPuF3R7s880joybQ@public.gmane.org
Received: from zohar.localdomain (zohar.kolej.mff.cuni.cz [78.128.198.199])
	by smtp1.kolej.mff.cuni.cz (8.14.4/8.14.4) with ESMTP id p2N5VBNV058385
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 06:31:13 +0100 (CET)
	(envelope-from anton-5jV5EzyPuF3R7s880joybQ@public.gmane.org)
Received: by zohar.localdomain (Postfix, from userid 1000)
	id B149D7F453; Wed, 23 Mar 2011 06:31:11 +0100 (CET)
X-Mailer: git-send-email 1.7.4.1
In-Reply-To: <1300858261-30193-1-git-send-email-anton-5jV5EzyPuF3R7s880joybQ@public.gmane.org>
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/34>

From: Stefano Sabatini <stefano.sabatini-lala-Syd3ARw+vPY@public.gmane.org>

Signed-off-by: Michael Niedermayer <michaelni-RbZlAiThDcE@public.gmane.org>
---
 configure                 |    6 +
 doc/filters.texi          |  112 ++++++++
 libavfilter/Makefile      |    1 +
 libavfilter/allfilters.c  |    1 +
 libavfilter/vf_drawtext.c |  650 +++++++++++++++++++++++++++++++++++++++++++++
 5 files changed, 770 insertions(+), 0 deletions(-)
 create mode 100644 libavfilter/vf_drawtext.c

diff --git a/configure b/configure
index 00aa9ed..d6d1953 100755
--- a/configure
+++ b/configure
@@ -169,6 +169,7 @@ External library support:
                            and libraw1394 [no]
   --enable-libdirac        enable Dirac support via libdirac [no]
   --enable-libfaac         enable FAAC support via libfaac [no]
+  --enable-libfreetype     enable libfreetype [no]
   --enable-libgsm          enable GSM support via libgsm [no]
   --enable-libmp3lame      enable MP3 encoding via libmp3lame [no]
   --enable-libnut          enable NUT (de)muxing via libnut,
@@ -927,6 +928,7 @@ CONFIG_LIST="
     libdc1394
     libdirac
     libfaac
+    libfreetype
     libgsm
     libmp3lame
     libnut
@@ -1074,6 +1076,7 @@ HAVE_LIST="
     llrintf
     local_aligned_16
     local_aligned_8
+    localtime_r
     log2
     log2f
     loongson
@@ -1454,6 +1457,7 @@ udp_protocol_deps="network"
 # filters
 blackframe_filter_deps="gpl"
 cropdetect_filter_deps="gpl"
+drawtext_filter_deps="libfreetype"
 frei0r_filter_deps="frei0r dlopen strtok_r"
 frei0r_src_filter_deps="frei0r dlopen strtok_r"
 hqdn3d_filter_deps="gpl"
@@ -2768,6 +2772,7 @@ check_func  getrusage
 check_struct "sys/time.h sys/resource.h" "struct rusage" ru_maxrss
 check_func  inet_aton $network_extralibs
 check_func  isatty
+check_func  localtime_r
 check_func  ${malloc_prefix}memalign            && enable memalign
 check_func  mkstemp
 check_func  mmap
@@ -2853,6 +2858,7 @@ enabled libdirac   && require_pkg_config dirac                          \
     "libdirac_decoder/dirac_parser.h libdirac_encoder/dirac_encoder.h"  \
     "dirac_decoder_init dirac_encoder_init"
 enabled libfaac    && require2 libfaac "stdint.h faac.h" faacEncGetVersion -lfaac
+enabled libfreetype && add_cflags $(pkg-config --cflags freetype2) && require libfreetype ft2build.h FT_Init_FreeType -lfreetype
 enabled libgsm     && require  libgsm gsm/gsm.h gsm_create -lgsm
 enabled libmp3lame && require  "libmp3lame >= 3.98.3" lame/lame.h lame_set_VBR_quality -lmp3lame
 enabled libnut     && require  libnut libnut.h nut_demuxer_init -lnut
diff --git a/doc/filters.texi b/doc/filters.texi
index 872afc6..3f626d2 100644
--- a/doc/filters.texi
+++ b/doc/filters.texi
@@ -386,6 +386,118 @@ fade=in:0:25, fade=out:975:25
 fade=in:5:20
 @end example
 
+@section drawtext
+
+Draw text string or text from specified file on top of video using the
+libfreetype library.
+
+To enable compilation of this filter you need to configure FFmpeg with
+@code{--enable-libfreetype}.
+
+The filter also recognizes strftime() sequences in the provided text
+and expands them accordingly. Check the documentation of strftime().
+
+The filter accepts parameters as a list of @var{key}=@var{value} pairs,
+separated by ":".
+
+The description of the accepted parameters follows.
+
+@table @option
+
+@item fontfile
+The font file to be used for drawing text. Path must be included.
+This parameter is mandatory.
+
+@item text
+The text string to be drawn. The text must be a sequence of UTF-8
+encoded characters.
+This parameter is mandatory if no file is specified.
+
+@item textfile
+A text file containing text to be drawn. The text must be a sequence
+of UTF-8 encoded characters
+
+This parameter is mandatory if no text string is specified.
+
+If both text and textfile are specified, an error is thrown.
+
+@item x, y
+The offsets where text will be drawn within the video frame.
+Relative to the top/left border of the output image.
+
+The default value of @var{x} and @var{y} is 0.
+
+@item fontsize
+The font size to be used for drawing text.
+The default value of @var{size} is 16.
+
+@item fontcolor
+The color to be used for drawing fonts.
+Either a string (e.g. "red") or in 0xRRGGBB[AA] format
+(e.g. "0xff000033"), possibly followed by an alpha specifier.
+The default value of @var{fontcolor} is "black".
+
+@item boxcolor
+The color to be used for drawing box around text.
+Either a string (e.g. "yellow") or in 0xRRGGBB[AA] format
+(e.g. "0xff00ff"), possibly followed by an alpha specifier.
+
+The default value of @var{bgcolor} is "white".
+
+@item box
+Used to draw a box around text using background color.
+Value should be either 1 (enable) or 0 (disable).
+The default value of @var{box} is 0.
+
+@item ft_load_flags
+Flags to be used for loading the fonts.
+
+The flags map the corresponding flags supported by libfreetype, and are
+a combination of the following values:
+@table @var
+@item default
+@item no_scale
+@item no_hinting
+@item render
+@item no_bitmap
+@item vertical_layout
+@item force_autohint
+@item crop_bitmap
+@item pedantic
+@item ignore_global_advance_width
+@item no_recurse
+@item ignore_transform
+@item monochrome
+@item linear_design
+@item no_autohint
+@item end table
+@end table
+
+Default value is "render".
+
+For more information consult the documentation for the FT_LOAD_*
+libfreetype flags.
+
+@item tabsize
+The size in number of spaces to use for rendering the tab.
+Default value is 4.
+@end table
+
+For example the command:
+@example
+drawtext=fontfile=FreeSerif.ttf: text='Test Text': x=100: y=50: fontsize=24: fontcolor=yellow@@0.2: boxcolor=red@@0.2: box=1"
+@end example
+
+will draw 'Test Text' with font FreeSerif of size 24 at position
+(100,50), text color is yellow, and draw a red box around text. Both
+the text and the box have an opacity of 20%.
+
+Note that the double quotes are not necessary if spaces are not used
+within the parameter list.
+
+For more information about libfreetype, check:
+@url{http://www.freetype.org/}
+
 @section fifo
 
 Buffer input images and send them when they are requested.
diff --git a/libavfilter/Makefile b/libavfilter/Makefile
index f7bc98d..f116fe5 100644
--- a/libavfilter/Makefile
+++ b/libavfilter/Makefile
@@ -26,6 +26,7 @@ OBJS-$(CONFIG_COPY_FILTER)                   += vf_copy.o
 OBJS-$(CONFIG_CROP_FILTER)                   += vf_crop.o
 OBJS-$(CONFIG_CROPDETECT_FILTER)             += vf_cropdetect.o
 OBJS-$(CONFIG_DRAWBOX_FILTER)                += vf_drawbox.o
+OBJS-$(CONFIG_DRAWTEXT_FILTER)               += vf_drawtext.o
 OBJS-$(CONFIG_FADE_FILTER)                   += vf_fade.o
 OBJS-$(CONFIG_FIFO_FILTER)                   += vf_fifo.o
 OBJS-$(CONFIG_FORMAT_FILTER)                 += vf_format.o
diff --git a/libavfilter/allfilters.c b/libavfilter/allfilters.c
index 34e87f5..06934c8 100644
--- a/libavfilter/allfilters.c
+++ b/libavfilter/allfilters.c
@@ -45,6 +45,7 @@ void avfilter_register_all(void)
     REGISTER_FILTER (CROP,        crop,        vf);
     REGISTER_FILTER (CROPDETECT,  cropdetect,  vf);
     REGISTER_FILTER (DRAWBOX,     drawbox,     vf);
+    REGISTER_FILTER (DRAWTEXT,    drawtext,    vf);
     REGISTER_FILTER (FADE,        fade,        vf);
     REGISTER_FILTER (FIFO,        fifo,        vf);
     REGISTER_FILTER (FORMAT,      format,      vf);
diff --git a/libavfilter/vf_drawtext.c b/libavfilter/vf_drawtext.c
new file mode 100644
index 0000000..9fe6def
--- /dev/null
+++ b/libavfilter/vf_drawtext.c
@@ -0,0 +1,650 @@
+/*
+ * Copyright (c) 2011 Stefano Sabatini
+ * Copyright (c) 2010 S.N. Hemanth Meenakshisundaram
+ * Copyright (c) 2003 Gustavo Sverzut Barbieri <gsbarbieri-/E1597aS9LRfJ/NunPodnw@public.gmane.org>
+ *
+ * This file is part of FFmpeg.
+ *
+ * FFmpeg is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Lesser General Public
+ * License as published by the Free Software Foundation; either
+ * version 2.1 of the License, or (at your option) any later version.
+ *
+ * FFmpeg is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with FFmpeg; if not, write to the Free Software
+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
+ */
+
+/**
+ * @file
+ * drawtext filter, based on the original FFmpeg vhook/drawtext.c
+ * filter by Gustavo Sverzut Barbieri
+ */
+
+#include <sys/time.h>
+#include <time.h>
+
+#include "libavutil/colorspace.h"
+#include "libavutil/file.h"
+#include "libavutil/opt.h"
+#include "libavutil/parseutils.h"
+#include "libavutil/pixdesc.h"
+#include "libavutil/tree.h"
+#include "avfilter.h"
+#include "drawutils.h"
+
+#undef time
+
+#include <ft2build.h>
+#include <freetype/config/ftheader.h>
+#include FT_FREETYPE_H
+#include FT_GLYPH_H
+
+#define MAX_EXPANDED_TEXT_SIZE 2048
+
+typedef struct {
+    const AVClass *class;
+    char *fontfile;                 ///< font to be used
+    char *text;                     ///< text to be drawn
+    int ft_load_flags;              ///< flags used for loading fonts, see FT_LOAD_*
+    /** buffer containing the text expanded by strftime */
+    char expanded_text[MAX_EXPANDED_TEXT_SIZE];
+    /** positions for each element in the text */
+    FT_Vector positions[MAX_EXPANDED_TEXT_SIZE];
+    char *textfile;                 ///< file with text to be drawn
+    unsigned int x;                 ///< x position to start drawing text
+    unsigned int y;                 ///< y position to start drawing text
+    unsigned int fontsize;          ///< font size to use
+    char *fontcolor_string;         ///< font color as string
+    char *boxcolor_string;          ///< box color as string
+    uint8_t fontcolor[4];           ///< foreground color
+    uint8_t boxcolor[4];            ///< background color
+    uint8_t fontcolor_rgba[4];      ///< foreground color in RGBA
+    uint8_t boxcolor_rgba[4];       ///< background color in RGBA
+
+    short int draw_box;             ///< draw box around text - true or false
+    int use_kerning;                ///< font kerning is used - true/false
+    int tabsize;                    ///< tab size
+
+    FT_Library library;             ///< freetype font library handle
+    FT_Face face;                   ///< freetype font face handle
+    struct AVTreeNode *glyphs;      ///< rendered glyphs, stored using the UTF-32 char code
+    int hsub, vsub;                 ///< chroma subsampling values
+    int is_packed_rgb;
+    int pixel_step[4];              ///< distance in bytes between the component of each pixel
+    uint8_t rgba_map[4];            ///< map RGBA offsets to the positions in the packed RGBA format
+    uint8_t *box_line[4];           ///< line used for filling the box background
+} DrawTextContext;
+
+#define OFFSET(x) offsetof(DrawTextContext, x)
+
+static const AVOption drawtext_options[]= {
+{"fontfile", "set font file",        OFFSET(fontfile),         FF_OPT_TYPE_STRING, 0,  CHAR_MIN, CHAR_MAX },
+{"text",     "set text",             OFFSET(text),             FF_OPT_TYPE_STRING, 0,  CHAR_MIN, CHAR_MAX },
+{"textfile", "set text file",        OFFSET(textfile),         FF_OPT_TYPE_STRING, 0,  CHAR_MIN, CHAR_MAX },
+{"fontcolor","set foreground color", OFFSET(fontcolor_string), FF_OPT_TYPE_STRING, 0,  CHAR_MIN, CHAR_MAX },
+{"boxcolor", "set box color",        OFFSET(boxcolor_string),  FF_OPT_TYPE_STRING, 0,  CHAR_MIN, CHAR_MAX },
+{"box",      "set box",              OFFSET(draw_box),         FF_OPT_TYPE_INT,    0,         0,        1 },
+{"fontsize", "set font size",        OFFSET(fontsize),         FF_OPT_TYPE_INT,   16,         1,       72 },
+{"x",        "set x",                OFFSET(x),                FF_OPT_TYPE_INT,    0,         0,  INT_MAX },
+{"y",        "set y",                OFFSET(y),                FF_OPT_TYPE_INT,    0,         0,  INT_MAX },
+{"tabsize",  "set tab size",         OFFSET(tabsize),          FF_OPT_TYPE_INT,    4,         0,  INT_MAX },
+
+/* FT_LOAD_* flags */
+{"ft_load_flags", "set font loading flags for libfreetype",   OFFSET(ft_load_flags),  FF_OPT_TYPE_FLAGS,  FT_LOAD_DEFAULT|FT_LOAD_RENDER, 0, INT_MAX, 0, "ft_load_flags" },
+{"default",                     "set default",                     0, FF_OPT_TYPE_CONST, FT_LOAD_DEFAULT,                     INT_MIN, INT_MAX, 0, "ft_load_flags" },
+{"no_scale",                    "set no_scale",                    0, FF_OPT_TYPE_CONST, FT_LOAD_NO_SCALE,                    INT_MIN, INT_MAX, 0, "ft_load_flags" },
+{"no_hinting",                  "set no_hinting",                  0, FF_OPT_TYPE_CONST, FT_LOAD_NO_HINTING,                  INT_MIN, INT_MAX, 0, "ft_load_flags" },
+{"render",                      "set render",                      0, FF_OPT_TYPE_CONST, FT_LOAD_RENDER,                      INT_MIN, INT_MAX, 0, "ft_load_flags" },
+{"no_bitmap",                   "set no_bitmap",                   0, FF_OPT_TYPE_CONST, FT_LOAD_NO_BITMAP,                   INT_MIN, INT_MAX, 0, "ft_load_flags" },
+{"vertical_layout",             "set vertical_layout",             0, FF_OPT_TYPE_CONST, FT_LOAD_VERTICAL_LAYOUT,             INT_MIN, INT_MAX, 0, "ft_load_flags" },
+{"force_autohint",              "set force_autohint",              0, FF_OPT_TYPE_CONST, FT_LOAD_FORCE_AUTOHINT,              INT_MIN, INT_MAX, 0, "ft_load_flags" },
+{"crop_bitmap",                 "set crop_bitmap",                 0, FF_OPT_TYPE_CONST, FT_LOAD_CROP_BITMAP,                 INT_MIN, INT_MAX, 0, "ft_load_flags" },
+{"pedantic",                    "set pedantic",                    0, FF_OPT_TYPE_CONST, FT_LOAD_PEDANTIC,                    INT_MIN, INT_MAX, 0, "ft_load_flags" },
+{"ignore_global_advance_width", "set ignore_global_advance_width", 0, FF_OPT_TYPE_CONST, FT_LOAD_IGNORE_GLOBAL_ADVANCE_WIDTH, INT_MIN, INT_MAX, 0, "ft_load_flags" },
+{"no_recurse",                  "set no_recurse",                  0, FF_OPT_TYPE_CONST, FT_LOAD_NO_RECURSE,                  INT_MIN, INT_MAX, 0, "ft_load_flags" },
+{"ignore_transform",            "set ignore_transform",            0, FF_OPT_TYPE_CONST, FT_LOAD_IGNORE_TRANSFORM,            INT_MIN, INT_MAX, 0, "ft_load_flags" },
+{"monochrome",                  "set monochrome",                  0, FF_OPT_TYPE_CONST, FT_LOAD_MONOCHROME,                  INT_MIN, INT_MAX, 0, "ft_load_flags" },
+{"linear_design",               "set linear_design",               0, FF_OPT_TYPE_CONST, FT_LOAD_LINEAR_DESIGN,               INT_MIN, INT_MAX, 0, "ft_load_flags" },
+{"no_autohint",                 "set no_autohint",                 0, FF_OPT_TYPE_CONST, FT_LOAD_NO_AUTOHINT,                 INT_MIN, INT_MAX, 0, "ft_load_flags" },
+{NULL},
+};
+
+static const char *drawtext_get_name(void *ctx)
+{
+    return "drawtext";
+}
+
+static const AVClass drawtext_class = {
+    "DrawTextContext",
+    drawtext_get_name,
+    drawtext_options
+};
+
+#undef __FTERRORS_H__
+#define FT_ERROR_START_LIST {
+#define FT_ERRORDEF(e, v, s) { (e), (s) },
+#define FT_ERROR_END_LIST { 0, NULL } };
+
+struct ft_error
+{
+    int err;
+    const char *err_msg;
+} static ft_errors[] =
+#include FT_ERRORS_H
+
+#define FT_ERRMSG(e) ft_errors[e].err_msg
+
+typedef struct {
+    FT_Glyph *glyph;
+    uint32_t code;
+    FT_Bitmap bitmap; ///< array holding bitmaps of font
+    FT_BBox bbox;
+    int advance;
+    int bitmap_left;
+    int bitmap_top;
+} Glyph;
+
+static int glyph_cmp(const Glyph *a, const Glyph *b)
+{
+    int64_t diff = (int64_t)a->code - (int64_t)b->code;
+    return diff > 0 ? 1 : diff < 0 ? -1 : 0;
+}
+
+/**
+ * Load glyphs corresponding to the UTF-32 codepoint code.
+ */
+static int load_glyph(AVFilterContext *ctx, Glyph **glyph_ptr, uint32_t code)
+{
+    DrawTextContext *dtext = ctx->priv;
+    Glyph *glyph = av_mallocz(sizeof(Glyph));
+    struct AVTreeNode *node = NULL;
+    int ret;
+
+    /* load glyph into dtext->face->glyph */
+    ret = FT_Load_Char(dtext->face, code, dtext->ft_load_flags);
+    if (ret)
+        return AVERROR(EINVAL);
+
+    /* save glyph */
+    glyph->code  = code;
+    glyph->glyph = av_mallocz(sizeof(FT_Glyph));
+    ret = FT_Get_Glyph(dtext->face->glyph, glyph->glyph);
+    if (ret)
+        return AVERROR(EINVAL);
+
+    glyph->bitmap      = dtext->face->glyph->bitmap;
+    glyph->bitmap_left = dtext->face->glyph->bitmap_left;
+    glyph->bitmap_top  = dtext->face->glyph->bitmap_top;
+    glyph->advance     = dtext->face->glyph->advance.x >> 6;
+
+    /* measure text height to calculate text_height (or the maximum text height) */
+    FT_Glyph_Get_CBox(*glyph->glyph, ft_glyph_bbox_pixels, &glyph->bbox);
+
+    /* cache the newly created glyph */
+    if (!node)
+        node = av_mallocz(av_tree_node_size);
+    av_tree_insert(&dtext->glyphs, glyph, (void *)glyph_cmp, &node);
+
+    if (glyph_ptr)
+        *glyph_ptr = glyph;
+    return 0;
+}
+
+static av_cold int init(AVFilterContext *ctx, const char *args, void *opaque)
+{
+    int err;
+    DrawTextContext *dtext = ctx->priv;
+
+    dtext->class = &drawtext_class;
+    av_opt_set_defaults2(dtext, 0, 0);
+    dtext->fontcolor_string = av_strdup("black");
+    dtext->boxcolor_string = av_strdup("white");
+
+    if ((err = (av_set_options_string(dtext, args, "=", ":"))) < 0) {
+        av_log(ctx, AV_LOG_ERROR, "Error parsing options string: '%s'\n", args);
+        return err;
+    }
+
+    if (!dtext->fontfile) {
+        av_log(ctx, AV_LOG_ERROR, "No font filename provided\n");
+        return AVERROR(EINVAL);
+    }
+
+    if (dtext->textfile) {
+        uint8_t *textbuf;
+        size_t textbuf_size;
+
+        if (dtext->text) {
+            av_log(ctx, AV_LOG_ERROR,
+                   "Both text and text file provided. Please provide only one\n");
+            return AVERROR(EINVAL);
+        }
+        if ((err = av_file_map(dtext->textfile, &textbuf, &textbuf_size, 0, ctx)) < 0) {
+            av_log(ctx, AV_LOG_ERROR,
+                   "The text file '%s' could not be read or is empty\n",
+                   dtext->textfile);
+            return err;
+        }
+
+        if (!(dtext->text = av_malloc(textbuf_size+1)))
+            return AVERROR(ENOMEM);
+        memcpy(dtext->text, textbuf, textbuf_size);
+        dtext->text[textbuf_size] = 0;
+        av_file_unmap(textbuf, textbuf_size);
+    }
+
+    if (!dtext->text) {
+        av_log(ctx, AV_LOG_ERROR,
+               "Either text or a valid file must be provided\n");
+        return AVERROR(EINVAL);
+    }
+
+    if ((err = av_parse_color(dtext->fontcolor_rgba, dtext->fontcolor_string, -1, ctx))) {
+        av_log(ctx, AV_LOG_ERROR,
+               "Invalid font color '%s'\n", dtext->fontcolor_string);
+        return err;
+    }
+
+    if ((err = av_parse_color(dtext->boxcolor_rgba, dtext->boxcolor_string, -1, ctx))) {
+        av_log(ctx, AV_LOG_ERROR,
+               "Invalid box color '%s'\n", dtext->boxcolor_string);
+        return err;
+    }
+
+    if ((err = FT_Init_FreeType(&(dtext->library)))) {
+        av_log(ctx, AV_LOG_ERROR,
+               "Could not load FreeType: %s\n", FT_ERRMSG(err));
+        return AVERROR(EINVAL);
+    }
+
+    /* load the face, and set up the encoding, which is by default UTF-8 */
+    if ((err = FT_New_Face(dtext->library, dtext->fontfile, 0, &dtext->face))) {
+        av_log(ctx, AV_LOG_ERROR, "Could not load fontface from file '%s': %s\n",
+               dtext->fontfile, FT_ERRMSG(err));
+        return AVERROR(EINVAL);
+    }
+    if ((err = FT_Set_Pixel_Sizes(dtext->face, 0, dtext->fontsize))) {
+        av_log(ctx, AV_LOG_ERROR, "Could not set font size to %d pixels: %s\n",
+               dtext->fontsize, FT_ERRMSG(err));
+        return AVERROR(EINVAL);
+    }
+
+    dtext->use_kerning = FT_HAS_KERNING(dtext->face);
+
+    /* load the fallback glyph with code 0 */
+    load_glyph(ctx, NULL, 0);
+
+#if !HAVE_LOCALTIME_R
+    av_log(ctx, AV_LOG_WARNING, "strftime() expansion unavailable!\n");
+#else
+    if (strlen(dtext->text) >= MAX_EXPANDED_TEXT_SIZE) {
+        av_log(ctx, AV_LOG_ERROR,
+               "Impossible to print text, string is too big\n");
+        return AVERROR(EINVAL);
+    }
+#endif
+
+    return 0;
+}
+
+static int query_formats(AVFilterContext *ctx)
+{
+    static const enum PixelFormat pix_fmts[] = {
+        PIX_FMT_ARGB,    PIX_FMT_RGBA,
+        PIX_FMT_ABGR,    PIX_FMT_BGRA,
+        PIX_FMT_RGB24,   PIX_FMT_BGR24,
+        PIX_FMT_YUV420P, PIX_FMT_YUV444P,
+        PIX_FMT_YUV422P, PIX_FMT_YUV411P,
+        PIX_FMT_YUV410P, PIX_FMT_YUV440P,
+        PIX_FMT_NONE
+    };
+
+    avfilter_set_common_formats(ctx, avfilter_make_format_list(pix_fmts));
+    return 0;
+}
+
+static int glyph_enu_free(void *opaque, void *elem)
+{
+    av_free(elem);
+    return 0;
+}
+
+static av_cold void uninit(AVFilterContext *ctx)
+{
+    DrawTextContext *dtext = ctx->priv;
+    int i;
+
+    av_freep(&dtext->fontfile);
+    av_freep(&dtext->text);
+    av_freep(&dtext->fontcolor_string);
+    av_freep(&dtext->boxcolor_string);
+    av_tree_enumerate(dtext->glyphs, NULL, NULL, glyph_enu_free);
+    av_tree_destroy(dtext->glyphs);
+    dtext->glyphs = 0;
+    FT_Done_Face(dtext->face);
+    FT_Done_FreeType(dtext->library);
+
+    for (i = 0; i < 4; i++) {
+        av_freep(&dtext->box_line[i]);
+        dtext->pixel_step[i] = 0;
+    }
+
+}
+
+static int config_input(AVFilterLink *inlink)
+{
+    DrawTextContext *dtext = inlink->dst->priv;
+    const AVPixFmtDescriptor *pix_desc = &av_pix_fmt_descriptors[inlink->format];
+    int ret;
+
+    dtext->hsub = pix_desc->log2_chroma_w;
+    dtext->vsub = pix_desc->log2_chroma_h;
+
+    if ((ret =
+         ff_fill_line_with_color(dtext->box_line, dtext->pixel_step,
+                                 inlink->w, dtext->boxcolor,
+                                 inlink->format, dtext->boxcolor_rgba,
+                                 &dtext->is_packed_rgb, dtext->rgba_map)) < 0)
+        return ret;
+
+    if (!dtext->is_packed_rgb) {
+        uint8_t *rgba = dtext->fontcolor_rgba;
+        dtext->fontcolor[0] = RGB_TO_Y_CCIR(rgba[0], rgba[1], rgba[2]);
+        dtext->fontcolor[1] = RGB_TO_U_CCIR(rgba[0], rgba[1], rgba[2], 0);
+        dtext->fontcolor[2] = RGB_TO_V_CCIR(rgba[0], rgba[1], rgba[2], 0);
+        dtext->fontcolor[3] = rgba[3];
+    }
+
+    return 0;
+}
+
+#define GET_BITMAP_VAL(r, c)                                            \
+    bitmap->pixel_mode == FT_PIXEL_MODE_MONO ?                          \
+        (bitmap->buffer[(r) * bitmap->pitch + ((c)>>3)] & (0x80 >> ((c)&7))) * 255 : \
+         bitmap->buffer[(r) * bitmap->pitch +  (c)]
+
+#define SET_PIXEL_YUV(picref, yuva_color, val, x, y, hsub, vsub) {           \
+    luma_pos    = ((x)          ) + ((y)          ) * picref->linesize[0]; \
+    chroma_pos1 = ((x) >> (hsub)) + ((y) >> (vsub)) * picref->linesize[1]; \
+    chroma_pos2 = ((x) >> (hsub)) + ((y) >> (vsub)) * picref->linesize[2]; \
+    alpha = (yuva_color[3] * (val)) / 255;                               \
+    picref->data[0][luma_pos] = (alpha * yuva_color[0] + (255 - alpha) * picref->data[0][luma_pos]) >> 8; \
+    alpha = (yuva_color[3] * (val)) / 224;                               \
+    picref->data[1][chroma_pos1] = 16 + (alpha * (yuva_color[1]-16) + (224 - alpha) * (picref->data[1][chroma_pos1]-16)) / 224; \
+    picref->data[2][chroma_pos2] = 16 + (alpha * (yuva_color[2]-16) + (224 - alpha) * (picref->data[2][chroma_pos2]-16)) / 224; \
+}
+
+static inline int draw_glyph_yuv(AVFilterBufferRef *picref, FT_Bitmap *bitmap, unsigned int x,
+                                 unsigned int y, unsigned int width, unsigned int height,
+                                 unsigned char yuva_color[4], int hsub, int vsub)
+{
+    int r, c, alpha;
+    unsigned int luma_pos, chroma_pos1, chroma_pos2;
+    uint8_t src_val, dst_pixel[4];
+
+    for (r = 0; r < bitmap->rows && r+y < height; r++) {
+        for (c = 0; c < bitmap->width && c+x < width; c++) {
+            /* get pixel in the picref (destination) */
+            dst_pixel[0] = picref->data[0][  c+x           +  (y+r)          * picref->linesize[0]];
+            dst_pixel[1] = picref->data[1][((c+x) >> hsub) + ((y+r) >> vsub) * picref->linesize[1]];
+            dst_pixel[2] = picref->data[2][((c+x) >> hsub) + ((y+r) >> vsub) * picref->linesize[2]];
+
+            /* get intensity value in the glyph bitmap (source) */
+            src_val = GET_BITMAP_VAL(r, c);
+            if (!src_val)
+                continue;
+
+            SET_PIXEL_YUV(picref, yuva_color, src_val, c+x, y+r, hsub, vsub);
+        }
+    }
+
+    return 0;
+}
+
+#define SET_PIXEL_RGB(picref, rgba_color, val, x, y, pixel_step, r_off, g_off, b_off, a_off) { \
+    p   = picref->data[0] + (x) * pixel_step + ((y) * picref->linesize[0]); \
+    alpha = (rgba_color[3] * (val)) / 255;                              \
+    *(p+r_off) = (alpha * rgba_color[0] + (255 - alpha) * *(p+r_off)) >> 8; \
+    *(p+g_off) = (alpha * rgba_color[1] + (255 - alpha) * *(p+g_off)) >> 8; \
+    *(p+b_off) = (alpha * rgba_color[2] + (255 - alpha) * *(p+b_off)) >> 8; \
+}
+
+static inline int draw_glyph_rgb(AVFilterBufferRef *picref, FT_Bitmap *bitmap,
+                                 unsigned int x, unsigned int y,
+                                 unsigned int width, unsigned int height, int pixel_step,
+                                 unsigned char rgba_color[4], uint8_t rgba_map[4])
+{
+    int r, c, alpha;
+    uint8_t *p;
+    uint8_t src_val, dst_pixel[4];
+
+    for (r = 0; r < bitmap->rows && r+y < height; r++) {
+        for (c = 0; c < bitmap->width && c+x < width; c++) {
+            /* get pixel in the picref (destination) */
+            dst_pixel[0] = picref->data[0][(c+x + rgba_map[0]) * pixel_step +
+                                           (y+r) * picref->linesize[0]];
+            dst_pixel[1] = picref->data[0][(c+x + rgba_map[1]) * pixel_step +
+                                           (y+r) * picref->linesize[0]];
+            dst_pixel[2] = picref->data[0][(c+x + rgba_map[2]) * pixel_step +
+                                           (y+r) * picref->linesize[0]];
+
+            /* get intensity value in the glyph bitmap (source) */
+            src_val = GET_BITMAP_VAL(r, c);
+            if (!src_val)
+                continue;
+
+            SET_PIXEL_RGB(picref, rgba_color, src_val, c+x, y+r, pixel_step,
+                          rgba_map[0], rgba_map[1], rgba_map[2], rgba_map[3]);
+        }
+    }
+
+    return 0;
+}
+
+static inline void drawbox(AVFilterBufferRef *picref, unsigned int x, unsigned int y,
+                           unsigned int width, unsigned int height,
+                           uint8_t *line[4], int pixel_step[4], uint8_t color[4],
+                           int hsub, int vsub, int is_rgba_packed, uint8_t rgba_map[4])
+{
+    int i, j, alpha;
+
+    if (color[3] != 0xFF) {
+        if (is_rgba_packed) {
+            uint8_t *p;
+            for (j = 0; j < height; j++)
+                for (i = 0; i < width; i++)
+                    SET_PIXEL_RGB(picref, color, 255, i+x, y+j, pixel_step[0],
+                                  rgba_map[0], rgba_map[1], rgba_map[2], rgba_map[3]);
+        } else {
+            unsigned int luma_pos, chroma_pos1, chroma_pos2;
+            for (j = 0; j < height; j++)
+                for (i = 0; i < width; i++)
+                    SET_PIXEL_YUV(picref, color, 255, i+x, y+j, hsub, vsub);
+        }
+    } else {
+        ff_draw_rectangle(picref->data, picref->linesize,
+                          line, pixel_step, hsub, vsub,
+                          x, y, width, height);
+    }
+}
+
+static int draw_text(AVFilterContext *ctx, AVFilterBufferRef *picref,
+                     int width, int height)
+{
+    DrawTextContext *dtext = ctx->priv;
+    char *text = dtext->text;
+    uint32_t code = 0, prev_code = 0;
+    int x = 0, y = 0, i = 0;
+    int text_height, baseline;
+    uint8_t *p;
+    int str_w, str_w_max;
+    int y_min = 32000, y_max = -32000;
+    FT_Vector delta;
+    Glyph *glyph = NULL, *prev_glyph = NULL;
+    Glyph dummy = { 0 };
+
+#if HAVE_LOCALTIME_R
+    time_t now = time(0);
+    struct tm ltime;
+    size_t expanded_text_len;
+
+    dtext->expanded_text[0] = '\1';
+    expanded_text_len = strftime(dtext->expanded_text, MAX_EXPANDED_TEXT_SIZE,
+                                 text, localtime_r(&now, &ltime));
+    text = dtext->expanded_text;
+    if (expanded_text_len == 0 && dtext->expanded_text[0] != '\0') {
+        av_log(ctx, AV_LOG_ERROR,
+               "Impossible to print text, string is too big\n");
+        return AVERROR(EINVAL);
+    }
+#endif
+
+    str_w = str_w_max = 0;
+    x = dtext->x;
+    y = dtext->y;
+
+    /* load and cache glyphs */
+    for (i = 0, p = text; *p; i++) {
+        GET_UTF8(code, *p++, continue;);
+
+        /* get glyph */
+        dummy.code = code;
+        glyph = av_tree_find(dtext->glyphs, &dummy, (void *)glyph_cmp, NULL);
+        if (!glyph)
+            load_glyph(ctx, &glyph, code);
+
+        y_min = FFMIN(glyph->bbox.yMin, y_min);
+        y_max = FFMAX(glyph->bbox.yMax, y_max);
+    }
+    text_height = y_max - y_min;
+    baseline    = y_max;
+
+    /* compute and save position for each glyph */
+    glyph = NULL;
+    for (i = 0, p = text; *p; i++) {
+        GET_UTF8(code, *p++, continue;);
+
+        /* skip the \n in the sequence \r\n */
+        if (prev_code == '\r' && code == '\n')
+            continue;
+
+        /* get glyph */
+        prev_glyph = glyph;
+        dummy.code = code;
+        glyph = av_tree_find(dtext->glyphs, &dummy, (void *)glyph_cmp, NULL);
+
+        /* kerning */
+        if (dtext->use_kerning && prev_glyph && glyph->code) {
+            FT_Get_Kerning(dtext->face, prev_glyph->code, glyph->code,
+                           ft_kerning_default, &delta);
+            x += delta.x >> 6;
+        }
+
+        if (x + glyph->advance >= width || code == '\r' || code == '\n') {
+            if (x + glyph->advance >= width)
+                str_w_max = width - dtext->x - 1;
+            y += text_height;
+            x = dtext->x;
+        }
+
+        /* save position */
+        dtext->positions[i].x = x + glyph->bitmap_left;
+        dtext->positions[i].y = y - glyph->bitmap_top + baseline;
+        if (code != '\n' && code != '\r') {
+            int advance = glyph->advance;
+            if (code == '\t')
+                advance *= dtext->tabsize;
+            x     += advance;
+            str_w += advance;
+        }
+        prev_code = code;
+    }
+
+    y += text_height;
+    if (str_w_max == 0)
+        str_w_max = str_w;
+
+    /* draw box */
+    if (dtext->draw_box) {
+        /* check if it doesn't pass the limits */
+        str_w_max = FFMIN(str_w_max, width - dtext->x - 1);
+        y = FFMIN(y, height - 1);
+
+        /* draw background */
+        drawbox(picref, dtext->x, dtext->y, str_w_max, y-dtext->y,
+                dtext->box_line, dtext->pixel_step, dtext->boxcolor,
+                dtext->hsub, dtext->vsub, dtext->is_packed_rgb, dtext->rgba_map);
+    }
+
+    /* draw glyphs */
+    for (i = 0, p = text; *p; i++) {
+        Glyph dummy = { 0 };
+        GET_UTF8(code, *p++, continue;);
+
+        /* skip new line chars, just go to new line */
+        if (code == '\n' || code == '\r' || code == '\t')
+            continue;
+
+        dummy.code = code;
+        glyph = av_tree_find(dtext->glyphs, &dummy, (void *)glyph_cmp, NULL);
+
+        if (glyph->bitmap.pixel_mode != FT_PIXEL_MODE_MONO &&
+            glyph->bitmap.pixel_mode != FT_PIXEL_MODE_GRAY)
+            return AVERROR(EINVAL);
+
+        if (dtext->is_packed_rgb) {
+            draw_glyph_rgb(picref, &glyph->bitmap,
+                           dtext->positions[i].x, dtext->positions[i].y, width, height,
+                           dtext->pixel_step[0], dtext->fontcolor_rgba, dtext->rgba_map);
+        } else {
+            draw_glyph_yuv(picref, &glyph->bitmap,
+                           dtext->positions[i].x, dtext->positions[i].y, width, height,
+                           dtext->fontcolor, dtext->hsub, dtext->vsub);
+        }
+    }
+
+    return 0;
+}
+
+static void null_draw_slice(AVFilterLink *link, int y, int h, int slice_dir) { }
+
+static void end_frame(AVFilterLink *inlink)
+{
+    AVFilterLink *outlink = inlink->dst->outputs[0];
+    AVFilterBufferRef *picref = inlink->cur_buf;
+
+    draw_text(inlink->dst, picref, picref->video->w, picref->video->h);
+
+    avfilter_draw_slice(outlink, 0, picref->video->h, 1);
+    avfilter_end_frame(outlink);
+}
+
+AVFilter avfilter_vf_drawtext = {
+    .name          = "drawtext",
+    .description   = NULL_IF_CONFIG_SMALL("Draw text on top of video frames using libfreetype library."),
+    .priv_size     = sizeof(DrawTextContext),
+    .init          = init,
+    .uninit        = uninit,
+    .query_formats = query_formats,
+
+    .inputs    = (AVFilterPad[]) {{ .name             = "default",
+                                    .type             = AVMEDIA_TYPE_VIDEO,
+                                    .get_video_buffer = avfilter_null_get_video_buffer,
+                                    .start_frame      = avfilter_null_start_frame,
+                                    .draw_slice       = null_draw_slice,
+                                    .end_frame        = end_frame,
+                                    .config_props     = config_input,
+                                    .min_perms        = AV_PERM_WRITE |
+                                                        AV_PERM_READ,
+                                    .rej_perms        = AV_PERM_PRESERVE },
+                                  { .name = NULL}},
+    .outputs   = (AVFilterPad[]) {{ .name             = "default",
+                                    .type             = AVMEDIA_TYPE_VIDEO, },
+                                  { .name = NULL}},
+};
-- 
1.7.4.1


From news@gmane.org Tue Mar 04 03:33:20 2003
From: Anton Khirnov <anton-5jV5EzyPuF3R7s880joybQ@public.gmane.org>
Subject: [PATCH 07/10] factor draw_glyphs out of drawtext
	filter
Date: Wed, 23 Mar 2011 06:30:58 +0100
Lines: 101
Message-ID: <1300858261-30193-7-git-send-email-anton@khirnov.net>
References: <1300858261-30193-1-git-send-email-anton@khirnov.net>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 06:31:29 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2GfJ-00008B-Id
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 06:31:29 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 5900E3C09E;
	Wed, 23 Mar 2011 06:31:29 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id DBD533C06C
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 06:31:14 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id QXnpVcQJ3+6n for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 06:31:14 +0100 (CET)
Received: from smtp1.kolej.mff.cuni.cz (smtp1.kolej.mff.cuni.cz
	[78.128.192.10])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 5D4EE3C06F
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 06:31:14 +0100 (CET)
X-Envelope-From: anton-5jV5EzyPuF3R7s880joybQ@public.gmane.org
Received: from zohar.localdomain (zohar.kolej.mff.cuni.cz [78.128.198.199])
	by smtp1.kolej.mff.cuni.cz (8.14.4/8.14.4) with ESMTP id p2N5VDTV058398
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 06:31:14 +0100 (CET)
	(envelope-from anton-5jV5EzyPuF3R7s880joybQ@public.gmane.org)
Received: by zohar.localdomain (Postfix, from userid 1000)
	id 609107F4CD; Wed, 23 Mar 2011 06:31:12 +0100 (CET)
X-Mailer: git-send-email 1.7.4.1
In-Reply-To: <1300858261-30193-1-git-send-email-anton-5jV5EzyPuF3R7s880joybQ@public.gmane.org>
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/35>

From: Michael Niedermayer <michaelni-RbZlAiThDcE@public.gmane.org>

Signed-off-by: Michael Niedermayer <michaelni-RbZlAiThDcE@public.gmane.org>
---
 libavfilter/vf_drawtext.c |   68 +++++++++++++++++++++++++++------------------
 1 files changed, 41 insertions(+), 27 deletions(-)

diff --git a/libavfilter/vf_drawtext.c b/libavfilter/vf_drawtext.c
index 95ee5e8..7802208 100644
--- a/libavfilter/vf_drawtext.c
+++ b/libavfilter/vf_drawtext.c
@@ -475,13 +475,51 @@ static inline void drawbox(AVFilterBufferRef *picref, unsigned int x, unsigned i
     }
 }
 
+static int draw_glyphs(DrawTextContext *dtext, AVFilterBufferRef *picref,
+                        int width, int height)
+{
+    char *text = dtext->text;
+    uint32_t code = 0;
+    int i;
+    uint8_t *p;
+    Glyph *glyph = NULL;
+
+    for (i = 0, p = text; *p; i++) {
+        Glyph dummy = { 0 };
+        GET_UTF8(code, *p++, continue;);
+
+        /* skip new line chars, just go to new line */
+        if (code == '\n' || code == '\r' || code == '\t')
+            continue;
+
+        dummy.code = code;
+        glyph = av_tree_find(dtext->glyphs, &dummy, (void *)glyph_cmp, NULL);
+
+        if (glyph->bitmap.pixel_mode != FT_PIXEL_MODE_MONO &&
+            glyph->bitmap.pixel_mode != FT_PIXEL_MODE_GRAY)
+            return AVERROR(EINVAL);
+
+        if (dtext->is_packed_rgb) {
+            draw_glyph_rgb(picref, &glyph->bitmap,
+                           dtext->positions[i].x, dtext->positions[i].y, width, height,
+                           dtext->pixel_step[0], dtext->fontcolor_rgba, dtext->rgba_map);
+        } else {
+            draw_glyph_yuv(picref, &glyph->bitmap,
+                           dtext->positions[i].x, dtext->positions[i].y, width, height,
+                           dtext->fontcolor, dtext->hsub, dtext->vsub);
+        }
+    }
+
+    return 0;
+}
+
 static int draw_text(AVFilterContext *ctx, AVFilterBufferRef *picref,
                      int width, int height)
 {
     DrawTextContext *dtext = ctx->priv;
     char *text = dtext->text;
     uint32_t code = 0, prev_code = 0;
-    int x = 0, y = 0, i = 0;
+    int x = 0, y = 0, i = 0, ret;
     int text_height, baseline;
     uint8_t *p;
     int str_w, str_w_max;
@@ -583,32 +621,8 @@ static int draw_text(AVFilterContext *ctx, AVFilterBufferRef *picref,
                 dtext->hsub, dtext->vsub, dtext->is_packed_rgb, dtext->rgba_map);
     }
 
-    /* draw glyphs */
-    for (i = 0, p = text; *p; i++) {
-        Glyph dummy = { 0 };
-        GET_UTF8(code, *p++, continue;);
-
-        /* skip new line chars, just go to new line */
-        if (code == '\n' || code == '\r' || code == '\t')
-            continue;
-
-        dummy.code = code;
-        glyph = av_tree_find(dtext->glyphs, &dummy, (void *)glyph_cmp, NULL);
-
-        if (glyph->bitmap.pixel_mode != FT_PIXEL_MODE_MONO &&
-            glyph->bitmap.pixel_mode != FT_PIXEL_MODE_GRAY)
-            return AVERROR(EINVAL);
-
-        if (dtext->is_packed_rgb) {
-            draw_glyph_rgb(picref, &glyph->bitmap,
-                           dtext->positions[i].x, dtext->positions[i].y, width, height,
-                           dtext->pixel_step[0], dtext->fontcolor_rgba, dtext->rgba_map);
-        } else {
-            draw_glyph_yuv(picref, &glyph->bitmap,
-                           dtext->positions[i].x, dtext->positions[i].y, width, height,
-                           dtext->fontcolor, dtext->hsub, dtext->vsub);
-        }
-    }
+    if((ret=draw_glyphs(dtext, picref, width, height))<0)
+        return ret;
 
     return 0;
 }
-- 
1.7.4.1


From news@gmane.org Tue Mar 04 03:33:20 2003
From: Anton Khirnov <anton-5jV5EzyPuF3R7s880joybQ@public.gmane.org>
Subject: [PATCH 08/10] Add shadow support to the drawtext
	filter
Date: Wed, 23 Mar 2011 06:30:59 +0100
Lines: 126
Message-ID: <1300858261-30193-8-git-send-email-anton@khirnov.net>
References: <1300858261-30193-1-git-send-email-anton@khirnov.net>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 06:31:32 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2GfK-00008P-3K
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 06:31:30 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id DDEDF3C0A2;
	Wed, 23 Mar 2011 06:31:29 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id E9EDC3C090
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 06:31:14 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id 8RtLIROiK+oN for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 06:31:14 +0100 (CET)
Received: from smtp1.kolej.mff.cuni.cz (smtp1.kolej.mff.cuni.cz
	[78.128.192.10])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 5E7AD3C070
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 06:31:14 +0100 (CET)
X-Envelope-From: anton-5jV5EzyPuF3R7s880joybQ@public.gmane.org
Received: from zohar.localdomain (zohar.kolej.mff.cuni.cz [78.128.198.199])
	by smtp1.kolej.mff.cuni.cz (8.14.4/8.14.4) with ESMTP id p2N5VDlI058400
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 06:31:14 +0100 (CET)
	(envelope-from anton-5jV5EzyPuF3R7s880joybQ@public.gmane.org)
Received: by zohar.localdomain (Postfix, from userid 1000)
	id 7905F7F4DA; Wed, 23 Mar 2011 06:31:12 +0100 (CET)
X-Mailer: git-send-email 1.7.4.1
In-Reply-To: <1300858261-30193-1-git-send-email-anton-5jV5EzyPuF3R7s880joybQ@public.gmane.org>
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/36>

From: Michael Niedermayer <michaelni-RbZlAiThDcE@public.gmane.org>

Signed-off-by: Michael Niedermayer <michaelni-RbZlAiThDcE@public.gmane.org>
---
 libavfilter/vf_drawtext.c |   37 +++++++++++++++++++++++++++++++------
 1 files changed, 31 insertions(+), 6 deletions(-)

diff --git a/libavfilter/vf_drawtext.c b/libavfilter/vf_drawtext.c
index 7802208..2751354 100644
--- a/libavfilter/vf_drawtext.c
+++ b/libavfilter/vf_drawtext.c
@@ -59,13 +59,17 @@ typedef struct {
     char *textfile;                 ///< file with text to be drawn
     unsigned int x;                 ///< x position to start drawing text
     unsigned int y;                 ///< y position to start drawing text
+    int shadowx, shadowy;
     unsigned int fontsize;          ///< font size to use
     char *fontcolor_string;         ///< font color as string
     char *boxcolor_string;          ///< box color as string
+    char *shadowcolor_string;       ///< shadow color as string
     uint8_t fontcolor[4];           ///< foreground color
     uint8_t boxcolor[4];            ///< background color
+    uint8_t shadowcolor[4];         ///< shadow color
     uint8_t fontcolor_rgba[4];      ///< foreground color in RGBA
     uint8_t boxcolor_rgba[4];       ///< background color in RGBA
+    uint8_t shadowcolor_rgba[4];    ///< shadow color in RGBA
 
     short int draw_box;             ///< draw box around text - true or false
     int use_kerning;                ///< font kerning is used - true/false
@@ -89,10 +93,13 @@ static const AVOption drawtext_options[]= {
 {"textfile", "set text file",        OFFSET(textfile),         FF_OPT_TYPE_STRING, 0,  CHAR_MIN, CHAR_MAX },
 {"fontcolor","set foreground color", OFFSET(fontcolor_string), FF_OPT_TYPE_STRING, 0,  CHAR_MIN, CHAR_MAX },
 {"boxcolor", "set box color",        OFFSET(boxcolor_string),  FF_OPT_TYPE_STRING, 0,  CHAR_MIN, CHAR_MAX },
+{"shadowcolor", "set shadow color",  OFFSET(shadowcolor_string),  FF_OPT_TYPE_STRING, 0,  CHAR_MIN, CHAR_MAX },
 {"box",      "set box",              OFFSET(draw_box),         FF_OPT_TYPE_INT,    0,         0,        1 },
 {"fontsize", "set font size",        OFFSET(fontsize),         FF_OPT_TYPE_INT,   16,         1,       72 },
 {"x",        "set x",                OFFSET(x),                FF_OPT_TYPE_INT,    0,         0,  INT_MAX },
 {"y",        "set y",                OFFSET(y),                FF_OPT_TYPE_INT,    0,         0,  INT_MAX },
+{"shadowx",  "set x",                OFFSET(shadowx),          FF_OPT_TYPE_INT,    0,         0,  INT_MAX },
+{"shadowy",  "set y",                OFFSET(shadowy),          FF_OPT_TYPE_INT,    0,         0,  INT_MAX },
 {"tabsize",  "set tab size",         OFFSET(tabsize),          FF_OPT_TYPE_INT,    4,         0,  INT_MAX },
 
 /* FT_LOAD_* flags */
@@ -205,6 +212,7 @@ static av_cold int init(AVFilterContext *ctx, const char *args, void *opaque)
     av_opt_set_defaults2(dtext, 0, 0);
     dtext->fontcolor_string = av_strdup("black");
     dtext->boxcolor_string = av_strdup("white");
+    dtext->shadowcolor_string = av_strdup("black");
 
     if ((err = (av_set_options_string(dtext, args, "=", ":"))) < 0) {
         av_log(ctx, AV_LOG_ERROR, "Error parsing options string: '%s'\n", args);
@@ -257,6 +265,12 @@ static av_cold int init(AVFilterContext *ctx, const char *args, void *opaque)
         return err;
     }
 
+    if ((err = av_parse_color(dtext->shadowcolor_rgba, dtext->shadowcolor_string, -1, ctx))) {
+        av_log(ctx, AV_LOG_ERROR,
+               "Invalid shadow color '%s'\n", dtext->shadowcolor_string);
+        return err;
+    }
+
     if ((err = FT_Init_FreeType(&(dtext->library)))) {
         av_log(ctx, AV_LOG_ERROR,
                "Could not load FreeType: %s\n", FT_ERRMSG(err));
@@ -324,6 +338,7 @@ static av_cold void uninit(AVFilterContext *ctx)
     av_freep(&dtext->text);
     av_freep(&dtext->fontcolor_string);
     av_freep(&dtext->boxcolor_string);
+    av_freep(&dtext->shadowcolor_string);
     av_tree_enumerate(dtext->glyphs, NULL, NULL, glyph_enu_free);
     av_tree_destroy(dtext->glyphs);
     dtext->glyphs = 0;
@@ -359,6 +374,11 @@ static int config_input(AVFilterLink *inlink)
         dtext->fontcolor[1] = RGB_TO_U_CCIR(rgba[0], rgba[1], rgba[2], 0);
         dtext->fontcolor[2] = RGB_TO_V_CCIR(rgba[0], rgba[1], rgba[2], 0);
         dtext->fontcolor[3] = rgba[3];
+        rgba = dtext->shadowcolor_rgba;
+        dtext->shadowcolor[0] = RGB_TO_Y_CCIR(rgba[0], rgba[1], rgba[2]);
+        dtext->shadowcolor[1] = RGB_TO_U_CCIR(rgba[0], rgba[1], rgba[2], 0);
+        dtext->shadowcolor[2] = RGB_TO_V_CCIR(rgba[0], rgba[1], rgba[2], 0);
+        dtext->shadowcolor[3] = rgba[3];
     }
 
     return 0;
@@ -476,7 +496,7 @@ static inline void drawbox(AVFilterBufferRef *picref, unsigned int x, unsigned i
 }
 
 static int draw_glyphs(DrawTextContext *dtext, AVFilterBufferRef *picref,
-                        int width, int height)
+                       int width, int height, const uint8_t rgbcolor[4], const uint8_t yuvcolor[4], int x, int y)
 {
     char *text = dtext->text;
     uint32_t code = 0;
@@ -501,12 +521,12 @@ static int draw_glyphs(DrawTextContext *dtext, AVFilterBufferRef *picref,
 
         if (dtext->is_packed_rgb) {
             draw_glyph_rgb(picref, &glyph->bitmap,
-                           dtext->positions[i].x, dtext->positions[i].y, width, height,
-                           dtext->pixel_step[0], dtext->fontcolor_rgba, dtext->rgba_map);
+                           dtext->positions[i].x+x, dtext->positions[i].y+y, width, height,
+                           dtext->pixel_step[0], rgbcolor, dtext->rgba_map);
         } else {
             draw_glyph_yuv(picref, &glyph->bitmap,
-                           dtext->positions[i].x, dtext->positions[i].y, width, height,
-                           dtext->fontcolor, dtext->hsub, dtext->vsub);
+                           dtext->positions[i].x+x, dtext->positions[i].y+y, width, height,
+                           yuvcolor, dtext->hsub, dtext->vsub);
         }
     }
 
@@ -621,7 +641,12 @@ static int draw_text(AVFilterContext *ctx, AVFilterBufferRef *picref,
                 dtext->hsub, dtext->vsub, dtext->is_packed_rgb, dtext->rgba_map);
     }
 
-    if((ret=draw_glyphs(dtext, picref, width, height))<0)
+    if(dtext->shadowx || dtext->shadowy){
+        if((ret=draw_glyphs(dtext, picref, width, height, dtext->shadowcolor_rgba, dtext->shadowcolor, dtext->shadowx, dtext->shadowy))<0)
+            return ret;
+    }
+
+    if((ret=draw_glyphs(dtext, picref, width, height, dtext->fontcolor_rgba, dtext->fontcolor, 0, 0))<0)
         return ret;
 
     return 0;
-- 
1.7.4.1


From news@gmane.org Tue Mar 04 03:33:20 2003
From: Anton Khirnov <anton-5jV5EzyPuF3R7s880joybQ@public.gmane.org>
Subject: [PATCH 10/10] Reduce picture size for yadif.
	Signed-off-by: Michael Niedermayer <michaelni-RbZlAiThDcE@public.gmane.org>
Date: Wed, 23 Mar 2011 06:31:01 +0100
Lines: 30
Message-ID: <1300858261-30193-10-git-send-email-anton@khirnov.net>
References: <1300858261-30193-1-git-send-email-anton@khirnov.net>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 06:31:32 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2GfL-00008d-IU
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 06:31:31 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 5A78C3C0A6;
	Wed, 23 Mar 2011 06:31:31 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 1AB0B3C06F
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 06:31:15 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id bRFuAkil70Fc for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 06:31:15 +0100 (CET)
Received: from smtp1.kolej.mff.cuni.cz (smtp1.kolej.mff.cuni.cz
	[78.128.192.10])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 6AAF73B1F9
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 06:31:14 +0100 (CET)
X-Envelope-From: anton-5jV5EzyPuF3R7s880joybQ@public.gmane.org
Received: from zohar.localdomain (zohar.kolej.mff.cuni.cz [78.128.198.199])
	by smtp1.kolej.mff.cuni.cz (8.14.4/8.14.4) with ESMTP id p2N5VDZR058399
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 06:31:14 +0100 (CET)
	(envelope-from anton-5jV5EzyPuF3R7s880joybQ@public.gmane.org)
Received: by zohar.localdomain (Postfix, from userid 1000)
	id 99A297F4F5; Wed, 23 Mar 2011 06:31:12 +0100 (CET)
X-Mailer: git-send-email 1.7.4.1
In-Reply-To: <1300858261-30193-1-git-send-email-anton-5jV5EzyPuF3R7s880joybQ@public.gmane.org>
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/37>

From: Michael Niedermayer <michaelni-RbZlAiThDcE@public.gmane.org>

---
 libavfilter/vf_yadif.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/libavfilter/vf_yadif.c b/libavfilter/vf_yadif.c
index 176349a..7a488d6 100644
--- a/libavfilter/vf_yadif.c
+++ b/libavfilter/vf_yadif.c
@@ -150,7 +150,7 @@ static AVFilterBufferRef *get_video_buffer(AVFilterLink *link, int perms, int w,
 {
     AVFilterBufferRef *picref;
     int width = FFALIGN(w, 32);
-    int height= FFALIGN(h+6, 32);
+    int height= FFALIGN(h+2, 32);
     int i;
 
     picref = avfilter_default_get_video_buffer(link, perms, width, height);
@@ -159,7 +159,7 @@ static AVFilterBufferRef *get_video_buffer(AVFilterLink *link, int perms, int w,
     picref->video->h = h;
 
     for (i = 0; i < 3; i++)
-        picref->data[i] += 3 * picref->linesize[i];
+        picref->data[i] += picref->linesize[i];
 
     return picref;
 }
-- 
1.7.4.1


From news@gmane.org Tue Mar 04 03:33:20 2003
From: Anton Khirnov <anton-5jV5EzyPuF3R7s880joybQ@public.gmane.org>
Subject: [PATCH 09/10] Change yadif to not use out of picture
	lines.
Date: Wed, 23 Mar 2011 06:31:00 +0100
Lines: 130
Message-ID: <1300858261-30193-9-git-send-email-anton@khirnov.net>
References: <1300858261-30193-1-git-send-email-anton@khirnov.net>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 06:31:33 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2GfM-00008f-2D
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 06:31:32 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id CFA393C0AA;
	Wed, 23 Mar 2011 06:31:31 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 2AF383C070
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 06:31:15 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id YLbmMgRVhvKA for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 06:31:15 +0100 (CET)
Received: from smtp1.kolej.mff.cuni.cz (smtp1.kolej.mff.cuni.cz
	[78.128.192.10])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 641423C08E
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 06:31:14 +0100 (CET)
X-Envelope-From: anton-5jV5EzyPuF3R7s880joybQ@public.gmane.org
Received: from zohar.localdomain (zohar.kolej.mff.cuni.cz [78.128.198.199])
	by smtp1.kolej.mff.cuni.cz (8.14.4/8.14.4) with ESMTP id p2N5VDVn058401
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 06:31:14 +0100 (CET)
	(envelope-from anton-5jV5EzyPuF3R7s880joybQ@public.gmane.org)
Received: by zohar.localdomain (Postfix, from userid 1000)
	id B33287F503; Wed, 23 Mar 2011 06:31:12 +0100 (CET)
X-Mailer: git-send-email 1.7.4.1
In-Reply-To: <1300858261-30193-1-git-send-email-anton-5jV5EzyPuF3R7s880joybQ@public.gmane.org>
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/38>

From: Michael Niedermayer <michaelni-RbZlAiThDcE@public.gmane.org>

Fixes issue2272.

Signed-off-by: Michael Niedermayer <michaelni-RbZlAiThDcE@public.gmane.org>
---
 libavfilter/vf_yadif.c           |   31 ++++++++++++++++---------------
 libavfilter/x86/yadif_template.c |    6 +++---
 libavfilter/yadif.h              |    6 +++---
 3 files changed, 22 insertions(+), 21 deletions(-)

diff --git a/libavfilter/vf_yadif.c b/libavfilter/vf_yadif.c
index e12a3c3..176349a 100644
--- a/libavfilter/vf_yadif.c
+++ b/libavfilter/vf_yadif.c
@@ -50,42 +50,42 @@ typedef struct {
     AVFilterBufferRef *out;
     void (*filter_line)(uint8_t *dst,
                         uint8_t *prev, uint8_t *cur, uint8_t *next,
-                        int w, int refs, int parity, int mode);
+                        int w, int prefs, int mrefs, int parity, int mode);
 } YADIFContext;
 
 static void filter_line_c(uint8_t *dst,
                           uint8_t *prev, uint8_t *cur, uint8_t *next,
-                          int w, int refs, int parity, int mode)
+                          int w, int prefs, int mrefs, int parity, int mode)
 {
     int x;
     uint8_t *prev2 = parity ? prev : cur ;
     uint8_t *next2 = parity ? cur  : next;
     for (x = 0;  x < w; x++) {
-        int c = cur[-refs];
+        int c = cur[mrefs];
         int d = (prev2[0] + next2[0])>>1;
-        int e = cur[+refs];
+        int e = cur[prefs];
         int temporal_diff0 = FFABS(prev2[0] - next2[0]);
-        int temporal_diff1 =(FFABS(prev[-refs] - c) + FFABS(prev[+refs] - e) )>>1;
-        int temporal_diff2 =(FFABS(next[-refs] - c) + FFABS(next[+refs] - e) )>>1;
+        int temporal_diff1 =(FFABS(prev[mrefs] - c) + FFABS(prev[prefs] - e) )>>1;
+        int temporal_diff2 =(FFABS(next[mrefs] - c) + FFABS(next[prefs] - e) )>>1;
         int diff = FFMAX3(temporal_diff0>>1, temporal_diff1, temporal_diff2);
         int spatial_pred = (c+e)>>1;
-        int spatial_score = FFABS(cur[-refs-1] - cur[+refs-1]) + FFABS(c-e)
-                          + FFABS(cur[-refs+1] - cur[+refs+1]) - 1;
+        int spatial_score = FFABS(cur[mrefs-1] - cur[prefs-1]) + FFABS(c-e)
+                          + FFABS(cur[mrefs+1] - cur[prefs+1]) - 1;
 
 #define CHECK(j)\
-    {   int score = FFABS(cur[-refs-1+(j)] - cur[+refs-1-(j)])\
-                  + FFABS(cur[-refs  +(j)] - cur[+refs  -(j)])\
-                  + FFABS(cur[-refs+1+(j)] - cur[+refs+1-(j)]);\
+    {   int score = FFABS(cur[mrefs-1+(j)] - cur[prefs-1-(j)])\
+                  + FFABS(cur[mrefs  +(j)] - cur[prefs  -(j)])\
+                  + FFABS(cur[mrefs+1+(j)] - cur[prefs+1-(j)]);\
         if (score < spatial_score) {\
             spatial_score= score;\
-            spatial_pred= (cur[-refs  +(j)] + cur[+refs  -(j)])>>1;\
+            spatial_pred= (cur[mrefs  +(j)] + cur[prefs  -(j)])>>1;\
 
         CHECK(-1) CHECK(-2) }} }}
         CHECK( 1) CHECK( 2) }} }}
 
         if (mode < 2) {
-            int b = (prev2[-2*refs] + next2[-2*refs])>>1;
-            int f = (prev2[+2*refs] + next2[+2*refs])>>1;
+            int b = (prev2[2*mrefs] + next2[2*mrefs])>>1;
+            int f = (prev2[2*prefs] + next2[2*prefs])>>1;
 #if 0
             int a = cur[-3*refs];
             int g = cur[+3*refs];
@@ -133,7 +133,8 @@ static void filter(AVFilterContext *ctx, AVFilterBufferRef *dstpic,
                 uint8_t *cur  = &yadif->cur ->data[i][y*refs];
                 uint8_t *next = &yadif->next->data[i][y*refs];
                 uint8_t *dst  = &dstpic->data[i][y*dstpic->linesize[i]];
-                yadif->filter_line(dst, prev, cur, next, w, refs, parity ^ tff, yadif->mode);
+                int     mode  = y==1 || y+2==h ? 2 : yadif->mode;
+                yadif->filter_line(dst, prev, cur, next, w, y+1<h ? refs : -refs, y ? -refs : refs, parity ^ tff, mode);
             } else {
                 memcpy(&dstpic->data[i][y*dstpic->linesize[i]],
                        &yadif->cur->data[i][y*refs], w);
diff --git a/libavfilter/x86/yadif_template.c b/libavfilter/x86/yadif_template.c
index 524048e..962a7c7 100644
--- a/libavfilter/x86/yadif_template.c
+++ b/libavfilter/x86/yadif_template.c
@@ -105,7 +105,7 @@
 
 void RENAME(ff_yadif_filter_line)(uint8_t *dst,
                                   uint8_t *prev, uint8_t *cur, uint8_t *next,
-                                  int w, int refs, int parity, int mode)
+                                  int w, int prefs, int mrefs, int parity, int mode)
 {
     DECLARE_ALIGNED(16, uint8_t, tmp0[16]);
     DECLARE_ALIGNED(16, uint8_t, tmp1[16]);
@@ -226,8 +226,8 @@ void RENAME(ff_yadif_filter_line)(uint8_t *dst,
             :[prev] "r"(prev),\
              [cur]  "r"(cur),\
              [next] "r"(next),\
-             [prefs]"r"((x86_reg)refs),\
-             [mrefs]"r"((x86_reg)-refs),\
+             [prefs]"r"((x86_reg)prefs),\
+             [mrefs]"r"((x86_reg)mrefs),\
              [mode] "g"(mode)\
         );\
         __asm__ volatile(MOV" "MM"1, %0" :"=m"(*dst));\
diff --git a/libavfilter/yadif.h b/libavfilter/yadif.h
index 2212a07..d658b68 100644
--- a/libavfilter/yadif.h
+++ b/libavfilter/yadif.h
@@ -23,14 +23,14 @@
 
 void ff_yadif_filter_line_mmx(uint8_t *dst,
                               uint8_t *prev, uint8_t *cur, uint8_t *next,
-                              int w, int refs, int parity, int mode);
+                              int w, int prefs, int mrefs, int parity, int mode);
 
 void ff_yadif_filter_line_sse2(uint8_t *dst,
                                uint8_t *prev, uint8_t *cur, uint8_t *next,
-                               int w, int refs, int parity, int mode);
+                               int w, int prefs, int mrefs, int parity, int mode);
 
 void ff_yadif_filter_line_ssse3(uint8_t *dst,
                                 uint8_t *prev, uint8_t *cur, uint8_t *next,
-                                int w, int refs, int parity, int mode);
+                                int w, int prefs, int mrefs, int parity, int mode);
 
 #endif /* AVFILTER_YADIF_H */
-- 
1.7.4.1


From news@gmane.org Tue Mar 04 03:33:20 2003
From: Alexander Strange <astrange-b+lghglF4J9Wk0Htik3J/w@public.gmane.org>
Subject: Re: [PATCH] matroskadec: set a default duration also
 for packets comming from a simple block
Date: Wed, 23 Mar 2011 03:20:11 -0400
Lines: 22
Message-ID: <AANLkTikJGSN3j5pyy-xZhwsjrs3ctKB6hLudNN7-1vfw@mail.gmail.com>
References: <4D850D5B.4050000@jetheaddev.com>
	<1300655467-7260-1-git-send-email-lu_zero@gentoo.org>
	<4D86705F.60406@gentoo.org>
	<0F5DA216-71C1-49C5-A2C8-4577C564A6CA@ithinksw.com>
	<4D868CFF.7090600@gentoo.org>
	<assp.006168c448.4D86974A.1020202@jetheaddev.com>
	<AANLkTiny_1XuGhHWQWhW+41_x2vu69g4gJd5hAVvAfeh@mail.gmail.com>
	<assp.00635fb0c3.4D895B79.8030704@jetheaddev.com>
	<4D895DB2.2030302@gentoo.org>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 08:20:15 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2IMZ-0007e9-3t
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 08:20:15 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id B066B3C07B;
	Wed, 23 Mar 2011 08:20:14 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 1B2343B0E5
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 08:20:12 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id NSaEOQekvt1z for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 08:20:12 +0100 (CET)
Received: from mail-bw0-f54.google.com (mail-bw0-f54.google.com
	[209.85.214.54])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id F0E5A3B0DD
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 08:20:11 +0100 (CET)
Received: by bwz12 with SMTP id 12so10358193bwz.27
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 00:20:11 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=gamma;
	h=domainkey-signature:mime-version:sender:in-reply-to:references:date
	:x-google-sender-auth:message-id:subject:from:to:content-type;
	bh=2KR7olNmJ+bXxxs2teS/tdkYXjQtgJlKmbA3rcaooZ0=;
	b=dcEQ4hyJ2ARY9JG+ea/OC0TgO/hns6NKNw5IhA8NFIrrNtaNCCoIJBghxR32tH8MPB
	HDZq4BBHyKgoX8kMH2OknQMsrTFBIG0cbPdgKgVJ0Hk4spIAmfisoehsXpcWWeKhz5xZ
	3vF19sQPXWQ6q5HGjMHOuMwSjHsIdB8+0CeDc=
DomainKey-Signature: a=rsa-sha1; c=nofws; d=gmail.com; s=gamma;
	h=mime-version:sender:in-reply-to:references:date
	:x-google-sender-auth:message-id:subject:from:to:content-type;
	b=IkHdV1e2ZmOWaTKj64AYt0KRWN0joL8Kcgb0wix2rHulYL6KHUi7+Zb/xchrdKv4c5
	U8LWw3gc8YEyN+vix3cI+7anDJ6Rn1XuiinexTkT97EH9+8PNAKfx47UJowrs36Jv4Bx
	B5rjou5G41Q42NU1Q8wJbdY6BTrxfMPhezlxs=
Received: by 10.204.81.203 with SMTP id y11mr5958441bkk.124.1300864811476;
	Wed, 23 Mar 2011 00:20:11 -0700 (PDT)
Received: by 10.204.5.66 with HTTP; Wed, 23 Mar 2011 00:20:11 -0700 (PDT)
In-Reply-To: <4D895DB2.2030302-aBrp7R+bbdUdnm+yROfE0A@public.gmane.org>
X-Google-Sender-Auth: qoLgwLCgK3f2RFqJ7I5E-JF0uyQ
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/39>

On Tue, Mar 22, 2011 at 10:40 PM, Luca Barbato <lu_zero-aBrp7R+bbdUdnm+yROfE0A@public.gmane.org> wrote:
> On 03/23/2011 03:31 AM, John Stebbins wrote:
>> fwiw, I've verified that both patches solve the original problem I had.
>
> I'd pick your since I expect to have 0 duration frames sooner or later.

Expect to have them where?

>
> lu
>
> --
>
> Luca Barbato
> Gentoo/linux
> http://dev.gentoo.org/~lu_zero
>
> _______________________________________________
> libav-devel mailing list
> libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
> https://lists.libav.org/mailman/listinfo/libav-devel
>


From news@gmane.org Tue Mar 04 03:33:20 2003
From: Diego Biurrun <diego-NvuzD6AdJSiELgA04lAiVw@public.gmane.org>
Subject: Re: [PATCH] Use macro __INTEL_COMPILER instead
	of	__ICC.
Date: Wed, 23 Mar 2011 08:35:55 +0100
Lines: 10
Message-ID: <20110323073555.GA30842@pool.informatik.RWTH-Aachen.DE>
References: <1300845942-4218-1-git-send-email-rsbultje@gmail.com>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 08:36:03 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2Ibp-00069w-KX
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 08:36:01 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 6A0F23C0C2;
	Wed, 23 Mar 2011 08:36:01 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 6E65E3C0C2
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 08:35:59 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id PXXYDudIqJop for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 08:35:59 +0100 (CET)
Received: from mta-1.ms.rz.rwth-aachen.de (mta-1.ms.rz.RWTH-Aachen.DE
	[134.130.7.72])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 52B173C089
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 08:35:59 +0100 (CET)
Content-disposition: inline
Received: from ironport-out-1.rz.rwth-aachen.de ([134.130.5.40])
	by mta-1.ms.rz.RWTH-Aachen.de
	(Sun Java(tm) System Messaging Server 6.3-7.04 (built Sep 26 2008))
	with ESMTP id <0LII006BT2FZTXH0-VQAYY6A2+UYyMoKJnVKI7zLO/+Hfi/qahC4ANOJQIlc@public.gmane.org> for
	libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org; Wed, 23 Mar 2011 08:35:59 +0100 (CET)
X-IronPort-AV: E=Sophos;i="4.63,230,1299452400";   d="scan'208";a="101906469"
Received: from smarthost-2.ms.rz.rwth-aachen.de (HELO smarthost.rwth-aachen.de)
	([134.130.7.90]) by ironport-in-1.rz.rwth-aachen.de with ESMTP; Wed,
	23 Mar 2011 08:35:59 +0100
Received: from hutch.Informatik.RWTH-Aachen.DE
	(hutch.informatik.RWTH-Aachen.DE [137.226.116.30])	by
	smarthost.rwth-aachen.de
	(8.14.4+Sun/8.13.8/1) with ESMTP id p2N7ZtRc014083	for
	<libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 08:35:55 +0100 (CET)
Received: from diego by hutch.Informatik.RWTH-Aachen.DE with local (Exim 4.69)
	(envelope-from <diego-C+EoYKesnrCVdxy9aTz+TbwNW4aj8/RQWV23jfQ1LcY@public.gmane.org>)
	id 1Q2Ibj-0006zt-Ts	for libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org;
	Wed, 23 Mar 2011 08:35:55 +0100
In-reply-to: <1300845942-4218-1-git-send-email-rsbultje-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>
User-Agent: Mutt/1.5.18 (2008-05-17)
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/40>

On Tue, Mar 22, 2011 at 10:05:42PM -0400, Ronald S. Bultje wrote:
> From: Carl Eugen Hoyos <cehoyos-iVVjmtzCFAg@public.gmane.org>
> 
> __ICC is not supported on all platforms, this is an Intel documentation
> bug that is supposed to be fixed in a future release.
> (Intel issue 612289)

OK

Diego


From news@gmane.org Tue Mar 04 03:33:20 2003
From: Diego Biurrun <diego-NvuzD6AdJSiELgA04lAiVw@public.gmane.org>
Subject: Re: [PATCH] Add xd55 codec tag for XDCAM HD422	720p25
 CBR files.
Date: Wed, 23 Mar 2011 08:36:29 +0100
Lines: 6
Message-ID: <20110323073629.GB30842@pool.informatik.RWTH-Aachen.DE>
References: <1300846283-6336-1-git-send-email-rsbultje@gmail.com>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 08:36:31 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2IcJ-0006OB-1f
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 08:36:31 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id D36C53C0C5;
	Wed, 23 Mar 2011 08:36:30 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 4EF0A3C0C5
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 08:36:29 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id ksvcB+gAkMNo for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 08:36:29 +0100 (CET)
Received: from mta-2.ms.rz.rwth-aachen.de (mta-2.ms.rz.RWTH-Aachen.DE
	[134.130.7.73])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 392A83C089
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 08:36:29 +0100 (CET)
Content-disposition: inline
Received: from ironport-out-2.rz.rwth-aachen.de ([134.130.5.41])
	by mta-2.ms.rz.RWTH-Aachen.de
	(Sun Java(tm) System Messaging Server 6.3-7.04 (built Sep 26 2008))
	with ESMTP id <0LII0074I2GT2BG0-LyQr6xbdBHgyMoKJnVKI7zLO/+Hfi/qahC4ANOJQIlc@public.gmane.org> for
	libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org; Wed, 23 Mar 2011 08:36:29 +0100 (CET)
X-IronPort-AV: E=Sophos;i="4.63,230,1299452400";   d="scan'208";a="51244381"
Received: from smarthost-2.ms.rz.rwth-aachen.de (HELO smarthost.rwth-aachen.de)
	([134.130.7.90]) by ironport-in-2.rz.rwth-aachen.de with ESMTP; Wed,
	23 Mar 2011 08:36:29 +0100
Received: from hutch.Informatik.RWTH-Aachen.DE
	(hutch.informatik.RWTH-Aachen.DE [137.226.116.30])	by
	smarthost.rwth-aachen.de
	(8.14.4+Sun/8.13.8/1) with ESMTP id p2N7aTwv014163	for
	<libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 08:36:29 +0100 (CET)
Received: from diego by hutch.Informatik.RWTH-Aachen.DE with local (Exim 4.69)
	(envelope-from <diego-C+EoYKesnrCVdxy9aTz+TbwNW4aj8/RQWV23jfQ1LcY@public.gmane.org>)
	id 1Q2IcH-00070G-1V	for libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org;
	Wed, 23 Mar 2011 08:36:29 +0100
In-reply-to: <1300846283-6336-1-git-send-email-rsbultje-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>
User-Agent: Mutt/1.5.18 (2008-05-17)
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/41>

On Tue, Mar 22, 2011 at 10:11:23PM -0400, Ronald S. Bultje wrote:
> From: Tomas H=E4rdin <tomas.hardin-hMd8BBQ7QCYwFerOooGFRg@public.gmane.org>

OK

Diego


From news@gmane.org Tue Mar 04 03:33:20 2003
From: can wu <wu.canus-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>
Subject: =?utf-8?b?5Zue5aSN77yaICBbUEFUQ0ggMDIvMTBdIFBvcnQg?=
	=?utf-8?q?drawtext_filter_by_Hemanth_from_the_libavfilter_soc_repo?=
	=?utf-8?q?=2C_with_the_following_additions=3A_*_support_to_anti-al?=
	=?utf-8?q?iased_glyph_rendering_*_support_to_UTF-8_text_and_Unicod?=
	=?utf-8?q?e_chars_rendering_*_support_for_RGB_packed_format?=
Date: Wed, 23 Mar 2011 16:17:04 +0800
Lines: 2309
Message-ID: <AANLkTikpAKdtTOC4OQvOn_bMrZ98bY09XtFn-G2FzS+d@mail.gmail.com>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: multipart/mixed; boundary="===============1672352679=="
To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 09:17:13 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2JFf-0008It-Nq
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 09:17:12 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 3EE023B116;
	Wed, 23 Mar 2011 09:17:11 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 024ED3B116
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 09:17:06 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id 1uIeYe16t7T7 for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 09:17:05 +0100 (CET)
Received: from mail-ew0-f54.google.com (mail-ew0-f54.google.com
	[209.85.215.54])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id A5D8F3B112
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 09:17:05 +0100 (CET)
Received: by ewy1 with SMTP id 1so3646781ewy.27
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 01:17:05 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=gamma;
	h=domainkey-signature:mime-version:date:message-id:subject:from:to
	:content-type; bh=1mng/to0IXy5IEmRtMjD3fRDwk+1lBhfcAEXkgrNYvI=;
	b=WfpvXz/yQVWb/2kDz9M8vdsL0sFQjLDyAikHbVqMYxbeiw0fREquYXZEqgt8S8ST66
	yEyzV9WgkcVEEqk1IRyuYMOMGuBPbnncLvSE3tGYeKLFlrTUs5Zu36jEqsnZNejAch+A
	tW8lvJDjfyD5EeLIBPDROqJgOWFnB0bAkB5hs=
DomainKey-Signature: a=rsa-sha1; c=nofws; d=gmail.com; s=gamma;
	h=mime-version:date:message-id:subject:from:to:content-type;
	b=Ekbr8rYwcUH1CdTpWpSfnO9V5qn6qfHtw7L1Mr2Tx723cb9O0jPWzYFagr96OxAV0I
	rYVjyG7D4JRMZ8EOwYvn/N2R/iXsE+L0GqD9BdnWyDTxFkO/NK0o2m3w9pRYpnivDkDt
	t4+LPvznNIfo+7DwUU1elZpNjtH616ZDSSQ6I=
Received: by 10.213.103.202 with SMTP id l10mr634671ebo.57.1300868224922; Wed,
	23 Mar 2011 01:17:04 -0700 (PDT)
Received: by 10.213.10.6 with HTTP; Wed, 23 Mar 2011 01:17:04 -0700 (PDT)
Received: by 10.213.10.6 with HTTP; Wed, 23 Mar 2011 01:17:04 -0700 (PDT)
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Mime-version: 1.0
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/42>

--===============1672352679==
Content-Type: multipart/alternative; boundary=0016e6d77d257235c2049f21fc0c

--0016e6d77d257235c2049f21fc0c
Content-Type: text/plain; charset=GB2312
Content-Transfer-Encoding: quoted-printable

please polish the title.

=D4=DA 2011-3-23 =CF=C2=CE=E71:31=A3=AC"Anton Khirnov" <anton-5jV5EzyPuF3R7s880joybQ@public.gmane.org>=
=B1=E0=D0=B4=A3=BA

From: Stefano Sabatini <stefano.sabatini-lala-Syd3ARw+vPY@public.gmane.org>

Signed-off-by: Michael Niedermayer <michaelni-RbZlAiThDcE@public.gmane.org>
---
 configure                 |    6 +
 doc/filters.texi          |  112 ++++++++
 libavfilter/Makefile      |    1 +
 libavfilter/allfilters.c  |    1 +
 libavfilter/vf_drawtext.c |  650
+++++++++++++++++++++++++++++++++++++++++++++
 5 files changed, 770 insertions(+), 0 deletions(-)
 create mode 100644 libavfilter/vf_drawtext.c

diff --git a/configure b/configure
index 00aa9ed..d6d1953 100755
--- a/configure
+++ b/configure
@@ -169,6 +169,7 @@ External library support:
                           and libraw1394 [no]
  --enable-libdirac        enable Dirac support via libdirac [no]
  --enable-libfaac         enable FAAC support via libfaac [no]
+  --enable-libfreetype     enable libfreetype [no]
  --enable-libgsm          enable GSM support via libgsm [no]
  --enable-libmp3lame      enable MP3 encoding via libmp3lame [no]
  --enable-libnut          enable NUT (de)muxing via libnut,
@@ -927,6 +928,7 @@ CONFIG_LIST=3D"
    libdc1394
    libdirac
    libfaac
+    libfreetype
    libgsm
    libmp3lame
    libnut
@@ -1074,6 +1076,7 @@ HAVE_LIST=3D"
    llrintf
    local_aligned_16
    local_aligned_8
+    localtime_r
    log2
    log2f
    loongson
@@ -1454,6 +1457,7 @@ udp_protocol_deps=3D"network"
 # filters
 blackframe_filter_deps=3D"gpl"
 cropdetect_filter_deps=3D"gpl"
+drawtext_filter_deps=3D"libfreetype"
 frei0r_filter_deps=3D"frei0r dlopen strtok_r"
 frei0r_src_filter_deps=3D"frei0r dlopen strtok_r"
 hqdn3d_filter_deps=3D"gpl"
@@ -2768,6 +2772,7 @@ check_func  getrusage
 check_struct "sys/time.h sys/resource.h" "struct rusage" ru_maxrss
 check_func  inet_aton $network_extralibs
 check_func  isatty
+check_func  localtime_r
 check_func  ${malloc_prefix}memalign            && enable memalign
 check_func  mkstemp
 check_func  mmap
@@ -2853,6 +2858,7 @@ enabled libdirac   && require_pkg_config dirac
                 \
    "libdirac_decoder/dirac_parser.h libdirac_encoder/dirac_encoder.h"  \
    "dirac_decoder_init dirac_encoder_init"
 enabled libfaac    && require2 libfaac "stdint.h faac.h" faacEncGetVersion
-lfaac
+enabled libfreetype && add_cflags $(pkg-config --cflags freetype2) &&
require libfreetype ft2build.h FT_Init_FreeType -lfreetype
 enabled libgsm     && require  libgsm gsm/gsm.h gsm_create -lgsm
 enabled libmp3lame && require  "libmp3lame >=3D 3.98.3" lame/lame.h
lame_set_VBR_quality -lmp3lame
 enabled libnut     && require  libnut libnut.h nut_demuxer_init -lnut
diff --git a/doc/filters.texi b/doc/filters.texi
index 872afc6..3f626d2 100644
--- a/doc/filters.texi
+++ b/doc/filters.texi
@@ -386,6 +386,118 @@ fade=3Din:0:25, fade=3Dout:975:25
 fade=3Din:5:20
 @end example

+@section drawtext
+
+Draw text string or text from specified file on top of video using the
+libfreetype library.
+
+To enable compilation of this filter you need to configure FFmpeg with
+@code{--enable-libfreetype}.
+
+The filter also recognizes strftime() sequences in the provided text
+and expands them accordingly. Check the documentation of strftime().
+
+The filter accepts parameters as a list of @var{key}=3D@var{value} pairs,
+separated by ":".
+
+The description of the accepted parameters follows.
+
+@table @option
+
+@item fontfile
+The font file to be used for drawing text. Path must be included.
+This parameter is mandatory.
+
+@item text
+The text string to be drawn. The text must be a sequence of UTF-8
+encoded characters.
+This parameter is mandatory if no file is specified.
+
+@item textfile
+A text file containing text to be drawn. The text must be a sequence
+of UTF-8 encoded characters
+
+This parameter is mandatory if no text string is specified.
+
+If both text and textfile are specified, an error is thrown.
+
+@item x, y
+The offsets where text will be drawn within the video frame.
+Relative to the top/left border of the output image.
+
+The default value of @var{x} and @var{y} is 0.
+
+@item fontsize
+The font size to be used for drawing text.
+The default value of @var{size} is 16.
+
+@item fontcolor
+The color to be used for drawing fonts.
+Either a string (e.g. "red") or in 0xRRGGBB[AA] format
+(e.g. "0xff000033"), possibly followed by an alpha specifier.
+The default value of @var{fontcolor} is "black".
+
+@item boxcolor
+The color to be used for drawing box around text.
+Either a string (e.g. "yellow") or in 0xRRGGBB[AA] format
+(e.g. "0xff00ff"), possibly followed by an alpha specifier.
+
+The default value of @var{bgcolor} is "white".
+
+@item box
+Used to draw a box around text using background color.
+Value should be either 1 (enable) or 0 (disable).
+The default value of @var{box} is 0.
+
+@item ft_load_flags
+Flags to be used for loading the fonts.
+
+The flags map the corresponding flags supported by libfreetype, and are
+a combination of the following values:
+@table @var
+@item default
+@item no_scale
+@item no_hinting
+@item render
+@item no_bitmap
+@item vertical_layout
+@item force_autohint
+@item crop_bitmap
+@item pedantic
+@item ignore_global_advance_width
+@item no_recurse
+@item ignore_transform
+@item monochrome
+@item linear_design
+@item no_autohint
+@item end table
+@end table
+
+Default value is "render".
+
+For more information consult the documentation for the FT_LOAD_*
+libfreetype flags.
+
+@item tabsize
+The size in number of spaces to use for rendering the tab.
+Default value is 4.
+@end table
+
+For example the command:
+@example
+drawtext=3Dfontfile=3DFreeSerif.ttf: text=3D'Test Text': x=3D100: y=3D50:
fontsize=3D24: fontcolor=3Dyellow@@0.2: boxcolor=3Dred@@0.2: box=3D1"
+@end example
+
+will draw 'Test Text' with font FreeSerif of size 24 at position
+(100,50), text color is yellow, and draw a red box around text. Both
+the text and the box have an opacity of 20%.
+
+Note that the double quotes are not necessary if spaces are not used
+within the parameter list.
+
+For more information about libfreetype, check:
+@url{http://www.freetype.org/}
+
 @section fifo

 Buffer input images and send them when they are requested.
diff --git a/libavfilter/Makefile b/libavfilter/Makefile
index f7bc98d..f116fe5 100644
--- a/libavfilter/Makefile
+++ b/libavfilter/Makefile
@@ -26,6 +26,7 @@ OBJS-$(CONFIG_COPY_FILTER)                   +=3D vf_copy=
.o
 OBJS-$(CONFIG_CROP_FILTER)                   +=3D vf_crop.o
 OBJS-$(CONFIG_CROPDETECT_FILTER)             +=3D vf_cropdetect.o
 OBJS-$(CONFIG_DRAWBOX_FILTER)                +=3D vf_drawbox.o
+OBJS-$(CONFIG_DRAWTEXT_FILTER)               +=3D vf_drawtext.o
 OBJS-$(CONFIG_FADE_FILTER)                   +=3D vf_fade.o
 OBJS-$(CONFIG_FIFO_FILTER)                   +=3D vf_fifo.o
 OBJS-$(CONFIG_FORMAT_FILTER)                 +=3D vf_format.o
diff --git a/libavfilter/allfilters.c b/libavfilter/allfilters.c
index 34e87f5..06934c8 100644
--- a/libavfilter/allfilters.c
+++ b/libavfilter/allfilters.c
@@ -45,6 +45,7 @@ void avfilter_register_all(void)
    REGISTER_FILTER (CROP,        crop,        vf);
    REGISTER_FILTER (CROPDETECT,  cropdetect,  vf);
    REGISTER_FILTER (DRAWBOX,     drawbox,     vf);
+    REGISTER_FILTER (DRAWTEXT,    drawtext,    vf);
    REGISTER_FILTER (FADE,        fade,        vf);
    REGISTER_FILTER (FIFO,        fifo,        vf);
    REGISTER_FILTER (FORMAT,      format,      vf);
diff --git a/libavfilter/vf_drawtext.c b/libavfilter/vf_drawtext.c
new file mode 100644
index 0000000..9fe6def
--- /dev/null
+++ b/libavfilter/vf_drawtext.c
@@ -0,0 +1,650 @@
+/*
+ * Copyright (c) 2011 Stefano Sabatini
+ * Copyright (c) 2010 S.N. Hemanth Meenakshisundaram
+ * Copyright (c) 2003 Gustavo Sverzut Barbieri <gsbarbieri-/E1597aS9LRfJ/NunPodnw@public.gmane.org>
+ *
+ * This file is part of FFmpeg.
+ *
+ * FFmpeg is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Lesser General Public
+ * License as published by the Free Software Foundation; either
+ * version 2.1 of the License, or (at your option) any later version.
+ *
+ * FFmpeg is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with FFmpeg; if not, write to the Free Software
+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-130=
1
USA
+ */
+
+/**
+ * @file
+ * drawtext filter, based on the original FFmpeg vhook/drawtext.c
+ * filter by Gustavo Sverzut Barbieri
+ */
+
+#include <sys/time.h>
+#include <time.h>
+
+#include "libavutil/colorspace.h"
+#include "libavutil/file.h"
+#include "libavutil/opt.h"
+#include "libavutil/parseutils.h"
+#include "libavutil/pixdesc.h"
+#include "libavutil/tree.h"
+#include "avfilter.h"
+#include "drawutils.h"
+
+#undef time
+
+#include <ft2build.h>
+#include <freetype/config/ftheader.h>
+#include FT_FREETYPE_H
+#include FT_GLYPH_H
+
+#define MAX_EXPANDED_TEXT_SIZE 2048
+
+typedef struct {
+    const AVClass *class;
+    char *fontfile;                 ///< font to be used
+    char *text;                     ///< text to be drawn
+    int ft_load_flags;              ///< flags used for loading fonts, see
FT_LOAD_*
+    /** buffer containing the text expanded by strftime */
+    char expanded_text[MAX_EXPANDED_TEXT_SIZE];
+    /** positions for each element in the text */
+    FT_Vector positions[MAX_EXPANDED_TEXT_SIZE];
+    char *textfile;                 ///< file with text to be drawn
+    unsigned int x;                 ///< x position to start drawing text
+    unsigned int y;                 ///< y position to start drawing text
+    unsigned int fontsize;          ///< font size to use
+    char *fontcolor_string;         ///< font color as string
+    char *boxcolor_string;          ///< box color as string
+    uint8_t fontcolor[4];           ///< foreground color
+    uint8_t boxcolor[4];            ///< background color
+    uint8_t fontcolor_rgba[4];      ///< foreground color in RGBA
+    uint8_t boxcolor_rgba[4];       ///< background color in RGBA
+
+    short int draw_box;             ///< draw box around text - true or
false
+    int use_kerning;                ///< font kerning is used - true/false
+    int tabsize;                    ///< tab size
+
+    FT_Library library;             ///< freetype font library handle
+    FT_Face face;                   ///< freetype font face handle
+    struct AVTreeNode *glyphs;      ///< rendered glyphs, stored using the
UTF-32 char code
+    int hsub, vsub;                 ///< chroma subsampling values
+    int is_packed_rgb;
+    int pixel_step[4];              ///< distance in bytes between the
component of each pixel
+    uint8_t rgba_map[4];            ///< map RGBA offsets to the positions
in the packed RGBA format
+    uint8_t *box_line[4];           ///< line used for filling the box
background
+} DrawTextContext;
+
+#define OFFSET(x) offsetof(DrawTextContext, x)
+
+static const AVOption drawtext_options[]=3D {
+{"fontfile", "set font file",        OFFSET(fontfile),
FF_OPT_TYPE_STRING, 0,  CHAR_MIN, CHAR_MAX },
+{"text",     "set text",             OFFSET(text),
FF_OPT_TYPE_STRING, 0,  CHAR_MIN, CHAR_MAX },
+{"textfile", "set text file",        OFFSET(textfile),
FF_OPT_TYPE_STRING, 0,  CHAR_MIN, CHAR_MAX },
+{"fontcolor","set foreground color", OFFSET(fontcolor_string),
FF_OPT_TYPE_STRING, 0,  CHAR_MIN, CHAR_MAX },
+{"boxcolor", "set box color",        OFFSET(boxcolor_string),
 FF_OPT_TYPE_STRING, 0,  CHAR_MIN, CHAR_MAX },
+{"box",      "set box",              OFFSET(draw_box),
FF_OPT_TYPE_INT,    0,         0,        1 },
+{"fontsize", "set font size",        OFFSET(fontsize),
FF_OPT_TYPE_INT,   16,         1,       72 },
+{"x",        "set x",                OFFSET(x),
 FF_OPT_TYPE_INT,    0,         0,  INT_MAX },
+{"y",        "set y",                OFFSET(y),
 FF_OPT_TYPE_INT,    0,         0,  INT_MAX },
+{"tabsize",  "set tab size",         OFFSET(tabsize),
 FF_OPT_TYPE_INT,    4,         0,  INT_MAX },
+
+/* FT_LOAD_* flags */
+{"ft_load_flags", "set font loading flags for libfreetype",
OFFSET(ft_load_flags),  FF_OPT_TYPE_FLAGS,  FT_LOAD_DEFAULT|FT_LOAD_RENDER,
0, INT_MAX, 0, "ft_load_flags" },
+{"default",                     "set default",                     0,
FF_OPT_TYPE_CONST, FT_LOAD_DEFAULT,                     INT_MIN, INT_MAX, 0=
,
"ft_load_flags" },
+{"no_scale",                    "set no_scale",                    0,
FF_OPT_TYPE_CONST, FT_LOAD_NO_SCALE,                    INT_MIN, INT_MAX, 0=
,
"ft_load_flags" },
+{"no_hinting",                  "set no_hinting",                  0,
FF_OPT_TYPE_CONST, FT_LOAD_NO_HINTING,                  INT_MIN, INT_MAX, 0=
,
"ft_load_flags" },
+{"render",                      "set render",                      0,
FF_OPT_TYPE_CONST, FT_LOAD_RENDER,                      INT_MIN, INT_MAX, 0=
,
"ft_load_flags" },
+{"no_bitmap",                   "set no_bitmap",                   0,
FF_OPT_TYPE_CONST, FT_LOAD_NO_BITMAP,                   INT_MIN, INT_MAX, 0=
,
"ft_load_flags" },
+{"vertical_layout",             "set vertical_layout",             0,
FF_OPT_TYPE_CONST, FT_LOAD_VERTICAL_LAYOUT,             INT_MIN, INT_MAX, 0=
,
"ft_load_flags" },
+{"force_autohint",              "set force_autohint",              0,
FF_OPT_TYPE_CONST, FT_LOAD_FORCE_AUTOHINT,              INT_MIN, INT_MAX, 0=
,
"ft_load_flags" },
+{"crop_bitmap",                 "set crop_bitmap",                 0,
FF_OPT_TYPE_CONST, FT_LOAD_CROP_BITMAP,                 INT_MIN, INT_MAX, 0=
,
"ft_load_flags" },
+{"pedantic",                    "set pedantic",                    0,
FF_OPT_TYPE_CONST, FT_LOAD_PEDANTIC,                    INT_MIN, INT_MAX, 0=
,
"ft_load_flags" },
+{"ignore_global_advance_width", "set ignore_global_advance_width", 0,
FF_OPT_TYPE_CONST, FT_LOAD_IGNORE_GLOBAL_ADVANCE_WIDTH, INT_MIN, INT_MAX, 0=
,
"ft_load_flags" },
+{"no_recurse",                  "set no_recurse",                  0,
FF_OPT_TYPE_CONST, FT_LOAD_NO_RECURSE,                  INT_MIN, INT_MAX, 0=
,
"ft_load_flags" },
+{"ignore_transform",            "set ignore_transform",            0,
FF_OPT_TYPE_CONST, FT_LOAD_IGNORE_TRANSFORM,            INT_MIN, INT_MAX, 0=
,
"ft_load_flags" },
+{"monochrome",                  "set monochrome",                  0,
FF_OPT_TYPE_CONST, FT_LOAD_MONOCHROME,                  INT_MIN, INT_MAX, 0=
,
"ft_load_flags" },
+{"linear_design",               "set linear_design",               0,
FF_OPT_TYPE_CONST, FT_LOAD_LINEAR_DESIGN,               INT_MIN, INT_MAX, 0=
,
"ft_load_flags" },
+{"no_autohint",                 "set no_autohint",                 0,
FF_OPT_TYPE_CONST, FT_LOAD_NO_AUTOHINT,                 INT_MIN, INT_MAX, 0=
,
"ft_load_flags" },
+{NULL},
+};
+
+static const char *drawtext_get_name(void *ctx)
+{
+    return "drawtext";
+}
+
+static const AVClass drawtext_class =3D {
+    "DrawTextContext",
+    drawtext_get_name,
+    drawtext_options
+};
+
+#undef __FTERRORS_H__
+#define FT_ERROR_START_LIST {
+#define FT_ERRORDEF(e, v, s) { (e), (s) },
+#define FT_ERROR_END_LIST { 0, NULL } };
+
+struct ft_error
+{
+    int err;
+    const char *err_msg;
+} static ft_errors[] =3D
+#include FT_ERRORS_H
+
+#define FT_ERRMSG(e) ft_errors[e].err_msg
+
+typedef struct {
+    FT_Glyph *glyph;
+    uint32_t code;
+    FT_Bitmap bitmap; ///< array holding bitmaps of font
+    FT_BBox bbox;
+    int advance;
+    int bitmap_left;
+    int bitmap_top;
+} Glyph;
+
+static int glyph_cmp(const Glyph *a, const Glyph *b)
+{
+    int64_t diff =3D (int64_t)a->code - (int64_t)b->code;
+    return diff > 0 ? 1 : diff < 0 ? -1 : 0;
+}
+
+/**
+ * Load glyphs corresponding to the UTF-32 codepoint code.
+ */
+static int load_glyph(AVFilterContext *ctx, Glyph **glyph_ptr, uint32_t
code)
+{
+    DrawTextContext *dtext =3D ctx->priv;
+    Glyph *glyph =3D av_mallocz(sizeof(Glyph));
+    struct AVTreeNode *node =3D NULL;
+    int ret;
+
+    /* load glyph into dtext->face->glyph */
+    ret =3D FT_Load_Char(dtext->face, code, dtext->ft_load_flags);
+    if (ret)
+        return AVERROR(EINVAL);
+
+    /* save glyph */
+    glyph->code  =3D code;
+    glyph->glyph =3D av_mallocz(sizeof(FT_Glyph));
+    ret =3D FT_Get_Glyph(dtext->face->glyph, glyph->glyph);
+    if (ret)
+        return AVERROR(EINVAL);
+
+    glyph->bitmap      =3D dtext->face->glyph->bitmap;
+    glyph->bitmap_left =3D dtext->face->glyph->bitmap_left;
+    glyph->bitmap_top  =3D dtext->face->glyph->bitmap_top;
+    glyph->advance     =3D dtext->face->glyph->advance.x >> 6;
+
+    /* measure text height to calculate text_height (or the maximum text
height) */
+    FT_Glyph_Get_CBox(*glyph->glyph, ft_glyph_bbox_pixels, &glyph->bbox);
+
+    /* cache the newly created glyph */
+    if (!node)
+        node =3D av_mallocz(av_tree_node_size);
+    av_tree_insert(&dtext->glyphs, glyph, (void *)glyph_cmp, &node);
+
+    if (glyph_ptr)
+        *glyph_ptr =3D glyph;
+    return 0;
+}
+
+static av_cold int init(AVFilterContext *ctx, const char *args, void
*opaque)
+{
+    int err;
+    DrawTextContext *dtext =3D ctx->priv;
+
+    dtext->class =3D &drawtext_class;
+    av_opt_set_defaults2(dtext, 0, 0);
+    dtext->fontcolor_string =3D av_strdup("black");
+    dtext->boxcolor_string =3D av_strdup("white");
+
+    if ((err =3D (av_set_options_string(dtext, args, "=3D", ":"))) < 0) {
+        av_log(ctx, AV_LOG_ERROR, "Error parsing options string: '%s'\n",
args);
+        return err;
+    }
+
+    if (!dtext->fontfile) {
+        av_log(ctx, AV_LOG_ERROR, "No font filename provided\n");
+        return AVERROR(EINVAL);
+    }
+
+    if (dtext->textfile) {
+        uint8_t *textbuf;
+        size_t textbuf_size;
+
+        if (dtext->text) {
+            av_log(ctx, AV_LOG_ERROR,
+                   "Both text and text file provided. Please provide only
one\n");
+            return AVERROR(EINVAL);
+        }
+        if ((err =3D av_file_map(dtext->textfile, &textbuf, &textbuf_size,=
 0,
ctx)) < 0) {
+            av_log(ctx, AV_LOG_ERROR,
+                   "The text file '%s' could not be read or is empty\n",
+                   dtext->textfile);
+            return err;
+        }
+
+        if (!(dtext->text =3D av_malloc(textbuf_size+1)))
+            return AVERROR(ENOMEM);
+        memcpy(dtext->text, textbuf, textbuf_size);
+        dtext->text[textbuf_size] =3D 0;
+        av_file_unmap(textbuf, textbuf_size);
+    }
+
+    if (!dtext->text) {
+        av_log(ctx, AV_LOG_ERROR,
+               "Either text or a valid file must be provided\n");
+        return AVERROR(EINVAL);
+    }
+
+    if ((err =3D av_parse_color(dtext->fontcolor_rgba,
dtext->fontcolor_string, -1, ctx))) {
+        av_log(ctx, AV_LOG_ERROR,
+               "Invalid font color '%s'\n", dtext->fontcolor_string);
+        return err;
+    }
+
+    if ((err =3D av_parse_color(dtext->boxcolor_rgba, dtext->boxcolor_stri=
ng,
-1, ctx))) {
+        av_log(ctx, AV_LOG_ERROR,
+               "Invalid box color '%s'\n", dtext->boxcolor_string);
+        return err;
+    }
+
+    if ((err =3D FT_Init_FreeType(&(dtext->library)))) {
+        av_log(ctx, AV_LOG_ERROR,
+               "Could not load FreeType: %s\n", FT_ERRMSG(err));
+        return AVERROR(EINVAL);
+    }
+
+    /* load the face, and set up the encoding, which is by default UTF-8 *=
/
+    if ((err =3D FT_New_Face(dtext->library, dtext->fontfile, 0,
&dtext->face))) {
+        av_log(ctx, AV_LOG_ERROR, "Could not load fontface from file '%s':
%s\n",
+               dtext->fontfile, FT_ERRMSG(err));
+        return AVERROR(EINVAL);
+    }
+    if ((err =3D FT_Set_Pixel_Sizes(dtext->face, 0, dtext->fontsize))) {
+        av_log(ctx, AV_LOG_ERROR, "Could not set font size to %d pixels:
%s\n",
+               dtext->fontsize, FT_ERRMSG(err));
+        return AVERROR(EINVAL);
+    }
+
+    dtext->use_kerning =3D FT_HAS_KERNING(dtext->face);
+
+    /* load the fallback glyph with code 0 */
+    load_glyph(ctx, NULL, 0);
+
+#if !HAVE_LOCALTIME_R
+    av_log(ctx, AV_LOG_WARNING, "strftime() expansion unavailable!\n");
+#else
+    if (strlen(dtext->text) >=3D MAX_EXPANDED_TEXT_SIZE) {
+        av_log(ctx, AV_LOG_ERROR,
+               "Impossible to print text, string is too big\n");
+        return AVERROR(EINVAL);
+    }
+#endif
+
+    return 0;
+}
+
+static int query_formats(AVFilterContext *ctx)
+{
+    static const enum PixelFormat pix_fmts[] =3D {
+        PIX_FMT_ARGB,    PIX_FMT_RGBA,
+        PIX_FMT_ABGR,    PIX_FMT_BGRA,
+        PIX_FMT_RGB24,   PIX_FMT_BGR24,
+        PIX_FMT_YUV420P, PIX_FMT_YUV444P,
+        PIX_FMT_YUV422P, PIX_FMT_YUV411P,
+        PIX_FMT_YUV410P, PIX_FMT_YUV440P,
+        PIX_FMT_NONE
+    };
+
+    avfilter_set_common_formats(ctx, avfilter_make_format_list(pix_fmts));
+    return 0;
+}
+
+static int glyph_enu_free(void *opaque, void *elem)
+{
+    av_free(elem);
+    return 0;
+}
+
+static av_cold void uninit(AVFilterContext *ctx)
+{
+    DrawTextContext *dtext =3D ctx->priv;
+    int i;
+
+    av_freep(&dtext->fontfile);
+    av_freep(&dtext->text);
+    av_freep(&dtext->fontcolor_string);
+    av_freep(&dtext->boxcolor_string);
+    av_tree_enumerate(dtext->glyphs, NULL, NULL, glyph_enu_free);
+    av_tree_destroy(dtext->glyphs);
+    dtext->glyphs =3D 0;
+    FT_Done_Face(dtext->face);
+    FT_Done_FreeType(dtext->library);
+
+    for (i =3D 0; i < 4; i++) {
+        av_freep(&dtext->box_line[i]);
+        dtext->pixel_step[i] =3D 0;
+    }
+
+}
+
+static int config_input(AVFilterLink *inlink)
+{
+    DrawTextContext *dtext =3D inlink->dst->priv;
+    const AVPixFmtDescriptor *pix_desc =3D
&av_pix_fmt_descriptors[inlink->format];
+    int ret;
+
+    dtext->hsub =3D pix_desc->log2_chroma_w;
+    dtext->vsub =3D pix_desc->log2_chroma_h;
+
+    if ((ret =3D
+         ff_fill_line_with_color(dtext->box_line, dtext->pixel_step,
+                                 inlink->w, dtext->boxcolor,
+                                 inlink->format, dtext->boxcolor_rgba,
+                                 &dtext->is_packed_rgb, dtext->rgba_map)) =
<
0)
+        return ret;
+
+    if (!dtext->is_packed_rgb) {
+        uint8_t *rgba =3D dtext->fontcolor_rgba;
+        dtext->fontcolor[0] =3D RGB_TO_Y_CCIR(rgba[0], rgba[1], rgba[2]);
+        dtext->fontcolor[1] =3D RGB_TO_U_CCIR(rgba[0], rgba[1], rgba[2], 0=
);
+        dtext->fontcolor[2] =3D RGB_TO_V_CCIR(rgba[0], rgba[1], rgba[2], 0=
);
+        dtext->fontcolor[3] =3D rgba[3];
+    }
+
+    return 0;
+}
+
+#define GET_BITMAP_VAL(r, c)                                            \
+    bitmap->pixel_mode =3D=3D FT_PIXEL_MODE_MONO ?                        =
  \
+        (bitmap->buffer[(r) * bitmap->pitch + ((c)>>3)] & (0x80 >>
((c)&7))) * 255 : \
+         bitmap->buffer[(r) * bitmap->pitch +  (c)]
+
+#define SET_PIXEL_YUV(picref, yuva_color, val, x, y, hsub, vsub) {
  \
+    luma_pos    =3D ((x)          ) + ((y)          ) * picref->linesize[0=
];
\
+    chroma_pos1 =3D ((x) >> (hsub)) + ((y) >> (vsub)) * picref->linesize[1=
];
\
+    chroma_pos2 =3D ((x) >> (hsub)) + ((y) >> (vsub)) * picref->linesize[2=
];
\
+    alpha =3D (yuva_color[3] * (val)) / 255;                              =
 \
+    picref->data[0][luma_pos] =3D (alpha * yuva_color[0] + (255 - alpha) *
picref->data[0][luma_pos]) >> 8; \
+    alpha =3D (yuva_color[3] * (val)) / 224;                              =
 \
+    picref->data[1][chroma_pos1] =3D 16 + (alpha * (yuva_color[1]-16) + (2=
24
- alpha) * (picref->data[1][chroma_pos1]-16)) / 224; \
+    picref->data[2][chroma_pos2] =3D 16 + (alpha * (yuva_color[2]-16) + (2=
24
- alpha) * (picref->data[2][chroma_pos2]-16)) / 224; \
+}
+
+static inline int draw_glyph_yuv(AVFilterBufferRef *picref, FT_Bitmap
*bitmap, unsigned int x,
+                                 unsigned int y, unsigned int width,
unsigned int height,
+                                 unsigned char yuva_color[4], int hsub, in=
t
vsub)
+{
+    int r, c, alpha;
+    unsigned int luma_pos, chroma_pos1, chroma_pos2;
+    uint8_t src_val, dst_pixel[4];
+
+    for (r =3D 0; r < bitmap->rows && r+y < height; r++) {
+        for (c =3D 0; c < bitmap->width && c+x < width; c++) {
+            /* get pixel in the picref (destination) */
+            dst_pixel[0] =3D picref->data[0][  c+x           +  (y+r)
 * picref->linesize[0]];
+            dst_pixel[1] =3D picref->data[1][((c+x) >> hsub) + ((y+r) >>
vsub) * picref->linesize[1]];
+            dst_pixel[2] =3D picref->data[2][((c+x) >> hsub) + ((y+r) >>
vsub) * picref->linesize[2]];
+
+            /* get intensity value in the glyph bitmap (source) */
+            src_val =3D GET_BITMAP_VAL(r, c);
+            if (!src_val)
+                continue;
+
+            SET_PIXEL_YUV(picref, yuva_color, src_val, c+x, y+r, hsub,
vsub);
+        }
+    }
+
+    return 0;
+}
+
+#define SET_PIXEL_RGB(picref, rgba_color, val, x, y, pixel_step, r_off,
g_off, b_off, a_off) { \
+    p   =3D picref->data[0] + (x) * pixel_step + ((y) * picref->linesize[0=
]);
\
+    alpha =3D (rgba_color[3] * (val)) / 255;                              =
\
+    *(p+r_off) =3D (alpha * rgba_color[0] + (255 - alpha) * *(p+r_off)) >>=
 8;
\
+    *(p+g_off) =3D (alpha * rgba_color[1] + (255 - alpha) * *(p+g_off)) >>=
 8;
\
+    *(p+b_off) =3D (alpha * rgba_color[2] + (255 - alpha) * *(p+b_off)) >>=
 8;
\
+}
+
+static inline int draw_glyph_rgb(AVFilterBufferRef *picref, FT_Bitmap
*bitmap,
+                                 unsigned int x, unsigned int y,
+                                 unsigned int width, unsigned int height,
int pixel_step,
+                                 unsigned char rgba_color[4], uint8_t
rgba_map[4])
+{
+    int r, c, alpha;
+    uint8_t *p;
+    uint8_t src_val, dst_pixel[4];
+
+    for (r =3D 0; r < bitmap->rows && r+y < height; r++) {
+        for (c =3D 0; c < bitmap->width && c+x < width; c++) {
+            /* get pixel in the picref (destination) */
+            dst_pixel[0] =3D picref->data[0][(c+x + rgba_map[0]) * pixel_s=
tep
+
+                                           (y+r) * picref->linesize[0]];
+            dst_pixel[1] =3D picref->data[0][(c+x + rgba_map[1]) * pixel_s=
tep
+
+                                           (y+r) * picref->linesize[0]];
+            dst_pixel[2] =3D picref->data[0][(c+x + rgba_map[2]) * pixel_s=
tep
+
+                                           (y+r) * picref->linesize[0]];
+
+            /* get intensity value in the glyph bitmap (source) */
+            src_val =3D GET_BITMAP_VAL(r, c);
+            if (!src_val)
+                continue;
+
+            SET_PIXEL_RGB(picref, rgba_color, src_val, c+x, y+r,
pixel_step,
+                          rgba_map[0], rgba_map[1], rgba_map[2],
rgba_map[3]);
+        }
+    }
+
+    return 0;
+}
+
+static inline void drawbox(AVFilterBufferRef *picref, unsigned int x,
unsigned int y,
+                           unsigned int width, unsigned int height,
+                           uint8_t *line[4], int pixel_step[4], uint8_t
color[4],
+                           int hsub, int vsub, int is_rgba_packed, uint8_t
rgba_map[4])
+{
+    int i, j, alpha;
+
+    if (color[3] !=3D 0xFF) {
+        if (is_rgba_packed) {
+            uint8_t *p;
+            for (j =3D 0; j < height; j++)
+                for (i =3D 0; i < width; i++)
+                    SET_PIXEL_RGB(picref, color, 255, i+x, y+j,
pixel_step[0],
+                                  rgba_map[0], rgba_map[1], rgba_map[2],
rgba_map[3]);
+        } else {
+            unsigned int luma_pos, chroma_pos1, chroma_pos2;
+            for (j =3D 0; j < height; j++)
+                for (i =3D 0; i < width; i++)
+                    SET_PIXEL_YUV(picref, color, 255, i+x, y+j, hsub,
vsub);
+        }
+    } else {
+        ff_draw_rectangle(picref->data, picref->linesize,
+                          line, pixel_step, hsub, vsub,
+                          x, y, width, height);
+    }
+}
+
+static int draw_text(AVFilterContext *ctx, AVFilterBufferRef *picref,
+                     int width, int height)
+{
+    DrawTextContext *dtext =3D ctx->priv;
+    char *text =3D dtext->text;
+    uint32_t code =3D 0, prev_code =3D 0;
+    int x =3D 0, y =3D 0, i =3D 0;
+    int text_height, baseline;
+    uint8_t *p;
+    int str_w, str_w_max;
+    int y_min =3D 32000, y_max =3D -32000;
+    FT_Vector delta;
+    Glyph *glyph =3D NULL, *prev_glyph =3D NULL;
+    Glyph dummy =3D { 0 };
+
+#if HAVE_LOCALTIME_R
+    time_t now =3D time(0);
+    struct tm ltime;
+    size_t expanded_text_len;
+
+    dtext->expanded_text[0] =3D '\1';
+    expanded_text_len =3D strftime(dtext->expanded_text,
MAX_EXPANDED_TEXT_SIZE,
+                                 text, localtime_r(&now, &ltime));
+    text =3D dtext->expanded_text;
+    if (expanded_text_len =3D=3D 0 && dtext->expanded_text[0] !=3D '\0') {
+        av_log(ctx, AV_LOG_ERROR,
+               "Impossible to print text, string is too big\n");
+        return AVERROR(EINVAL);
+    }
+#endif
+
+    str_w =3D str_w_max =3D 0;
+    x =3D dtext->x;
+    y =3D dtext->y;
+
+    /* load and cache glyphs */
+    for (i =3D 0, p =3D text; *p; i++) {
+        GET_UTF8(code, *p++, continue;);
+
+        /* get glyph */
+        dummy.code =3D code;
+        glyph =3D av_tree_find(dtext->glyphs, &dummy, (void *)glyph_cmp,
NULL);
+        if (!glyph)
+            load_glyph(ctx, &glyph, code);
+
+        y_min =3D FFMIN(glyph->bbox.yMin, y_min);
+        y_max =3D FFMAX(glyph->bbox.yMax, y_max);
+    }
+    text_height =3D y_max - y_min;
+    baseline    =3D y_max;
+
+    /* compute and save position for each glyph */
+    glyph =3D NULL;
+    for (i =3D 0, p =3D text; *p; i++) {
+        GET_UTF8(code, *p++, continue;);
+
+        /* skip the \n in the sequence \r\n */
+        if (prev_code =3D=3D '\r' && code =3D=3D '\n')
+            continue;
+
+        /* get glyph */
+        prev_glyph =3D glyph;
+        dummy.code =3D code;
+        glyph =3D av_tree_find(dtext->glyphs, &dummy, (void *)glyph_cmp,
NULL);
+
+        /* kerning */
+        if (dtext->use_kerning && prev_glyph && glyph->code) {
+            FT_Get_Kerning(dtext->face, prev_glyph->code, glyph->code,
+                           ft_kerning_default, &delta);
+            x +=3D delta.x >> 6;
+        }
+
+        if (x + glyph->advance >=3D width || code =3D=3D '\r' || code =3D=
=3D '\n') {
+            if (x + glyph->advance >=3D width)
+                str_w_max =3D width - dtext->x - 1;
+            y +=3D text_height;
+            x =3D dtext->x;
+        }
+
+        /* save position */
+        dtext->positions[i].x =3D x + glyph->bitmap_left;
+        dtext->positions[i].y =3D y - glyph->bitmap_top + baseline;
+        if (code !=3D '\n' && code !=3D '\r') {
+            int advance =3D glyph->advance;
+            if (code =3D=3D '\t')
+                advance *=3D dtext->tabsize;
+            x     +=3D advance;
+            str_w +=3D advance;
+        }
+        prev_code =3D code;
+    }
+
+    y +=3D text_height;
+    if (str_w_max =3D=3D 0)
+        str_w_max =3D str_w;
+
+    /* draw box */
+    if (dtext->draw_box) {
+        /* check if it doesn't pass the limits */
+        str_w_max =3D FFMIN(str_w_max, width - dtext->x - 1);
+        y =3D FFMIN(y, height - 1);
+
+        /* draw background */
+        drawbox(picref, dtext->x, dtext->y, str_w_max, y-dtext->y,
+                dtext->box_line, dtext->pixel_step, dtext->boxcolor,
+                dtext->hsub, dtext->vsub, dtext->is_packed_rgb,
dtext->rgba_map);
+    }
+
+    /* draw glyphs */
+    for (i =3D 0, p =3D text; *p; i++) {
+        Glyph dummy =3D { 0 };
+        GET_UTF8(code, *p++, continue;);
+
+        /* skip new line chars, just go to new line */
+        if (code =3D=3D '\n' || code =3D=3D '\r' || code =3D=3D '\t')
+            continue;
+
+        dummy.code =3D code;
+        glyph =3D av_tree_find(dtext->glyphs, &dummy, (void *)glyph_cmp,
NULL);
+
+        if (glyph->bitmap.pixel_mode !=3D FT_PIXEL_MODE_MONO &&
+            glyph->bitmap.pixel_mode !=3D FT_PIXEL_MODE_GRAY)
+            return AVERROR(EINVAL);
+
+        if (dtext->is_packed_rgb) {
+            draw_glyph_rgb(picref, &glyph->bitmap,
+                           dtext->positions[i].x, dtext->positions[i].y,
width, height,
+                           dtext->pixel_step[0], dtext->fontcolor_rgba,
dtext->rgba_map);
+        } else {
+            draw_glyph_yuv(picref, &glyph->bitmap,
+                           dtext->positions[i].x, dtext->positions[i].y,
width, height,
+                           dtext->fontcolor, dtext->hsub, dtext->vsub);
+        }
+    }
+
+    return 0;
+}
+
+static void null_draw_slice(AVFilterLink *link, int y, int h, int
slice_dir) { }
+
+static void end_frame(AVFilterLink *inlink)
+{
+    AVFilterLink *outlink =3D inlink->dst->outputs[0];
+    AVFilterBufferRef *picref =3D inlink->cur_buf;
+
+    draw_text(inlink->dst, picref, picref->video->w, picref->video->h);
+
+    avfilter_draw_slice(outlink, 0, picref->video->h, 1);
+    avfilter_end_frame(outlink);
+}
+
+AVFilter avfilter_vf_drawtext =3D {
+    .name          =3D "drawtext",
+    .description   =3D NULL_IF_CONFIG_SMALL("Draw text on top of video fra=
mes
using libfreetype library."),
+    .priv_size     =3D sizeof(DrawTextContext),
+    .init          =3D init,
+    .uninit        =3D uninit,
+    .query_formats =3D query_formats,
+
+    .inputs    =3D (AVFilterPad[]) {{ .name             =3D "default",
+                                    .type             =3D AVMEDIA_TYPE_VID=
EO,
+                                    .get_video_buffer =3D
avfilter_null_get_video_buffer,
+                                    .start_frame      =3D
avfilter_null_start_frame,
+                                    .draw_slice       =3D null_draw_slice,
+                                    .end_frame        =3D end_frame,
+                                    .config_props     =3D config_input,
+                                    .min_perms        =3D AV_PERM_WRITE |
+                                                        AV_PERM_READ,
+                                    .rej_perms        =3D AV_PERM_PRESERVE=
 },
+                                  { .name =3D NULL}},
+    .outputs   =3D (AVFilterPad[]) {{ .name             =3D "default",
+                                    .type             =3D AVMEDIA_TYPE_VID=
EO,
},
+                                  { .name =3D NULL}},
+};
--
1.7.4.1

_______________________________________________
libav-devel mailing list
libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
https://lists.libav.org/mailman/listinfo/libav-devel

--0016e6d77d257235c2049f21fc0c
Content-Type: text/html; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

<p>please polish the title.</p>
<p><blockquote type=3D"cite">=E5=9C=A8 2011-3-23 =E4=B8=8B=E5=8D=881:31=EF=
=BC=8C&quot;Anton Khirnov&quot; &lt;<a href=3D"mailto:anton-5jV5EzyPuF3R7s880joybQ@public.gmane.org">an=
ton-5jV5EzyPuF3R7s880joybQ@public.gmane.org</a>&gt;=E7=BC=96=E5=86=99=EF=BC=9A<br><br>From: Stefano Sab=
atini &lt;<a href=3D"mailto:stefano.sabatini-lala-Syd3ARw+vPY@public.gmane.org">stefano.sabatin=
i-lala-Syd3ARw+vPY@public.gmane.org</a>&gt;<br>

<br>
Signed-off-by: Michael Niedermayer &lt;<a href=3D"mailto:michaelni-RbZlAiThDcE@public.gmane.org">=
michaelni-RbZlAiThDcE@public.gmane.org</a>&gt;<br>
---<br>
=C2=A0configure =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 | =
=C2=A0 =C2=A06 +<br>
=C2=A0doc/filters.texi =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0| =C2=A0112 ++++++=
++<br>
=C2=A0libavfilter/Makefile =C2=A0 =C2=A0 =C2=A0| =C2=A0 =C2=A01 +<br>
=C2=A0libavfilter/allfilters.c =C2=A0| =C2=A0 =C2=A01 +<br>
=C2=A0libavfilter/vf_drawtext.c | =C2=A0650 +++++++++++++++++++++++++++++++=
++++++++++++++<br>
=C2=A05 files changed, 770 insertions(+), 0 deletions(-)<br>
=C2=A0create mode 100644 libavfilter/vf_drawtext.c<br>
<br>
diff --git a/configure b/configure<br>
index 00aa9ed..d6d1953 100755<br>
--- a/configure<br>
+++ b/configure<br>
@@ -169,6 +169,7 @@ External library support:<br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0and libraw1394 [no]<br>
 =C2=A0 --enable-libdirac =C2=A0 =C2=A0 =C2=A0 =C2=A0enable Dirac support v=
ia libdirac [no]<br>
 =C2=A0 --enable-libfaac =C2=A0 =C2=A0 =C2=A0 =C2=A0 enable FAAC support vi=
a libfaac [no]<br>
+ =C2=A0--enable-libfreetype =C2=A0 =C2=A0 enable libfreetype [no]<br>
 =C2=A0 --enable-libgsm =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0enable GSM suppor=
t via libgsm [no]<br>
 =C2=A0 --enable-libmp3lame =C2=A0 =C2=A0 =C2=A0enable MP3 encoding via lib=
mp3lame [no]<br>
 =C2=A0 --enable-libnut =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0enable NUT (de)mu=
xing via libnut,<br>
@@ -927,6 +928,7 @@ CONFIG_LIST=3D&quot;<br>
 =C2=A0 =C2=A0 libdc1394<br>
 =C2=A0 =C2=A0 libdirac<br>
 =C2=A0 =C2=A0 libfaac<br>
+ =C2=A0 =C2=A0libfreetype<br>
 =C2=A0 =C2=A0 libgsm<br>
 =C2=A0 =C2=A0 libmp3lame<br>
 =C2=A0 =C2=A0 libnut<br>
@@ -1074,6 +1076,7 @@ HAVE_LIST=3D&quot;<br>
 =C2=A0 =C2=A0 llrintf<br>
 =C2=A0 =C2=A0 local_aligned_16<br>
 =C2=A0 =C2=A0 local_aligned_8<br>
+ =C2=A0 =C2=A0localtime_r<br>
 =C2=A0 =C2=A0 log2<br>
 =C2=A0 =C2=A0 log2f<br>
 =C2=A0 =C2=A0 loongson<br>
@@ -1454,6 +1457,7 @@ udp_protocol_deps=3D&quot;network&quot;<br>
=C2=A0# filters<br>
=C2=A0blackframe_filter_deps=3D&quot;gpl&quot;<br>
=C2=A0cropdetect_filter_deps=3D&quot;gpl&quot;<br>
+drawtext_filter_deps=3D&quot;libfreetype&quot;<br>
=C2=A0frei0r_filter_deps=3D&quot;frei0r dlopen strtok_r&quot;<br>
=C2=A0frei0r_src_filter_deps=3D&quot;frei0r dlopen strtok_r&quot;<br>
=C2=A0hqdn3d_filter_deps=3D&quot;gpl&quot;<br>
@@ -2768,6 +2772,7 @@ check_func =C2=A0getrusage<br>
=C2=A0check_struct &quot;sys/time.h sys/resource.h&quot; &quot;struct rusag=
e&quot; ru_maxrss<br>
=C2=A0check_func =C2=A0inet_aton $network_extralibs<br>
=C2=A0check_func =C2=A0isatty<br>
+check_func =C2=A0localtime_r<br>
=C2=A0check_func =C2=A0${malloc_prefix}memalign =C2=A0 =C2=A0 =C2=A0 =C2=A0=
 =C2=A0 =C2=A0&amp;&amp; enable memalign<br>
=C2=A0check_func =C2=A0mkstemp<br>
=C2=A0check_func =C2=A0mmap<br>
@@ -2853,6 +2858,7 @@ enabled libdirac =C2=A0 &amp;&amp; require_pkg_config=
 dirac =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0\<br>
 =C2=A0 =C2=A0 &quot;libdirac_decoder/dirac_parser.h libdirac_encoder/dirac=
_encoder.h&quot; =C2=A0\<br>
 =C2=A0 =C2=A0 &quot;dirac_decoder_init dirac_encoder_init&quot;<br>
=C2=A0enabled libfaac =C2=A0 =C2=A0&amp;&amp; require2 libfaac &quot;stdint=
.h faac.h&quot; faacEncGetVersion -lfaac<br>
+enabled libfreetype &amp;&amp; add_cflags $(pkg-config --cflags freetype2)=
 &amp;&amp; require libfreetype ft2build.h FT_Init_FreeType -lfreetype<br>
=C2=A0enabled libgsm =C2=A0 =C2=A0 &amp;&amp; require =C2=A0libgsm gsm/gsm.=
h gsm_create -lgsm<br>
=C2=A0enabled libmp3lame &amp;&amp; require =C2=A0&quot;libmp3lame &gt;=3D =
3.98.3&quot; lame/lame.h lame_set_VBR_quality -lmp3lame<br>
=C2=A0enabled libnut =C2=A0 =C2=A0 &amp;&amp; require =C2=A0libnut libnut.h=
 nut_demuxer_init -lnut<br>
diff --git a/doc/filters.texi b/doc/filters.texi<br>
index 872afc6..3f626d2 100644<br>
--- a/doc/filters.texi<br>
+++ b/doc/filters.texi<br>
@@ -386,6 +386,118 @@ fade=3Din:0:25, fade=3Dout:975:25<br>
=C2=A0fade=3Din:5:20<br>
=C2=A0@end example<br>
<br>
+@section drawtext<br>
+<br>
+Draw text string or text from specified file on top of video using the<br>
+libfreetype library.<br>
+<br>
+To enable compilation of this filter you need to configure FFmpeg with<br>
+@code{--enable-libfreetype}.<br>
+<br>
+The filter also recognizes strftime() sequences in the provided text<br>
+and expands them accordingly. Check the documentation of strftime().<br>
+<br>
+The filter accepts parameters as a list of @var{key}=3D@var{value} pairs,<=
br>
+separated by &quot;:&quot;.<br>
+<br>
+The description of the accepted parameters follows.<br>
+<br>
+@table @option<br>
+<br>
+@item fontfile<br>
+The font file to be used for drawing text. Path must be included.<br>
+This parameter is mandatory.<br>
+<br>
+@item text<br>
+The text string to be drawn. The text must be a sequence of UTF-8<br>
+encoded characters.<br>
+This parameter is mandatory if no file is specified.<br>
+<br>
+@item textfile<br>
+A text file containing text to be drawn. The text must be a sequence<br>
+of UTF-8 encoded characters<br>
+<br>
+This parameter is mandatory if no text string is specified.<br>
+<br>
+If both text and textfile are specified, an error is thrown.<br>
+<br>
+@item x, y<br>
+The offsets where text will be drawn within the video frame.<br>
+Relative to the top/left border of the output image.<br>
+<br>
+The default value of @var{x} and @var{y} is 0.<br>
+<br>
+@item fontsize<br>
+The font size to be used for drawing text.<br>
+The default value of @var{size} is 16.<br>
+<br>
+@item fontcolor<br>
+The color to be used for drawing fonts.<br>
+Either a string (e.g. &quot;red&quot;) or in 0xRRGGBB[AA] format<br>
+(e.g. &quot;0xff000033&quot;), possibly followed by an alpha specifier.<br=
>
+The default value of @var{fontcolor} is &quot;black&quot;.<br>
+<br>
+@item boxcolor<br>
+The color to be used for drawing box around text.<br>
+Either a string (e.g. &quot;yellow&quot;) or in 0xRRGGBB[AA] format<br>
+(e.g. &quot;0xff00ff&quot;), possibly followed by an alpha specifier.<br>
+<br>
+The default value of @var{bgcolor} is &quot;white&quot;.<br>
+<br>
+@item box<br>
+Used to draw a box around text using background color.<br>
+Value should be either 1 (enable) or 0 (disable).<br>
+The default value of @var{box} is 0.<br>
+<br>
+@item ft_load_flags<br>
+Flags to be used for loading the fonts.<br>
+<br>
+The flags map the corresponding flags supported by libfreetype, and are<br=
>
+a combination of the following values:<br>
+@table @var<br>
+@item default<br>
+@item no_scale<br>
+@item no_hinting<br>
+@item render<br>
+@item no_bitmap<br>
+@item vertical_layout<br>
+@item force_autohint<br>
+@item crop_bitmap<br>
+@item pedantic<br>
+@item ignore_global_advance_width<br>
+@item no_recurse<br>
+@item ignore_transform<br>
+@item monochrome<br>
+@item linear_design<br>
+@item no_autohint<br>
+@item end table<br>
+@end table<br>
+<br>
+Default value is &quot;render&quot;.<br>
+<br>
+For more information consult the documentation for the FT_LOAD_*<br>
+libfreetype flags.<br>
+<br>
+@item tabsize<br>
+The size in number of spaces to use for rendering the tab.<br>
+Default value is 4.<br>
+@end table<br>
+<br>
+For example the command:<br>
+@example<br>
+drawtext=3Dfontfile=3DFreeSerif.ttf: text=3D&#39;Test Text&#39;: x=3D100: =
y=3D50: fontsize=3D24: fontcolor=3Dyellow@@0.2: boxcolor=3Dred@@0.2: box=3D=
1&quot;<br>
+@end example<br>
+<br>
+will draw &#39;Test Text&#39; with font FreeSerif of size 24 at position<b=
r>
+(100,50), text color is yellow, and draw a red box around text. Both<br>
+the text and the box have an opacity of 20%.<br>
+<br>
+Note that the double quotes are not necessary if spaces are not used<br>
+within the parameter list.<br>
+<br>
+For more information about libfreetype, check:<br>
+@url{<a href=3D"http://www.freetype.org/" target=3D"_blank">http://www.fre=
etype.org/</a>}<br>
+<br>
=C2=A0@section fifo<br>
<br>
=C2=A0Buffer input images and send them when they are requested.<br>
diff --git a/libavfilter/Makefile b/libavfilter/Makefile<br>
index f7bc98d..f116fe5 100644<br>
--- a/libavfilter/Makefile<br>
+++ b/libavfilter/Makefile<br>
@@ -26,6 +26,7 @@ OBJS-$(CONFIG_COPY_FILTER) =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 +=3D vf_copy.o<br>
=C2=A0OBJS-$(CONFIG_CROP_FILTER) =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 +=3D vf_crop.o<br>
=C2=A0OBJS-$(CONFIG_CROPDETECT_FILTER) =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 +=3D vf_cropdetect.o<br>
=C2=A0OBJS-$(CONFIG_DRAWBOX_FILTER) =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0+=3D vf_drawbox.o<br>
+OBJS-$(CONFIG_DRAWTEXT_FILTER) =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 +=3D vf_drawtext.o<br>
=C2=A0OBJS-$(CONFIG_FADE_FILTER) =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 +=3D vf_fade.o<br>
=C2=A0OBJS-$(CONFIG_FIFO_FILTER) =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 +=3D vf_fifo.o<br>
=C2=A0OBJS-$(CONFIG_FORMAT_FILTER) =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 +=3D vf_format.o<br>
diff --git a/libavfilter/allfilters.c b/libavfilter/allfilters.c<br>
index 34e87f5..06934c8 100644<br>
--- a/libavfilter/allfilters.c<br>
+++ b/libavfilter/allfilters.c<br>
@@ -45,6 +45,7 @@ void avfilter_register_all(void)<br>
 =C2=A0 =C2=A0 REGISTER_FILTER (CROP, =C2=A0 =C2=A0 =C2=A0 =C2=A0crop, =C2=
=A0 =C2=A0 =C2=A0 =C2=A0vf);<br>
 =C2=A0 =C2=A0 REGISTER_FILTER (CROPDETECT, =C2=A0cropdetect, =C2=A0vf);<br=
>
 =C2=A0 =C2=A0 REGISTER_FILTER (DRAWBOX, =C2=A0 =C2=A0 drawbox, =C2=A0 =C2=
=A0 vf);<br>
+ =C2=A0 =C2=A0REGISTER_FILTER (DRAWTEXT, =C2=A0 =C2=A0drawtext, =C2=A0 =C2=
=A0vf);<br>
 =C2=A0 =C2=A0 REGISTER_FILTER (FADE, =C2=A0 =C2=A0 =C2=A0 =C2=A0fade, =C2=
=A0 =C2=A0 =C2=A0 =C2=A0vf);<br>
 =C2=A0 =C2=A0 REGISTER_FILTER (FIFO, =C2=A0 =C2=A0 =C2=A0 =C2=A0fifo, =C2=
=A0 =C2=A0 =C2=A0 =C2=A0vf);<br>
 =C2=A0 =C2=A0 REGISTER_FILTER (FORMAT, =C2=A0 =C2=A0 =C2=A0format, =C2=A0 =
=C2=A0 =C2=A0vf);<br>
diff --git a/libavfilter/vf_drawtext.c b/libavfilter/vf_drawtext.c<br>
new file mode 100644<br>
index 0000000..9fe6def<br>
--- /dev/null<br>
+++ b/libavfilter/vf_drawtext.c<br>
@@ -0,0 +1,650 @@<br>
+/*<br>
+ * Copyright (c) 2011 Stefano Sabatini<br>
+ * Copyright (c) 2010 S.N. Hemanth Meenakshisundaram<br>
+ * Copyright (c) 2003 Gustavo Sverzut Barbieri &lt;<a href=3D"mailto:gsbar=
bieri-/E1597aS9LRfJ/NunPodnw@public.gmane.org">gsbarbieri-/E1597aS9LRfJ/NunPodnw@public.gmane.org</a>&gt;<br>
+ *<br>
+ * This file is part of FFmpeg.<br>
+ *<br>
+ * FFmpeg is free software; you can redistribute it and/or<br>
+ * modify it under the terms of the GNU Lesser General Public<br>
+ * License as published by the Free Software Foundation; either<br>
+ * version 2.1 of the License, or (at your option) any later version.<br>
+ *<br>
+ * FFmpeg is distributed in the hope that it will be useful,<br>
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of<br>
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. =C2=A0See the GNU<=
br>
+ * Lesser General Public License for more details.<br>
+ *<br>
+ * You should have received a copy of the GNU Lesser General Public<br>
+ * License along with FFmpeg; if not, write to the Free Software<br>
+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-130=
1 USA<br>
+ */<br>
+<br>
+/**<br>
+ * @file<br>
+ * drawtext filter, based on the original FFmpeg vhook/drawtext.c<br>
+ * filter by Gustavo Sverzut Barbieri<br>
+ */<br>
+<br>
+#include &lt;sys/time.h&gt;<br>
+#include &lt;time.h&gt;<br>
+<br>
+#include &quot;libavutil/colorspace.h&quot;<br>
+#include &quot;libavutil/file.h&quot;<br>
+#include &quot;libavutil/opt.h&quot;<br>
+#include &quot;libavutil/parseutils.h&quot;<br>
+#include &quot;libavutil/pixdesc.h&quot;<br>
+#include &quot;libavutil/tree.h&quot;<br>
+#include &quot;avfilter.h&quot;<br>
+#include &quot;drawutils.h&quot;<br>
+<br>
+#undef time<br>
+<br>
+#include &lt;ft2build.h&gt;<br>
+#include &lt;freetype/config/ftheader.h&gt;<br>
+#include FT_FREETYPE_H<br>
+#include FT_GLYPH_H<br>
+<br>
+#define MAX_EXPANDED_TEXT_SIZE 2048<br>
+<br>
+typedef struct {<br>
+ =C2=A0 =C2=A0const AVClass *class;<br>
+ =C2=A0 =C2=A0char *fontfile; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 ///&lt; font to be used<br>
+ =C2=A0 =C2=A0char *text; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0=
 =C2=A0 =C2=A0 =C2=A0 ///&lt; text to be drawn<br>
+ =C2=A0 =C2=A0int ft_load_flags; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0=
 =C2=A0///&lt; flags used for loading fonts, see FT_LOAD_*<br>
+ =C2=A0 =C2=A0/** buffer containing the text expanded by strftime */<br>
+ =C2=A0 =C2=A0char expanded_text[MAX_EXPANDED_TEXT_SIZE];<br>
+ =C2=A0 =C2=A0/** positions for each element in the text */<br>
+ =C2=A0 =C2=A0FT_Vector positions[MAX_EXPANDED_TEXT_SIZE];<br>
+ =C2=A0 =C2=A0char *textfile; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 ///&lt; file with text to be drawn<br>
+ =C2=A0 =C2=A0unsigned int x; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 ///&lt; x position to start drawing text<br>
+ =C2=A0 =C2=A0unsigned int y; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 ///&lt; y position to start drawing text<br>
+ =C2=A0 =C2=A0unsigned int fontsize; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0///=
&lt; font size to use<br>
+ =C2=A0 =C2=A0char *fontcolor_string; =C2=A0 =C2=A0 =C2=A0 =C2=A0 ///&lt; =
font color as string<br>
+ =C2=A0 =C2=A0char *boxcolor_string; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0///=
&lt; box color as string<br>
+ =C2=A0 =C2=A0uint8_t fontcolor[4]; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 ///=
&lt; foreground color<br>
+ =C2=A0 =C2=A0uint8_t boxcolor[4]; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0///&lt; background color<br>
+ =C2=A0 =C2=A0uint8_t fontcolor_rgba[4]; =C2=A0 =C2=A0 =C2=A0///&lt; foreg=
round color in RGBA<br>
+ =C2=A0 =C2=A0uint8_t boxcolor_rgba[4]; =C2=A0 =C2=A0 =C2=A0 ///&lt; backg=
round color in RGBA<br>
+<br>
+ =C2=A0 =C2=A0short int draw_box; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 ///&lt; draw box around text - true or false<br>
+ =C2=A0 =C2=A0int use_kerning; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0///&lt; font kerning is used - true/false<br>
+ =C2=A0 =C2=A0int tabsize; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0///&lt; tab size<br>
+<br>
+ =C2=A0 =C2=A0FT_Library library; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 ///&lt; freetype font library handle<br>
+ =C2=A0 =C2=A0FT_Face face; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 ///&lt; freetype font face handle<br>
+ =C2=A0 =C2=A0struct AVTreeNode *glyphs; =C2=A0 =C2=A0 =C2=A0///&lt; rende=
red glyphs, stored using the UTF-32 char code<br>
+ =C2=A0 =C2=A0int hsub, vsub; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 ///&lt; chroma subsampling values<br>
+ =C2=A0 =C2=A0int is_packed_rgb;<br>
+ =C2=A0 =C2=A0int pixel_step[4]; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0=
 =C2=A0///&lt; distance in bytes between the component of each pixel<br>
+ =C2=A0 =C2=A0uint8_t rgba_map[4]; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0///&lt; map RGBA offsets to the positions in the packed RGBA format<br>
+ =C2=A0 =C2=A0uint8_t *box_line[4]; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 ///=
&lt; line used for filling the box background<br>
+} DrawTextContext;<br>
+<br>
+#define OFFSET(x) offsetof(DrawTextContext, x)<br>
+<br>
+static const AVOption drawtext_options[]=3D {<br>
+{&quot;fontfile&quot;, &quot;set font file&quot;, =C2=A0 =C2=A0 =C2=A0 =C2=
=A0OFFSET(fontfile), =C2=A0 =C2=A0 =C2=A0 =C2=A0 FF_OPT_TYPE_STRING, 0, =C2=
=A0CHAR_MIN, CHAR_MAX },<br>
+{&quot;text&quot;, =C2=A0 =C2=A0 &quot;set text&quot;, =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 OFFSET(text), =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 FF_OPT_TYPE_STRING, 0, =C2=A0CHAR_MIN, CHAR_MAX },<br>
+{&quot;textfile&quot;, &quot;set text file&quot;, =C2=A0 =C2=A0 =C2=A0 =C2=
=A0OFFSET(textfile), =C2=A0 =C2=A0 =C2=A0 =C2=A0 FF_OPT_TYPE_STRING, 0, =C2=
=A0CHAR_MIN, CHAR_MAX },<br>
+{&quot;fontcolor&quot;,&quot;set foreground color&quot;, OFFSET(fontcolor_=
string), FF_OPT_TYPE_STRING, 0, =C2=A0CHAR_MIN, CHAR_MAX },<br>
+{&quot;boxcolor&quot;, &quot;set box color&quot;, =C2=A0 =C2=A0 =C2=A0 =C2=
=A0OFFSET(boxcolor_string), =C2=A0FF_OPT_TYPE_STRING, 0, =C2=A0CHAR_MIN, CH=
AR_MAX },<br>
+{&quot;box&quot;, =C2=A0 =C2=A0 =C2=A0&quot;set box&quot;, =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0OFFSET(draw_box), =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 FF_OPT_TYPE_INT, =C2=A0 =C2=A00, =C2=A0 =C2=A0 =C2=A0 =C2=A0 0, =C2=
=A0 =C2=A0 =C2=A0 =C2=A01 },<br>
+{&quot;fontsize&quot;, &quot;set font size&quot;, =C2=A0 =C2=A0 =C2=A0 =C2=
=A0OFFSET(fontsize), =C2=A0 =C2=A0 =C2=A0 =C2=A0 FF_OPT_TYPE_INT, =C2=A0 16=
, =C2=A0 =C2=A0 =C2=A0 =C2=A0 1, =C2=A0 =C2=A0 =C2=A0 72 },<br>
+{&quot;x&quot;, =C2=A0 =C2=A0 =C2=A0 =C2=A0&quot;set x&quot;, =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0OFFSET(x), =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0FF_OPT_TYPE_INT, =C2=A0 =C2=A00, =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 0, =C2=A0INT_MAX },<br>
+{&quot;y&quot;, =C2=A0 =C2=A0 =C2=A0 =C2=A0&quot;set y&quot;, =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0OFFSET(y), =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0FF_OPT_TYPE_INT, =C2=A0 =C2=A00, =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 0, =C2=A0INT_MAX },<br>
+{&quot;tabsize&quot;, =C2=A0&quot;set tab size&quot;, =C2=A0 =C2=A0 =C2=A0=
 =C2=A0 OFFSET(tabsize), =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0FF_OPT_TYPE_INT,=
 =C2=A0 =C2=A04, =C2=A0 =C2=A0 =C2=A0 =C2=A0 0, =C2=A0INT_MAX },<br>
+<br>
+/* FT_LOAD_* flags */<br>
+{&quot;ft_load_flags&quot;, &quot;set font loading flags for libfreetype&q=
uot;, =C2=A0 OFFSET(ft_load_flags), =C2=A0FF_OPT_TYPE_FLAGS, =C2=A0FT_LOAD_=
DEFAULT|FT_LOAD_RENDER, 0, INT_MAX, 0, &quot;ft_load_flags&quot; },<br>
+{&quot;default&quot;, =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 &quot;set default&quot;, =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 0, FF_OPT_TYPE_CONST, FT_LOAD_DEFAUL=
T, =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 IN=
T_MIN, INT_MAX, 0, &quot;ft_load_flags&quot; },<br>
+{&quot;no_scale&quot;, =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0&quot;set no_scale&quot;, =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A00, FF_OPT_TYPE_CONST, FT_LOAD_NO_S=
CALE, =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0=
INT_MIN, INT_MAX, 0, &quot;ft_load_flags&quot; },<br>
+{&quot;no_hinting&quot;, =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0&quot;set no_hinting&quot;, =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0=
 =C2=A0 =C2=A0 =C2=A0 =C2=A00, FF_OPT_TYPE_CONST, FT_LOAD_NO_HINTING, =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0INT_MIN, INT_MAX=
, 0, &quot;ft_load_flags&quot; },<br>
+{&quot;render&quot;, =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0&quot;set render&quot;, =C2=A0 =C2=A0 =C2=A0 =C2=A0=
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A00, FF_OPT_TYPE_CONST, FT_L=
OAD_RENDER, =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0INT_MIN, INT_MAX, 0, &quot;ft_load_flags&quot; },<br>
+{&quot;no_bitmap&quot;, =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 &quot;set no_bitmap&quot;, =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0=
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 0, FF_OPT_TYPE_CONST, FT_LOAD_NO_BITMAP, =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 INT_MIN, INT_MA=
X, 0, &quot;ft_load_flags&quot; },<br>
+{&quot;vertical_layout&quot;, =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 &q=
uot;set vertical_layout&quot;, =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 0,=
 FF_OPT_TYPE_CONST, FT_LOAD_VERTICAL_LAYOUT, =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 INT_MIN, INT_MAX, 0, &quot;ft_load_flags&quot; },<br>
+{&quot;force_autohint&quot;, =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0&quot;set force_autohint&quot;, =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A00, FF_OPT_TYPE_CONST, FT_LOAD_FORCE_AUTOHINT, =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0INT_MIN, INT_MAX, 0, &quot;ft_load_flags&quo=
t; },<br>
+{&quot;crop_bitmap&quot;, =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0=
 =C2=A0 &quot;set crop_bitmap&quot;, =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 0, FF_OPT_TYPE_CONST, FT_LOAD_CROP_BITMAP, =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 INT_MIN, INT_MAX, 0, &quot;ft_loa=
d_flags&quot; },<br>
+{&quot;pedantic&quot;, =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0&quot;set pedantic&quot;, =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A00, FF_OPT_TYPE_CONST, FT_LOAD_PEDA=
NTIC, =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0=
INT_MIN, INT_MAX, 0, &quot;ft_load_flags&quot; },<br>
+{&quot;ignore_global_advance_width&quot;, &quot;set ignore_global_advance_=
width&quot;, 0, FF_OPT_TYPE_CONST, FT_LOAD_IGNORE_GLOBAL_ADVANCE_WIDTH, INT=
_MIN, INT_MAX, 0, &quot;ft_load_flags&quot; },<br>
+{&quot;no_recurse&quot;, =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0&quot;set no_recurse&quot;, =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0=
 =C2=A0 =C2=A0 =C2=A0 =C2=A00, FF_OPT_TYPE_CONST, FT_LOAD_NO_RECURSE, =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0INT_MIN, INT_MAX=
, 0, &quot;ft_load_flags&quot; },<br>
+{&quot;ignore_transform&quot;, =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0&q=
uot;set ignore_transform&quot;, =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A00,=
 FF_OPT_TYPE_CONST, FT_LOAD_IGNORE_TRANSFORM, =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0INT_MIN, INT_MAX, 0, &quot;ft_load_flags&quot; },<br>
+{&quot;monochrome&quot;, =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0&quot;set monochrome&quot;, =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0=
 =C2=A0 =C2=A0 =C2=A0 =C2=A00, FF_OPT_TYPE_CONST, FT_LOAD_MONOCHROME, =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0INT_MIN, INT_MAX=
, 0, &quot;ft_load_flags&quot; },<br>
+{&quot;linear_design&quot;, =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 &quot;set linear_design&quot;, =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 0, FF_OPT_TYPE_CONST, FT_LOAD_LINEAR_DESIGN, =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 INT_MIN, INT_MAX, 0, &quot;ft_load_flags&qu=
ot; },<br>
+{&quot;no_autohint&quot;, =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0=
 =C2=A0 &quot;set no_autohint&quot;, =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 0, FF_OPT_TYPE_CONST, FT_LOAD_NO_AUTOHINT, =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 INT_MIN, INT_MAX, 0, &quot;ft_loa=
d_flags&quot; },<br>
+{NULL},<br>
+};<br>
+<br>
+static const char *drawtext_get_name(void *ctx)<br>
+{<br>
+ =C2=A0 =C2=A0return &quot;drawtext&quot;;<br>
+}<br>
+<br>
+static const AVClass drawtext_class =3D {<br>
+ =C2=A0 =C2=A0&quot;DrawTextContext&quot;,<br>
+ =C2=A0 =C2=A0drawtext_get_name,<br>
+ =C2=A0 =C2=A0drawtext_options<br>
+};<br>
+<br>
+#undef __FTERRORS_H__<br>
+#define FT_ERROR_START_LIST {<br>
+#define FT_ERRORDEF(e, v, s) { (e), (s) },<br>
+#define FT_ERROR_END_LIST { 0, NULL } };<br>
+<br>
+struct ft_error<br>
+{<br>
+ =C2=A0 =C2=A0int err;<br>
+ =C2=A0 =C2=A0const char *err_msg;<br>
+} static ft_errors[] =3D<br>
+#include FT_ERRORS_H<br>
+<br>
+#define FT_ERRMSG(e) ft_errors[e].err_msg<br>
+<br>
+typedef struct {<br>
+ =C2=A0 =C2=A0FT_Glyph *glyph;<br>
+ =C2=A0 =C2=A0uint32_t code;<br>
+ =C2=A0 =C2=A0FT_Bitmap bitmap; ///&lt; array holding bitmaps of font<br>
+ =C2=A0 =C2=A0FT_BBox bbox;<br>
+ =C2=A0 =C2=A0int advance;<br>
+ =C2=A0 =C2=A0int bitmap_left;<br>
+ =C2=A0 =C2=A0int bitmap_top;<br>
+} Glyph;<br>
+<br>
+static int glyph_cmp(const Glyph *a, const Glyph *b)<br>
+{<br>
+ =C2=A0 =C2=A0int64_t diff =3D (int64_t)a-&gt;code - (int64_t)b-&gt;code;<=
br>
+ =C2=A0 =C2=A0return diff &gt; 0 ? 1 : diff &lt; 0 ? -1 : 0;<br>
+}<br>
+<br>
+/**<br>
+ * Load glyphs corresponding to the UTF-32 codepoint code.<br>
+ */<br>
+static int load_glyph(AVFilterContext *ctx, Glyph **glyph_ptr, uint32_t co=
de)<br>
+{<br>
+ =C2=A0 =C2=A0DrawTextContext *dtext =3D ctx-&gt;priv;<br>
+ =C2=A0 =C2=A0Glyph *glyph =3D av_mallocz(sizeof(Glyph));<br>
+ =C2=A0 =C2=A0struct AVTreeNode *node =3D NULL;<br>
+ =C2=A0 =C2=A0int ret;<br>
+<br>
+ =C2=A0 =C2=A0/* load glyph into dtext-&gt;face-&gt;glyph */<br>
+ =C2=A0 =C2=A0ret =3D FT_Load_Char(dtext-&gt;face, code, dtext-&gt;ft_load=
_flags);<br>
+ =C2=A0 =C2=A0if (ret)<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0return AVERROR(EINVAL);<br>
+<br>
+ =C2=A0 =C2=A0/* save glyph */<br>
+ =C2=A0 =C2=A0glyph-&gt;code =C2=A0=3D code;<br>
+ =C2=A0 =C2=A0glyph-&gt;glyph =3D av_mallocz(sizeof(FT_Glyph));<br>
+ =C2=A0 =C2=A0ret =3D FT_Get_Glyph(dtext-&gt;face-&gt;glyph, glyph-&gt;gly=
ph);<br>
+ =C2=A0 =C2=A0if (ret)<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0return AVERROR(EINVAL);<br>
+<br>
+ =C2=A0 =C2=A0glyph-&gt;bitmap =C2=A0 =C2=A0 =C2=A0=3D dtext-&gt;face-&gt;=
glyph-&gt;bitmap;<br>
+ =C2=A0 =C2=A0glyph-&gt;bitmap_left =3D dtext-&gt;face-&gt;glyph-&gt;bitma=
p_left;<br>
+ =C2=A0 =C2=A0glyph-&gt;bitmap_top =C2=A0=3D dtext-&gt;face-&gt;glyph-&gt;=
bitmap_top;<br>
+ =C2=A0 =C2=A0glyph-&gt;advance =C2=A0 =C2=A0 =3D dtext-&gt;face-&gt;glyph=
-&gt;advance.x &gt;&gt; 6;<br>
+<br>
+ =C2=A0 =C2=A0/* measure text height to calculate text_height (or the maxi=
mum text height) */<br>
+ =C2=A0 =C2=A0FT_Glyph_Get_CBox(*glyph-&gt;glyph, ft_glyph_bbox_pixels, &a=
mp;glyph-&gt;bbox);<br>
+<br>
+ =C2=A0 =C2=A0/* cache the newly created glyph */<br>
+ =C2=A0 =C2=A0if (!node)<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0node =3D av_mallocz(av_tree_node_size);<br>
+ =C2=A0 =C2=A0av_tree_insert(&amp;dtext-&gt;glyphs, glyph, (void *)glyph_c=
mp, &amp;node);<br>
+<br>
+ =C2=A0 =C2=A0if (glyph_ptr)<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0*glyph_ptr =3D glyph;<br>
+ =C2=A0 =C2=A0return 0;<br>
+}<br>
+<br>
+static av_cold int init(AVFilterContext *ctx, const char *args, void *opaq=
ue)<br>
+{<br>
+ =C2=A0 =C2=A0int err;<br>
+ =C2=A0 =C2=A0DrawTextContext *dtext =3D ctx-&gt;priv;<br>
+<br>
+ =C2=A0 =C2=A0dtext-&gt;class =3D &amp;drawtext_class;<br>
+ =C2=A0 =C2=A0av_opt_set_defaults2(dtext, 0, 0);<br>
+ =C2=A0 =C2=A0dtext-&gt;fontcolor_string =3D av_strdup(&quot;black&quot;);=
<br>
+ =C2=A0 =C2=A0dtext-&gt;boxcolor_string =3D av_strdup(&quot;white&quot;);<=
br>
+<br>
+ =C2=A0 =C2=A0if ((err =3D (av_set_options_string(dtext, args, &quot;=3D&q=
uot;, &quot;:&quot;))) &lt; 0) {<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0av_log(ctx, AV_LOG_ERROR, &quot;Error parsing =
options string: &#39;%s&#39;\n&quot;, args);<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0return err;<br>
+ =C2=A0 =C2=A0}<br>
+<br>
+ =C2=A0 =C2=A0if (!dtext-&gt;fontfile) {<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0av_log(ctx, AV_LOG_ERROR, &quot;No font filena=
me provided\n&quot;);<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0return AVERROR(EINVAL);<br>
+ =C2=A0 =C2=A0}<br>
+<br>
+ =C2=A0 =C2=A0if (dtext-&gt;textfile) {<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0uint8_t *textbuf;<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0size_t textbuf_size;<br>
+<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0if (dtext-&gt;text) {<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0av_log(ctx, AV_LOG_ERROR,<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 &quot;Both=
 text and text file provided. Please provide only one\n&quot;);<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0return AVERROR(EINVAL);<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0}<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0if ((err =3D av_file_map(dtext-&gt;textfile, &=
amp;textbuf, &amp;textbuf_size, 0, ctx)) &lt; 0) {<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0av_log(ctx, AV_LOG_ERROR,<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 &quot;The =
text file &#39;%s&#39; could not be read or is empty\n&quot;,<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 dtext-&gt;=
textfile);<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0return err;<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0}<br>
+<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0if (!(dtext-&gt;text =3D av_malloc(textbuf_siz=
e+1)))<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0return AVERROR(ENOMEM);<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0memcpy(dtext-&gt;text, textbuf, textbuf_size);=
<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0dtext-&gt;text[textbuf_size] =3D 0;<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0av_file_unmap(textbuf, textbuf_size);<br>
+ =C2=A0 =C2=A0}<br>
+<br>
+ =C2=A0 =C2=A0if (!dtext-&gt;text) {<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0av_log(ctx, AV_LOG_ERROR,<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 &quot;Either text or a v=
alid file must be provided\n&quot;);<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0return AVERROR(EINVAL);<br>
+ =C2=A0 =C2=A0}<br>
+<br>
+ =C2=A0 =C2=A0if ((err =3D av_parse_color(dtext-&gt;fontcolor_rgba, dtext-=
&gt;fontcolor_string, -1, ctx))) {<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0av_log(ctx, AV_LOG_ERROR,<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 &quot;Invalid font color=
 &#39;%s&#39;\n&quot;, dtext-&gt;fontcolor_string);<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0return err;<br>
+ =C2=A0 =C2=A0}<br>
+<br>
+ =C2=A0 =C2=A0if ((err =3D av_parse_color(dtext-&gt;boxcolor_rgba, dtext-&=
gt;boxcolor_string, -1, ctx))) {<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0av_log(ctx, AV_LOG_ERROR,<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 &quot;Invalid box color =
&#39;%s&#39;\n&quot;, dtext-&gt;boxcolor_string);<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0return err;<br>
+ =C2=A0 =C2=A0}<br>
+<br>
+ =C2=A0 =C2=A0if ((err =3D FT_Init_FreeType(&amp;(dtext-&gt;library)))) {<=
br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0av_log(ctx, AV_LOG_ERROR,<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 &quot;Could not load Fre=
eType: %s\n&quot;, FT_ERRMSG(err));<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0return AVERROR(EINVAL);<br>
+ =C2=A0 =C2=A0}<br>
+<br>
+ =C2=A0 =C2=A0/* load the face, and set up the encoding, which is by defau=
lt UTF-8 */<br>
+ =C2=A0 =C2=A0if ((err =3D FT_New_Face(dtext-&gt;library, dtext-&gt;fontfi=
le, 0, &amp;dtext-&gt;face))) {<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0av_log(ctx, AV_LOG_ERROR, &quot;Could not load=
 fontface from file &#39;%s&#39;: %s\n&quot;,<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 dtext-&gt;fontfile, FT_E=
RRMSG(err));<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0return AVERROR(EINVAL);<br>
+ =C2=A0 =C2=A0}<br>
+ =C2=A0 =C2=A0if ((err =3D FT_Set_Pixel_Sizes(dtext-&gt;face, 0, dtext-&gt=
;fontsize))) {<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0av_log(ctx, AV_LOG_ERROR, &quot;Could not set =
font size to %d pixels: %s\n&quot;,<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 dtext-&gt;fontsize, FT_E=
RRMSG(err));<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0return AVERROR(EINVAL);<br>
+ =C2=A0 =C2=A0}<br>
+<br>
+ =C2=A0 =C2=A0dtext-&gt;use_kerning =3D FT_HAS_KERNING(dtext-&gt;face);<br=
>
+<br>
+ =C2=A0 =C2=A0/* load the fallback glyph with code 0 */<br>
+ =C2=A0 =C2=A0load_glyph(ctx, NULL, 0);<br>
+<br>
+#if !HAVE_LOCALTIME_R<br>
+ =C2=A0 =C2=A0av_log(ctx, AV_LOG_WARNING, &quot;strftime() expansion unava=
ilable!\n&quot;);<br>
+#else<br>
+ =C2=A0 =C2=A0if (strlen(dtext-&gt;text) &gt;=3D MAX_EXPANDED_TEXT_SIZE) {=
<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0av_log(ctx, AV_LOG_ERROR,<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 &quot;Impossible to prin=
t text, string is too big\n&quot;);<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0return AVERROR(EINVAL);<br>
+ =C2=A0 =C2=A0}<br>
+#endif<br>
+<br>
+ =C2=A0 =C2=A0return 0;<br>
+}<br>
+<br>
+static int query_formats(AVFilterContext *ctx)<br>
+{<br>
+ =C2=A0 =C2=A0static const enum PixelFormat pix_fmts[] =3D {<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0PIX_FMT_ARGB, =C2=A0 =C2=A0PIX_FMT_RGBA,<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0PIX_FMT_ABGR, =C2=A0 =C2=A0PIX_FMT_BGRA,<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0PIX_FMT_RGB24, =C2=A0 PIX_FMT_BGR24,<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0PIX_FMT_YUV420P, PIX_FMT_YUV444P,<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0PIX_FMT_YUV422P, PIX_FMT_YUV411P,<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0PIX_FMT_YUV410P, PIX_FMT_YUV440P,<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0PIX_FMT_NONE<br>
+ =C2=A0 =C2=A0};<br>
+<br>
+ =C2=A0 =C2=A0avfilter_set_common_formats(ctx, avfilter_make_format_list(p=
ix_fmts));<br>
+ =C2=A0 =C2=A0return 0;<br>
+}<br>
+<br>
+static int glyph_enu_free(void *opaque, void *elem)<br>
+{<br>
+ =C2=A0 =C2=A0av_free(elem);<br>
+ =C2=A0 =C2=A0return 0;<br>
+}<br>
+<br>
+static av_cold void uninit(AVFilterContext *ctx)<br>
+{<br>
+ =C2=A0 =C2=A0DrawTextContext *dtext =3D ctx-&gt;priv;<br>
+ =C2=A0 =C2=A0int i;<br>
+<br>
+ =C2=A0 =C2=A0av_freep(&amp;dtext-&gt;fontfile);<br>
+ =C2=A0 =C2=A0av_freep(&amp;dtext-&gt;text);<br>
+ =C2=A0 =C2=A0av_freep(&amp;dtext-&gt;fontcolor_string);<br>
+ =C2=A0 =C2=A0av_freep(&amp;dtext-&gt;boxcolor_string);<br>
+ =C2=A0 =C2=A0av_tree_enumerate(dtext-&gt;glyphs, NULL, NULL, glyph_enu_fr=
ee);<br>
+ =C2=A0 =C2=A0av_tree_destroy(dtext-&gt;glyphs);<br>
+ =C2=A0 =C2=A0dtext-&gt;glyphs =3D 0;<br>
+ =C2=A0 =C2=A0FT_Done_Face(dtext-&gt;face);<br>
+ =C2=A0 =C2=A0FT_Done_FreeType(dtext-&gt;library);<br>
+<br>
+ =C2=A0 =C2=A0for (i =3D 0; i &lt; 4; i++) {<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0av_freep(&amp;dtext-&gt;box_line[i]);<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0dtext-&gt;pixel_step[i] =3D 0;<br>
+ =C2=A0 =C2=A0}<br>
+<br>
+}<br>
+<br>
+static int config_input(AVFilterLink *inlink)<br>
+{<br>
+ =C2=A0 =C2=A0DrawTextContext *dtext =3D inlink-&gt;dst-&gt;priv;<br>
+ =C2=A0 =C2=A0const AVPixFmtDescriptor *pix_desc =3D &amp;av_pix_fmt_descr=
iptors[inlink-&gt;format];<br>
+ =C2=A0 =C2=A0int ret;<br>
+<br>
+ =C2=A0 =C2=A0dtext-&gt;hsub =3D pix_desc-&gt;log2_chroma_w;<br>
+ =C2=A0 =C2=A0dtext-&gt;vsub =3D pix_desc-&gt;log2_chroma_h;<br>
+<br>
+ =C2=A0 =C2=A0if ((ret =3D<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 ff_fill_line_with_color(dtext-&gt;box_line, d=
text-&gt;pixel_step,<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 inlink-&gt;w, dtext-&gt;boxcolor,<br=
>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 inlink-&gt;format, dtext-&gt;boxcolo=
r_rgba,<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 &amp;dtext-&gt;is_packed_rgb, dtext-=
&gt;rgba_map)) &lt; 0)<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0return ret;<br>
+<br>
+ =C2=A0 =C2=A0if (!dtext-&gt;is_packed_rgb) {<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0uint8_t *rgba =3D dtext-&gt;fontcolor_rgba;<br=
>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0dtext-&gt;fontcolor[0] =3D RGB_TO_Y_CCIR(rgba[=
0], rgba[1], rgba[2]);<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0dtext-&gt;fontcolor[1] =3D RGB_TO_U_CCIR(rgba[=
0], rgba[1], rgba[2], 0);<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0dtext-&gt;fontcolor[2] =3D RGB_TO_V_CCIR(rgba[=
0], rgba[1], rgba[2], 0);<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0dtext-&gt;fontcolor[3] =3D rgba[3];<br>
+ =C2=A0 =C2=A0}<br>
+<br>
+ =C2=A0 =C2=A0return 0;<br>
+}<br>
+<br>
+#define GET_BITMAP_VAL(r, c) =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0\<br>
+ =C2=A0 =C2=A0bitmap-&gt;pixel_mode =3D=3D FT_PIXEL_MODE_MONO ? =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0\<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0(bitmap-&gt;buffer[(r) * bitmap-&gt;pitch + ((=
c)&gt;&gt;3)] &amp; (0x80 &gt;&gt; ((c)&amp;7))) * 255 : \<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 bitmap-&gt;buffer[(r) * bitmap-&gt;pitch + =
=C2=A0(c)]<br>
+<br>
+#define SET_PIXEL_YUV(picref, yuva_color, val, x, y, hsub, vsub) { =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 \<br>
+ =C2=A0 =C2=A0luma_pos =C2=A0 =C2=A0=3D ((x) =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0) + ((y) =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0) * picref-&gt;linesize[0]=
; \<br>
+ =C2=A0 =C2=A0chroma_pos1 =3D ((x) &gt;&gt; (hsub)) + ((y) &gt;&gt; (vsub)=
) * picref-&gt;linesize[1]; \<br>
+ =C2=A0 =C2=A0chroma_pos2 =3D ((x) &gt;&gt; (hsub)) + ((y) &gt;&gt; (vsub)=
) * picref-&gt;linesize[2]; \<br>
+ =C2=A0 =C2=A0alpha =3D (yuva_color[3] * (val)) / 255; =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 \<br>
+ =C2=A0 =C2=A0picref-&gt;data[0][luma_pos] =3D (alpha * yuva_color[0] + (2=
55 - alpha) * picref-&gt;data[0][luma_pos]) &gt;&gt; 8; \<br>
+ =C2=A0 =C2=A0alpha =3D (yuva_color[3] * (val)) / 224; =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 \<br>
+ =C2=A0 =C2=A0picref-&gt;data[1][chroma_pos1] =3D 16 + (alpha * (yuva_colo=
r[1]-16) + (224 - alpha) * (picref-&gt;data[1][chroma_pos1]-16)) / 224; \<b=
r>
+ =C2=A0 =C2=A0picref-&gt;data[2][chroma_pos2] =3D 16 + (alpha * (yuva_colo=
r[2]-16) + (224 - alpha) * (picref-&gt;data[2][chroma_pos2]-16)) / 224; \<b=
r>
+}<br>
+<br>
+static inline int draw_glyph_yuv(AVFilterBufferRef *picref, FT_Bitmap *bit=
map, unsigned int x,<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 unsigned int y, unsigned int width, =
unsigned int height,<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 unsigned char yuva_color[4], int hsu=
b, int vsub)<br>
+{<br>
+ =C2=A0 =C2=A0int r, c, alpha;<br>
+ =C2=A0 =C2=A0unsigned int luma_pos, chroma_pos1, chroma_pos2;<br>
+ =C2=A0 =C2=A0uint8_t src_val, dst_pixel[4];<br>
+<br>
+ =C2=A0 =C2=A0for (r =3D 0; r &lt; bitmap-&gt;rows &amp;&amp; r+y &lt; hei=
ght; r++) {<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0for (c =3D 0; c &lt; bitmap-&gt;width &amp;&am=
p; c+x &lt; width; c++) {<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0/* get pixel in the picref (dest=
ination) */<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0dst_pixel[0] =3D picref-&gt;data=
[0][ =C2=A0c+x =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 + =C2=A0(y+r) =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0* picref-&gt;linesize[0]];<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0dst_pixel[1] =3D picref-&gt;data=
[1][((c+x) &gt;&gt; hsub) + ((y+r) &gt;&gt; vsub) * picref-&gt;linesize[1]]=
;<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0dst_pixel[2] =3D picref-&gt;data=
[2][((c+x) &gt;&gt; hsub) + ((y+r) &gt;&gt; vsub) * picref-&gt;linesize[2]]=
;<br>
+<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0/* get intensity value in the gl=
yph bitmap (source) */<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0src_val =3D GET_BITMAP_VAL(r, c)=
;<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0if (!src_val)<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0continue;<br>
+<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0SET_PIXEL_YUV(picref, yuva_color=
, src_val, c+x, y+r, hsub, vsub);<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0}<br>
+ =C2=A0 =C2=A0}<br>
+<br>
+ =C2=A0 =C2=A0return 0;<br>
+}<br>
+<br>
+#define SET_PIXEL_RGB(picref, rgba_color, val, x, y, pixel_step, r_off, g_=
off, b_off, a_off) { \<br>
+ =C2=A0 =C2=A0p =C2=A0 =3D picref-&gt;data[0] + (x) * pixel_step + ((y) * =
picref-&gt;linesize[0]); \<br>
+ =C2=A0 =C2=A0alpha =3D (rgba_color[3] * (val)) / 255; =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0\<br>
+ =C2=A0 =C2=A0*(p+r_off) =3D (alpha * rgba_color[0] + (255 - alpha) * *(p+=
r_off)) &gt;&gt; 8; \<br>
+ =C2=A0 =C2=A0*(p+g_off) =3D (alpha * rgba_color[1] + (255 - alpha) * *(p+=
g_off)) &gt;&gt; 8; \<br>
+ =C2=A0 =C2=A0*(p+b_off) =3D (alpha * rgba_color[2] + (255 - alpha) * *(p+=
b_off)) &gt;&gt; 8; \<br>
+}<br>
+<br>
+static inline int draw_glyph_rgb(AVFilterBufferRef *picref, FT_Bitmap *bit=
map,<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 unsigned int x, unsigned int y,<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 unsigned int width, unsigned int hei=
ght, int pixel_step,<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 unsigned char rgba_color[4], uint8_t=
 rgba_map[4])<br>
+{<br>
+ =C2=A0 =C2=A0int r, c, alpha;<br>
+ =C2=A0 =C2=A0uint8_t *p;<br>
+ =C2=A0 =C2=A0uint8_t src_val, dst_pixel[4];<br>
+<br>
+ =C2=A0 =C2=A0for (r =3D 0; r &lt; bitmap-&gt;rows &amp;&amp; r+y &lt; hei=
ght; r++) {<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0for (c =3D 0; c &lt; bitmap-&gt;width &amp;&am=
p; c+x &lt; width; c++) {<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0/* get pixel in the picref (dest=
ination) */<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0dst_pixel[0] =3D picref-&gt;data=
[0][(c+x + rgba_map[0]) * pixel_step +<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 (=
y+r) * picref-&gt;linesize[0]];<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0dst_pixel[1] =3D picref-&gt;data=
[0][(c+x + rgba_map[1]) * pixel_step +<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 (=
y+r) * picref-&gt;linesize[0]];<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0dst_pixel[2] =3D picref-&gt;data=
[0][(c+x + rgba_map[2]) * pixel_step +<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 (=
y+r) * picref-&gt;linesize[0]];<br>
+<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0/* get intensity value in the gl=
yph bitmap (source) */<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0src_val =3D GET_BITMAP_VAL(r, c)=
;<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0if (!src_val)<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0continue;<br>
+<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0SET_PIXEL_RGB(picref, rgba_color=
, src_val, c+x, y+r, pixel_step,<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0rgba_map[0], rgba_map[1], rgba_map[2], rgba_map[3]);<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0}<br>
+ =C2=A0 =C2=A0}<br>
+<br>
+ =C2=A0 =C2=A0return 0;<br>
+}<br>
+<br>
+static inline void drawbox(AVFilterBufferRef *picref, unsigned int x, unsi=
gned int y,<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 unsigned int width, unsigned int height,<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 uint8_t *line[4], int pixel_step[4], uint8_t color[4],<br=
>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 int hsub, int vsub, int is_rgba_packed, uint8_t rgba_map[=
4])<br>
+{<br>
+ =C2=A0 =C2=A0int i, j, alpha;<br>
+<br>
+ =C2=A0 =C2=A0if (color[3] !=3D 0xFF) {<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0if (is_rgba_packed) {<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0uint8_t *p;<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0for (j =3D 0; j &lt; height; j++=
)<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0for (i =3D 0; i &l=
t; width; i++)<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0SET_=
PIXEL_RGB(picref, color, 255, i+x, y+j, pixel_step[0],<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0rgba_map[0], rgba_map[1], rgba=
_map[2], rgba_map[3]);<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0} else {<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0unsigned int luma_pos, chroma_po=
s1, chroma_pos2;<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0for (j =3D 0; j &lt; height; j++=
)<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0for (i =3D 0; i &l=
t; width; i++)<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0SET_=
PIXEL_YUV(picref, color, 255, i+x, y+j, hsub, vsub);<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0}<br>
+ =C2=A0 =C2=A0} else {<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0ff_draw_rectangle(picref-&gt;data, picref-&gt;=
linesize,<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0line, pixel_step, hsub, vsub,<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0x, y, width, height);<br>
+ =C2=A0 =C2=A0}<br>
+}<br>
+<br>
+static int draw_text(AVFilterContext *ctx, AVFilterBufferRef *picref,<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 int=
 width, int height)<br>
+{<br>
+ =C2=A0 =C2=A0DrawTextContext *dtext =3D ctx-&gt;priv;<br>
+ =C2=A0 =C2=A0char *text =3D dtext-&gt;text;<br>
+ =C2=A0 =C2=A0uint32_t code =3D 0, prev_code =3D 0;<br>
+ =C2=A0 =C2=A0int x =3D 0, y =3D 0, i =3D 0;<br>
+ =C2=A0 =C2=A0int text_height, baseline;<br>
+ =C2=A0 =C2=A0uint8_t *p;<br>
+ =C2=A0 =C2=A0int str_w, str_w_max;<br>
+ =C2=A0 =C2=A0int y_min =3D 32000, y_max =3D -32000;<br>
+ =C2=A0 =C2=A0FT_Vector delta;<br>
+ =C2=A0 =C2=A0Glyph *glyph =3D NULL, *prev_glyph =3D NULL;<br>
+ =C2=A0 =C2=A0Glyph dummy =3D { 0 };<br>
+<br>
+#if HAVE_LOCALTIME_R<br>
+ =C2=A0 =C2=A0time_t now =3D time(0);<br>
+ =C2=A0 =C2=A0struct tm ltime;<br>
+ =C2=A0 =C2=A0size_t expanded_text_len;<br>
+<br>
+ =C2=A0 =C2=A0dtext-&gt;expanded_text[0] =3D &#39;\1&#39;;<br>
+ =C2=A0 =C2=A0expanded_text_len =3D strftime(dtext-&gt;expanded_text, MAX_=
EXPANDED_TEXT_SIZE,<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 text, localtime_r(&amp;now, &amp;lti=
me));<br>
+ =C2=A0 =C2=A0text =3D dtext-&gt;expanded_text;<br>
+ =C2=A0 =C2=A0if (expanded_text_len =3D=3D 0 &amp;&amp; dtext-&gt;expanded=
_text[0] !=3D &#39;\0&#39;) {<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0av_log(ctx, AV_LOG_ERROR,<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 &quot;Impossible to prin=
t text, string is too big\n&quot;);<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0return AVERROR(EINVAL);<br>
+ =C2=A0 =C2=A0}<br>
+#endif<br>
+<br>
+ =C2=A0 =C2=A0str_w =3D str_w_max =3D 0;<br>
+ =C2=A0 =C2=A0x =3D dtext-&gt;x;<br>
+ =C2=A0 =C2=A0y =3D dtext-&gt;y;<br>
+<br>
+ =C2=A0 =C2=A0/* load and cache glyphs */<br>
+ =C2=A0 =C2=A0for (i =3D 0, p =3D text; *p; i++) {<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0GET_UTF8(code, *p++, continue;);<br>
+<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0/* get glyph */<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0dummy.code =3D code;<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0glyph =3D av_tree_find(dtext-&gt;glyphs, &amp;=
dummy, (void *)glyph_cmp, NULL);<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0if (!glyph)<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0load_glyph(ctx, &amp;glyph, code=
);<br>
+<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0y_min =3D FFMIN(glyph-&gt;bbox.yMin, y_min);<b=
r>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0y_max =3D FFMAX(glyph-&gt;bbox.yMax, y_max);<b=
r>
+ =C2=A0 =C2=A0}<br>
+ =C2=A0 =C2=A0text_height =3D y_max - y_min;<br>
+ =C2=A0 =C2=A0baseline =C2=A0 =C2=A0=3D y_max;<br>
+<br>
+ =C2=A0 =C2=A0/* compute and save position for each glyph */<br>
+ =C2=A0 =C2=A0glyph =3D NULL;<br>
+ =C2=A0 =C2=A0for (i =3D 0, p =3D text; *p; i++) {<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0GET_UTF8(code, *p++, continue;);<br>
+<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0/* skip the \n in the sequence \r\n */<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0if (prev_code =3D=3D &#39;\r&#39; &amp;&amp; c=
ode =3D=3D &#39;\n&#39;)<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0continue;<br>
+<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0/* get glyph */<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0prev_glyph =3D glyph;<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0dummy.code =3D code;<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0glyph =3D av_tree_find(dtext-&gt;glyphs, &amp;=
dummy, (void *)glyph_cmp, NULL);<br>
+<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0/* kerning */<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0if (dtext-&gt;use_kerning &amp;&amp; prev_glyp=
h &amp;&amp; glyph-&gt;code) {<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0FT_Get_Kerning(dtext-&gt;face, p=
rev_glyph-&gt;code, glyph-&gt;code,<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 ft_kerning_default, &amp;delta);<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0x +=3D delta.x &gt;&gt; 6;<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0}<br>
+<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0if (x + glyph-&gt;advance &gt;=3D width || cod=
e =3D=3D &#39;\r&#39; || code =3D=3D &#39;\n&#39;) {<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0if (x + glyph-&gt;advance &gt;=
=3D width)<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0str_w_max =3D widt=
h - dtext-&gt;x - 1;<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0y +=3D text_height;<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0x =3D dtext-&gt;x;<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0}<br>
+<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0/* save position */<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0dtext-&gt;positions[i].x =3D x + glyph-&gt;bit=
map_left;<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0dtext-&gt;positions[i].y =3D y - glyph-&gt;bit=
map_top + baseline;<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0if (code !=3D &#39;\n&#39; &amp;&amp; code !=
=3D &#39;\r&#39;) {<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0int advance =3D glyph-&gt;advanc=
e;<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0if (code =3D=3D &#39;\t&#39;)<br=
>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0advance *=3D dtext=
-&gt;tabsize;<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0x =C2=A0 =C2=A0 +=3D advance;<br=
>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0str_w +=3D advance;<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0}<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0prev_code =3D code;<br>
+ =C2=A0 =C2=A0}<br>
+<br>
+ =C2=A0 =C2=A0y +=3D text_height;<br>
+ =C2=A0 =C2=A0if (str_w_max =3D=3D 0)<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0str_w_max =3D str_w;<br>
+<br>
+ =C2=A0 =C2=A0/* draw box */<br>
+ =C2=A0 =C2=A0if (dtext-&gt;draw_box) {<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0/* check if it doesn&#39;t pass the limits */<=
br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0str_w_max =3D FFMIN(str_w_max, width - dtext-&=
gt;x - 1);<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0y =3D FFMIN(y, height - 1);<br>
+<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0/* draw background */<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0drawbox(picref, dtext-&gt;x, dtext-&gt;y, str_=
w_max, y-dtext-&gt;y,<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0dtext-&gt;box_line=
, dtext-&gt;pixel_step, dtext-&gt;boxcolor,<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0dtext-&gt;hsub, dt=
ext-&gt;vsub, dtext-&gt;is_packed_rgb, dtext-&gt;rgba_map);<br>
+ =C2=A0 =C2=A0}<br>
+<br>
+ =C2=A0 =C2=A0/* draw glyphs */<br>
+ =C2=A0 =C2=A0for (i =3D 0, p =3D text; *p; i++) {<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0Glyph dummy =3D { 0 };<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0GET_UTF8(code, *p++, continue;);<br>
+<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0/* skip new line chars, just go to new line */=
<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0if (code =3D=3D &#39;\n&#39; || code =3D=3D &#=
39;\r&#39; || code =3D=3D &#39;\t&#39;)<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0continue;<br>
+<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0dummy.code =3D code;<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0glyph =3D av_tree_find(dtext-&gt;glyphs, &amp;=
dummy, (void *)glyph_cmp, NULL);<br>
+<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0if (glyph-&gt;bitmap.pixel_mode !=3D FT_PIXEL_=
MODE_MONO &amp;&amp;<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0glyph-&gt;bitmap.pixel_mode !=3D=
 FT_PIXEL_MODE_GRAY)<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0return AVERROR(EINVAL);<br>
+<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0if (dtext-&gt;is_packed_rgb) {<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0draw_glyph_rgb(picref, &amp;glyp=
h-&gt;bitmap,<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 dtext-&gt;positions[i].x, dtext-&gt;positions[i].y, width=
, height,<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 dtext-&gt;pixel_step[0], dtext-&gt;fontcolor_rgba, dtext-=
&gt;rgba_map);<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0} else {<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0draw_glyph_yuv(picref, &amp;glyp=
h-&gt;bitmap,<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 dtext-&gt;positions[i].x, dtext-&gt;positions[i].y, width=
, height,<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 dtext-&gt;fontcolor, dtext-&gt;hsub, dtext-&gt;vsub);<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0}<br>
+ =C2=A0 =C2=A0}<br>
+<br>
+ =C2=A0 =C2=A0return 0;<br>
+}<br>
+<br>
+static void null_draw_slice(AVFilterLink *link, int y, int h, int slice_di=
r) { }<br>
+<br>
+static void end_frame(AVFilterLink *inlink)<br>
+{<br>
+ =C2=A0 =C2=A0AVFilterLink *outlink =3D inlink-&gt;dst-&gt;outputs[0];<br>
+ =C2=A0 =C2=A0AVFilterBufferRef *picref =3D inlink-&gt;cur_buf;<br>
+<br>
+ =C2=A0 =C2=A0draw_text(inlink-&gt;dst, picref, picref-&gt;video-&gt;w, pi=
cref-&gt;video-&gt;h);<br>
+<br>
+ =C2=A0 =C2=A0avfilter_draw_slice(outlink, 0, picref-&gt;video-&gt;h, 1);<=
br>
+ =C2=A0 =C2=A0avfilter_end_frame(outlink);<br>
+}<br>
+<br>
+AVFilter avfilter_vf_drawtext =3D {<br>
+ =C2=A0 =C2=A0.name =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0=3D &quot;drawtext&q=
uot;,<br>
+ =C2=A0 =C2=A0.description =C2=A0 =3D NULL_IF_CONFIG_SMALL(&quot;Draw text=
 on top of video frames using libfreetype library.&quot;),<br>
+ =C2=A0 =C2=A0.priv_size =C2=A0 =C2=A0 =3D sizeof(DrawTextContext),<br>
+ =C2=A0 =C2=A0.init =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0=3D init,<br>
+ =C2=A0 =C2=A0.uninit =C2=A0 =C2=A0 =C2=A0 =C2=A0=3D uninit,<br>
+ =C2=A0 =C2=A0.query_formats =3D query_formats,<br>
+<br>
+ =C2=A0 =C2=A0.inputs =C2=A0 =C2=A0=3D (AVFilterPad[]) {{ .name =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =3D &quot;default&quot;,<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0.type =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =3D AVMEDIA_TYPE_VIDEO,<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0.get_video_buffer =3D a=
vfilter_null_get_video_buffer,<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0.start_frame =C2=A0 =C2=
=A0 =C2=A0=3D avfilter_null_start_frame,<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0.draw_slice =C2=A0 =C2=
=A0 =C2=A0 =3D null_draw_slice,<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0.end_frame =C2=A0 =C2=
=A0 =C2=A0 =C2=A0=3D end_frame,<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0.config_props =C2=A0 =
=C2=A0 =3D config_input,<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0.min_perms =C2=A0 =C2=
=A0 =C2=A0 =C2=A0=3D AV_PERM_WRITE |<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0AV_PERM_READ,<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0.rej_perms =C2=A0 =C2=
=A0 =C2=A0 =C2=A0=3D AV_PERM_PRESERVE },<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0{ .name =3D NULL}},<br>
+ =C2=A0 =C2=A0.outputs =C2=A0 =3D (AVFilterPad[]) {{ .name =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =3D &quot;default&quot;,<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0.type =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =3D AVMEDIA_TYPE_VIDEO, },<br>
+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0{ .name =3D NULL}},<br>
+};<br>
<font color=3D"#888888">--<br>
1.7.4.1<br>
<br>
_______________________________________________<br>
libav-devel mailing list<br>
<a href=3D"mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org">libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org</a><br>
<a href=3D"https://lists.libav.org/mailman/listinfo/libav-devel" target=3D"=
_blank">https://lists.libav.org/mailman/listinfo/libav-devel</a><br>
</font></blockquote></p>

--0016e6d77d257235c2049f21fc0c--

--===============1672352679==
Content-Type: text/plain; charset="us-ascii"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
Content-Disposition: inline

_______________________________________________
libav-devel mailing list
libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
https://lists.libav.org/mailman/listinfo/libav-devel

--===============1672352679==--



From news@gmane.org Tue Mar 04 03:33:20 2003
From: =?UTF-8?q?Martin=20Storsj=C3=B6?= <martin-TqfNSX0MhmxeoWH0uzbU5w@public.gmane.org>
Subject: [PATCH] rtsp: Don't use a locale dependent format
	string
Date: Wed, 23 Mar 2011 10:26:22 +0200
Lines: 22
Message-ID: <1300868782-57340-1-git-send-email-martin@martin.st>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 09:26:26 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2JOc-0004Fa-14
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 09:26:26 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id A2F0A3B12C;
	Wed, 23 Mar 2011 09:26:25 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 18AF23B12C
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 09:26:24 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id MVFdZy3TJoy9 for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 09:26:24 +0100 (CET)
Received: from mail-bw0-f54.google.com (mail-bw0-f54.google.com
	[209.85.214.54])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id F08473B12B
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 09:26:23 +0100 (CET)
Received: by bwz12 with SMTP id 12so10409047bwz.27
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 01:26:23 -0700 (PDT)
Received: by 10.204.81.224 with SMTP id y32mr5892285bkk.152.1300868783534;
	Wed, 23 Mar 2011 01:26:23 -0700 (PDT)
Received: from localhost (bambuser.masterplanet.fi [194.100.86.5])
	by mx.google.com with ESMTPS id z18sm5724521bkf.20.2011.03.23.01.26.22
	(version=TLSv1/SSLv3 cipher=OTHER);
	Wed, 23 Mar 2011 01:26:22 -0700 (PDT)
X-Mailer: git-send-email 1.7.3.1
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/43>

In this particular case, we aren't ever printing anything else than
0.000 anyway.
---
 libavformat/rtspenc.c |    3 +--
 1 files changed, 1 insertions(+), 2 deletions(-)

diff --git a/libavformat/rtspenc.c b/libavformat/rtspenc.c
index c163f4c..1f1fd32 100644
--- a/libavformat/rtspenc.c
+++ b/libavformat/rtspenc.c
@@ -103,8 +103,7 @@ static int rtsp_write_record(AVFormatContext *s)
     char cmd[1024];
 
     snprintf(cmd, sizeof(cmd),
-             "Range: npt=%0.3f-\r\n",
-             (double) 0);
+             "Range: npt=0.000-\r\n");
     ff_rtsp_send_cmd(s, "RECORD", rt->control_uri, cmd, reply, NULL);
     if (reply->status_code != RTSP_STATUS_OK)
         return -1;
-- 
1.7.3.1


From news@gmane.org Tue Mar 04 03:33:20 2003
From: =?ISO-8859-15?Q?Martin_Storsj=F6?= <martin-TqfNSX0MhmxeoWH0uzbU5w@public.gmane.org>
Subject: Re: configure: remove early check_deps $ARCH_EXT_LIST
Date: Wed, 23 Mar 2011 11:15:30 +0200 (EET)
Lines: 93
Message-ID: <alpine.DEB.2.00.1103231112190.3794@cone.home.martin.st>
References: <20110211184533.1428D3B32D@natsuki.mplayerhq.hu>
	<alpine.DEB.2.00.1102171121220.17057@cone.home.martin.st>
	<yw1xr5b6alm1.fsf@unicorn.mansr.com>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: MULTIPART/MIXED;
	BOUNDARY="-1463810048-1169679819-1300871730=:3794"
To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 10:15:33 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2KA9-00033O-CX
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 10:15:33 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 2665A3C08F;
	Wed, 23 Mar 2011 10:15:33 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id E9B8C3C08F
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 10:15:30 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id BnUhHGa+rSSa for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 10:15:30 +0100 (CET)
Received: from jenni2.inet.fi (mta-out.inet.fi [195.156.147.13])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id BD1793C08E
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 10:15:30 +0100 (CET)
Received: from dsl-tkubrasgw1-fe1efa00-177.dhcp.inet.fi (84.250.30.177) by
	jenni2.inet.fi (8.5.133)
	id 4D061FFC04880E4E for libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org;
	Wed, 23 Mar 2011 11:15:30 +0200
X-X-Sender: martin-bySdwzmfsd4wFlGVRAW2/FdQdH8mP9S6@public.gmane.org
In-Reply-To: <yw1xr5b6alm1.fsf-OEaqT8BN2ezZK2NkWkPsZwC/G2K4zDHf@public.gmane.org>
User-Agent: Alpine 2.00 (DEB 1167 2008-08-23)
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/44>

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.

---1463810048-1169679819-1300871730=:3794
Content-Type: TEXT/PLAIN; charset=iso-8859-1
Content-Transfer-Encoding: quoted-printable

On Thu, 17 Feb 2011, M=E5ns Rullg=E5rd wrote:

> Martin Storsj=F6 <martin-TqfNSX0MhmxeoWH0uzbU5w@public.gmane.org> writes:
>=20
> > On Fri, 11 Feb 2011, Mans Rullgard  wrote:
> >
> >> Module: ffmpeg
> >> Branch: master
> >> Commit: 4b884207eb7319577f8ceb94a56f42c5ac0ab294
> >>=20
> >> Author: Mans Rullgard <mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org>
> >> Date:   Fri Feb 11 18:28:12 2011 +0000
> >>=20
> >> configure: remove early check_deps $ARCH_EXT_LIST
> >>=20
> >> The early disabling of irrelevant arch extensions is no longer
> >> required, and removing it makes dependencies involving these
> >> work as expected.
> >>=20
> >> Signed-off-by: Mans Rullgard <mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org>
> >>=20
> >> ---
> >>=20
> >>  configure |    2 --
> >>  1 files changed, 0 insertions(+), 2 deletions(-)
> >>=20
> >> diff --git a/configure b/configure
> >> index a3ca15d..a310d25 100755
> >> --- a/configure
> >> +++ b/configure
> >> @@ -2494,8 +2494,6 @@ die_license_disabled version3 libopencore_amrw=
b
> >> =20
> >>  enabled version3 && { enabled gpl && enable gplv3 || enable lgplv3;=
 }
> >> =20
> >> -check_deps $ARCH_EXT_LIST
> >> -
> >>  disabled optimizations || check_cflags -fomit-frame-pointer
> >> =20
> >>  enable_pic() {
> >
> > This change broke compilation for Windows CE, where configure now err=
ors=20
> > out with this error:
> >
> > Error, no aligned memory allocator but SSE enabled, disable it or use=
=20
> > --enable-memalign-hack.
> >
> > This is checked at this point:
> >
> > if ! enabled_any memalign memalign_hack posix_memalign malloc_aligned=
 &&
> >      enabled_any $need_memalign ; then
> >     die "Error, no aligned memory allocator but SSE enabled, disable =
it or use --enable-memalign-hack."
> > fi
> >
> > Here, enabled_any $need_memalign (which is "altivec neon sse") trigge=
rs,=20
> > believing altivec and sse to be enabled (while neon correctly seems t=
o be=20
> > disabled).
>=20
> Now I remember why that check_deps was there...
>=20
> Can you live with it while I come up with a proper solution?

Moving the thread over to this ML (I just ran into this issue in another=20
build configuration, too).

// Martin
---1463810048-1169679819-1300871730=:3794
Content-Type: text/plain; charset="us-ascii"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
Content-Disposition: inline

_______________________________________________
libav-devel mailing list
libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
https://lists.libav.org/mailman/listinfo/libav-devel

---1463810048-1169679819-1300871730=:3794--



From news@gmane.org Tue Mar 04 03:33:20 2003
From: Luca Barbato <lu_zero-aBrp7R+bbdUdnm+yROfE0A@public.gmane.org>
Subject: Re: [PATCH] rtsp: Don't use a locale dependent format
 string
Date: Wed, 23 Mar 2011 10:36:29 +0100
Lines: 8
Message-ID: <4D89BF1D.70905@gentoo.org>
References: <1300868782-57340-1-git-send-email-martin@martin.st>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 10:36:41 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2KUa-00054B-Tg
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 10:36:40 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 4692F3B194;
	Wed, 23 Mar 2011 10:36:40 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id C7ECD3B194
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 10:36:38 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id YZH7JEaFIRJt for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 10:36:38 +0100 (CET)
Received: from smtp.gentoo.org (smtp.gentoo.org [140.211.166.183])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 88A543B191
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 10:36:38 +0100 (CET)
Received: from [192.168.1.116] (dynamic-adsl-84-223-248-146.clienti.tiscali.it
	[84.223.248.146])
	(using TLSv1 with cipher DHE-RSA-CAMELLIA256-SHA (256/256 bits))
	(No client certificate requested) (Authenticated sender: lu_zero)
	by smtp.gentoo.org (Postfix) with ESMTPSA id D370B1B4059
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 09:36:34 +0000 (UTC)
User-Agent: Mozilla/5.0 (X11; Linux x86_64;
	rv:2.0b10pre) Gecko/20110314 Thunderbird/3.3a2
In-Reply-To: <1300868782-57340-1-git-send-email-martin-TqfNSX0MhmxeoWH0uzbU5w@public.gmane.org>
X-Enigmail-Version: 1.2a1pre
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/45>

T24gMDMvMjMvMjAxMSAwOToyNiBBTSwgTWFydGluIFN0b3JzasO2IHdyb3RlOgo+IEluIHRoaXMg
cGFydGljdWxhciBjYXNlLCB3ZSBhcmVuJ3QgZXZlciBwcmludGluZyBhbnl0aGluZyBlbHNlIHRo
YW4KPiAwLjAwMCBhbnl3YXkuCgpQYXRjaCBvayA9KQoKLS0gCgpMdWNhIEJhcmJhdG8KR2VudG9v
L2xpbnV4Cmh0dHA6Ly9kZXYuZ2VudG9vLm9yZy9+bHVfemVybwoKX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX18KbGliYXYtZGV2ZWwgbWFpbGluZyBsaXN0Cmxp
YmF2LWRldmVsQGxpYmF2Lm9yZwpodHRwczovL2xpc3RzLmxpYmF2Lm9yZy9tYWlsbWFuL2xpc3Rp
bmZvL2xpYmF2LWRldmVsCg==



From news@gmane.org Tue Mar 04 03:33:20 2003
From: Mans Rullgard <mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org>
Subject: [PATCH] configure: get libavcodec version from new
	version.h header
Date: Wed, 23 Mar 2011 09:39:04 +0000
Lines: 22
Message-ID: <1300873144-14467-1-git-send-email-mans@mansr.com>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 10:39:11 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2KX0-0006QW-1M
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 10:39:10 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id BF4783B198;
	Wed, 23 Mar 2011 10:39:09 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id DABF83B199
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 10:39:07 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id 9QKylovMWCtK for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 10:39:07 +0100 (CET)
Received: from unicorn.mansr.com (unicorn.mansr.com [78.86.181.103])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id ACBB03B198
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 10:39:07 +0100 (CET)
Received: by unicorn.mansr.com (Postfix, from userid 51770)
	id 6549517B41; Wed, 23 Mar 2011 09:39:07 +0000 (GMT)
X-Mailer: git-send-email 1.7.4.1
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/46>

This fixes shared library versioning after 3dd851c.

Signed-off-by: Mans Rullgard <mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org>
---
 configure |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/configure b/configure
index e312489..43dcaac 100755
--- a/configure
+++ b/configure
@@ -3287,7 +3287,7 @@ get_version(){
 
 get_version LIBSWSCALE  libswscale/swscale.h
 get_version LIBPOSTPROC libpostproc/postprocess.h
-get_version LIBAVCODEC  libavcodec/avcodec.h
+get_version LIBAVCODEC  libavcodec/version.h
 get_version LIBAVDEVICE libavdevice/avdevice.h
 get_version LIBAVFORMAT libavformat/version.h
 get_version LIBAVUTIL   libavutil/avutil.h
-- 
1.7.4.1


From news@gmane.org Tue Mar 04 03:33:20 2003
From: Kostya <kostya.shishkov-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>
Subject: Re: [PATCH] configure: get libavcodec version from
 new version.h header
Date: Wed, 23 Mar 2011 10:44:23 +0100
Lines: 24
Message-ID: <20110323094423.GA22744@kst-acer>
References: <1300873144-14467-1-git-send-email-mans@mansr.com>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 10:43:08 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2Kap-0000E4-PU
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 10:43:07 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 8421A3B19A;
	Wed, 23 Mar 2011 10:43:07 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 6F06B3B19A
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 10:43:06 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id H0WZH-VyqRuj for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 10:43:06 +0100 (CET)
Received: from mail-bw0-f54.google.com (mail-bw0-f54.google.com
	[209.85.214.54])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 50A443B199
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 10:43:06 +0100 (CET)
Received: by bwz12 with SMTP id 12so10473372bwz.27
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 02:43:05 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=gamma;
	h=domainkey-signature:date:from:to:subject:message-id:references
	:mime-version:content-type:content-disposition:in-reply-to
	:user-agent; bh=n0iKevEiuwMKQTsXqjOhXL193E/8s4NVccYEQ2nZGMI=;
	b=k90cx/3UJVlArYRWYByxe59H+/k7z+Y5LKDPypLxsMPUIdeiEYiflD+jFWNTvFqFXj
	Bu49EDts1NuTnwYARLiBcL44n65l9UIT+7FMtbuASZp+PTnJ/EsDPKeUNC5MSOYSqm6Z
	IDGP+TDwynZKeuwuS72n1f7OV7ZtSWLGmMYGA=
DomainKey-Signature: a=rsa-sha1; c=nofws; d=gmail.com; s=gamma;
	h=date:from:to:subject:message-id:references:mime-version
	:content-type:content-disposition:in-reply-to:user-agent;
	b=leiQNEug4BWd/M83kkjIo823Pj/jgjMx3rfHayv0OXcp0k1tZW2ZK5j2fBLeu7O+8h
	AXumhVhOi+Uv2srsG1mUVbWmOngaHoa4CV176ES74fxH9+XFo5vcVoWmCwTFSuL5gUr1
	527GcNzgkMvNMZ+y5DEtX3enuhLILB3OHBo6s=
Received: by 10.204.23.81 with SMTP id q17mr6000252bkb.2.1300873385848;
	Wed, 23 Mar 2011 02:43:05 -0700 (PDT)
Received: from localhost
	(HSI-KBW-078-043-255-085.hsi4.kabel-badenwuerttemberg.de
	[78.43.255.85])
	by mx.google.com with ESMTPS id x6sm5775107bkv.0.2011.03.23.02.43.04
	(version=TLSv1/SSLv3 cipher=OTHER);
	Wed, 23 Mar 2011 02:43:04 -0700 (PDT)
Content-Disposition: inline
In-Reply-To: <1300873144-14467-1-git-send-email-mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org>
User-Agent: Mutt/1.5.20 (2009-06-14)
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/47>

On Wed, Mar 23, 2011 at 09:39:04AM +0000, Mans Rullgard wrote:
> This fixes shared library versioning after 3dd851c.
> 
> Signed-off-by: Mans Rullgard <mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org>
> ---
>  configure |    2 +-
>  1 files changed, 1 insertions(+), 1 deletions(-)
> 
> diff --git a/configure b/configure
> index e312489..43dcaac 100755
> --- a/configure
> +++ b/configure
> @@ -3287,7 +3287,7 @@ get_version(){
>  
>  get_version LIBSWSCALE  libswscale/swscale.h
>  get_version LIBPOSTPROC libpostproc/postprocess.h
> -get_version LIBAVCODEC  libavcodec/avcodec.h
> +get_version LIBAVCODEC  libavcodec/version.h
>  get_version LIBAVDEVICE libavdevice/avdevice.h
>  get_version LIBAVFORMAT libavformat/version.h
>  get_version LIBAVUTIL   libavutil/avutil.h
> -- 

looks ok, maybe should be done for other libraries as well


From news@gmane.org Tue Mar 04 03:33:20 2003
From: =?iso-8859-1?Q?M=E5ns_Rullg=E5rd?= <mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org>
Subject: Re: [PATCH] Use macro __INTEL_COMPILER instead
	of	__ICC.
Date: Wed, 23 Mar 2011 09:45:05 +0000
Lines: 18
Message-ID: <yw1x1v1ytbku.fsf@unicorn.mansr.com>
References: <1300845942-4218-1-git-send-email-rsbultje@gmail.com>
	<20110323073555.GA30842@pool.informatik.RWTH-Aachen.DE>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 10:45:07 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2Kcl-0001Oj-BY
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 10:45:07 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 22E8E3B13C;
	Wed, 23 Mar 2011 10:45:07 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id B77243B13C
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 10:45:05 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id uMbzO0ood7ph for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 10:45:05 +0100 (CET)
Received: from unicorn.mansr.com (unicorn.mansr.com [78.86.181.103])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 98D3A3B13B
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 10:45:05 +0100 (CET)
Received: by unicorn.mansr.com (Postfix, from userid 51770)
	id 716B817B41; Wed, 23 Mar 2011 09:45:05 +0000 (GMT)
In-Reply-To: <20110323073555.GA30842-C+EoYKesnrCVdxy9aTz+TbLZb8cQPPy3S7qENs8ugTg@public.gmane.org> (Diego
	Biurrun's message of "Wed, 23 Mar 2011 08:35:55 +0100")
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/23.2 (gnu/linux)
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/48>

Diego Biurrun <diego-NvuzD6AdJSiELgA04lAiVw@public.gmane.org> writes:

> On Tue, Mar 22, 2011 at 10:05:42PM -0400, Ronald S. Bultje wrote:
>> From: Carl Eugen Hoyos <cehoyos-iVVjmtzCFAg@public.gmane.org>
>> =

>> __ICC is not supported on all platforms, this is an Intel documentation
>> bug that is supposed to be fixed in a future release.
>> (Intel issue 612289)
>
> OK

No, it's not  OK.

-- =

M=E5ns Rullg=E5rd
mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org


From news@gmane.org Tue Mar 04 03:33:20 2003
From: Reinhard Tartler <siretart-t24Mxcv9r2eELgA04lAiVw@public.gmane.org>
Subject: Re: [PATCH] configure: get libavcodec version from
	new version.h header
Date: Wed, 23 Mar 2011 10:45:50 +0100
Lines: 36
Message-ID: <87mxkm186p.fsf@faui44a.informatik.uni-erlangen.de>
References: <1300873144-14467-1-git-send-email-mans@mansr.com>
	<20110323094423.GA22744@kst-acer>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 10:45:54 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2KdV-0001oR-N5
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 10:45:53 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 820E13B16F;
	Wed, 23 Mar 2011 10:45:53 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 704613B16F
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 10:45:52 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id y-CQKwzkz3yB for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 10:45:52 +0100 (CET)
Received: from vamos2c.informatik.uni-erlangen.de
	(vamos2c.informatik.uni-erlangen.de [131.188.42.15])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 5A44A3B13B
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 10:45:52 +0100 (CET)
Received: from [2001:638:a00:22:216:d3ff:feb8:79cc] (helo=faui44a)
	by vamos2c.informatik.uni-erlangen.de with esmtpsa
	(TLS1.0:RSA_AES_256_CBC_SHA1:32) (Exim 4.72)
	(envelope-from <siretart-t24Mxcv9r2eELgA04lAiVw@public.gmane.org>) id 1Q2KdQ-0000B3-BA
	for libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org; Wed, 23 Mar 2011 10:45:50 +0100
Received: from siretart by faui44a with local (Exim 4.71)
	(envelope-from <siretart-Jp65AdzTraCM0MU9lROt9PpTrGXM5HoexJJUWDj/nkeELgA04lAiVw@public.gmane.org>)
	id 1Q2KdS-0002fQ-9U
	for libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org; Wed, 23 Mar 2011 10:45:50 +0100
X-Url: http://tauware.de
In-Reply-To: <20110323094423.GA22744@kst-acer> (Kostya's message of "Wed, 23
	Mar 2011 10:44:23 +0100")
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/23.1 (gnu/linux)
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/49>

On Wed, Mar 23, 2011 at 10:44:23 (CET), Kostya wrote:

> On Wed, Mar 23, 2011 at 09:39:04AM +0000, Mans Rullgard wrote:
>> This fixes shared library versioning after 3dd851c.
>> 
>> Signed-off-by: Mans Rullgard <mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org>
>> ---
>>  configure |    2 +-
>>  1 files changed, 1 insertions(+), 1 deletions(-)
>> 
>> diff --git a/configure b/configure
>> index e312489..43dcaac 100755
>> --- a/configure
>> +++ b/configure
>> @@ -3287,7 +3287,7 @@ get_version(){
>>  
>>  get_version LIBSWSCALE  libswscale/swscale.h
>>  get_version LIBPOSTPROC libpostproc/postprocess.h
>> -get_version LIBAVCODEC  libavcodec/avcodec.h
>> +get_version LIBAVCODEC  libavcodec/version.h
>>  get_version LIBAVDEVICE libavdevice/avdevice.h
>>  get_version LIBAVFORMAT libavformat/version.h
>>  get_version LIBAVUTIL   libavutil/avutil.h
>> -- 
>
> looks ok, maybe should be done for other libraries as well

OK to me as well.

As an additional change, maybe the get_version() function could do some
basic sanity checks to yell immediately if the grep/awk calls fail?


-- 
Gruesse/greetings,
Reinhard Tartler, KeyID 945348A4


From news@gmane.org Tue Mar 04 03:33:20 2003
From: =?UTF-8?q?Martin=20Storsj=C3=B6?= <martin-TqfNSX0MhmxeoWH0uzbU5w@public.gmane.org>
Subject: [PATCH] configure: Initial support for
	--target-os=symbian
Date: Wed, 23 Mar 2011 11:47:22 +0200
Lines: 37
Message-ID: <1300873642-83040-1-git-send-email-martin@martin.st>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 10:47:26 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2Kf0-0002cj-2n
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 10:47:26 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id DE3FF3B195;
	Wed, 23 Mar 2011 10:47:25 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 92E063B195
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 10:47:24 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id kWqho9kQFC9Z for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 10:47:24 +0100 (CET)
Received: from mail-bw0-f54.google.com (mail-bw0-f54.google.com
	[209.85.214.54])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 70E643B179
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 10:47:24 +0100 (CET)
Received: by bwz12 with SMTP id 12so10477182bwz.27
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 02:47:24 -0700 (PDT)
Received: by 10.204.189.76 with SMTP id dd12mr5838108bkb.206.1300873644006;
	Wed, 23 Mar 2011 02:47:24 -0700 (PDT)
Received: from localhost (bambuser.masterplanet.fi [194.100.86.5])
	by mx.google.com with ESMTPS id l1sm1992932bkl.1.2011.03.23.02.47.23
	(version=TLSv1/SSLv3 cipher=OTHER);
	Wed, 23 Mar 2011 02:47:23 -0700 (PDT)
X-Mailer: git-send-email 1.7.3.1
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/50>

The filtering of ASFLAGS is required since the symbian toolchain
requires a --include parameter in extra_cflags, which shouldn't
be passed on to ASFLAGS. The $(echo) surrounding the filtering
is needed since the output from filter_out contains linebreaks
between each parameter.
---
 configure |    8 +++++++-
 1 files changed, 7 insertions(+), 1 deletions(-)

diff --git a/configure b/configure
index 00aa9ed..14ef220 100755
--- a/configure
+++ b/configure
@@ -1824,7 +1824,7 @@ set_default host_cc
 
 exesuf() {
     case $1 in
-        mingw32*|cygwin*|*-dos|freedos|opendos|os/2*) echo .exe ;;
+        mingw32*|cygwin*|*-dos|freedos|opendos|os/2*|symbian) echo .exe ;;
     esac
 }
 
@@ -2487,6 +2487,12 @@ case $target_os in
         add_cppflags -D_QNX_SOURCE
         network_extralibs="-lsocket"
         ;;
+    symbian)
+        SLIBSUF=".dll"
+        disable ffserver
+        enable dos_paths
+        ASFLAGS=$(echo $(filter_out --include* $ASFLAGS))
+        ;;
     none)
         ;;
     *)
-- 
1.7.3.1


From news@gmane.org Tue Mar 04 03:33:20 2003
From: =?iso-8859-1?Q?M=E5ns_Rullg=E5rd?= <mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org>
Subject: Re: configure: remove early check_deps $ARCH_EXT_LIST
Date: Wed, 23 Mar 2011 09:54:50 +0000
Lines: 96
Message-ID: <yw1xwrjqrwk5.fsf@unicorn.mansr.com>
References: <20110211184533.1428D3B32D@natsuki.mplayerhq.hu>
	<alpine.DEB.2.00.1102171121220.17057@cone.home.martin.st>
	<yw1xr5b6alm1.fsf@unicorn.mansr.com>
	<alpine.DEB.2.00.1103231112190.3794@cone.home.martin.st>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 10:54:54 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2KmD-0006TU-U8
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 10:54:54 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id A90163B15E;
	Wed, 23 Mar 2011 10:54:53 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 41D803B15E
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 10:54:51 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id UkrkcvisnTfK for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 10:54:51 +0100 (CET)
Received: from unicorn.mansr.com (unicorn.mansr.com [78.86.181.103])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 173943B15B
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 10:54:51 +0100 (CET)
Received: by unicorn.mansr.com (Postfix, from userid 51770)
	id E27C617B41; Wed, 23 Mar 2011 09:54:50 +0000 (GMT)
In-Reply-To: <alpine.DEB.2.00.1103231112190.3794-bySdwzmfsd4wFlGVRAW2/FdQdH8mP9S6@public.gmane.org> ("Martin
	=?iso-8859-1?Q?Storsj=F6=22's?= message of "Wed,
	23 Mar 2011 11:15:30 +0200 (EET)")
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/23.2 (gnu/linux)
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/51>

Martin Storsj=F6 <martin-TqfNSX0MhmxeoWH0uzbU5w@public.gmane.org> writes:

> On Thu, 17 Feb 2011, M=E5ns Rullg=E5rd wrote:
>
>> Martin Storsj=F6 <martin-TqfNSX0MhmxeoWH0uzbU5w@public.gmane.org> writes:
>> =

>> > On Fri, 11 Feb 2011, Mans Rullgard  wrote:
>> >
>> >> Module: ffmpeg
>> >> Branch: master
>> >> Commit: 4b884207eb7319577f8ceb94a56f42c5ac0ab294
>> >> =

>> >> Author: Mans Rullgard <mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org>
>> >> Date:   Fri Feb 11 18:28:12 2011 +0000
>> >> =

>> >> configure: remove early check_deps $ARCH_EXT_LIST
>> >> =

>> >> The early disabling of irrelevant arch extensions is no longer
>> >> required, and removing it makes dependencies involving these
>> >> work as expected.
>> >> =

>> >> Signed-off-by: Mans Rullgard <mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org>
>> >> =

>> >> ---
>> >> =

>> >>  configure |    2 --
>> >>  1 files changed, 0 insertions(+), 2 deletions(-)
>> >> =

>> >> diff --git a/configure b/configure
>> >> index a3ca15d..a310d25 100755
>> >> --- a/configure
>> >> +++ b/configure
>> >> @@ -2494,8 +2494,6 @@ die_license_disabled version3 libopencore_amrwb
>> >>  =

>> >>  enabled version3 && { enabled gpl && enable gplv3 || enable lgplv3; }
>> >>  =

>> >> -check_deps $ARCH_EXT_LIST
>> >> -
>> >>  disabled optimizations || check_cflags -fomit-frame-pointer
>> >>  =

>> >>  enable_pic() {
>> >
>> > This change broke compilation for Windows CE, where configure now erro=
rs =

>> > out with this error:
>> >
>> > Error, no aligned memory allocator but SSE enabled, disable it or use =

>> > --enable-memalign-hack.
>> >
>> > This is checked at this point:
>> >
>> > if ! enabled_any memalign memalign_hack posix_memalign malloc_aligned =
&&
>> >      enabled_any $need_memalign ; then
>> >     die "Error, no aligned memory allocator but SSE enabled, disable i=
t or use --enable-memalign-hack."
>> > fi
>> >
>> > Here, enabled_any $need_memalign (which is "altivec neon sse") trigger=
s, =

>> > believing altivec and sse to be enabled (while neon correctly seems to=
 be =

>> > disabled).
>> =

>> Now I remember why that check_deps was there...
>> =

>> Can you live with it while I come up with a proper solution?
>
> Moving the thread over to this ML (I just ran into this issue in another =

> build configuration, too).

A simple fix would be to move that memalign error after the check_deps
call.  In fact, that should be more correct in general.

-- =

M=E5ns Rullg=E5rd
mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org


From news@gmane.org Tue Mar 04 03:33:20 2003
From: Luca Barbato <lu_zero-aBrp7R+bbdUdnm+yROfE0A@public.gmane.org>
Subject: Re: [PATCH] matroskadec: set a default duration also
 for packets comming from a simple block
Date: Wed, 23 Mar 2011 11:00:31 +0100
Lines: 22
Message-ID: <4D89C4BF.4010208@gentoo.org>
References: <4D850D5B.4050000@jetheaddev.com>
	<1300655467-7260-1-git-send-email-lu_zero@gentoo.org>
	<4D86705F.60406@gentoo.org>
	<0F5DA216-71C1-49C5-A2C8-4577C564A6CA@ithinksw.com>
	<4D868CFF.7090600@gentoo.org>
	<assp.006168c448.4D86974A.1020202@jetheaddev.com>
	<AANLkTiny_1XuGhHWQWhW+41_x2vu69g4gJd5hAVvAfeh@mail.gmail.com>
	<assp.00635fb0c3.4D895B79.8030704@jetheaddev.com>
	<4D895DB2.2030302@gentoo.org>
	<AANLkTikJGSN3j5pyy-xZhwsjrs3ctKB6hLudNN7-1vfw@mail.gmail.com>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 11:00:44 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2Krp-0000kX-06
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 11:00:41 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id C8BE53B191;
	Wed, 23 Mar 2011 11:00:40 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 2E21D3B191
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 11:00:38 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id GmraThduNhQo for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 11:00:38 +0100 (CET)
Received: from smtp.gentoo.org (smtp.gentoo.org [140.211.166.183])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id DBBF23B182
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 11:00:37 +0100 (CET)
Received: from [192.168.1.116] (dynamic-adsl-84-223-248-146.clienti.tiscali.it
	[84.223.248.146])
	(using TLSv1 with cipher DHE-RSA-CAMELLIA256-SHA (256/256 bits))
	(No client certificate requested) (Authenticated sender: lu_zero)
	by smtp.gentoo.org (Postfix) with ESMTPSA id 91A2D1B4059
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 10:00:36 +0000 (UTC)
User-Agent: Mozilla/5.0 (X11; Linux x86_64;
	rv:2.0b10pre) Gecko/20110314 Thunderbird/3.3a2
In-Reply-To: <AANLkTikJGSN3j5pyy-xZhwsjrs3ctKB6hLudNN7-1vfw-JsoAwUIsXosN+BqQ9rBEUg@public.gmane.org>
X-Enigmail-Version: 1.2a1pre
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/52>

On 03/23/2011 08:20 AM, Alexander Strange wrote:
> On Tue, Mar 22, 2011 at 10:40 PM, Luca Barbato <lu_zero-aBrp7R+bbdUdnm+yROfE0A@public.gmane.org> wrote:
>> On 03/23/2011 03:31 AM, John Stebbins wrote:
>>> fwiw, I've verified that both patches solve the original problem I had.
>>
>> I'd pick your since I expect to have 0 duration frames sooner or later.
> 
> Expect to have them where?

The current specification states that Duration should be >0 (as already
discussed in the thread), so both patch are safe and correct now.
Setting the default in a more explicit way feels more futureproof.

Adding a comment on the Aurel patch would make me happy as well.

lu

-- 

Luca Barbato
Gentoo/linux
http://dev.gentoo.org/~lu_zero


From news@gmane.org Tue Mar 04 03:33:20 2003
From: =?iso-8859-1?Q?M=E5ns_Rullg=E5rd?= <mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org>
Subject: Re: [PATCH] configure: Initial support for
	--target-os=symbian
Date: Wed, 23 Mar 2011 10:00:42 +0000
Lines: 56
Message-ID: <yw1xsjuerwad.fsf@unicorn.mansr.com>
References: <1300873642-83040-1-git-send-email-martin@martin.st>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 11:00:46 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2Krt-0000mt-Bk
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 11:00:45 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 2B4FC3B19E;
	Wed, 23 Mar 2011 11:00:45 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id F07E43B19E
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 11:00:42 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id OjTz4ckbzH7b for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 11:00:42 +0100 (CET)
Received: from unicorn.mansr.com (unicorn.mansr.com [78.86.181.103])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id CCAF73B182
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 11:00:42 +0100 (CET)
Received: by unicorn.mansr.com (Postfix, from userid 51770)
	id A622017B41; Wed, 23 Mar 2011 10:00:42 +0000 (GMT)
In-Reply-To: <1300873642-83040-1-git-send-email-martin-TqfNSX0MhmxeoWH0uzbU5w@public.gmane.org> ("Martin
	=?iso-8859-1?Q?Storsj=F6=22's?= message of "Wed, 23 Mar 2011 11:47:22
	+0200")
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/23.2 (gnu/linux)
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/53>

Martin Storsj=F6 <martin-TqfNSX0MhmxeoWH0uzbU5w@public.gmane.org> writes:

> The filtering of ASFLAGS is required since the symbian toolchain
> requires a --include parameter in extra_cflags, which shouldn't
> be passed on to ASFLAGS. The $(echo) surrounding the filtering
> is needed since the output from filter_out contains linebreaks
> between each parameter.
> ---
>  configure |    8 +++++++-
>  1 files changed, 7 insertions(+), 1 deletions(-)
>
> diff --git a/configure b/configure
> index 00aa9ed..14ef220 100755
> --- a/configure
> +++ b/configure
> @@ -1824,7 +1824,7 @@ set_default host_cc
>  =

>  exesuf() {
>      case $1 in
> -        mingw32*|cygwin*|*-dos|freedos|opendos|os/2*) echo .exe ;;
> +        mingw32*|cygwin*|*-dos|freedos|opendos|os/2*|symbian) echo .exe =
;;
>      esac
>  }
>  =

> @@ -2487,6 +2487,12 @@ case $target_os in
>          add_cppflags -D_QNX_SOURCE
>          network_extralibs=3D"-lsocket"
>          ;;
> +    symbian)
> +        SLIBSUF=3D".dll"
> +        disable ffserver

Why does ffserver need to be explicitly disabled?  If it fails to build,
there is a missing check somewhere.

> +        enable dos_paths
> +        ASFLAGS=3D$(echo $(filter_out --include* $ASFLAGS))

filter_asflags=3D"filter_out --include*"

> +        ;;
>      none)
>          ;;
>      *)
> -- =

> 1.7.3.1
>

-- =

M=E5ns Rullg=E5rd
mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org


From news@gmane.org Tue Mar 04 03:33:20 2003
From: Anton Khirnov <anton-5jV5EzyPuF3R7s880joybQ@public.gmane.org>
Subject: [PATCH] matroskaenc: remove a variable that's unused
	after bc17bd9.
Date: Wed, 23 Mar 2011 11:09:34 +0100
Lines: 18
Message-ID: <1300874974-7464-1-git-send-email-anton@khirnov.net>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 11:09:41 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2L0V-0005mM-1w
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 11:09:39 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id C20013C090;
	Wed, 23 Mar 2011 11:09:38 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 7CBBD3C090
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 11:09:37 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id u3L+lDiZkyGS for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 11:09:37 +0100 (CET)
Received: from smtp1.kolej.mff.cuni.cz (smtp1.kolej.mff.cuni.cz
	[78.128.192.10])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 5248A3C08E
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 11:09:37 +0100 (CET)
X-Envelope-From: anton-5jV5EzyPuF3R7s880joybQ@public.gmane.org
Received: from zohar.localdomain (zohar.kolej.mff.cuni.cz [78.128.198.199])
	by smtp1.kolej.mff.cuni.cz (8.14.4/8.14.4) with ESMTP id p2NA9ZXG068179
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 11:09:37 +0100 (CET)
	(envelope-from anton-5jV5EzyPuF3R7s880joybQ@public.gmane.org)
Received: by zohar.localdomain (Postfix, from userid 1000)
	id 866C27F471; Wed, 23 Mar 2011 11:09:35 +0100 (CET)
X-Mailer: git-send-email 1.7.4.1
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/54>

---
 libavformat/matroskaenc.c |    1 -
 1 files changed, 0 insertions(+), 1 deletions(-)

diff --git a/libavformat/matroskaenc.c b/libavformat/matroskaenc.c
index 0ab1832..4f9bf0a 100644
--- a/libavformat/matroskaenc.c
+++ b/libavformat/matroskaenc.c
@@ -438,7 +438,6 @@ static int put_xiph_codecpriv(AVFormatContext *s, AVIOContext *pb, AVCodecContex
 
 static void get_aac_sample_rates(AVFormatContext *s, AVCodecContext *codec, int *sample_rate, int *output_sample_rate)
 {
-    int sri;
     MPEG4AudioConfig mp4ac;
 
     if (ff_mpeg4audio_get_config(&mp4ac, codec->extradata, codec->extradata_size) < 0) {
-- 
1.7.4.1


From news@gmane.org Tue Mar 04 03:33:20 2003
From: Kostya <kostya.shishkov-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>
Subject: Re: [PATCH] matroskaenc: remove a variable that's
 unused after bc17bd9.
Date: Wed, 23 Mar 2011 11:24:22 +0100
Lines: 20
Message-ID: <20110323102422.GA22848@kst-acer>
References: <1300874974-7464-1-git-send-email-anton@khirnov.net>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 11:23:07 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2LDW-0004KT-B3
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 11:23:06 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 120FF3C079;
	Wed, 23 Mar 2011 11:23:06 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id AB63C3C079
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 11:23:04 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id aUqnp6bfq-HK for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 11:23:04 +0100 (CET)
Received: from mail-ey0-f182.google.com (mail-ey0-f182.google.com
	[209.85.215.182])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 8E1123C06F
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 11:23:04 +0100 (CET)
Received: by eyg7 with SMTP id 7so3696067eyg.27
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 03:23:04 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=gamma;
	h=domainkey-signature:date:from:to:subject:message-id:references
	:mime-version:content-type:content-disposition:in-reply-to
	:user-agent; bh=97cxfENw1brs9kfo9ykNhsNLhzIQsK8JPEQUf/Fkhy4=;
	b=tHH8us7EkmrOpM/fw+p0nMCvY1Ter8cvKEGw50KLBOwiZjKYmouKssbTimrgDND7t3
	j6nHdPBE5shzIrpxb4QjXgMFoo1Z3wMJMKukxuSl2hMRozb5JLl8AGaQGMulmtGJuzUC
	/NeCXYSqL0l9BlLETc0ZBEOrt15y0HGiumvXQ=
DomainKey-Signature: a=rsa-sha1; c=nofws; d=gmail.com; s=gamma;
	h=date:from:to:subject:message-id:references:mime-version
	:content-type:content-disposition:in-reply-to:user-agent;
	b=YiyLsMpykJtSAmD/0ISXHil+VhntCK6gnywJCN5htdboRNPgj7rAvcYDvahbAqLTFu
	kHZKpvLT8jKt5SCwObHeHT0ukxMZkOsk7WaVNnbbDBX2/B4h2BZDwyLg1dzcEAtTU6LI
	PHUNW7ArovE8Nwjp0TLDZwX6ePESFdwzSgvoE=
Received: by 10.213.114.3 with SMTP id c3mr3104703ebq.126.1300875783938;
	Wed, 23 Mar 2011 03:23:03 -0700 (PDT)
Received: from localhost
	(HSI-KBW-078-043-255-085.hsi4.kabel-badenwuerttemberg.de
	[78.43.255.85])
	by mx.google.com with ESMTPS id b52sm3514202eei.22.2011.03.23.03.23.02
	(version=TLSv1/SSLv3 cipher=OTHER);
	Wed, 23 Mar 2011 03:23:03 -0700 (PDT)
Content-Disposition: inline
In-Reply-To: <1300874974-7464-1-git-send-email-anton-5jV5EzyPuF3R7s880joybQ@public.gmane.org>
User-Agent: Mutt/1.5.20 (2009-06-14)
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/55>

On Wed, Mar 23, 2011 at 11:09:34AM +0100, Anton Khirnov wrote:
> ---
>  libavformat/matroskaenc.c |    1 -
>  1 files changed, 0 insertions(+), 1 deletions(-)
> 
> diff --git a/libavformat/matroskaenc.c b/libavformat/matroskaenc.c
> index 0ab1832..4f9bf0a 100644
> --- a/libavformat/matroskaenc.c
> +++ b/libavformat/matroskaenc.c
> @@ -438,7 +438,6 @@ static int put_xiph_codecpriv(AVFormatContext *s, AVIOContext *pb, AVCodecContex
>  
>  static void get_aac_sample_rates(AVFormatContext *s, AVCodecContext *codec, int *sample_rate, int *output_sample_rate)
>  {
> -    int sri;
>      MPEG4AudioConfig mp4ac;
>  
>      if (ff_mpeg4audio_get_config(&mp4ac, codec->extradata, codec->extradata_size) < 0) {
> -- 

lgtm


From news@gmane.org Tue Mar 04 03:33:20 2003
From: =?UTF-8?q?Martin=20Storsj=C3=B6?= <martin-TqfNSX0MhmxeoWH0uzbU5w@public.gmane.org>
Subject: [PATCH 2/2] configure: Remove the explicit disabling
	of ffserver from the mingw section
Date: Wed, 23 Mar 2011 12:26:59 +0200
Lines: 19
Message-ID: <1300876019-26388-2-git-send-email-martin@martin.st>
References: <1300876019-26388-1-git-send-email-martin@martin.st>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 11:27:04 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2LHL-0006Le-Tz
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 11:27:03 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 9FF993B1BD;
	Wed, 23 Mar 2011 11:27:03 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 3EC833B1BD
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 11:27:02 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id TTJQunQCIvoU for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 11:27:02 +0100 (CET)
Received: from mail-bw0-f54.google.com (mail-bw0-f54.google.com
	[209.85.214.54])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 1E3A03B1BC
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 11:27:02 +0100 (CET)
Received: by bwz12 with SMTP id 12so10512669bwz.27
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 03:27:01 -0700 (PDT)
Received: by 10.204.83.88 with SMTP id e24mr5868657bkl.78.1300876021792;
	Wed, 23 Mar 2011 03:27:01 -0700 (PDT)
Received: from localhost (bambuser.masterplanet.fi [194.100.86.5])
	by mx.google.com with ESMTPS id b6sm5800770bkb.10.2011.03.23.03.27.01
	(version=TLSv1/SSLv3 cipher=OTHER);
	Wed, 23 Mar 2011 03:27:01 -0700 (PDT)
X-Mailer: git-send-email 1.7.3.1
In-Reply-To: <1300876019-26388-1-git-send-email-martin-TqfNSX0MhmxeoWH0uzbU5w@public.gmane.org>
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/56>

It is automatically disabled due to the lack of fork.
---
 configure |    1 -
 1 files changed, 0 insertions(+), 1 deletions(-)

diff --git a/configure b/configure
index 7219083..fdc8408 100755
--- a/configure
+++ b/configure
@@ -2410,7 +2410,6 @@ case $target_os in
             LIBTARGET=arm-wince
         fi
         shlibdir_default="$bindir_default"
-        disable ffserver
         SLIBPREF=""
         SLIBSUF=".dll"
         SLIBNAME_WITH_VERSION='$(SLIBPREF)$(FULLNAME)-$(LIBVERSION)$(SLIBSUF)'
-- 
1.7.3.1


From news@gmane.org Tue Mar 04 03:33:20 2003
From: =?ISO-8859-15?Q?Martin_Storsj=F6?= <martin-TqfNSX0MhmxeoWH0uzbU5w@public.gmane.org>
Subject: Re: configure: remove early check_deps $ARCH_EXT_LIST
Date: Wed, 23 Mar 2011 12:27:30 +0200 (EET)
Lines: 103
Message-ID: <alpine.DEB.2.00.1103231227210.3794@cone.home.martin.st>
References: <20110211184533.1428D3B32D@natsuki.mplayerhq.hu>
	<alpine.DEB.2.00.1102171121220.17057@cone.home.martin.st>
	<yw1xr5b6alm1.fsf@unicorn.mansr.com>
	<alpine.DEB.2.00.1103231112190.3794@cone.home.martin.st>
	<yw1xwrjqrwk5.fsf@unicorn.mansr.com>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: MULTIPART/MIXED;
	BOUNDARY="-1463810048-1205904653-1300876053=:3794"
To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 11:27:40 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2LHr-0006bz-C1
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 11:27:35 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 280F13B1C1;
	Wed, 23 Mar 2011 11:27:35 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id AFB083B1C0
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 11:27:33 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id MKwSfM9g1gqC for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 11:27:33 +0100 (CET)
Received: from kirsi1.inet.fi (mta-out.inet.fi [195.156.147.13])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 7DC4A3B1BC
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 11:27:33 +0100 (CET)
Received: from dsl-tkubrasgw1-fe1efa00-177.dhcp.inet.fi (84.250.30.177) by
	kirsi1.inet.fi (8.5.133)
	id 4D072CA704A37740 for libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org;
	Wed, 23 Mar 2011 12:27:33 +0200
X-X-Sender: martin-bySdwzmfsd4wFlGVRAW2/FdQdH8mP9S6@public.gmane.org
In-Reply-To: <yw1xwrjqrwk5.fsf-OEaqT8BN2ezZK2NkWkPsZwC/G2K4zDHf@public.gmane.org>
User-Agent: Alpine 2.00 (DEB 1167 2008-08-23)
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/57>

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.

---1463810048-1205904653-1300876053=:3794
Content-Type: TEXT/PLAIN; charset=iso-8859-1
Content-Transfer-Encoding: quoted-printable

On Wed, 23 Mar 2011, M=E5ns Rullg=E5rd wrote:

> Martin Storsj=F6 <martin-TqfNSX0MhmxeoWH0uzbU5w@public.gmane.org> writes:
>=20
> > On Thu, 17 Feb 2011, M=E5ns Rullg=E5rd wrote:
> >
> >> Martin Storsj=F6 <martin-TqfNSX0MhmxeoWH0uzbU5w@public.gmane.org> writes:
> >>=20
> >> > On Fri, 11 Feb 2011, Mans Rullgard  wrote:
> >> >
> >> >> Module: ffmpeg
> >> >> Branch: master
> >> >> Commit: 4b884207eb7319577f8ceb94a56f42c5ac0ab294
> >> >>=20
> >> >> Author: Mans Rullgard <mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org>
> >> >> Date:   Fri Feb 11 18:28:12 2011 +0000
> >> >>=20
> >> >> configure: remove early check_deps $ARCH_EXT_LIST
> >> >>=20
> >> >> The early disabling of irrelevant arch extensions is no longer
> >> >> required, and removing it makes dependencies involving these
> >> >> work as expected.
> >> >>=20
> >> >> Signed-off-by: Mans Rullgard <mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org>
> >> >>=20
> >> >> ---
> >> >>=20
> >> >>  configure |    2 --
> >> >>  1 files changed, 0 insertions(+), 2 deletions(-)
> >> >>=20
> >> >> diff --git a/configure b/configure
> >> >> index a3ca15d..a310d25 100755
> >> >> --- a/configure
> >> >> +++ b/configure
> >> >> @@ -2494,8 +2494,6 @@ die_license_disabled version3 libopencore_a=
mrwb
> >> >> =20
> >> >>  enabled version3 && { enabled gpl && enable gplv3 || enable lgpl=
v3; }
> >> >> =20
> >> >> -check_deps $ARCH_EXT_LIST
> >> >> -
> >> >>  disabled optimizations || check_cflags -fomit-frame-pointer
> >> >> =20
> >> >>  enable_pic() {
> >> >
> >> > This change broke compilation for Windows CE, where configure now =
errors=20
> >> > out with this error:
> >> >
> >> > Error, no aligned memory allocator but SSE enabled, disable it or =
use=20
> >> > --enable-memalign-hack.
> >> >
> >> > This is checked at this point:
> >> >
> >> > if ! enabled_any memalign memalign_hack posix_memalign malloc_alig=
ned &&
> >> >      enabled_any $need_memalign ; then
> >> >     die "Error, no aligned memory allocator but SSE enabled, disab=
le it or use --enable-memalign-hack."
> >> > fi
> >> >
> >> > Here, enabled_any $need_memalign (which is "altivec neon sse") tri=
ggers,=20
> >> > believing altivec and sse to be enabled (while neon correctly seem=
s to be=20
> >> > disabled).
> >>=20
> >> Now I remember why that check_deps was there...
> >>=20
> >> Can you live with it while I come up with a proper solution?
> >
> > Moving the thread over to this ML (I just ran into this issue in anot=
her=20
> > build configuration, too).
>=20
> A simple fix would be to move that memalign error after the check_deps
> call.  In fact, that should be more correct in general.

Yes, that does sound sane.

// Martin
---1463810048-1205904653-1300876053=:3794
Content-Type: text/plain; charset="us-ascii"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
Content-Disposition: inline

_______________________________________________
libav-devel mailing list
libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
https://lists.libav.org/mailman/listinfo/libav-devel

---1463810048-1205904653-1300876053=:3794--



From news@gmane.org Tue Mar 04 03:33:20 2003
From: =?UTF-8?q?Martin=20Storsj=C3=B6?= <martin-TqfNSX0MhmxeoWH0uzbU5w@public.gmane.org>
Subject: [PATCH 1/2] configure: Add fork as a dependency to
	ffserver
Date: Wed, 23 Mar 2011 12:26:58 +0200
Lines: 19
Message-ID: <1300876019-26388-1-git-send-email-martin@martin.st>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 11:28:49 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2LJ2-0007D1-PY
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 11:28:48 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 91B6C3B1C0;
	Wed, 23 Mar 2011 11:28:48 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 0EB2D3B1C0
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 11:28:47 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id TKzanlzctgNb for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 11:28:46 +0100 (CET)
Received: from mail-bw0-f54.google.com (mail-bw0-f54.google.com
	[209.85.214.54])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id E0ED53B1BE
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 11:28:46 +0100 (CET)
Received: by bwz12 with SMTP id 12so10514234bwz.27
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 03:28:46 -0700 (PDT)
Received: by 10.204.25.20 with SMTP id x20mr6001253bkb.112.1300876020641;
	Wed, 23 Mar 2011 03:27:00 -0700 (PDT)
Received: from localhost (bambuser.masterplanet.fi [194.100.86.5])
	by mx.google.com with ESMTPS id z18sm5803139bkf.20.2011.03.23.03.26.59
	(version=TLSv1/SSLv3 cipher=OTHER);
	Wed, 23 Mar 2011 03:27:00 -0700 (PDT)
X-Mailer: git-send-email 1.7.3.1
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/58>

---
 configure |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/configure b/configure
index 00aa9ed..7219083 100755
--- a/configure
+++ b/configure
@@ -1471,7 +1471,7 @@ ffmpeg_select="buffer_filter"
 ffplay_deps="avcodec avformat swscale sdl"
 ffplay_select="rdft"
 ffprobe_deps="avcodec avformat"
-ffserver_deps="avformat ffm_muxer rtp_protocol rtsp_demuxer"
+ffserver_deps="avformat ffm_muxer rtp_protocol rtsp_demuxer fork"
 ffserver_extralibs='$ldl'
 
 doc_deps="texi2html"
-- 
1.7.3.1


From news@gmane.org Tue Mar 04 03:33:20 2003
From: =?ISO-8859-15?Q?Martin_Storsj=F6?= <martin-TqfNSX0MhmxeoWH0uzbU5w@public.gmane.org>
Subject: Re: [PATCH] configure: Initial support for
 --target-os=symbian
Date: Wed, 23 Mar 2011 12:32:16 +0200 (EET)
Lines: 82
Message-ID: <alpine.DEB.2.00.1103231227360.3794@cone.home.martin.st>
References: <1300873642-83040-1-git-send-email-martin@martin.st>
	<yw1xsjuerwad.fsf@unicorn.mansr.com>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: MULTIPART/MIXED;
	BOUNDARY="-1463810048-231947423-1300876336=:3794"
To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 11:32:24 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2LMR-0000Y5-EH
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 11:32:19 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 2DEE53C087;
	Wed, 23 Mar 2011 11:32:19 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 427033C087
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 11:32:17 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id AAKRG5D48gbp for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 11:32:17 +0100 (CET)
Received: from jenni2.inet.fi (mta-out.inet.fi [195.156.147.13])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 159443C085
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 11:32:17 +0100 (CET)
Received: from dsl-tkubrasgw1-fe1efa00-177.dhcp.inet.fi (84.250.30.177) by
	jenni2.inet.fi (8.5.133)
	id 4D061FFC04894C62 for libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org;
	Wed, 23 Mar 2011 12:32:16 +0200
X-X-Sender: martin-bySdwzmfsd4wFlGVRAW2/FdQdH8mP9S6@public.gmane.org
In-Reply-To: <yw1xsjuerwad.fsf-OEaqT8BN2ezZK2NkWkPsZwC/G2K4zDHf@public.gmane.org>
User-Agent: Alpine 2.00 (DEB 1167 2008-08-23)
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/59>

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.

---1463810048-231947423-1300876336=:3794
Content-Type: TEXT/PLAIN; charset=iso-8859-1
Content-Transfer-Encoding: quoted-printable

On Wed, 23 Mar 2011, M=E5ns Rullg=E5rd wrote:

> Martin Storsj=F6 <martin-TqfNSX0MhmxeoWH0uzbU5w@public.gmane.org> writes:
>=20
> > The filtering of ASFLAGS is required since the symbian toolchain
> > requires a --include parameter in extra_cflags, which shouldn't
> > be passed on to ASFLAGS. The $(echo) surrounding the filtering
> > is needed since the output from filter_out contains linebreaks
> > between each parameter.
> > ---
> >  configure |    8 +++++++-
> >  1 files changed, 7 insertions(+), 1 deletions(-)
> >
> > diff --git a/configure b/configure
> > index 00aa9ed..14ef220 100755
> > --- a/configure
> > +++ b/configure
> > @@ -1824,7 +1824,7 @@ set_default host_cc
> > =20
> >  exesuf() {
> >      case $1 in
> > -        mingw32*|cygwin*|*-dos|freedos|opendos|os/2*) echo .exe ;;
> > +        mingw32*|cygwin*|*-dos|freedos|opendos|os/2*|symbian) echo .=
exe ;;
> >      esac
> >  }
> > =20
> > @@ -2487,6 +2487,12 @@ case $target_os in
> >          add_cppflags -D_QNX_SOURCE
> >          network_extralibs=3D"-lsocket"
> >          ;;
> > +    symbian)
> > +        SLIBSUF=3D".dll"
> > +        disable ffserver
>=20
> Why does ffserver need to be explicitly disabled?  If it fails to build=
,
> there is a missing check somewhere.

Indeed - sent a patchset fixing this.

> > +        enable dos_paths
> > +        ASFLAGS=3D$(echo $(filter_out --include* $ASFLAGS))
>=20
> filter_asflags=3D"filter_out --include*"

Ah yes - I tried that initially, but this is past the section where cflag=
s=20
are added to ASFLAGS ("add_asflags $extra_cflags", quite soon after the=20
compiler detection section) - setting filter_asflags here doesn't have an=
y=20
effect.

Do you prefer moving part this up a bit, as a separate block, next to the=
=20
compiler section? Something like this:

if [ "$target_os =3D "symbian" ]; then
    filter_asflags=3D"filter_out --include*"
endif

// Martin
---1463810048-231947423-1300876336=:3794
Content-Type: text/plain; charset="us-ascii"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
Content-Disposition: inline

_______________________________________________
libav-devel mailing list
libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
https://lists.libav.org/mailman/listinfo/libav-devel

---1463810048-231947423-1300876336=:3794--



From news@gmane.org Tue Mar 04 03:33:20 2003
From: Vladimir Pantelic <vladoman-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>
Subject: Re: [PATCH] also subtract preroll when reading ASF
 simple index object
Date: Wed, 23 Mar 2011 11:39:12 +0100
Lines: 46
Message-ID: <4D89CDD0.9090106@gmail.com>
References: <4D827F16.8010608@gmail.com>
	<20110318063253.GD18946@zohar.khirnov.net>
	<4D83145D.5060309@gmail.com> <yw1x39mfwgds.fsf@unicorn.mansr.com>
	<4D889A0D.9010004@gmail.com>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="iso-8859-1"; Format="flowed"
Content-Transfer-Encoding: quoted-printable
To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 11:39:20 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2LTD-000414-MQ
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 11:39:19 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 0CD743B174;
	Wed, 23 Mar 2011 11:39:19 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 48BB83B174
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 11:39:16 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id A0S96vSex2YC for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 11:39:16 +0100 (CET)
Received: from mail-fx0-f54.google.com (mail-fx0-f54.google.com
	[209.85.161.54])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 26E663B170
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 11:39:16 +0100 (CET)
Received: by fxm11 with SMTP id 11so12003205fxm.27
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 03:39:15 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=gamma;
	h=domainkey-signature:message-id:date:from:user-agent:mime-version:to
	:subject:references:in-reply-to:content-type
	:content-transfer-encoding;
	bh=tqXmSkRayyeM2nq6le9oSemh8eByC4rp5LA59GcMi0c=;
	b=EkFboXArPexsvDsb1z7TcZjjNjTWENNt+l6OEOC8NJhXu9oK5YQ6Ut/Q38UGu+KW7M
	VT8Gzr+2WCsVZvlrVeAW0CeWceghUMJ1A2NZxzll9G+jjUkcNg/yEVMpPK7pFVZItiAS
	qXlzLppWOidCSvIuApURD5cjn3P/d/K9vG+5Q=
DomainKey-Signature: a=rsa-sha1; c=nofws; d=gmail.com; s=gamma;
	h=message-id:date:from:user-agent:mime-version:to:subject:references
	:in-reply-to:content-type:content-transfer-encoding;
	b=EI+V+gXN4vN//hEKwXQG8LnjA3XFA7YHmgkLXnT5qSWH0fq7sPd+B3VRqCHtb1X0EK
	xAlpY65HmGsKNOQ51SxhRSualVrI/x6Y61Edausa4niqtSB/qpA4blDwQqWVt+04Gklb
	XbVtCs57BxhwJpODcdSWJk5evTJD/hq8gV7JY=
Received: by 10.223.161.133 with SMTP id r5mr3054716fax.18.1300876755637;
	Wed, 23 Mar 2011 03:39:15 -0700 (PDT)
Received: from [192.168.1.22] (p50996ded.dip0.t-ipconnect.de [80.153.109.237])
	by mx.google.com with ESMTPS id c11sm36694fav.2.2011.03.23.03.39.13
	(version=SSLv3 cipher=OTHER); Wed, 23 Mar 2011 03:39:14 -0700 (PDT)
User-Agent: Mozilla/5.0 (X11; Linux i686;
	rv:2.0b7pre) Gecko/20101008 Firefox/4.0b7pre SeaMonkey/2.1b1
In-Reply-To: <4D889A0D.9010004-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/60>

ping

Vladimir Pantelic wrote:
> M=E5ns Rullg=E5rd wrote:
>>  Vladimir Pantelic<vladoman-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>   writes:
>
>>>     From 057af717394ec2352d52fa8c1d96f66262da423c Mon Sep 17 00:00:00 2=
001
>>>   From: Vladimir Pantelic<vladoman-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>
>>>   Date: Thu, 17 Mar 2011 22:34:52 +0100
>>>   Subject: [PATCH] also subtract preroll when reading ASF simple index =
object
>>>
>>>   this was missed when ASF was changed to return timestamps
>>>   without preroll.
>>>   ---
>>>    libavformat/asfdec.c |    4 ++--
>>>    1 files changed, 2 insertions(+), 2 deletions(-)
>>>
>>>   diff --git a/libavformat/asfdec.c b/libavformat/asfdec.c
>>>   index 79b3bcb..9f460dd 100644
>>>   --- a/libavformat/asfdec.c
>>>   +++ b/libavformat/asfdec.c
>>>   @@ -1218,10 +1218,10 @@ static void asf_build_simple_index(AVFormatCo=
ntext *s, int stream_index)
>>>                int pktnum=3Davio_rl32(s->pb);
>>>                int pktct =3Davio_rl16(s->pb);
>>>                int64_t pos      =3D s->data_offset + s->packet_size*(in=
t64_t)pktnum;
>>>   -            int64_t index_pts=3D av_rescale(itime, i, 10000);
>>>   +            int64_t index_pts=3D FFMAX(av_rescale(itime, i, 10000) -=
 asf->hdr.preroll, 0);
>>
>>  Under what circumstances does this become negative without the FFMAX?
>
> the simple index starts at 0, so with a preroll of e.g. 3000ms the 1st 4 =
index entries
> (0ms, 1000ms, 2000ms, 3000ms) all point to the same packet with timestamp=
 3000ms.
>
> since we subtract the preroll, we need to do that for the index time too =
and thus the 1st
> entries all map to 0
>
>
>


From news@gmane.org Tue Mar 04 03:33:20 2003
From: =?iso-8859-1?Q?M=E5ns_Rullg=E5rd?= <mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org>
Subject: Re: [PATCH] Use macro __INTEL_COMPILER instead
	of	__ICC.
Date: Wed, 23 Mar 2011 11:02:15 +0000
Lines: 44
Message-ID: <yw1xk4fqrtfs.fsf@unicorn.mansr.com>
References: <1300845942-4218-1-git-send-email-rsbultje@gmail.com>
	<20110323073555.GA30842@pool.informatik.RWTH-Aachen.DE>
	<yw1x1v1ytbku.fsf@unicorn.mansr.com>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 12:02:18 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2LpR-00005q-U3
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 12:02:18 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 99FAB3B135;
	Wed, 23 Mar 2011 12:02:17 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 2E2E83B135
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 12:02:16 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id ddAfPMnvR+Y8 for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 12:02:16 +0100 (CET)
Received: from unicorn.mansr.com (unicorn.mansr.com [78.86.181.103])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 07BDA3B12F
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 12:02:16 +0100 (CET)
Received: by unicorn.mansr.com (Postfix, from userid 51770)
	id B71094B38; Wed, 23 Mar 2011 11:02:15 +0000 (GMT)
In-Reply-To: <yw1x1v1ytbku.fsf-OEaqT8BN2ezZK2NkWkPsZwC/G2K4zDHf@public.gmane.org> (=?iso-8859-1?Q?=22M=E5n?=
	=?iso-8859-1?Q?s_Rullg=E5rd=22's?= message
	of "Wed, 23 Mar 2011 09:45:05 +0000")
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/23.2 (gnu/linux)
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/61>

M=E5ns Rullg=E5rd <mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org> writes:

> Diego Biurrun <diego-NvuzD6AdJSiELgA04lAiVw@public.gmane.org> writes:
>
>> On Tue, Mar 22, 2011 at 10:05:42PM -0400, Ronald S. Bultje wrote:
>>> From: Carl Eugen Hoyos <cehoyos-iVVjmtzCFAg@public.gmane.org>
>>> =

>>> __ICC is not supported on all platforms, this is an Intel documentation
>>> bug that is supposed to be fixed in a future release.
>>> (Intel issue 612289)
>>
>> OK
>
> No, it's not  OK.

I'll elaborate a bit on those tests.  The ifdefs are there to enable
various attributes for recent enough gcc versions.  They test the
version macros rather than a configure test since they are needed in
public headers.  So far all is well.

Enter icc.  Some misguided individual at Intel thought it a good idea to
make icc report itself as whatever gcc version happens to be on the
system, whether or not it actually supports all its extensions.  The
result is that with only a gcc version check, the compiler output is
flooded with warnings about unknown attributes.  Thankfully these are
only warnings, not errors, so they are merely an annoyance unless the
effect of the attribute is relied on for correct operation (not our case).

The good news in all this is that a simple compiler flag will disable
these warnings all at once with no added clutter to the code.  I even
added it to our builds once, only to have CE scream bloody murder and it
was removed again.

I suggest we once again shut that warning up and remove all the useless
icc version checks from the code.  This might give some warnings for
people using the public headers, but that's their own fault for using
icc in the first place.  If they don't like it, they can complain to
Intel.

-- =

M=E5ns Rullg=E5rd
mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org


From news@gmane.org Tue Mar 04 03:33:20 2003
From: =?iso-8859-1?Q?M=E5ns_Rullg=E5rd?= <mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org>
Subject: Re: [PATCH 1/2] configure: Add fork as a dependency
	to ffserver
Date: Wed, 23 Mar 2011 11:05:18 +0000
Lines: 30
Message-ID: <yw1xfwqertap.fsf@unicorn.mansr.com>
References: <1300876019-26388-1-git-send-email-martin@martin.st>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 12:05:20 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2LsO-0001tX-HE
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 12:05:20 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 51D343B189;
	Wed, 23 Mar 2011 12:05:20 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 158D93B189
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 12:05:19 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id du9sEDl7lVqc for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 12:05:19 +0100 (CET)
Received: from unicorn.mansr.com (unicorn.mansr.com [78.86.181.103])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id E79553B186
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 12:05:18 +0100 (CET)
Received: by unicorn.mansr.com (Postfix, from userid 51770)
	id BD8B617B41; Wed, 23 Mar 2011 11:05:18 +0000 (GMT)
In-Reply-To: <1300876019-26388-1-git-send-email-martin-TqfNSX0MhmxeoWH0uzbU5w@public.gmane.org> ("Martin
	=?iso-8859-1?Q?Storsj=F6=22's?= message of "Wed, 23 Mar 2011 12:26:58
	+0200")
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/23.2 (gnu/linux)
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/62>

Martin Storsj=F6 <martin-TqfNSX0MhmxeoWH0uzbU5w@public.gmane.org> writes:

> ---
>  configure |    2 +-
>  1 files changed, 1 insertions(+), 1 deletions(-)
>
> diff --git a/configure b/configure
> index 00aa9ed..7219083 100755
> --- a/configure
> +++ b/configure
> @@ -1471,7 +1471,7 @@ ffmpeg_select=3D"buffer_filter"
>  ffplay_deps=3D"avcodec avformat swscale sdl"
>  ffplay_select=3D"rdft"
>  ffprobe_deps=3D"avcodec avformat"
> -ffserver_deps=3D"avformat ffm_muxer rtp_protocol rtsp_demuxer"
> +ffserver_deps=3D"avformat ffm_muxer rtp_protocol rtsp_demuxer fork"
>  ffserver_extralibs=3D'$ldl'
>  =

>  doc_deps=3D"texi2html"
> -- =

> 1.7.3.1

OK, but Diego will want that in alphabetical order.

-- =

M=E5ns Rullg=E5rd
mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org


From news@gmane.org Tue Mar 04 03:33:20 2003
From: =?iso-8859-1?Q?M=E5ns_Rullg=E5rd?= <mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org>
Subject: Re: [PATCH 2/2] configure: Remove the explicit
	disabling of ffserver from the mingw section
Date: Wed, 23 Mar 2011 11:06:08 +0000
Lines: 32
Message-ID: <yw1xbp12rt9b.fsf@unicorn.mansr.com>
References: <1300876019-26388-1-git-send-email-martin@martin.st>
	<1300876019-26388-2-git-send-email-martin@martin.st>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 12:06:11 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2LtD-0002MO-0o
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 12:06:11 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id CC14A3B190;
	Wed, 23 Mar 2011 12:06:10 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 49DA13B190
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 12:06:09 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id P9Ww0uP809O5 for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 12:06:09 +0100 (CET)
Received: from unicorn.mansr.com (unicorn.mansr.com [78.86.181.103])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 2A3BF3B18E
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 12:06:09 +0100 (CET)
Received: by unicorn.mansr.com (Postfix, from userid 51770)
	id 0203A17B41; Wed, 23 Mar 2011 11:06:08 +0000 (GMT)
In-Reply-To: <1300876019-26388-2-git-send-email-martin-TqfNSX0MhmxeoWH0uzbU5w@public.gmane.org> ("Martin
	=?iso-8859-1?Q?Storsj=F6=22's?= message of "Wed, 23 Mar 2011 12:26:59
	+0200")
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/23.2 (gnu/linux)
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/63>

Martin Storsj=F6 <martin-TqfNSX0MhmxeoWH0uzbU5w@public.gmane.org> writes:

> It is automatically disabled due to the lack of fork.
> ---
>  configure |    1 -
>  1 files changed, 0 insertions(+), 1 deletions(-)
>
> diff --git a/configure b/configure
> index 7219083..fdc8408 100755
> --- a/configure
> +++ b/configure
> @@ -2410,7 +2410,6 @@ case $target_os in
>              LIBTARGET=3Darm-wince
>          fi
>          shlibdir_default=3D"$bindir_default"
> -        disable ffserver
>          SLIBPREF=3D""
>          SLIBSUF=3D".dll"
>          SLIBNAME_WITH_VERSION=3D'$(SLIBPREF)$(FULLNAME)-$(LIBVERSION)$(S=
LIBSUF)'
> -- =

> 1.7.3.1

OK

Can the same change be made for DOS too?

-- =

M=E5ns Rullg=E5rd
mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org


From news@gmane.org Tue Mar 04 03:33:20 2003
From: =?iso-8859-1?Q?M=E5ns_Rullg=E5rd?= <mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org>
Subject: Re: [PATCH] configure: Initial support for
	--target-os=symbian
Date: Wed, 23 Mar 2011 11:08:08 +0000
Lines: 77
Message-ID: <yw1x7hbqrt5z.fsf@unicorn.mansr.com>
References: <1300873642-83040-1-git-send-email-martin@martin.st>
	<yw1xsjuerwad.fsf@unicorn.mansr.com>
	<alpine.DEB.2.00.1103231227360.3794@cone.home.martin.st>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 12:08:12 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2Lv9-0003XI-J2
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 12:08:11 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 5581A3B19C;
	Wed, 23 Mar 2011 12:08:11 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 4E2973B19C
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 12:08:09 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id Q-fRAagXk9-i for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 12:08:09 +0100 (CET)
Received: from unicorn.mansr.com (unicorn.mansr.com [78.86.181.103])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 29CDA3B18D
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 12:08:09 +0100 (CET)
Received: by unicorn.mansr.com (Postfix, from userid 51770)
	id 0217D17B41; Wed, 23 Mar 2011 11:08:08 +0000 (GMT)
In-Reply-To: <alpine.DEB.2.00.1103231227360.3794-bySdwzmfsd4wFlGVRAW2/FdQdH8mP9S6@public.gmane.org> ("Martin
	=?iso-8859-1?Q?Storsj=F6=22's?= message of "Wed,
	23 Mar 2011 12:32:16 +0200 (EET)")
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/23.2 (gnu/linux)
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/64>

Martin Storsj=F6 <martin-TqfNSX0MhmxeoWH0uzbU5w@public.gmane.org> writes:

> On Wed, 23 Mar 2011, M=E5ns Rullg=E5rd wrote:
>
>> Martin Storsj=F6 <martin-TqfNSX0MhmxeoWH0uzbU5w@public.gmane.org> writes:
>> =

>> > The filtering of ASFLAGS is required since the symbian toolchain
>> > requires a --include parameter in extra_cflags, which shouldn't
>> > be passed on to ASFLAGS. The $(echo) surrounding the filtering
>> > is needed since the output from filter_out contains linebreaks
>> > between each parameter.
>> > ---
>> >  configure |    8 +++++++-
>> >  1 files changed, 7 insertions(+), 1 deletions(-)
>> >
>> > diff --git a/configure b/configure
>> > index 00aa9ed..14ef220 100755
>> > --- a/configure
>> > +++ b/configure
>> > @@ -1824,7 +1824,7 @@ set_default host_cc
>> >  =

>> >  exesuf() {
>> >      case $1 in
>> > -        mingw32*|cygwin*|*-dos|freedos|opendos|os/2*) echo .exe ;;
>> > +        mingw32*|cygwin*|*-dos|freedos|opendos|os/2*|symbian) echo .e=
xe ;;
>> >      esac
>> >  }
>> >  =

>> > @@ -2487,6 +2487,12 @@ case $target_os in
>> >          add_cppflags -D_QNX_SOURCE
>> >          network_extralibs=3D"-lsocket"
>> >          ;;
>> > +    symbian)
>> > +        SLIBSUF=3D".dll"
>> > +        disable ffserver
>> =

>> Why does ffserver need to be explicitly disabled?  If it fails to build,
>> there is a missing check somewhere.
>
> Indeed - sent a patchset fixing this.
>
>> > +        enable dos_paths
>> > +        ASFLAGS=3D$(echo $(filter_out --include* $ASFLAGS))
>> =

>> filter_asflags=3D"filter_out --include*"
>
> Ah yes - I tried that initially, but this is past the section where cflag=
s =

> are added to ASFLAGS ("add_asflags $extra_cflags", quite soon after the =

> compiler detection section) - setting filter_asflags here doesn't have an=
y =

> effect.
>
> Do you prefer moving part this up a bit, as a separate block, next to the =

> compiler section? Something like this:
>
> if [ "$target_os =3D "symbian" ]; then
>     filter_asflags=3D"filter_out --include*"
> endif

No, that's worse.  Bother me about it later today, I'll try to think of
a nice solution.

-- =

M=E5ns Rullg=E5rd
mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org


From news@gmane.org Tue Mar 04 03:33:20 2003
From: Kostya <kostya.shishkov-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>
Subject: Re: [PATCH] Use macro __INTEL_COMPILER instead of
 __ICC.
Date: Wed, 23 Mar 2011 12:11:29 +0100
Lines: 48
Message-ID: <20110323111129.GA22962@kst-acer>
References: <1300845942-4218-1-git-send-email-rsbultje@gmail.com>
	<20110323073555.GA30842@pool.informatik.RWTH-Aachen.DE>
	<yw1x1v1ytbku.fsf@unicorn.mansr.com>
	<yw1xk4fqrtfs.fsf@unicorn.mansr.com>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 12:10:15 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2Lx7-0004VK-2K
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 12:10:13 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id D83A53B0DD;
	Wed, 23 Mar 2011 12:10:12 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 14D363B0DD
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 12:10:11 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id AOxpEji1u4nx for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 12:10:11 +0100 (CET)
Received: from mail-fx0-f54.google.com (mail-fx0-f54.google.com
	[209.85.161.54])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id F27633B09C
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 12:10:10 +0100 (CET)
Received: by fxm11 with SMTP id 11so12039190fxm.27
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 04:10:10 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=gamma;
	h=domainkey-signature:date:from:to:subject:message-id:references
	:mime-version:content-type:content-disposition
	:content-transfer-encoding:in-reply-to:user-agent;
	bh=EzDogkV4FLtlWfhst3A0IiG/vcyDGjCBxcGKBGruo8A=;
	b=LzLrrsLwDTS3zzJSFS6LtBRa+c6Vvd/RDUDsO0KzFNqGo4YzmqmeIj0yv29w+oaGBF
	xruIdQRIGN4/rY8rXy2k7eQXgsFGTKzqgnk1MIMsdeozskjd0wb8dtnblYZcL3vQhuyh
	mAeXvPdK91hxSJFN9nBtqwgDo6nolYjDjyssE=
DomainKey-Signature: a=rsa-sha1; c=nofws; d=gmail.com; s=gamma;
	h=date:from:to:subject:message-id:references:mime-version
	:content-type:content-disposition:content-transfer-encoding
	:in-reply-to:user-agent;
	b=nEzBGqaHW8roHGm/2Z9yrkMcZhpYBOA1lDahEjbDn4d2gTmQCWxmHq10rlthQApmr2
	C/IbBtRVY+jAXbrMJcXgk/P7QqBn0n6TDYWUbCP2RpUCK8Tl7RlD25VnWx+MVvYZ2Lrx
	eUWx4tmpEjVbr5RtdNAQyfO38PfwkxP6rlSMk=
Received: by 10.223.21.18 with SMTP id h18mr8002190fab.42.1300878610821;
	Wed, 23 Mar 2011 04:10:10 -0700 (PDT)
Received: from localhost
	(HSI-KBW-078-043-255-085.hsi4.kabel-badenwuerttemberg.de
	[78.43.255.85])
	by mx.google.com with ESMTPS id k5sm533346faa.39.2011.03.23.04.10.09
	(version=TLSv1/SSLv3 cipher=OTHER);
	Wed, 23 Mar 2011 04:10:09 -0700 (PDT)
Content-Disposition: inline
In-Reply-To: <yw1xk4fqrtfs.fsf-OEaqT8BN2ezZK2NkWkPsZwC/G2K4zDHf@public.gmane.org>
User-Agent: Mutt/1.5.20 (2009-06-14)
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/65>

On Wed, Mar 23, 2011 at 11:02:15AM +0000, M=E5ns Rullg=E5rd wrote:
> M=E5ns Rullg=E5rd <mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org> writes:
> =

> > Diego Biurrun <diego-NvuzD6AdJSiELgA04lAiVw@public.gmane.org> writes:
> >
> >> On Tue, Mar 22, 2011 at 10:05:42PM -0400, Ronald S. Bultje wrote:
> >>> From: Carl Eugen Hoyos <cehoyos-iVVjmtzCFAg@public.gmane.org>
> >>> =

> >>> __ICC is not supported on all platforms, this is an Intel documentati=
on
> >>> bug that is supposed to be fixed in a future release.
> >>> (Intel issue 612289)
> >>
> >> OK
> >
> > No, it's not  OK.
> =

> I'll elaborate a bit on those tests.  The ifdefs are there to enable
> various attributes for recent enough gcc versions.  They test the
> version macros rather than a configure test since they are needed in
> public headers.  So far all is well.
> =

> Enter icc.  Some misguided individual at Intel thought it a good idea to
> make icc report itself as whatever gcc version happens to be on the
> system, whether or not it actually supports all its extensions.  The
> result is that with only a gcc version check, the compiler output is
> flooded with warnings about unknown attributes.  Thankfully these are
> only warnings, not errors, so they are merely an annoyance unless the
> effect of the attribute is relied on for correct operation (not our case).
> =

> The good news in all this is that a simple compiler flag will disable
> these warnings all at once with no added clutter to the code.  I even
> added it to our builds once, only to have CE scream bloody murder and it
> was removed again.
> =

> I suggest we once again shut that warning up and remove all the useless
> icc version checks from the code.  This might give some warnings for
> people using the public headers, but that's their own fault for using
> icc in the first place.  If they don't like it, they can complain to
> Intel.

Oink, I mean good idea.


From news@gmane.org Tue Mar 04 03:33:20 2003
From: =?iso-8859-1?Q?M=E5ns_Rullg=E5rd?= <mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org>
Subject: Re: [PATCH] also subtract preroll when reading ASF
	simple index object
Date: Wed, 23 Mar 2011 11:11:17 +0000
Lines: 46
Message-ID: <yw1x39mert0q.fsf@unicorn.mansr.com>
References: <4D827F16.8010608@gmail.com>
	<20110318063253.GD18946@zohar.khirnov.net>
	<4D83145D.5060309@gmail.com> <yw1x39mfwgds.fsf@unicorn.mansr.com>
	<4D889A0D.9010004@gmail.com>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 12:11:20 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2LyB-000521-Gk
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 12:11:19 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 50DF43B0E5;
	Wed, 23 Mar 2011 12:11:19 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 75FEF3B0E5
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 12:11:17 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id 3q--r59P73XB for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 12:11:17 +0100 (CET)
Received: from unicorn.mansr.com (unicorn.mansr.com [78.86.181.103])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 522D73B0E1
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 12:11:17 +0100 (CET)
Received: by unicorn.mansr.com (Postfix, from userid 51770)
	id 28B5717B41; Wed, 23 Mar 2011 11:11:17 +0000 (GMT)
In-Reply-To: <4D889A0D.9010004-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org> (Vladimir Pantelic's message of
	"Tue, 22 Mar 2011 13:46:05 +0100")
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/23.2 (gnu/linux)
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/66>

Vladimir Pantelic <vladoman-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org> writes:

> M=E5ns Rullg=E5rd wrote:
>> Vladimir Pantelic<vladoman-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>  writes:
>
>>>   From 057af717394ec2352d52fa8c1d96f66262da423c Mon Sep 17 00:00:00 2001
>>>  From: Vladimir Pantelic<vladoman-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>
>>>  Date: Thu, 17 Mar 2011 22:34:52 +0100
>>>  Subject: [PATCH] also subtract preroll when reading ASF simple index o=
bject
>>>
>>>  this was missed when ASF was changed to return timestamps
>>>  without preroll.
>>>  ---
>>>   libavformat/asfdec.c |    4 ++--
>>>   1 files changed, 2 insertions(+), 2 deletions(-)
>>>
>>>  diff --git a/libavformat/asfdec.c b/libavformat/asfdec.c
>>>  index 79b3bcb..9f460dd 100644
>>>  --- a/libavformat/asfdec.c
>>>  +++ b/libavformat/asfdec.c
>>>  @@ -1218,10 +1218,10 @@ static void asf_build_simple_index(AVFormatCon=
text *s, int stream_index)
>>>               int pktnum=3Davio_rl32(s->pb);
>>>               int pktct =3Davio_rl16(s->pb);
>>>               int64_t pos      =3D s->data_offset + s->packet_size*(int=
64_t)pktnum;
>>>  -            int64_t index_pts=3D av_rescale(itime, i, 10000);
>>>  +            int64_t index_pts=3D FFMAX(av_rescale(itime, i, 10000) - =
asf->hdr.preroll, 0);
>>
>> Under what circumstances does this become negative without the FFMAX?
>
> the simple index starts at 0, so with a preroll of e.g. 3000ms the 1st
> 4 index entries (0ms, 1000ms, 2000ms, 3000ms) all point to the same
> packet with timestamp 3000ms.
>
> since we subtract the preroll, we need to do that for the index time
> too and thus the 1st entries all map to 0

Is this intentional and correct?  I sounds totally weird to me.

-- =

M=E5ns Rullg=E5rd
mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org


From news@gmane.org Tue Mar 04 03:33:20 2003
From: =?ISO-8859-15?Q?Martin_Storsj=F6?= <martin-TqfNSX0MhmxeoWH0uzbU5w@public.gmane.org>
Subject: Re: [PATCH 2/2] configure: Remove the
 explicit	disabling of ffserver from the mingw section
Date: Wed, 23 Mar 2011 13:11:28 +0200 (EET)
Lines: 52
Message-ID: <alpine.DEB.2.00.1103231311050.3794@cone.home.martin.st>
References: <1300876019-26388-1-git-send-email-martin@martin.st>
	<1300876019-26388-2-git-send-email-martin@martin.st>
	<yw1xbp12rt9b.fsf@unicorn.mansr.com>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: MULTIPART/MIXED;
	BOUNDARY="-1463810048-931269086-1300878688=:3794"
To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 12:11:30 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2LyL-00057k-T8
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 12:11:29 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id ACE173B1A5;
	Wed, 23 Mar 2011 12:11:29 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 827653B1A5
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 12:11:28 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id WqDuD7y+vHuU for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 12:11:28 +0100 (CET)
Received: from kirsi1.inet.fi (mta-out.inet.fi [195.156.147.13])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 5F9B23B0E1
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 12:11:28 +0100 (CET)
Received: from dsl-tkubrasgw1-fe1efa00-177.dhcp.inet.fi (84.250.30.177) by
	kirsi1.inet.fi (8.5.133)
	id 4D072CA704A4157B for libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org;
	Wed, 23 Mar 2011 13:11:28 +0200
X-X-Sender: martin-bySdwzmfsd4wFlGVRAW2/FdQdH8mP9S6@public.gmane.org
In-Reply-To: <yw1xbp12rt9b.fsf-OEaqT8BN2ezZK2NkWkPsZwC/G2K4zDHf@public.gmane.org>
User-Agent: Alpine 2.00 (DEB 1167 2008-08-23)
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/67>

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.

---1463810048-931269086-1300878688=:3794
Content-Type: TEXT/PLAIN; charset=iso-8859-1
Content-Transfer-Encoding: quoted-printable

On Wed, 23 Mar 2011, M=E5ns Rullg=E5rd wrote:

> Martin Storsj=F6 <martin-TqfNSX0MhmxeoWH0uzbU5w@public.gmane.org> writes:
>=20
> > It is automatically disabled due to the lack of fork.
> > ---
> >  configure |    1 -
> >  1 files changed, 0 insertions(+), 1 deletions(-)
> >
> > diff --git a/configure b/configure
> > index 7219083..fdc8408 100755
> > --- a/configure
> > +++ b/configure
> > @@ -2410,7 +2410,6 @@ case $target_os in
> >              LIBTARGET=3Darm-wince
> >          fi
> >          shlibdir_default=3D"$bindir_default"
> > -        disable ffserver
> >          SLIBPREF=3D""
> >          SLIBSUF=3D".dll"
> >          SLIBNAME_WITH_VERSION=3D'$(SLIBPREF)$(FULLNAME)-$(LIBVERSION=
)$(SLIBSUF)'
> > --=20
> > 1.7.3.1
>=20
> OK
>=20
> Can the same change be made for DOS too?

Yes, I missed that one.

// Martin
---1463810048-931269086-1300878688=:3794
Content-Type: text/plain; charset="us-ascii"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
Content-Disposition: inline

_______________________________________________
libav-devel mailing list
libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
https://lists.libav.org/mailman/listinfo/libav-devel

---1463810048-931269086-1300878688=:3794--



From news@gmane.org Tue Mar 04 03:33:20 2003
From: =?UTF-8?q?Martin=20Storsj=C3=B6?= <martin-TqfNSX0MhmxeoWH0uzbU5w@public.gmane.org>
Subject: [PATCH 1/2] configure: Add fork as a dependency to
	ffserver
Date: Wed, 23 Mar 2011 13:13:30 +0200
Lines: 19
Message-ID: <1300878811-27535-1-git-send-email-martin@martin.st>
References: <alpine.DEB.2.00.1103231311050.3794@cone.home.martin.st>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 12:13:36 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2M0N-0006In-I6
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 12:13:35 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 433E63B18E;
	Wed, 23 Mar 2011 12:13:35 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id E37C93B18E
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 12:13:32 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id EeXdksM9I-CN for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 12:13:32 +0100 (CET)
Received: from mail-bw0-f54.google.com (mail-bw0-f54.google.com
	[209.85.214.54])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id C67E83B184
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 12:13:32 +0100 (CET)
Received: by bwz12 with SMTP id 12so10556682bwz.27
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 04:13:32 -0700 (PDT)
Received: by 10.204.181.7 with SMTP id bw7mr707205bkb.16.1300878812095;
	Wed, 23 Mar 2011 04:13:32 -0700 (PDT)
Received: from localhost (bambuser.masterplanet.fi [194.100.86.5])
	by mx.google.com with ESMTPS id t1sm5835343bkx.19.2011.03.23.04.13.31
	(version=TLSv1/SSLv3 cipher=OTHER);
	Wed, 23 Mar 2011 04:13:31 -0700 (PDT)
X-Mailer: git-send-email 1.7.3.1
In-Reply-To: <alpine.DEB.2.00.1103231311050.3794-bySdwzmfsd4wFlGVRAW2/FdQdH8mP9S6@public.gmane.org>
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/68>

---
 configure |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/configure b/configure
index 00aa9ed..f7c9ff7 100755
--- a/configure
+++ b/configure
@@ -1471,7 +1471,7 @@ ffmpeg_select="buffer_filter"
 ffplay_deps="avcodec avformat swscale sdl"
 ffplay_select="rdft"
 ffprobe_deps="avcodec avformat"
-ffserver_deps="avformat ffm_muxer rtp_protocol rtsp_demuxer"
+ffserver_deps="avformat ffm_muxer fork rtp_protocol rtsp_demuxer"
 ffserver_extralibs='$ldl'
 
 doc_deps="texi2html"
-- 
1.7.3.1


From news@gmane.org Tue Mar 04 03:33:20 2003
From: =?UTF-8?q?Martin=20Storsj=C3=B6?= <martin-TqfNSX0MhmxeoWH0uzbU5w@public.gmane.org>
Subject: [PATCH 2/2] configure: Remove the explicit disabling
	of ffserver
Date: Wed, 23 Mar 2011 13:13:31 +0200
Lines: 29
Message-ID: <1300878811-27535-2-git-send-email-martin@martin.st>
References: <alpine.DEB.2.00.1103231311050.3794@cone.home.martin.st>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 12:13:39 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2M0Q-0006KP-RB
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 12:13:38 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 9664E3B1C4;
	Wed, 23 Mar 2011 12:13:38 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 634863B18E
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 12:13:34 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id DZAWtfAKNLaA for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 12:13:34 +0100 (CET)
Received: from mail-fx0-f54.google.com (mail-fx0-f54.google.com
	[209.85.161.54])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 4A5373B184
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 12:13:34 +0100 (CET)
Received: by fxm11 with SMTP id 11so12043121fxm.27
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 04:13:34 -0700 (PDT)
Received: by 10.223.97.196 with SMTP id m4mr962351fan.105.1300878813556;
	Wed, 23 Mar 2011 04:13:33 -0700 (PDT)
Received: from localhost (bambuser.masterplanet.fi [194.100.86.5])
	by mx.google.com with ESMTPS id f15sm2957809fax.10.2011.03.23.04.13.32
	(version=TLSv1/SSLv3 cipher=OTHER);
	Wed, 23 Mar 2011 04:13:33 -0700 (PDT)
X-Mailer: git-send-email 1.7.3.1
In-Reply-To: <alpine.DEB.2.00.1103231311050.3794-bySdwzmfsd4wFlGVRAW2/FdQdH8mP9S6@public.gmane.org>
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/69>

It is automatically disabled on both mingw and dos due to
the lack of fork.
---
 configure |    3 +--
 1 files changed, 1 insertions(+), 2 deletions(-)

diff --git a/configure b/configure
index f7c9ff7..776eccc 100755
--- a/configure
+++ b/configure
@@ -2410,7 +2410,6 @@ case $target_os in
             LIBTARGET=arm-wince
         fi
         shlibdir_default="$bindir_default"
-        disable ffserver
         SLIBPREF=""
         SLIBSUF=".dll"
         SLIBNAME_WITH_VERSION='$(SLIBPREF)$(FULLNAME)-$(LIBVERSION)$(SLIBSUF)'
@@ -2443,7 +2442,7 @@ case $target_os in
         check_cflags -fno-common
         ;;
     *-dos|freedos|opendos)
-        disable ffplay ffserver
+        disable ffplay
         disable $INDEV_LIST $OUTDEV_LIST
         network_extralibs="-lsocket"
         objformat="coff"
-- 
1.7.3.1


From news@gmane.org Tue Mar 04 03:33:20 2003
From: Diego Biurrun <diego-NvuzD6AdJSiELgA04lAiVw@public.gmane.org>
Subject: Re: [PATCH] Use macro __INTEL_COMPILER instead
	of	__ICC.
Date: Wed, 23 Mar 2011 12:17:02 +0100
Lines: 22
Message-ID: <20110323111702.GC30842@pool.informatik.RWTH-Aachen.DE>
References: <1300845942-4218-1-git-send-email-rsbultje@gmail.com>
	<20110323073555.GA30842@pool.informatik.RWTH-Aachen.DE>
	<yw1x1v1ytbku.fsf@unicorn.mansr.com>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 12:17:06 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2M3l-00089x-Jy
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 12:17:05 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 5D80B3B1BF;
	Wed, 23 Mar 2011 12:17:05 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id E58ED3B1BF
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 12:17:02 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id uc0tWVceOy7d for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 12:17:02 +0100 (CET)
Received: from mta-2.ms.rz.rwth-aachen.de (mta-2.ms.rz.RWTH-Aachen.DE
	[134.130.7.73])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id CE0D33B1BC
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 12:17:02 +0100 (CET)
Content-disposition: inline
Received: from ironport-out-1.rz.rwth-aachen.de ([134.130.5.40])
	by mta-2.ms.rz.RWTH-Aachen.de
	(Sun Java(tm) System Messaging Server 6.3-7.04 (built Sep 26 2008))
	with ESMTP id <0LII00D44COECZ20-LyQr6xbdBHgyMoKJnVKI7zLO/+Hfi/qahC4ANOJQIlc@public.gmane.org> for
	libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org; Wed, 23 Mar 2011 12:17:02 +0100 (CET)
X-IronPort-AV: E=Sophos;i="4.63,230,1299452400";   d="scan'208";a="101954289"
Received: from smarthost-2.ms.rz.rwth-aachen.de (HELO smarthost.rwth-aachen.de)
	([134.130.7.90]) by ironport-in-1.rz.rwth-aachen.de with ESMTP; Wed,
	23 Mar 2011 12:17:02 +0100
Received: from hutch.Informatik.RWTH-Aachen.DE
	(hutch.informatik.RWTH-Aachen.DE [137.226.116.30])	by
	smarthost.rwth-aachen.de
	(8.14.4+Sun/8.13.8/1) with ESMTP id p2NBH21U002997	for
	<libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 12:17:02 +0100 (CET)
Received: from diego by hutch.Informatik.RWTH-Aachen.DE with local (Exim 4.69)
	(envelope-from <diego-C+EoYKesnrCVdxy9aTz+TbwNW4aj8/RQWV23jfQ1LcY@public.gmane.org>)
	id 1Q2M3i-00005A-Kc	for libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org;
	Wed, 23 Mar 2011 12:17:02 +0100
In-reply-to: <yw1x1v1ytbku.fsf-OEaqT8BN2ezZK2NkWkPsZwC/G2K4zDHf@public.gmane.org>
User-Agent: Mutt/1.5.18 (2008-05-17)
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/70>

On Wed, Mar 23, 2011 at 09:45:05AM +0000, M=E5ns Rullg=E5rd wrote:
> Diego Biurrun <diego-NvuzD6AdJSiELgA04lAiVw@public.gmane.org> writes:
> =

> > On Tue, Mar 22, 2011 at 10:05:42PM -0400, Ronald S. Bultje wrote:
> >> From: Carl Eugen Hoyos <cehoyos-iVVjmtzCFAg@public.gmane.org>
> >> =

> >> __ICC is not supported on all platforms, this is an Intel documentation
> >> bug that is supposed to be fixed in a future release.
> >> (Intel issue 612289)
> >
> > OK
> =

> No, it's not  OK.

Why not?  I was planning to implement something like
AV_ICC_ATLEAST later today, but until then this is an
independent change that can go in already...

Diego


From news@gmane.org Tue Mar 04 03:33:20 2003
From: "Ronald S. Bultje" <rsbultje-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>
Subject: Re: [PATCH] rtsp: Don't use a locale dependent format
	string
Date: Wed, 23 Mar 2011 07:18:42 -0400
Lines: 12
Message-ID: <AANLkTikAAE2nxCOnRYhEFdjBKDhJnWcWR=sSLLZKV80O@mail.gmail.com>
References: <1300868782-57340-1-git-send-email-martin@martin.st>
	<4D89BF1D.70905@gentoo.org>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 12:18:52 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2M5P-0000pM-4X
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 12:18:47 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id E7BF03B1C7;
	Wed, 23 Mar 2011 12:18:46 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 90E0B3B1C7
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 12:18:43 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id Zbk7Dhr78OHN for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 12:18:43 +0100 (CET)
Received: from mail-iy0-f182.google.com (mail-iy0-f182.google.com
	[209.85.210.182])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 338FD3B1C6
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 12:18:43 +0100 (CET)
Received: by iyj12 with SMTP id 12so13774672iyj.27
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 04:18:42 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=gamma;
	h=domainkey-signature:mime-version:in-reply-to:references:date
	:message-id:subject:from:to:cc:content-type
	:content-transfer-encoding;
	bh=tU2JG5CFNLzVrClAHYNHLAmjGYZ4N6YZYIAbETQGPck=;
	b=RL9liQK7GwMWl/nAyMrFFU1YvwouJdbWhjbTC/GTNsVNz3YmM5k8fBsdlVNqHhr5rp
	Bn/BVgLoUOx09El3/CA5kfPhfLPn9AaYvCv0L7aUzrWgq+1ynmjY82mYiy1JAkXrEYj5
	gtv9kV/phdm38UdM5femHxz1MkBWL5csl6I2w=
DomainKey-Signature: a=rsa-sha1; c=nofws; d=gmail.com; s=gamma;
	h=mime-version:in-reply-to:references:date:message-id:subject:from:to
	:cc:content-type:content-transfer-encoding;
	b=BlrcnG4K/Dc7WGSAs/7JOBhivH6dpcA7z/lU9lvlEqsQuI97dTbS1bK9331HbP/f9E
	JgAKjMFGw7QggjIsTE1JTEbgPflmXq2QiioBY0ukXfmWkSbCisr9PQky18LlUHWj27Uk
	VhL7L4FnOEdU+4st/uzeJ+HVawLznUVFCWp00=
Received: by 10.42.174.131 with SMTP id v3mr3967985icz.21.1300879122026; Wed,
	23 Mar 2011 04:18:42 -0700 (PDT)
Received: by 10.42.75.133 with HTTP; Wed, 23 Mar 2011 04:18:42 -0700 (PDT)
In-Reply-To: <4D89BF1D.70905-aBrp7R+bbdUdnm+yROfE0A@public.gmane.org>
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/71>

Hi,

On Wed, Mar 23, 2011 at 5:36 AM, Luca Barbato <lu_zero-aBrp7R+bbdUdnm+yROfE0A@public.gmane.org> wrote:
> On 03/23/2011 09:26 AM, Martin Storsj=F6 wrote:
>> In this particular case, we aren't ever printing anything else than
>> 0.000 anyway.
>
> Patch ok =3D)

Queued.

Ronald


From news@gmane.org Tue Mar 04 03:33:20 2003
From: =?iso-8859-1?Q?M=E5ns_Rullg=E5rd?= <mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org>
Subject: Re: [PATCH 1/2] configure: Add fork as a dependency
	to ffserver
Date: Wed, 23 Mar 2011 11:19:51 +0000
Lines: 30
Message-ID: <yw1xy646qe20.fsf@unicorn.mansr.com>
References: <alpine.DEB.2.00.1103231311050.3794@cone.home.martin.st>
	<1300878811-27535-1-git-send-email-martin@martin.st>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 12:19:53 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2M6T-0001ax-Hi
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 12:19:53 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 56BA53B1CA;
	Wed, 23 Mar 2011 12:19:53 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id A8F8D3B1CA
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 12:19:51 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id VXAV8ovGrs+p for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 12:19:51 +0100 (CET)
Received: from unicorn.mansr.com (unicorn.mansr.com [78.86.181.103])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 89C173B1C8
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 12:19:51 +0100 (CET)
Received: by unicorn.mansr.com (Postfix, from userid 51770)
	id 5D86817B41; Wed, 23 Mar 2011 11:19:51 +0000 (GMT)
In-Reply-To: <1300878811-27535-1-git-send-email-martin-TqfNSX0MhmxeoWH0uzbU5w@public.gmane.org> ("Martin
	=?iso-8859-1?Q?Storsj=F6=22's?= message of "Wed, 23 Mar 2011 13:13:30
	+0200")
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/23.2 (gnu/linux)
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/72>

Martin Storsj=F6 <martin-TqfNSX0MhmxeoWH0uzbU5w@public.gmane.org> writes:

> ---
>  configure |    2 +-
>  1 files changed, 1 insertions(+), 1 deletions(-)
>
> diff --git a/configure b/configure
> index 00aa9ed..f7c9ff7 100755
> --- a/configure
> +++ b/configure
> @@ -1471,7 +1471,7 @@ ffmpeg_select=3D"buffer_filter"
>  ffplay_deps=3D"avcodec avformat swscale sdl"
>  ffplay_select=3D"rdft"
>  ffprobe_deps=3D"avcodec avformat"
> -ffserver_deps=3D"avformat ffm_muxer rtp_protocol rtsp_demuxer"
> +ffserver_deps=3D"avformat ffm_muxer fork rtp_protocol rtsp_demuxer"
>  ffserver_extralibs=3D'$ldl'
>  =

>  doc_deps=3D"texi2html"
> -- =

> 1.7.3.1

OK

-- =

M=E5ns Rullg=E5rd
mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org


From news@gmane.org Tue Mar 04 03:33:20 2003
From: =?iso-8859-1?Q?M=E5ns_Rullg=E5rd?= <mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org>
Subject: Re: [PATCH 2/2] configure: Remove the explicit
	disabling of ffserver
Date: Wed, 23 Mar 2011 11:20:03 +0000
Lines: 40
Message-ID: <yw1xtyeuqe1o.fsf@unicorn.mansr.com>
References: <alpine.DEB.2.00.1103231311050.3794@cone.home.martin.st>
	<1300878811-27535-2-git-send-email-martin@martin.st>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 12:20:05 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2M6e-0001ik-Rz
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 12:20:04 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id A84763B165;
	Wed, 23 Mar 2011 12:20:04 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 519463B02D
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 12:20:03 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id 7Z-X8R2M9PYh for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 12:20:03 +0100 (CET)
Received: from unicorn.mansr.com (unicorn.mansr.com [78.86.181.103])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 2E3D43B1C8
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 12:20:03 +0100 (CET)
Received: by unicorn.mansr.com (Postfix, from userid 51770)
	id 07B814B38; Wed, 23 Mar 2011 11:20:03 +0000 (GMT)
In-Reply-To: <1300878811-27535-2-git-send-email-martin-TqfNSX0MhmxeoWH0uzbU5w@public.gmane.org> ("Martin
	=?iso-8859-1?Q?Storsj=F6=22's?= message of "Wed, 23 Mar 2011 13:13:31
	+0200")
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/23.2 (gnu/linux)
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/73>

Martin Storsj=F6 <martin-TqfNSX0MhmxeoWH0uzbU5w@public.gmane.org> writes:

> It is automatically disabled on both mingw and dos due to
> the lack of fork.
> ---
>  configure |    3 +--
>  1 files changed, 1 insertions(+), 2 deletions(-)
>
> diff --git a/configure b/configure
> index f7c9ff7..776eccc 100755
> --- a/configure
> +++ b/configure
> @@ -2410,7 +2410,6 @@ case $target_os in
>              LIBTARGET=3Darm-wince
>          fi
>          shlibdir_default=3D"$bindir_default"
> -        disable ffserver
>          SLIBPREF=3D""
>          SLIBSUF=3D".dll"
>          SLIBNAME_WITH_VERSION=3D'$(SLIBPREF)$(FULLNAME)-$(LIBVERSION)$(S=
LIBSUF)'
> @@ -2443,7 +2442,7 @@ case $target_os in
>          check_cflags -fno-common
>          ;;
>      *-dos|freedos|opendos)
> -        disable ffplay ffserver
> +        disable ffplay
>          disable $INDEV_LIST $OUTDEV_LIST
>          network_extralibs=3D"-lsocket"
>          objformat=3D"coff"
> -- =

> 1.7.3.1

OK

-- =

M=E5ns Rullg=E5rd
mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org


From news@gmane.org Tue Mar 04 03:33:20 2003
From: =?iso-8859-1?Q?M=E5ns_Rullg=E5rd?= <mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org>
Subject: Re: [PATCH] Use macro __INTEL_COMPILER instead
	of	__ICC.
Date: Wed, 23 Mar 2011 11:20:23 +0000
Lines: 30
Message-ID: <yw1xpqpiqe14.fsf@unicorn.mansr.com>
References: <1300845942-4218-1-git-send-email-rsbultje@gmail.com>
	<20110323073555.GA30842@pool.informatik.RWTH-Aachen.DE>
	<yw1x1v1ytbku.fsf@unicorn.mansr.com>
	<20110323111702.GC30842@pool.informatik.RWTH-Aachen.DE>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 12:20:26 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2M70-0001w8-2F
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 12:20:26 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id D6D6B3B16C;
	Wed, 23 Mar 2011 12:20:25 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id EAF003B16C
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 12:20:23 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id ZvMxaZcZtjMj for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 12:20:23 +0100 (CET)
Received: from unicorn.mansr.com (unicorn.mansr.com [78.86.181.103])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id C9A723B16B
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 12:20:23 +0100 (CET)
Received: by unicorn.mansr.com (Postfix, from userid 51770)
	id A203617B41; Wed, 23 Mar 2011 11:20:23 +0000 (GMT)
In-Reply-To: <20110323111702.GC30842-C+EoYKesnrCVdxy9aTz+TbLZb8cQPPy3S7qENs8ugTg@public.gmane.org> (Diego
	Biurrun's message of "Wed, 23 Mar 2011 12:17:02 +0100")
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/23.2 (gnu/linux)
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/74>

Diego Biurrun <diego-NvuzD6AdJSiELgA04lAiVw@public.gmane.org> writes:

> On Wed, Mar 23, 2011 at 09:45:05AM +0000, M=E5ns Rullg=E5rd wrote:
>> Diego Biurrun <diego-NvuzD6AdJSiELgA04lAiVw@public.gmane.org> writes:
>> =

>> > On Tue, Mar 22, 2011 at 10:05:42PM -0400, Ronald S. Bultje wrote:
>> >> From: Carl Eugen Hoyos <cehoyos-iVVjmtzCFAg@public.gmane.org>
>> >> =

>> >> __ICC is not supported on all platforms, this is an Intel documentati=
on
>> >> bug that is supposed to be fixed in a future release.
>> >> (Intel issue 612289)
>> >
>> > OK
>> =

>> No, it's not  OK.
>
> Why not?  I was planning to implement something like
> AV_ICC_ATLEAST later today, but until then this is an
> independent change that can go in already...

See my other mail.

-- =

M=E5ns Rullg=E5rd
mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org


From news@gmane.org Tue Mar 04 03:33:20 2003
From: "Ronald S. Bultje" <rsbultje-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>
Subject: Re: [PATCH] Add xd55 codec tag for XDCAM HD422 720p25
 CBR files.
Date: Wed, 23 Mar 2011 07:34:39 -0400
Lines: 11
Message-ID: <AANLkTinQCtDtq6dgha4V9rgwMwUJMoyd3-3e+8tv7hTj@mail.gmail.com>
References: <1300846283-6336-1-git-send-email-rsbultje@gmail.com>
	<20110323073629.GB30842@pool.informatik.RWTH-Aachen.DE>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 12:34:44 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2MKo-0001mv-Em
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 12:34:42 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 3158E3B1AB;
	Wed, 23 Mar 2011 12:34:42 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id AAD723B1AB
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 12:34:40 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id iAIzXP2Pm8-d for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 12:34:40 +0100 (CET)
Received: from mail-iy0-f182.google.com (mail-iy0-f182.google.com
	[209.85.210.182])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 50DD93B1A9
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 12:34:40 +0100 (CET)
Received: by iyj12 with SMTP id 12so13798073iyj.27
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 04:34:39 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=gamma;
	h=domainkey-signature:mime-version:in-reply-to:references:date
	:message-id:subject:from:to:cc:content-type
	:content-transfer-encoding;
	bh=qRorJgNE4emUQZrHj9Wvb1diqcC5yMh7FgWRrDQdnnU=;
	b=F+ZtmdF0wvsUdGBFfwBtT26LCC+Sxc8eBkEgCUUGPxbUzrZXx6QYZi1eHu2QJhZUQe
	bNsjLaH/qn6KjhqaRMMEXwPSbkWbx/0EGY2KATg6E0sZe0Hfo5P2CKdU2pUkmgqB8FD0
	zwLNqpW2hxQLfsJCXdNiLJ7rnKCdqgRhWOEGk=
DomainKey-Signature: a=rsa-sha1; c=nofws; d=gmail.com; s=gamma;
	h=mime-version:in-reply-to:references:date:message-id:subject:from:to
	:cc:content-type:content-transfer-encoding;
	b=GrkQgBEoFa7gcK5GcE+X1oyBuSqd71BvnbFTdkPr0NUKRF3Qag+y001BfG3jw5u1yd
	FUXnNx33T6oHF6h2yNvNYakYWfkhCFjmy4O9fUAnk9yoTdAuo76YNkaR/yDz3+rwGJSv
	jP0JZH6f/fFqP17w5HNiqT7Vq0kJJ1+NG990k=
Received: by 10.43.65.146 with SMTP id xm18mr1484011icb.356.1300880079552;
	Wed, 23 Mar 2011 04:34:39 -0700 (PDT)
Received: by 10.42.75.133 with HTTP; Wed, 23 Mar 2011 04:34:39 -0700 (PDT)
In-Reply-To: <20110323073629.GB30842-C+EoYKesnrCVdxy9aTz+TbLZb8cQPPy3S7qENs8ugTg@public.gmane.org>
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/75>

Hi,

On Wed, Mar 23, 2011 at 3:36 AM, Diego Biurrun <diego-NvuzD6AdJSiELgA04lAiVw@public.gmane.org> wrote:
> On Tue, Mar 22, 2011 at 10:11:23PM -0400, Ronald S. Bultje wrote:
>> From: Tomas H=E4rdin <tomas.hardin-hMd8BBQ7QCYwFerOooGFRg@public.gmane.org>
>
> OK

Queued.

Ronald


From news@gmane.org Tue Mar 04 03:33:20 2003
From: Vladimir Pantelic <vladoman-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>
Subject: Re: [PATCH] also subtract preroll when reading ASF
 simple index object
Date: Wed, 23 Mar 2011 12:36:10 +0100
Lines: 87
Message-ID: <4D89DB2A.8040707@gmail.com>
References: <4D827F16.8010608@gmail.com>
	<20110318063253.GD18946@zohar.khirnov.net>
	<4D83145D.5060309@gmail.com> <yw1x39mfwgds.fsf@unicorn.mansr.com>
	<4D889A0D.9010004@gmail.com> <yw1x39mert0q.fsf@unicorn.mansr.com>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="iso-8859-1"; Format="flowed"
Content-Transfer-Encoding: quoted-printable
To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 12:36:17 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2MMK-0002dO-02
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 12:36:16 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id C95713B1AE;
	Wed, 23 Mar 2011 12:36:15 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 0566E3B1AE
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 12:36:14 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id 5LOV2aKnkwhP for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 12:36:13 +0100 (CET)
Received: from mail-fx0-f54.google.com (mail-fx0-f54.google.com
	[209.85.161.54])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id DD7A23B1AC
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 12:36:13 +0100 (CET)
Received: by fxm11 with SMTP id 11so12071286fxm.27
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 04:36:13 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=gamma;
	h=domainkey-signature:message-id:date:from:user-agent:mime-version:to
	:subject:references:in-reply-to:content-type
	:content-transfer-encoding;
	bh=fF65dtj8LzNPgyCalx501Mivqc0ZD2Tp7j3yI7m/rcA=;
	b=CI7SHidWaHeXZgoZqy8bHSHVUMQTkr8J8TTRwrclwfOTMM9QIlpz/jdH5UCMEax5Fl
	S7IppAz1/aee8SuC7Ovd8LdzV0FiNO0HKdJ2Rg+5WslSij4QBsMZhIGtINHuzTdcp73j
	SeFfgjJC8rHIWq8t/zohxIrF8MOgxRYrO/mQw=
DomainKey-Signature: a=rsa-sha1; c=nofws; d=gmail.com; s=gamma;
	h=message-id:date:from:user-agent:mime-version:to:subject:references
	:in-reply-to:content-type:content-transfer-encoding;
	b=fdw/GFt91MhGIczzp4wVcHAFpfA36eBYlUf7/gCakhJZ4RFTvrcdX8u4VBgnGGd8Vn
	CP3uxVsLrcQgsK80DckIfboOo1u/0jaPywcQX7U4hNL7edlfjUWDweNvnTA6qNNlBMJc
	YbILFAuHjn//Jcm8aigZXX5yIFYPr+7gGkPSE=
Received: by 10.223.102.80 with SMTP id f16mr8037465fao.33.1300880173151;
	Wed, 23 Mar 2011 04:36:13 -0700 (PDT)
Received: from [192.168.1.22] (p50996ded.dip0.t-ipconnect.de [80.153.109.237])
	by mx.google.com with ESMTPS id l4sm1815672fan.38.2011.03.23.04.36.11
	(version=SSLv3 cipher=OTHER); Wed, 23 Mar 2011 04:36:11 -0700 (PDT)
User-Agent: Mozilla/5.0 (X11; Linux i686;
	rv:2.0b7pre) Gecko/20101008 Firefox/4.0b7pre SeaMonkey/2.1b1
In-Reply-To: <yw1x39mert0q.fsf-OEaqT8BN2ezZK2NkWkPsZwC/G2K4zDHf@public.gmane.org>
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/76>

M=E5ns Rullg=E5rd wrote:
> Vladimir Pantelic<vladoman-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>  writes:
>
>>  M=E5ns Rullg=E5rd wrote:
>>>  Vladimir Pantelic<vladoman-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>   writes:
>>
>>>>     From 057af717394ec2352d52fa8c1d96f66262da423c Mon Sep 17 00:00:00 =
2001
>>>>   From: Vladimir Pantelic<vladoman-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>
>>>>   Date: Thu, 17 Mar 2011 22:34:52 +0100
>>>>   Subject: [PATCH] also subtract preroll when reading ASF simple index=
 object
>>>>
>>>>   this was missed when ASF was changed to return timestamps
>>>>   without preroll.
>>>>   ---
>>>>    libavformat/asfdec.c |    4 ++--
>>>>    1 files changed, 2 insertions(+), 2 deletions(-)
>>>>
>>>>   diff --git a/libavformat/asfdec.c b/libavformat/asfdec.c
>>>>   index 79b3bcb..9f460dd 100644
>>>>   --- a/libavformat/asfdec.c
>>>>   +++ b/libavformat/asfdec.c
>>>>   @@ -1218,10 +1218,10 @@ static void asf_build_simple_index(AVFormatC=
ontext *s, int stream_index)
>>>>                int pktnum=3Davio_rl32(s->pb);
>>>>                int pktct =3Davio_rl16(s->pb);
>>>>                int64_t pos      =3D s->data_offset + s->packet_size*(i=
nt64_t)pktnum;
>>>>   -            int64_t index_pts=3D av_rescale(itime, i, 10000);
>>>>   +            int64_t index_pts=3D FFMAX(av_rescale(itime, i, 10000) =
- asf->hdr.preroll, 0);
>>>
>>>  Under what circumstances does this become negative without the FFMAX?
>>
>>  the simple index starts at 0, so with a preroll of e.g. 3000ms the 1st
>>  4 index entries (0ms, 1000ms, 2000ms, 3000ms) all point to the same
>>  packet with timestamp 3000ms.
>>
>>  since we subtract the preroll, we need to do that for the index time
>>  too and thus the 1st entries all map to 0
>
> Is this intentional and correct?  I sounds totally weird to me.
>

file: asf_with_chapters.wmv (muxed using M$ tools)

index with old behaviour:

[asf @ 0x8c3d6d0] pktnum:0, pktct:2  pts: 0
[asf @ 0x8c3d6d0] pktnum:0, pktct:2  pts: 1000
[asf @ 0x8c3d6d0] pktnum:0, pktct:2  pts: 2000
[asf @ 0x8c3d6d0] pktnum:0, pktct:2  pts: 3000
[asf @ 0x8c3d6d0] pktnum:1, pktct:5  pts: 4000
[asf @ 0x8c3d6d0] pktnum:1, pktct:5  pts: 5000
[asf @ 0x8c3d6d0] pktnum:122, pktct:5  pts: 6000
[asf @ 0x8c3d6d0] pktnum:122, pktct:5  pts: 7000
[asf @ 0x8c3d6d0] pktnum:257, pktct:6  pts: 8000
[asf @ 0x8c3d6d0] pktnum:257, pktct:6  pts: 9000
...
...

The 1st 4 index entries all point to the same packet
and thus to the same 1st key frame (at 3000ms)

since they all point to the same packet/position,
3 of them are suppressed due to:

     if(pos !=3D last_pos){
         ...
     }


new behaviour:

[asf @ 0x8c3d6d0] pktnum:0, pktct:2  pts: 0
     Last message repeated 3 times
[asf @ 0x8c3d6d0] pktnum:1, pktct:5  pts: 1000
[asf @ 0x8c3d6d0] pktnum:1, pktct:5  pts: 2000
[asf @ 0x8c3d6d0] pktnum:122, pktct:5  pts: 3000
[asf @ 0x8c3d6d0] pktnum:122, pktct:5  pts: 4000
[asf @ 0x8c3d6d0] pktnum:257, pktct:6  pts: 5000
[asf @ 0x8c3d6d0] pktnum:257, pktct:6  pts: 6000
...
...

again, 3 are suppressed.


From news@gmane.org Tue Mar 04 03:33:20 2003
From: Mans Rullgard <mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org>
Subject: [PATCH 1/2] Disable 'attribute "foo" ignored'
	warnings from icc
Date: Wed, 23 Mar 2011 11:36:26 +0000
Lines: 28
Message-ID: <1300880187-23154-1-git-send-email-mans@mansr.com>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 12:36:31 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2MMZ-0002lp-7n
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 12:36:31 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 0C80F3B1B5;
	Wed, 23 Mar 2011 12:36:31 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 6303D3B1B8
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 12:36:29 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id PiH-cG8bRDu5 for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 12:36:29 +0100 (CET)
Received: from unicorn.mansr.com (unicorn.mansr.com [78.86.181.103])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 39D293B1AC
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 12:36:29 +0100 (CET)
Received: by unicorn.mansr.com (Postfix, from userid 51770)
	id 0767017B41; Wed, 23 Mar 2011 11:36:29 +0000 (GMT)
X-Mailer: git-send-email 1.7.4.1
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/77>

ICC lies about the version of gcc it emulates, which results
in unsupported attributes sometimes being used.  The warning
is an annoyance and should be disabled.

Signed-off-by: Mans Rullgard <mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org>
---
 configure |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

diff --git a/configure b/configure
index 43dcaac..e4da675 100755
--- a/configure
+++ b/configure
@@ -2988,10 +2988,11 @@ if enabled icc; then
     check_cflags -w1
     # -wd: Disable following warnings
     # 144, 167, 556: -Wno-pointer-sign
+    # 1292: attribute "foo" ignored
     # 10006: ignoring unknown option -fno-signed-zeros
     # 10148: ignoring unknown option -Wno-parentheses
     # 10156: ignoring option '-W'; no argument required
-    check_cflags -wd144,167,556,10006,10148,10156
+    check_cflags -wd144,167,556,1292,10006,10148,10156
     # 11030: Warning unknown option --as-needed
     # 10156: ignoring option '-export'; no argument required
     check_ldflags -wd10156,11030
-- 
1.7.4.1


From news@gmane.org Tue Mar 04 03:33:20 2003
From: Mans Rullgard <mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org>
Subject: [PATCH 2/2] Remove unnecessary ICC version checks
Date: Wed, 23 Mar 2011 11:36:27 +0000
Lines: 70
Message-ID: <1300880187-23154-2-git-send-email-mans@mansr.com>
References: <1300880187-23154-1-git-send-email-mans@mansr.com>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 12:36:33 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2MMZ-0002lr-Jn
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 12:36:31 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 5DFBE3B1BE;
	Wed, 23 Mar 2011 12:36:31 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 69CDB3B1B9
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 12:36:29 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id NvlfDxQp8een for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 12:36:29 +0100 (CET)
Received: from unicorn.mansr.com (unicorn.mansr.com [78.86.181.103])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 3BAAE3B1B5
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 12:36:29 +0100 (CET)
Received: by unicorn.mansr.com (Postfix, from userid 51770)
	id 08DAE17B47; Wed, 23 Mar 2011 11:36:29 +0000 (GMT)
X-Mailer: git-send-email 1.7.4.1
In-Reply-To: <1300880187-23154-1-git-send-email-mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org>
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/78>

With unknown attribute warnings disabled, these checks are no
longer needed.  Removing them improves readability while having
no effect on generated code.

Signed-off-by: Mans Rullgard <mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org>
---
 libavutil/attributes.h |    6 +++---
 libavutil/internal.h   |    2 +-
 libavutil/mem.h        |    2 +-
 3 files changed, 5 insertions(+), 5 deletions(-)

diff --git a/libavutil/attributes.h b/libavutil/attributes.h
index 4ee0dde..4abe78f 100644
--- a/libavutil/attributes.h
+++ b/libavutil/attributes.h
@@ -65,7 +65,7 @@
 #endif
 
 #ifndef av_cold
-#if (!defined(__ICC) || __ICC > 1110) && AV_GCC_VERSION_AT_LEAST(4,3)
+#if AV_GCC_VERSION_AT_LEAST(4,3)
 #    define av_cold __attribute__((cold))
 #else
 #    define av_cold
@@ -73,7 +73,7 @@
 #endif
 
 #ifndef av_flatten
-#if (!defined(__ICC) || __ICC > 1110) && AV_GCC_VERSION_AT_LEAST(4,1)
+#if AV_GCC_VERSION_AT_LEAST(4,1)
 #    define av_flatten __attribute__((flatten))
 #else
 #    define av_flatten
@@ -110,7 +110,7 @@
 #endif
 
 #ifndef av_alias
-#if (!defined(__ICC) || __ICC > 1200) && AV_GCC_VERSION_AT_LEAST(3,3)
+#if AV_GCC_VERSION_AT_LEAST(3,3)
 #   define av_alias __attribute__((may_alias))
 #else
 #   define av_alias
diff --git a/libavutil/internal.h b/libavutil/internal.h
index ac2ad17..37bc681 100644
--- a/libavutil/internal.h
+++ b/libavutil/internal.h
@@ -39,7 +39,7 @@
 #include "timer.h"
 
 #ifndef attribute_align_arg
-#if ARCH_X86_32 && (!defined(__ICC) || __ICC > 1200) && AV_GCC_VERSION_AT_LEAST(4,2)
+#if ARCH_X86_32 && AV_GCC_VERSION_AT_LEAST(4,2)
 #    define attribute_align_arg __attribute__((force_align_arg_pointer))
 #else
 #    define attribute_align_arg
diff --git a/libavutil/mem.h b/libavutil/mem.h
index da8ad89..f52777b 100644
--- a/libavutil/mem.h
+++ b/libavutil/mem.h
@@ -56,7 +56,7 @@
     #define av_malloc_attrib
 #endif
 
-#if (!defined(__ICC) || __ICC > 1200) && AV_GCC_VERSION_AT_LEAST(4,3)
+#if AV_GCC_VERSION_AT_LEAST(4,3)
     #define av_alloc_size(n) __attribute__((alloc_size(n)))
 #else
     #define av_alloc_size(n)
-- 
1.7.4.1


From news@gmane.org Tue Mar 04 03:33:20 2003
From: Diego Biurrun <diego-NvuzD6AdJSiELgA04lAiVw@public.gmane.org>
Subject: Re: [PATCH] Add support for sndio to libavdevice
Date: Wed, 23 Mar 2011 12:48:23 +0100
Lines: 127
Message-ID: <20110323114823.GD30842@pool.informatik.RWTH-Aachen.DE>
References: <20110321021443.GA10122@rox.home.comstyle.com>
	<20110321082030.0dfa2883@bfouet-dev1.eng.vmware.com>
	<20110322011328.GA15626@rox.home.comstyle.com>
	<AANLkTin_guqntW2=D=qODfi8D8VeoPA0rzcgdEq80m8g@mail.gmail.com>
	<20110322020934.GA8887@rox.home.comstyle.com> <4D885571.60304@free.fr>
	<20110323002443.GA3649@rox.home.comstyle.com>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 12:48:30 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2MY6-0001h5-JU
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 12:48:26 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 119D13C098;
	Wed, 23 Mar 2011 12:48:26 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 7B46E3C098
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 12:48:24 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id 9aDupD9Eogji for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 12:48:24 +0100 (CET)
Received: from mta-1.ms.rz.rwth-aachen.de (mta-1.ms.rz.RWTH-Aachen.DE
	[134.130.7.72])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 62B773C097
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 12:48:24 +0100 (CET)
Content-disposition: inline
Received: from ironport-out-1.rz.rwth-aachen.de ([134.130.5.40])
	by mta-1.ms.rz.RWTH-Aachen.de
	(Sun Java(tm) System Messaging Server 6.3-7.04 (built Sep 26 2008))
	with ESMTP id <0LII00DFCE4OGX30-VQAYY6A2+UYyMoKJnVKI7zLO/+Hfi/qahC4ANOJQIlc@public.gmane.org> for
	libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org; Wed, 23 Mar 2011 12:48:24 +0100 (CET)
X-IronPort-AV: E=Sophos;i="4.63,230,1299452400";   d="scan'208";a="101961155"
Received: from smarthost-2.ms.rz.rwth-aachen.de (HELO smarthost.rwth-aachen.de)
	([134.130.7.90]) by ironport-in-1.rz.rwth-aachen.de with ESMTP; Wed,
	23 Mar 2011 12:48:24 +0100
Received: from hutch.Informatik.RWTH-Aachen.DE
	(hutch.informatik.RWTH-Aachen.DE [137.226.116.30])	by
	smarthost.rwth-aachen.de
	(8.14.4+Sun/8.13.8/1) with ESMTP id p2NBmNlE009986	for
	<libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 12:48:23 +0100 (CET)
Received: from diego by hutch.Informatik.RWTH-Aachen.DE with local (Exim 4.69)
	(envelope-from <diego-C+EoYKesnrCVdxy9aTz+TbwNW4aj8/RQWV23jfQ1LcY@public.gmane.org>)
	id 1Q2MY3-0000Iz-S8	for libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org;
	Wed, 23 Mar 2011 12:48:23 +0100
In-reply-to: <20110323002443.GA3649-0NxWWC0wc7DURyjtZ1b4R2Xnswh1EIUO@public.gmane.org>
User-Agent: Mutt/1.5.18 (2008-05-17)
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/79>

On Tue, Mar 22, 2011 at 08:24:44PM -0400, Brad wrote:
> On Tue, Mar 22, 2011 at 08:53:21AM +0100, Benoit Fouet wrote:
> > The usage is wrong, it should be av_freep(&s->buffer)
> > No other remarks from me.
> 
> Updated diff.
> 
> 
> --- a/configure
> +++ b/configure
> @@ -1096,6 +1096,7 @@ HAVE_LIST="
>      soundcard_h
> +    sndio_h
>      poll_h

alphabetical order

> @@ -1433,6 +1434,8 @@ jack_indev_deps="jack_jack_h"
>  oss_outdev_deps_any="soundcard_h sys_soundcard_h"
> +sndio_indev_deps="sndio_h"
> +sndio_outdev_deps="sndio_h"
>  v4l_indev_deps="linux_videodev_h"

alphabetical order

> --- /dev/null
> +++ b/libavdevice/sndio_common.c
> @@ -0,0 +1,114 @@
> +
> +#include <sndio.h>
> +#include "libavformat/avformat.h"
> +
> +#include "sndio_common.h"

Please leave an empty line between system and local #includes.

> +static void movecb(void *addr, int delta)
> +{
> +    AudioData *s = addr;
> +
> +    s->hwpos += delta * s->channels * s->bps;
> +}

inline?

This is only used once...

> --- /dev/null
> +++ b/libavdevice/sndio_common.h
> @@ -0,0 +1,45 @@
> +
> +#ifndef AVDEVICE_SNDIO_COMMON_H
> +#define AVDEVICE_SNDIO_COMMON_H
> +
> +#include <sndio.h>
> +#include "config.h"
> +#include "libavformat/avformat.h"

same comment as above

> +typedef struct {
> +    struct sio_hdl *hdl;
> +    int sample_rate;
> +    int channels;
> +    int bps;
> +    enum CodecID codec_id;
> +    int buffer_size;
> +    uint8_t *buffer;
> +    int buffer_offset;
> +    long long hwpos;
> +    long long softpos;
> +} AudioData;

You should also #include stdint.h, you use uint8_t.

> +int ff_sndio_open(AVFormatContext *, int, const char *);
> +int ff_sndio_close(AudioData *);

Please add the parameter names to the declaration, they provide useful
information.

> --- /dev/null
> +++ b/libavdevice/sndio_dec.c
> @@ -0,0 +1,106 @@
> +
> +#include <sndio.h>
> +#include "libavformat/avformat.h"
> +
> +#include "sndio_common.h"

see above

> --- /dev/null
> +++ b/libavdevice/sndio_enc.c
> @@ -0,0 +1,95 @@
> +
> +#include <sndio.h>
> +#include "libavformat/avformat.h"
> +
> +#include "sndio_common.h"

See my comment about #includes above.

> +static av_cold int audio_write_header(AVFormatContext *s1)
> +{
> +    AudioData *s = s1->priv_data;
> +    while (size > 0) {
> +        len = s->buffer_size - s->buffer_offset;
> +        if (len > size)
> +            len = size;
> +        memcpy(s->buffer + s->buffer_offset, buf, len);
> +        buf += len;
> +        size -= len;

nit: align the '='

> +        s->buffer_offset += len;
> +        if (s->buffer_offset >= s->buffer_size) {
> +            ret = sio_write(s->hdl, s->buffer, s->buffer_size);
> +            if (ret == 0 || sio_eof(s->hdl))
> +                return AVERROR(EIO);
> +            s->softpos += ret;
> +            s->buffer_offset = 0;

ditto

Diego


From news@gmane.org Tue Mar 04 03:33:20 2003
From: Anton Khirnov <anton-5jV5EzyPuF3R7s880joybQ@public.gmane.org>
Subject: [PATCH] avio: cosmetics - nicer vertical alignment.
Date: Wed, 23 Mar 2011 12:58:02 +0100
Lines: 33
Message-ID: <1300881482-9701-1-git-send-email-anton@khirnov.net>
References: <yw1xhbavun7f.fsf@unicorn.mansr.com>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 12:58:08 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2MhT-0007JG-GY
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 12:58:07 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 2835B3C09D;
	Wed, 23 Mar 2011 12:58:07 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 31B803C09D
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 12:58:05 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id VpdvmPo3dwGy for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 12:58:05 +0100 (CET)
Received: from smtp1.kolej.mff.cuni.cz (smtp1.kolej.mff.cuni.cz
	[78.128.192.10])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id F35433C09C
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 12:58:04 +0100 (CET)
X-Envelope-From: anton-5jV5EzyPuF3R7s880joybQ@public.gmane.org
Received: from zohar.localdomain (zohar.kolej.mff.cuni.cz [78.128.198.199])
	by smtp1.kolej.mff.cuni.cz (8.14.4/8.14.4) with ESMTP id p2NBw3j7071588
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 12:58:04 +0100 (CET)
	(envelope-from anton-5jV5EzyPuF3R7s880joybQ@public.gmane.org)
Received: by zohar.localdomain (Postfix, from userid 1000)
	id 9288C7F471; Wed, 23 Mar 2011 12:58:03 +0100 (CET)
X-Mailer: git-send-email 1.7.4.1
In-Reply-To: <yw1xhbavun7f.fsf-OEaqT8BN2ezZK2NkWkPsZwC/G2K4zDHf@public.gmane.org>
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/80>

---
 libavformat/avio.h          |    2 +-
 libavformat/avio_internal.h |    2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/libavformat/avio.h b/libavformat/avio.h
index 753fa0c..d11c398 100644
--- a/libavformat/avio.h
+++ b/libavformat/avio.h
@@ -416,7 +416,7 @@ attribute_deprecated void         put_tag(AVIOContext *s, const char *tag);
  */
 
 attribute_deprecated int     av_url_read_fpause(AVIOContext *h,    int pause);
-attribute_deprecated int64_t av_url_read_fseek( AVIOContext *h,    int stream_index,
+attribute_deprecated int64_t av_url_read_fseek (AVIOContext *h,    int stream_index,
                                                 int64_t timestamp, int flags);
 
 /**
diff --git a/libavformat/avio_internal.h b/libavformat/avio_internal.h
index 7dd9bdf..4061016 100644
--- a/libavformat/avio_internal.h
+++ b/libavformat/avio_internal.h
@@ -67,7 +67,7 @@ uint64_t ffio_read_varlen(AVIOContext *bc);
 int ffio_set_buf_size(AVIOContext *s, int buf_size);
 
 int     ffio_read_pause(AVIOContext *h,    int pause);
-int64_t ffio_read_seek( AVIOContext *h,    int stream_index,
+int64_t ffio_read_seek (AVIOContext *h,    int stream_index,
                         int64_t timestamp, int flags);
 
 
-- 
1.7.4.1


From news@gmane.org Tue Mar 04 03:33:20 2003
From: Luca Barbato <lu_zero-aBrp7R+bbdUdnm+yROfE0A@public.gmane.org>
Subject: Re: [PATCH 1/2] Disable 'attribute "foo" ignored'
 warnings from icc
Date: Wed, 23 Mar 2011 13:22:13 +0100
Lines: 14
Message-ID: <4D89E5F5.8060007@gentoo.org>
References: <1300880187-23154-1-git-send-email-mans@mansr.com>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 13:22:28 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2N4x-0004ip-Mj
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 13:22:23 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 511963B170;
	Wed, 23 Mar 2011 13:22:23 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 66A933B170
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 13:22:21 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id wpZkvpmJYYba for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 13:22:21 +0100 (CET)
Received: from smtp.gentoo.org (smtp.gentoo.org [140.211.166.183])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 27F8E3B163
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 13:22:21 +0100 (CET)
Received: from [192.168.1.116] (dynamic-adsl-84-223-248-146.clienti.tiscali.it
	[84.223.248.146])
	(using TLSv1 with cipher DHE-RSA-CAMELLIA256-SHA (256/256 bits))
	(No client certificate requested) (Authenticated sender: lu_zero)
	by smtp.gentoo.org (Postfix) with ESMTPSA id 705ED1B4064
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 12:22:18 +0000 (UTC)
User-Agent: Mozilla/5.0 (X11; Linux x86_64;
	rv:2.0b10pre) Gecko/20110314 Thunderbird/3.3a2
In-Reply-To: <1300880187-23154-1-git-send-email-mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org>
X-Enigmail-Version: 1.2a1pre
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/81>

On 03/23/2011 12:36 PM, Mans Rullgard wrote:
> ICC lies about the version of gcc it emulates, which results
> in unsupported attributes sometimes being used.  The warning
> is an annoyance and should be disabled.
> 

Ok to both of them.


-- 

Luca Barbato
Gentoo/linux
http://dev.gentoo.org/~lu_zero


From news@gmane.org Tue Mar 04 03:33:20 2003
From: =?iso-8859-1?Q?M=E5ns_Rullg=E5rd?= <mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org>
Subject: Re: [PATCH] avio: cosmetics - nicer vertical
	alignment.
Date: Wed, 23 Mar 2011 12:40:19 +0000
Lines: 52
Message-ID: <yw1xipvaqabw.fsf@unicorn.mansr.com>
References: <yw1xhbavun7f.fsf@unicorn.mansr.com>
	<1300881482-9701-1-git-send-email-anton@khirnov.net>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 13:40:21 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2NML-0006Ch-Cq
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 13:40:21 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 251403B169;
	Wed, 23 Mar 2011 13:40:21 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id C8AFD3B169
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 13:40:19 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id 2v4pfp8AHAnP for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 13:40:19 +0100 (CET)
Received: from unicorn.mansr.com (unicorn.mansr.com [78.86.181.103])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id A53803B164
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 13:40:19 +0100 (CET)
Received: by unicorn.mansr.com (Postfix, from userid 51770)
	id 49E114B38; Wed, 23 Mar 2011 12:40:19 +0000 (GMT)
In-Reply-To: <1300881482-9701-1-git-send-email-anton-5jV5EzyPuF3R7s880joybQ@public.gmane.org> (Anton
	Khirnov's message of "Wed, 23 Mar 2011 12:58:02 +0100")
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/23.2 (gnu/linux)
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/82>

Anton Khirnov <anton-5jV5EzyPuF3R7s880joybQ@public.gmane.org> writes:

> ---
>  libavformat/avio.h          |    2 +-
>  libavformat/avio_internal.h |    2 +-
>  2 files changed, 2 insertions(+), 2 deletions(-)
>
> diff --git a/libavformat/avio.h b/libavformat/avio.h
> index 753fa0c..d11c398 100644
> --- a/libavformat/avio.h
> +++ b/libavformat/avio.h
> @@ -416,7 +416,7 @@ attribute_deprecated void         put_tag(AVIOContext=
 *s, const char *tag);
>   */
>  =

>  attribute_deprecated int     av_url_read_fpause(AVIOContext *h,    int p=
ause);
> -attribute_deprecated int64_t av_url_read_fseek( AVIOContext *h,    int s=
tream_index,
> +attribute_deprecated int64_t av_url_read_fseek (AVIOContext *h,    int s=
tream_index,
>                                                  int64_t timestamp, int f=
lags);
>  =

>  /**
> diff --git a/libavformat/avio_internal.h b/libavformat/avio_internal.h
> index 7dd9bdf..4061016 100644
> --- a/libavformat/avio_internal.h
> +++ b/libavformat/avio_internal.h
> @@ -67,7 +67,7 @@ uint64_t ffio_read_varlen(AVIOContext *bc);
>  int ffio_set_buf_size(AVIOContext *s, int buf_size);
>  =

>  int     ffio_read_pause(AVIOContext *h,    int pause);
> -int64_t ffio_read_seek( AVIOContext *h,    int stream_index,
> +int64_t ffio_read_seek (AVIOContext *h,    int stream_index,
>                          int64_t timestamp, int flags);
>  =

>  =

> -- =


OK, queued.

-- =

M=E5ns Rullg=E5rd
mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org


From news@gmane.org Tue Mar 04 03:33:20 2003
From: Brad <brad-BUbV6I797GxWk0Htik3J/w@public.gmane.org>
Subject: Re: [PATCH] Add support for sndio to libavdevice
Date: Wed, 23 Mar 2011 08:38:41 -0400
Lines: 16
Message-ID: <1300883921.2886.9.camel@Nokia-N900-42-11>
References: <20110321021443.GA10122@rox.home.comstyle.com>
	<20110321082030.0dfa2883@bfouet-dev1.eng.vmware.com>
	<20110322011328.GA15626@rox.home.comstyle.com>
	<AANLkTin_guqntW2=D=qODfi8D8VeoPA0rzcgdEq80m8g@mail.gmail.com>
	<20110322020934.GA8887@rox.home.comstyle.com> <4D885571.60304@free.fr>
	<20110323002443.GA3649@rox.home.comstyle.com>
	<20110323114823.GD30842@pool.informatik.RWTH-Aachen.DE>
Reply-To: Brad <brad-BUbV6I797GxWk0Htik3J/w@public.gmane.org>, libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>, Diego Biurrun <diego-NvuzD6AdJSiELgA04lAiVw@public.gmane.org>
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 13:41:44 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2NNb-0006sk-My
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 13:41:39 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 7FE9A3B16D;
	Wed, 23 Mar 2011 13:41:39 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 6A65D3B16D
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 13:41:38 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id kMhUcPRkpWmB for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 13:41:38 +0100 (CET)
Received: from mail.comstyle.com (speedy.comstyle.com [206.51.28.2])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 3BE0F3B164
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 13:41:38 +0100 (CET)
Received: from [10.204.96.131] (74-115-197-40.eng.wind.ca [74.115.197.40])
	(using TLSv1 with cipher ECDHE-RSA-AES256-SHA (256/256 bits))
	(No client certificate requested) (Authenticated sender: brad)
	by mail.comstyle.com (Postfix) with ESMTPSA id 8026398464;
	Wed, 23 Mar 2011 08:38:04 -0400 (EDT)
X-Mailer: Modest 3.90.7
In-Reply-To: <20110323114823.GD30842-C+EoYKesnrCVdxy9aTz+TbLZb8cQPPy3S7qENs8ugTg@public.gmane.org>
Content-ID: <1300883921.2886.8.camel@Nokia-N900-42-11>
X-comstyle-MailScanner-Information: Please contact the ISP for more information
X-comstyle-MailScanner-ID: 8026398464.A5148
X-comstyle-MailScanner: Found to be clean
X-comstyle-MailScanner-SpamCheck: not spam (whitelisted),
	SpamAssassin (not cached, score=-2.9, required 6, autolearn=not spam,
	ALL_TRUSTED -1.00, BAYES_00 -1.90)
X-comstyle-MailScanner-From: brad-BUbV6I797GxWk0Htik3J/w@public.gmane.org
X-Spam-Status: No
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/83>

On Wed, 23 Mar 2011, 07:48:23 EDT, Diego Biurrun <diego-NvuzD6AdJSiELgA04lAiVw@public.gmane.org> wrote:

> > @@ -1433,6 +1434,8 @@ jack_indev_deps="jack_jack_h"
> > oss_outdev_deps_any="soundcard_h sys_soundcard_h"
> > +sndio_indev_deps="sndio_h"
> > +sndio_outdev_deps="sndio_h"
> > v4l_indev_deps="linux_videodev_h"
> 
> alphabetical order

Can you be more specific? s is in-between o and v.

-- 
This message has been scanned for viruses and
dangerous content by MailScanner, and is
believed to be clean.


From news@gmane.org Tue Mar 04 03:33:20 2003
From: =?iso-8859-1?Q?M=E5ns_Rullg=E5rd?= <mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org>
Subject: Re: [PATCH] also subtract preroll when reading ASF
	simple index object
Date: Wed, 23 Mar 2011 12:51:36 +0000
Lines: 79
Message-ID: <yw1xei5yq9t3.fsf@unicorn.mansr.com>
References: <4D827F16.8010608@gmail.com>
	<20110318063253.GD18946@zohar.khirnov.net>
	<4D83145D.5060309@gmail.com> <yw1x39mfwgds.fsf@unicorn.mansr.com>
	<4D889A0D.9010004@gmail.com> <yw1x39mert0q.fsf@unicorn.mansr.com>
	<4D89DB2A.8040707@gmail.com>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 13:51:38 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2NXG-0004cB-A1
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 13:51:38 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 1BBB93B1B0;
	Wed, 23 Mar 2011 13:51:38 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 1DF9C3B1B2
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 13:51:37 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id A4orQ-zEbWVn for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 13:51:37 +0100 (CET)
Received: from unicorn.mansr.com (unicorn.mansr.com [78.86.181.103])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id E66703B1A7
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 13:51:36 +0100 (CET)
Received: by unicorn.mansr.com (Postfix, from userid 51770)
	id B43A54B38; Wed, 23 Mar 2011 12:51:36 +0000 (GMT)
In-Reply-To: <4D89DB2A.8040707-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org> (Vladimir Pantelic's message of
	"Wed, 23 Mar 2011 12:36:10 +0100")
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/23.2 (gnu/linux)
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/84>

Vladimir Pantelic <vladoman-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org> writes:

> M=E5ns Rullg=E5rd wrote:
>> Vladimir Pantelic<vladoman-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>  writes:
>>
>>>  M=E5ns Rullg=E5rd wrote:
>>>>  Vladimir Pantelic<vladoman-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>   writes:
>>>
>>>>>     From 057af717394ec2352d52fa8c1d96f66262da423c Mon Sep 17 00:00:00=
 2001
>>>>>   From: Vladimir Pantelic<vladoman-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>
>>>>>   Date: Thu, 17 Mar 2011 22:34:52 +0100
>>>>>   Subject: [PATCH] also subtract preroll when reading ASF simple inde=
x object
>>>>>
>>>>>   this was missed when ASF was changed to return timestamps
>>>>>   without preroll.
>>>>>   ---
>>>>>    libavformat/asfdec.c |    4 ++--
>>>>>    1 files changed, 2 insertions(+), 2 deletions(-)
>>>>>
>>>>>   diff --git a/libavformat/asfdec.c b/libavformat/asfdec.c
>>>>>   index 79b3bcb..9f460dd 100644
>>>>>   --- a/libavformat/asfdec.c
>>>>>   +++ b/libavformat/asfdec.c
>>>>>   @@ -1218,10 +1218,10 @@ static void asf_build_simple_index(AVFormat=
Context *s, int stream_index)
>>>>>                int pktnum=3Davio_rl32(s->pb);
>>>>>                int pktct =3Davio_rl16(s->pb);
>>>>>                int64_t pos      =3D s->data_offset + s->packet_size*(=
int64_t)pktnum;
>>>>>   -            int64_t index_pts=3D av_rescale(itime, i, 10000);
>>>>>   +            int64_t index_pts=3D FFMAX(av_rescale(itime, i, 10000)=
 - asf->hdr.preroll, 0);
>>>>
>>>>  Under what circumstances does this become negative without the FFMAX?
>>>
>>>  the simple index starts at 0, so with a preroll of e.g. 3000ms the 1st
>>>  4 index entries (0ms, 1000ms, 2000ms, 3000ms) all point to the same
>>>  packet with timestamp 3000ms.
>>>
>>>  since we subtract the preroll, we need to do that for the index time
>>>  too and thus the 1st entries all map to 0
>>
>> Is this intentional and correct?  I sounds totally weird to me.
>>
>
> file: asf_with_chapters.wmv (muxed using M$ tools)
>
> index with old behaviour:
>
> [asf @ 0x8c3d6d0] pktnum:0, pktct:2  pts: 0
> [asf @ 0x8c3d6d0] pktnum:0, pktct:2  pts: 1000
> [asf @ 0x8c3d6d0] pktnum:0, pktct:2  pts: 2000
> [asf @ 0x8c3d6d0] pktnum:0, pktct:2  pts: 3000
> [asf @ 0x8c3d6d0] pktnum:1, pktct:5  pts: 4000
> [asf @ 0x8c3d6d0] pktnum:1, pktct:5  pts: 5000
> [asf @ 0x8c3d6d0] pktnum:122, pktct:5  pts: 6000
> [asf @ 0x8c3d6d0] pktnum:122, pktct:5  pts: 7000
> [asf @ 0x8c3d6d0] pktnum:257, pktct:6  pts: 8000
> [asf @ 0x8c3d6d0] pktnum:257, pktct:6  pts: 9000
> ...
> ...
>
> The 1st 4 index entries all point to the same packet
> and thus to the same 1st key frame (at 3000ms)

What is the point of having 4 index entries for the same packet?

> again, 3 are suppressed.

I'm not doubting that, but I am questioning the correctness of that
behaviour in the first place.  Are those index entries really supposed
to indicate the same packet, or is that libavformat f*cking up?

-- =

M=E5ns Rullg=E5rd
mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org


From news@gmane.org Tue Mar 04 03:33:20 2003
From: "Ronald S. Bultje" <rsbultje-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>
Subject: Re: [PATCH] matroskaenc: remove a variable that's
 unused after bc17bd9.
Date: Wed, 23 Mar 2011 08:59:33 -0400
Lines: 30
Message-ID: <AANLkTin846T8YaM7HmU8J5Kkcyj5bRJs28H9H6ar+Eef@mail.gmail.com>
References: <1300874974-7464-1-git-send-email-anton@khirnov.net>
	<20110323102422.GA22848@kst-acer>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 13:59:38 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2Nez-0001O9-GN
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 13:59:37 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 1476A3C08E;
	Wed, 23 Mar 2011 13:59:37 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id C21F93C08E
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 13:59:34 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id grmK48E6PXyT for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 13:59:34 +0100 (CET)
Received: from mail-iy0-f182.google.com (mail-iy0-f182.google.com
	[209.85.210.182])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 5AB773C06F
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 13:59:34 +0100 (CET)
Received: by iyj12 with SMTP id 12so13924185iyj.27
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 05:59:33 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=gamma;
	h=domainkey-signature:mime-version:in-reply-to:references:date
	:message-id:subject:from:to:cc:content-type
	:content-transfer-encoding;
	bh=geoofm5E+AwlkFbZzP66Ch4skjo/7ZkfNhfCIieE8XQ=;
	b=RbwqjyK++d0NnfZMzfu0Qjh1B/UHEw0L6H4S19EqWiBH91lHZdTEjICvf7g3uC5GhS
	tnMTCZ3botcQm+MF9MEUlAuo1oYcQg0BRXx/6StxAtpUFFyQbaqtyeV+uKN44pxZbJXq
	UpmxJpzvo+Pq12mx2FC1yLL6nkpACUIcSjJ4Q=
DomainKey-Signature: a=rsa-sha1; c=nofws; d=gmail.com; s=gamma;
	h=mime-version:in-reply-to:references:date:message-id:subject:from:to
	:cc:content-type:content-transfer-encoding;
	b=daOEwc7sZ3XUrAwkXDf04ExfdWEcZygyet38dql9lSL/rA1MEKZ7dXwQqiBKrCDa1Z
	5XmGVJZU1hHr+gMgLBaTjM8B1U6KBOcKYYb+mSPvS2XfJhWIUCZ/2PrSeKfgtAc5XQev
	3yGWzo4599/yDcAr4XJfGsZAzpEFQpP/twTiY=
Received: by 10.43.70.203 with SMTP id yh11mr2599792icb.222.1300885173208;
	Wed, 23 Mar 2011 05:59:33 -0700 (PDT)
Received: by 10.42.75.133 with HTTP; Wed, 23 Mar 2011 05:59:33 -0700 (PDT)
In-Reply-To: <20110323102422.GA22848@kst-acer>
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/85>

Hi,

On Wed, Mar 23, 2011 at 6:24 AM, Kostya <kostya.shishkov-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org> wrote:
> On Wed, Mar 23, 2011 at 11:09:34AM +0100, Anton Khirnov wrote:
>> ---
>> =A0libavformat/matroskaenc.c | =A0 =A01 -
>> =A01 files changed, 0 insertions(+), 1 deletions(-)
>>
>> diff --git a/libavformat/matroskaenc.c b/libavformat/matroskaenc.c
>> index 0ab1832..4f9bf0a 100644
>> --- a/libavformat/matroskaenc.c
>> +++ b/libavformat/matroskaenc.c
>> @@ -438,7 +438,6 @@ static int put_xiph_codecpriv(AVFormatContext *s, AV=
IOContext *pb, AVCodecContex
>>
>> =A0static void get_aac_sample_rates(AVFormatContext *s, AVCodecContext *=
codec, int *sample_rate, int *output_sample_rate)
>> =A0{
>> - =A0 =A0int sri;
>> =A0 =A0 =A0MPEG4AudioConfig mp4ac;
>>
>> =A0 =A0 =A0if (ff_mpeg4audio_get_config(&mp4ac, codec->extradata, codec-=
>extradata_size) < 0) {
>> --
>
> lgtm

Queued.

Ronald


From news@gmane.org Tue Mar 04 03:33:20 2003
From: Vladimir Pantelic <vladoman-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>
Subject: Re: [PATCH] also subtract preroll when reading ASF
 simple index object
Date: Wed, 23 Mar 2011 14:26:12 +0100
Lines: 86
Message-ID: <4D89F4F4.4070405@gmail.com>
References: <4D827F16.8010608@gmail.com>
	<20110318063253.GD18946@zohar.khirnov.net>
	<4D83145D.5060309@gmail.com> <yw1x39mfwgds.fsf@unicorn.mansr.com>
	<4D889A0D.9010004@gmail.com> <yw1x39mert0q.fsf@unicorn.mansr.com>
	<4D89DB2A.8040707@gmail.com> <yw1xei5yq9t3.fsf@unicorn.mansr.com>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="iso-8859-1"; Format="flowed"
Content-Transfer-Encoding: quoted-printable
To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 14:26:56 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2O5Q-0002Iu-5h
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 14:26:56 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id EAFEC3B184;
	Wed, 23 Mar 2011 14:26:55 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id AC3103B184
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 14:26:53 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id U4kE9P5xqxt6 for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 14:26:53 +0100 (CET)
Received: from mail-fx0-f54.google.com (mail-fx0-f54.google.com
	[209.85.161.54])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 947E63B16A
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 14:26:53 +0100 (CET)
Received: by fxm11 with SMTP id 11so12229707fxm.27
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 06:26:53 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=gamma;
	h=domainkey-signature:message-id:date:from:user-agent:mime-version:to
	:subject:references:in-reply-to:content-type
	:content-transfer-encoding;
	bh=3yqEoSA9QiQKGOQqY0rS1PmYnQUS3eg38I8scXVysG4=;
	b=ZE5y98nQhAw/R3SFVfvFRlk2hw9KAMHm90WR6EerdPPIpch9YoE9g4cXGWFG9J1Siu
	zsgMgjogMJG2hjNIaFPoQEcT2NoeWLIWh3pPINUbRB1eZFAUQ6HjaXvTxlJwy/4GPjEp
	SQRmSGdwI/jmdDuO+g77Z2NMnMkUXyE1lABfY=
DomainKey-Signature: a=rsa-sha1; c=nofws; d=gmail.com; s=gamma;
	h=message-id:date:from:user-agent:mime-version:to:subject:references
	:in-reply-to:content-type:content-transfer-encoding;
	b=sww2zIVf5dKsu3jHoIJGUXVhosjvIE6+bwr/ApM8R65mzHcTsfjS5S73++CsBOyoGU
	g6c0hIh03UTJtKwDyw5akuxE/Cth+6uF+7/TFmhbncHXNLb2MjJWM6/UuOgZSBF5jUpM
	+PnHmreAQVVyouyLNvLPQ3JRgz9B2o89ztzwo=
Received: by 10.223.95.138 with SMTP id d10mr11205fan.21.1300886775103;
	Wed, 23 Mar 2011 06:26:15 -0700 (PDT)
Received: from [192.168.1.22] (p50996ded.dip0.t-ipconnect.de [80.153.109.237])
	by mx.google.com with ESMTPS id k5sm600017faa.39.2011.03.23.06.26.13
	(version=SSLv3 cipher=OTHER); Wed, 23 Mar 2011 06:26:14 -0700 (PDT)
User-Agent: Mozilla/5.0 (X11; Linux i686;
	rv:2.0b7pre) Gecko/20101008 Firefox/4.0b7pre SeaMonkey/2.1b1
In-Reply-To: <yw1xei5yq9t3.fsf-OEaqT8BN2ezZK2NkWkPsZwC/G2K4zDHf@public.gmane.org>
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/86>

M=E5ns Rullg=E5rd wrote:
> Vladimir Pantelic<vladoman-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>  writes:
>
>>  M=E5ns Rullg=E5rd wrote:
>>>  Vladimir Pantelic<vladoman-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>   writes:
>>>
>>>>   M=E5ns Rullg=E5rd wrote:
>>>>>   Vladimir Pantelic<vladoman-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>    writes:
>>>>
>>>>>>       From 057af717394ec2352d52fa8c1d96f66262da423c Mon Sep 17 00:00=
:00 2001
>>>>>>    From: Vladimir Pantelic<vladoman-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>
>>>>>>    Date: Thu, 17 Mar 2011 22:34:52 +0100
>>>>>>    Subject: [PATCH] also subtract preroll when reading ASF simple in=
dex object
>>>>>>
>>>>>>    this was missed when ASF was changed to return timestamps
>>>>>>    without preroll.
>>>>>>    ---
>>>>>>     libavformat/asfdec.c |    4 ++--
>>>>>>     1 files changed, 2 insertions(+), 2 deletions(-)
>>>>>>
>>>>>>    diff --git a/libavformat/asfdec.c b/libavformat/asfdec.c
>>>>>>    index 79b3bcb..9f460dd 100644
>>>>>>    --- a/libavformat/asfdec.c
>>>>>>    +++ b/libavformat/asfdec.c
>>>>>>    @@ -1218,10 +1218,10 @@ static void asf_build_simple_index(AVForm=
atContext *s, int stream_index)
>>>>>>                 int pktnum=3Davio_rl32(s->pb);
>>>>>>                 int pktct =3Davio_rl16(s->pb);
>>>>>>                 int64_t pos      =3D s->data_offset + s->packet_size=
*(int64_t)pktnum;
>>>>>>    -            int64_t index_pts=3D av_rescale(itime, i, 10000);
>>>>>>    +            int64_t index_pts=3D FFMAX(av_rescale(itime, i, 1000=
0) - asf->hdr.preroll, 0);
>>>>>
>>>>>   Under what circumstances does this become negative without the FFMA=
X?
>>>>
>>>>   the simple index starts at 0, so with a preroll of e.g. 3000ms the 1=
st
>>>>   4 index entries (0ms, 1000ms, 2000ms, 3000ms) all point to the same
>>>>   packet with timestamp 3000ms.
>>>>
>>>>   since we subtract the preroll, we need to do that for the index time
>>>>   too and thus the 1st entries all map to 0
>>>
>>>  Is this intentional and correct?  I sounds totally weird to me.
>>>
>>
>>  file: asf_with_chapters.wmv (muxed using M$ tools)
>>
>>  index with old behaviour:
>>
>>  [asf @ 0x8c3d6d0] pktnum:0, pktct:2  pts: 0
>>  [asf @ 0x8c3d6d0] pktnum:0, pktct:2  pts: 1000
>>  [asf @ 0x8c3d6d0] pktnum:0, pktct:2  pts: 2000
>>  [asf @ 0x8c3d6d0] pktnum:0, pktct:2  pts: 3000
>>  [asf @ 0x8c3d6d0] pktnum:1, pktct:5  pts: 4000
>>  [asf @ 0x8c3d6d0] pktnum:1, pktct:5  pts: 5000
>>  [asf @ 0x8c3d6d0] pktnum:122, pktct:5  pts: 6000
>>  [asf @ 0x8c3d6d0] pktnum:122, pktct:5  pts: 7000
>>  [asf @ 0x8c3d6d0] pktnum:257, pktct:6  pts: 8000
>>  [asf @ 0x8c3d6d0] pktnum:257, pktct:6  pts: 9000
>>  ...
>>  ...
>>
>>  The 1st 4 index entries all point to the same packet
>>  and thus to the same 1st key frame (at 3000ms)
>
> What is the point of having 4 index entries for the same packet?

don't ask me, ask M$

but see here: http://imagebin.org/144532

this is the M$ ASF viewer showing this file that was created with M$ tools.
(it was remuxed by me from an AVI)

>>  again, 3 are suppressed.
>
> I'm not doubting that, but I am questioning the correctness of that
> behaviour in the first place.  Are those index entries really supposed
> to indicate the same packet, or is that libavformat f*cking up?

no, they are like that in the original ASF file. see above.


From news@gmane.org Tue Mar 04 03:33:20 2003
From: =?iso-8859-1?Q?M=E5ns_Rullg=E5rd?= <mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org>
Subject: Re: [PATCH] also subtract preroll when reading ASF
	simple index object
Date: Wed, 23 Mar 2011 13:45:09 +0000
Lines: 90
Message-ID: <yw1xaagmq7bu.fsf@unicorn.mansr.com>
References: <4D827F16.8010608@gmail.com>
	<20110318063253.GD18946@zohar.khirnov.net>
	<4D83145D.5060309@gmail.com> <yw1x39mfwgds.fsf@unicorn.mansr.com>
	<4D889A0D.9010004@gmail.com> <yw1x39mert0q.fsf@unicorn.mansr.com>
	<4D89DB2A.8040707@gmail.com> <yw1xei5yq9t3.fsf@unicorn.mansr.com>
	<4D89F4F4.4070405@gmail.com>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 14:45:12 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2ON6-0005iL-3q
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 14:45:12 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id C451D3B1E9;
	Wed, 23 Mar 2011 14:45:11 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 46CE63B1E9
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 14:45:10 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id THO545qt6d75 for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 14:45:10 +0100 (CET)
Received: from unicorn.mansr.com (unicorn.mansr.com [78.86.181.103])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 093993B1E6
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 14:45:10 +0100 (CET)
Received: by unicorn.mansr.com (Postfix, from userid 51770)
	id 92E8F17B41; Wed, 23 Mar 2011 13:45:09 +0000 (GMT)
In-Reply-To: <4D89F4F4.4070405-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org> (Vladimir Pantelic's message of
	"Wed, 23 Mar 2011 14:26:12 +0100")
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/23.2 (gnu/linux)
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/87>

Vladimir Pantelic <vladoman-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org> writes:

> M=E5ns Rullg=E5rd wrote:
>> Vladimir Pantelic<vladoman-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>  writes:
>>
>>>  M=E5ns Rullg=E5rd wrote:
>>>>  Vladimir Pantelic<vladoman-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>   writes:
>>>>
>>>>>   M=E5ns Rullg=E5rd wrote:
>>>>>>   Vladimir Pantelic<vladoman-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>    writes:
>>>>>
>>>>>>>       From 057af717394ec2352d52fa8c1d96f66262da423c Mon Sep 17 00:0=
0:00 2001
>>>>>>>    From: Vladimir Pantelic<vladoman-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>
>>>>>>>    Date: Thu, 17 Mar 2011 22:34:52 +0100
>>>>>>>    Subject: [PATCH] also subtract preroll when reading ASF simple i=
ndex object
>>>>>>>
>>>>>>>    this was missed when ASF was changed to return timestamps
>>>>>>>    without preroll.
>>>>>>>    ---
>>>>>>>     libavformat/asfdec.c |    4 ++--
>>>>>>>     1 files changed, 2 insertions(+), 2 deletions(-)
>>>>>>>
>>>>>>>    diff --git a/libavformat/asfdec.c b/libavformat/asfdec.c
>>>>>>>    index 79b3bcb..9f460dd 100644
>>>>>>>    --- a/libavformat/asfdec.c
>>>>>>>    +++ b/libavformat/asfdec.c
>>>>>>>    @@ -1218,10 +1218,10 @@ static void asf_build_simple_index(AVFor=
matContext *s, int stream_index)
>>>>>>>                 int pktnum=3Davio_rl32(s->pb);
>>>>>>>                 int pktct =3Davio_rl16(s->pb);
>>>>>>>                 int64_t pos      =3D s->data_offset + s->packet_siz=
e*(int64_t)pktnum;
>>>>>>>    -            int64_t index_pts=3D av_rescale(itime, i, 10000);
>>>>>>>    +            int64_t index_pts=3D FFMAX(av_rescale(itime, i, 100=
00) - asf->hdr.preroll, 0);
>>>>>>
>>>>>>   Under what circumstances does this become negative without the FFM=
AX?
>>>>>
>>>>>   the simple index starts at 0, so with a preroll of e.g. 3000ms the =
1st
>>>>>   4 index entries (0ms, 1000ms, 2000ms, 3000ms) all point to the same
>>>>>   packet with timestamp 3000ms.
>>>>>
>>>>>   since we subtract the preroll, we need to do that for the index time
>>>>>   too and thus the 1st entries all map to 0
>>>>
>>>>  Is this intentional and correct?  I sounds totally weird to me.
>>>>
>>>
>>>  file: asf_with_chapters.wmv (muxed using M$ tools)
>>>
>>>  index with old behaviour:
>>>
>>>  [asf @ 0x8c3d6d0] pktnum:0, pktct:2  pts: 0
>>>  [asf @ 0x8c3d6d0] pktnum:0, pktct:2  pts: 1000
>>>  [asf @ 0x8c3d6d0] pktnum:0, pktct:2  pts: 2000
>>>  [asf @ 0x8c3d6d0] pktnum:0, pktct:2  pts: 3000
>>>  [asf @ 0x8c3d6d0] pktnum:1, pktct:5  pts: 4000
>>>  [asf @ 0x8c3d6d0] pktnum:1, pktct:5  pts: 5000
>>>  [asf @ 0x8c3d6d0] pktnum:122, pktct:5  pts: 6000
>>>  [asf @ 0x8c3d6d0] pktnum:122, pktct:5  pts: 7000
>>>  [asf @ 0x8c3d6d0] pktnum:257, pktct:6  pts: 8000
>>>  [asf @ 0x8c3d6d0] pktnum:257, pktct:6  pts: 9000
>>>  ...
>>>  ...
>>>
>>>  The 1st 4 index entries all point to the same packet
>>>  and thus to the same 1st key frame (at 3000ms)
>>
>> What is the point of having 4 index entries for the same packet?
>
> don't ask me, ask M$
>
> but see here: http://imagebin.org/144532
>
> this is the M$ ASF viewer showing this file that was created with M$ tool=
s.
> (it was remuxed by me from an AVI)

OK, I'm convinced.  This just sounds so stupid I had to make sure.

Patch OK.

-- =

M=E5ns Rullg=E5rd
mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org


From news@gmane.org Tue Mar 04 03:33:20 2003
From: =?UTF-8?q?Martin=20Storsj=C3=B6?= <martin-TqfNSX0MhmxeoWH0uzbU5w@public.gmane.org>
Subject: [PATCH] configure: Don't explicitly disable ffplay or
	in/outdevices on dos
Date: Wed, 23 Mar 2011 15:49:37 +0200
Lines: 23
Message-ID: <1300888177-29953-1-git-send-email-martin@martin.st>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 14:49:43 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2ORS-0000hn-2X
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 14:49:42 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 7CD6F3B1EB;
	Wed, 23 Mar 2011 14:49:41 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 12D1C3B1EB
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 14:49:39 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id ZGGeNtg9Qzb3 for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 14:49:39 +0100 (CET)
Received: from mail-bw0-f54.google.com (mail-bw0-f54.google.com
	[209.85.214.54])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id E49EE3B1EA
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 14:49:38 +0100 (CET)
Received: by bwz12 with SMTP id 12so10739367bwz.27
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 06:49:38 -0700 (PDT)
Received: by 10.204.25.20 with SMTP id x20mr6226742bkb.112.1300888178522;
	Wed, 23 Mar 2011 06:49:38 -0700 (PDT)
Received: from localhost (bambuser.masterplanet.fi [194.100.86.5])
	by mx.google.com with ESMTPS id 16sm2662141bkm.18.2011.03.23.06.49.37
	(version=TLSv1/SSLv3 cipher=OTHER);
	Wed, 23 Mar 2011 06:49:38 -0700 (PDT)
X-Mailer: git-send-email 1.7.3.1
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/88>

The normal dependency tracking system disables them just fine.
---
This goes on top of the earlier ones fixing automatic disabling
of ffserver.

 configure |    2 --
 1 files changed, 0 insertions(+), 2 deletions(-)

diff --git a/configure b/configure
index fccd7a4..a9b6e7c 100755
--- a/configure
+++ b/configure
@@ -2442,8 +2442,6 @@ case $target_os in
         check_cflags -fno-common
         ;;
     *-dos|freedos|opendos)
-        disable ffplay
-        disable $INDEV_LIST $OUTDEV_LIST
         network_extralibs="-lsocket"
         objformat="coff"
         enable dos_paths
-- 
1.7.3.1


From news@gmane.org Tue Mar 04 03:33:20 2003
From: =?iso-8859-1?Q?M=E5ns_Rullg=E5rd?= <mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org>
Subject: Re: [PATCH] configure: Don't explicitly disable
	ffplay or in/outdevices on dos
Date: Wed, 23 Mar 2011 13:54:20 +0000
Lines: 33
Message-ID: <yw1x62raq6wj.fsf@unicorn.mansr.com>
References: <1300888177-29953-1-git-send-email-martin@martin.st>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 14:54:25 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2OVz-0003vp-Kg
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 14:54:23 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 5A0233C082;
	Wed, 23 Mar 2011 14:54:23 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id ECBC83C071
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 14:54:20 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id O1m9z1AnpJQG for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 14:54:20 +0100 (CET)
Received: from unicorn.mansr.com (unicorn.mansr.com [78.86.181.103])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id CB0C33C06C
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 14:54:20 +0100 (CET)
Received: by unicorn.mansr.com (Postfix, from userid 51770)
	id A12B34B38; Wed, 23 Mar 2011 13:54:20 +0000 (GMT)
In-Reply-To: <1300888177-29953-1-git-send-email-martin-TqfNSX0MhmxeoWH0uzbU5w@public.gmane.org> ("Martin
	=?iso-8859-1?Q?Storsj=F6=22's?= message of "Wed, 23 Mar 2011 15:49:37
	+0200")
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/23.2 (gnu/linux)
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/89>

Martin Storsj=F6 <martin-TqfNSX0MhmxeoWH0uzbU5w@public.gmane.org> writes:

> The normal dependency tracking system disables them just fine.
> ---
> This goes on top of the earlier ones fixing automatic disabling
> of ffserver.
>
>  configure |    2 --
>  1 files changed, 0 insertions(+), 2 deletions(-)
>
> diff --git a/configure b/configure
> index fccd7a4..a9b6e7c 100755
> --- a/configure
> +++ b/configure
> @@ -2442,8 +2442,6 @@ case $target_os in
>          check_cflags -fno-common
>          ;;
>      *-dos|freedos|opendos)
> -        disable ffplay
> -        disable $INDEV_LIST $OUTDEV_LIST
>          network_extralibs=3D"-lsocket"
>          objformat=3D"coff"
>          enable dos_paths
> -- =

> 1.7.3.1

OK

-- =

M=E5ns Rullg=E5rd
mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org


From news@gmane.org Tue Mar 04 03:33:20 2003
From: Mans Rullgard <mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org>
Subject: [PATCH][RFC] Fixed-point FFT and MDCT
Date: Wed, 23 Mar 2011 14:04:15 +0000
Lines: 546
Message-ID: <1300889055-14977-1-git-send-email-mans@mansr.com>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 15:04:21 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2Ofd-0002Kr-B5
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 15:04:21 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 1DBC03C08D;
	Wed, 23 Mar 2011 15:04:21 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 646373C08D
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 15:04:18 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id 0UHXXqLk9gQ7 for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 15:04:18 +0100 (CET)
Received: from unicorn.mansr.com (unicorn.mansr.com [78.86.181.103])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 0BC593C071
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 15:04:18 +0100 (CET)
Received: by unicorn.mansr.com (Postfix, from userid 51770)
	id D66C54B38; Wed, 23 Mar 2011 14:04:17 +0000 (GMT)
X-Mailer: git-send-email 1.7.4.1
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/90>

This creates fixed-point versions of the FFT and MDCT, as was promised
"soon" back in 2002.  Some parts of the patch are a bit hackish, hence
the RFC.  I have tested it with the AC3 encoder where it seems to work.

The _fixed/float wrapper files could be removed and replaced with make
trickery.  I'm not sure which is best there.  There is also some macro
magic which could possibly be done differently.

I have unfinished patches to make fft-test also test these fixed-point
versions, but that's still too ugly to post.
---
 libavcodec/Makefile       |    5 ++-
 libavcodec/fft-internal.h |   67 +++++++++++++++++++++++++++++++++++++++++++++
 libavcodec/fft.c          |   53 ++++++++++++++++++++---------------
 libavcodec/fft.h          |   47 ++++++++++++++++++++++++++-----
 libavcodec/fft_fixed.c    |   20 +++++++++++++
 libavcodec/fft_float.c    |   20 +++++++++++++
 libavcodec/mdct.c         |   32 +++++++++------------
 libavcodec/mdct_fixed.c   |   20 +++++++++++++
 libavcodec/mdct_float.c   |   20 +++++++++++++
 9 files changed, 233 insertions(+), 51 deletions(-)
 create mode 100644 libavcodec/fft-internal.h
 create mode 100644 libavcodec/fft_fixed.c
 create mode 100644 libavcodec/fft_float.c
 create mode 100644 libavcodec/mdct_fixed.c
 create mode 100644 libavcodec/mdct_float.c

diff --git a/libavcodec/Makefile b/libavcodec/Makefile
index 91dcdbe..424acbf 100644
--- a/libavcodec/Makefile
+++ b/libavcodec/Makefile
@@ -32,14 +32,15 @@ OBJS-$(CONFIG_DCT)                     += dct.o
 OBJS-$(CONFIG_DWT)                     += dwt.o
 OBJS-$(CONFIG_DXVA2)                   += dxva2.o
 FFT-OBJS-$(CONFIG_HARDCODED_TABLES)    += cos_tables.o
-OBJS-$(CONFIG_FFT)                     += avfft.o fft.o $(FFT-OBJS-yes)
+OBJS-$(CONFIG_FFT)                     += avfft.o fft_fixed.o fft_float.o \
+                                          $(FFT-OBJS-yes)
 OBJS-$(CONFIG_GOLOMB)                  += golomb.o
 OBJS-$(CONFIG_H264DSP)                 += h264dsp.o h264idct.o
 OBJS-$(CONFIG_H264PRED)                += h264pred.o
 OBJS-$(CONFIG_HUFFMAN)                 += huffman.o
 OBJS-$(CONFIG_LPC)                     += lpc.o
 OBJS-$(CONFIG_LSP)                     += lsp.o
-OBJS-$(CONFIG_MDCT)                    += mdct.o
+OBJS-$(CONFIG_MDCT)                    += mdct_fixed.o mdct_float.o
 RDFT-OBJS-$(CONFIG_HARDCODED_TABLES)   += sin_tables.o
 OBJS-$(CONFIG_RDFT)                    += rdft.o $(RDFT-OBJS-yes)
 OBJS-$(CONFIG_SINEWIN)                 += sinewin.o
diff --git a/libavcodec/fft-internal.h b/libavcodec/fft-internal.h
new file mode 100644
index 0000000..cdae3a5
--- /dev/null
+++ b/libavcodec/fft-internal.h
@@ -0,0 +1,67 @@
+/*
+ * This file is part of Libav.
+ *
+ * Libav is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Lesser General Public
+ * License as published by the Free Software Foundation; either
+ * version 2.1 of the License, or (at your option) any later version.
+ *
+ * Libav is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with Libav; if not, write to the Free Software
+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
+ */
+
+#ifndef AVCODEC_FFT_INTERNAL_H
+#define AVCODEC_FFT_INTERNAL_H
+
+#if CONFIG_FFT_FLOAT
+
+#define FIX15(v) (v)
+#define sqrthalf (float)M_SQRT1_2
+
+#define BF(x, y, a, b) do {                     \
+        x = a - b;                              \
+        y = a + b;                              \
+    } while (0)
+
+#define CMUL(dre, dim, are, aim, bre, bim) do { \
+        (dre) = (are) * (bre) - (aim) * (bim);  \
+        (dim) = (are) * (bim) + (bre) * (aim);  \
+    } while (0)
+
+#else
+
+#include "libavutil/intmath.h"
+#include "mathops.h"
+
+#define SCALE_FLOAT(a, bits) lrintf((a) * (float)(1 << (bits)))
+#define FIX15(a) av_clip(SCALE_FLOAT(a, 15), -32767, 32767)
+
+#define sqrthalf ((int16_t)((1<<15)*M_SQRT1_2))
+
+#define BF(x, y, a, b) do {                     \
+        x = (a - b) >> 1;                       \
+        y = (a + b) >> 1;                       \
+    } while (0)
+
+#define CMUL(dre, dim, are, aim, bre, bim) do {                 \
+        (dre) = (MUL16(are, bre) - MUL16(aim, bim)) >> 15;      \
+        (dim) = (MUL16(are, bim) + MUL16(bre, aim)) >> 15;      \
+    } while (0)
+
+#endif /* CONFIG_FFT_FLOAT */
+
+#define ff_imdct_calc_c FFT_NAME(ff_imdct_calc_c)
+#define ff_imdct_half_c FFT_NAME(ff_imdct_half_c)
+#define ff_mdct_calc_c  FFT_NAME(ff_mdct_calc_c)
+
+void ff_imdct_calc_c(FFTContext *s, FFTSample *output, const FFTSample *input);
+void ff_imdct_half_c(FFTContext *s, FFTSample *output, const FFTSample *input);
+void ff_mdct_calc_c(FFTContext *s, FFTSample *output, const FFTSample *input);
+
+#endif /* AVCODEC_FFT_INTERNAL_H */
diff --git a/libavcodec/fft.c b/libavcodec/fft.c
index 76e9c41..3aa9b4d 100644
--- a/libavcodec/fft.c
+++ b/libavcodec/fft.c
@@ -30,6 +30,7 @@
 #include <string.h>
 #include "libavutil/mathematics.h"
 #include "fft.h"
+#include "fft-internal.h"
 
 /* cos(2*pi*x/n) for 0<=x<=n/4, followed by its reverse */
 #if !CONFIG_HARDCODED_TABLES
@@ -47,10 +48,21 @@ COSTABLE(16384);
 COSTABLE(32768);
 COSTABLE(65536);
 #endif
-COSTABLE_CONST FFTSample * const ff_cos_tabs[] = {
+COSTABLE_CONST FFTSample * const FFT_NAME(ff_cos_tabs)[] = {
     NULL, NULL, NULL, NULL,
-    ff_cos_16, ff_cos_32, ff_cos_64, ff_cos_128, ff_cos_256, ff_cos_512, ff_cos_1024,
-    ff_cos_2048, ff_cos_4096, ff_cos_8192, ff_cos_16384, ff_cos_32768, ff_cos_65536,
+    FFT_NAME(ff_cos_16),
+    FFT_NAME(ff_cos_32),
+    FFT_NAME(ff_cos_64),
+    FFT_NAME(ff_cos_128),
+    FFT_NAME(ff_cos_256),
+    FFT_NAME(ff_cos_512),
+    FFT_NAME(ff_cos_1024),
+    FFT_NAME(ff_cos_2048),
+    FFT_NAME(ff_cos_4096),
+    FFT_NAME(ff_cos_8192),
+    FFT_NAME(ff_cos_16384),
+    FFT_NAME(ff_cos_32768),
+    FFT_NAME(ff_cos_65536),
 };
 
 static void ff_fft_permute_c(FFTContext *s, FFTComplex *z);
@@ -73,9 +85,9 @@ av_cold void ff_init_ff_cos_tabs(int index)
     int i;
     int m = 1<<index;
     double freq = 2*M_PI/m;
-    FFTSample *tab = ff_cos_tabs[index];
+    FFTSample *tab = FFT_NAME(ff_cos_tabs)[index];
     for(i=0; i<=m/4; i++)
-        tab[i] = cos(i*freq);
+        tab[i] = FIX15(cos(i*freq));
     for(i=1; i<m/4; i++)
         tab[m/2-i] = tab[i];
 #endif
@@ -107,9 +119,11 @@ av_cold int ff_fft_init(FFTContext *s, int nbits, int inverse)
     s->mdct_calc   = ff_mdct_calc_c;
 #endif
 
+#if CONFIG_FFT_FLOAT
     if (ARCH_ARM)     ff_fft_init_arm(s);
     if (HAVE_ALTIVEC) ff_fft_init_altivec(s);
     if (HAVE_MMX)     ff_fft_init_mmx(s);
+#endif
 
     for(j=4; j<=nbits; j++) {
         ff_init_ff_cos_tabs(j);
@@ -144,13 +158,6 @@ av_cold void ff_fft_end(FFTContext *s)
     av_freep(&s->tmp_buf);
 }
 
-#define sqrthalf (float)M_SQRT1_2
-
-#define BF(x,y,a,b) {\
-    x = a - b;\
-    y = a + b;\
-}
-
 #define BUTTERFLIES(a0,a1,a2,a3) {\
     BF(t3, t5, t5, t1);\
     BF(a2.re, a0.re, a0.re, t5);\
@@ -174,10 +181,8 @@ av_cold void ff_fft_end(FFTContext *s)
 }
 
 #define TRANSFORM(a0,a1,a2,a3,wre,wim) {\
-    t1 = a2.re * wre + a2.im * wim;\
-    t2 = a2.im * wre - a2.re * wim;\
-    t5 = a3.re * wre - a3.im * wim;\
-    t6 = a3.im * wre + a3.re * wim;\
+    CMUL(t1, t2, a2.re, a2.im, wre, -wim);      \
+    CMUL(t5, t6, a3.re, a3.im, wre,  wim);      \
     BUTTERFLIES(a0,a1,a2,a3)\
 }
 
@@ -193,7 +198,7 @@ av_cold void ff_fft_end(FFTContext *s)
 #define PASS(name)\
 static void name(FFTComplex *z, const FFTSample *wre, unsigned int n)\
 {\
-    FFTSample t1, t2, t3, t4, t5, t6;\
+    FFTDouble t1, t2, t3, t4, t5, t6;\
     int o1 = 2*n;\
     int o2 = 4*n;\
     int o3 = 6*n;\
@@ -222,12 +227,12 @@ static void fft##n(FFTComplex *z)\
     fft##n2(z);\
     fft##n4(z+n4*2);\
     fft##n4(z+n4*3);\
-    pass(z,ff_cos_##n,n4/2);\
+    pass(z,FFT_NAME(ff_cos_##n),n4/2);        \
 }
 
 static void fft4(FFTComplex *z)
 {
-    FFTSample t1, t2, t3, t4, t5, t6, t7, t8;
+    FFTDouble t1, t2, t3, t4, t5, t6, t7, t8;
 
     BF(t3, t1, z[0].re, z[1].re);
     BF(t8, t6, z[3].re, z[2].re);
@@ -241,7 +246,7 @@ static void fft4(FFTComplex *z)
 
 static void fft8(FFTComplex *z)
 {
-    FFTSample t1, t2, t3, t4, t5, t6, t7, t8;
+    FFTDouble t1, t2, t3, t4, t5, t6, t7, t8;
 
     fft4(z);
 
@@ -262,7 +267,9 @@ static void fft8(FFTComplex *z)
 #if !CONFIG_SMALL
 static void fft16(FFTComplex *z)
 {
-    FFTSample t1, t2, t3, t4, t5, t6;
+    FFTDouble t1, t2, t3, t4, t5, t6;
+    FFTSample cos_16_1 = FFT_NAME(ff_cos_16)[1];
+    FFTSample cos_16_3 = FFT_NAME(ff_cos_16)[3];
 
     fft8(z);
     fft4(z+8);
@@ -270,8 +277,8 @@ static void fft16(FFTComplex *z)
 
     TRANSFORM_ZERO(z[0],z[4],z[8],z[12]);
     TRANSFORM(z[2],z[6],z[10],z[14],sqrthalf,sqrthalf);
-    TRANSFORM(z[1],z[5],z[9],z[13],ff_cos_16[1],ff_cos_16[3]);
-    TRANSFORM(z[3],z[7],z[11],z[15],ff_cos_16[3],ff_cos_16[1]);
+    TRANSFORM(z[1],z[5],z[9],z[13],cos_16_1,cos_16_3);
+    TRANSFORM(z[3],z[7],z[11],z[15],cos_16_3,cos_16_1);
 }
 #else
 DECL_FFT(16,8,4)
diff --git a/libavcodec/fft.h b/libavcodec/fft.h
index 36be996..43621c4 100644
--- a/libavcodec/fft.h
+++ b/libavcodec/fft.h
@@ -22,11 +22,37 @@
 #ifndef AVCODEC_FFT_H
 #define AVCODEC_FFT_H
 
+#ifndef CONFIG_FFT_FLOAT
+#define CONFIG_FFT_FLOAT 1
+#endif
+
 #include <stdint.h>
 #include "config.h"
 #include "libavutil/mem.h"
+
+#if CONFIG_FFT_FLOAT
+
 #include "avfft.h"
 
+#define FFT_NAME(x) x
+
+typedef float FFTDouble;
+
+#else
+
+#define FFT_NAME(x) x ## _fixed
+
+typedef int16_t FFTSample;
+typedef int     FFTDouble;
+
+typedef struct FFTComplex {
+    int16_t re, im;
+} FFTComplex;
+
+typedef struct FFTContext FFTContext;
+
+#endif /* CONFIG_FFT_FLOAT */
+
 /* FFT computation */
 
 struct FFTContext {
@@ -66,7 +92,7 @@ struct FFTContext {
 #endif
 
 #define COSTABLE(size) \
-    COSTABLE_CONST DECLARE_ALIGNED(16, FFTSample, ff_cos_##size)[size/2]
+    COSTABLE_CONST DECLARE_ALIGNED(16, FFTSample, FFT_NAME(ff_cos_##size))[size/2]
 
 extern COSTABLE(16);
 extern COSTABLE(32);
@@ -81,7 +107,9 @@ extern COSTABLE(8192);
 extern COSTABLE(16384);
 extern COSTABLE(32768);
 extern COSTABLE(65536);
-extern COSTABLE_CONST FFTSample* const ff_cos_tabs[17];
+extern COSTABLE_CONST FFTSample* const FFT_NAME(ff_cos_tabs)[17];
+
+#define ff_init_ff_cos_tabs FFT_NAME(ff_init_ff_cos_tabs)
 
 /**
  * Initialize the cosine table in ff_cos_tabs[index]
@@ -89,6 +117,9 @@ extern COSTABLE_CONST FFTSample* const ff_cos_tabs[17];
  */
 void ff_init_ff_cos_tabs(int index);
 
+#define ff_fft_init FFT_NAME(ff_fft_init)
+#define ff_fft_end  FFT_NAME(ff_fft_end)
+
 /**
  * Set up a complex FFT.
  * @param nbits           log2 of the length of the input array
@@ -96,16 +127,16 @@ void ff_init_ff_cos_tabs(int index);
  */
 int ff_fft_init(FFTContext *s, int nbits, int inverse);
 
-void ff_fft_init_altivec(FFTContext *s);
-void ff_fft_init_mmx(FFTContext *s);
-void ff_fft_init_arm(FFTContext *s);
+void FFT_NAME(ff_fft_init_altivec)(FFTContext *s);
+void FFT_NAME(ff_fft_init_mmx)(FFTContext *s);
+void FFT_NAME(ff_fft_init_arm)(FFTContext *s);
 
 void ff_fft_end(FFTContext *s);
 
+#define ff_mdct_init FFT_NAME(ff_mdct_init)
+#define ff_mdct_end  FFT_NAME(ff_mdct_end)
+
 int ff_mdct_init(FFTContext *s, int nbits, int inverse, double scale);
-void ff_imdct_calc_c(FFTContext *s, FFTSample *output, const FFTSample *input);
-void ff_imdct_half_c(FFTContext *s, FFTSample *output, const FFTSample *input);
-void ff_mdct_calc_c(FFTContext *s, FFTSample *output, const FFTSample *input);
 void ff_mdct_end(FFTContext *s);
 
 #endif /* AVCODEC_FFT_H */
diff --git a/libavcodec/fft_fixed.c b/libavcodec/fft_fixed.c
new file mode 100644
index 0000000..b28091d
--- /dev/null
+++ b/libavcodec/fft_fixed.c
@@ -0,0 +1,20 @@
+/*
+ * This file is part of Libav.
+ *
+ * Libav is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Lesser General Public
+ * License as published by the Free Software Foundation; either
+ * version 2.1 of the License, or (at your option) any later version.
+ *
+ * Libav is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with Libav; if not, write to the Free Software
+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
+ */
+
+#define CONFIG_FFT_FLOAT 0
+#include "fft.c"
diff --git a/libavcodec/fft_float.c b/libavcodec/fft_float.c
new file mode 100644
index 0000000..24c9fdb
--- /dev/null
+++ b/libavcodec/fft_float.c
@@ -0,0 +1,20 @@
+/*
+ * This file is part of Libav.
+ *
+ * Libav is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Lesser General Public
+ * License as published by the Free Software Foundation; either
+ * version 2.1 of the License, or (at your option) any later version.
+ *
+ * Libav is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with Libav; if not, write to the Free Software
+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
+ */
+
+#define CONFIG_FFT_FLOAT 1
+#include "fft.c"
diff --git a/libavcodec/mdct.c b/libavcodec/mdct.c
index 9edb577..6f64534 100644
--- a/libavcodec/mdct.c
+++ b/libavcodec/mdct.c
@@ -24,12 +24,19 @@
 #include "libavutil/common.h"
 #include "libavutil/mathematics.h"
 #include "fft.h"
+#include "fft-internal.h"
 
 /**
  * @file
  * MDCT/IMDCT transforms.
  */
 
+#if CONFIG_FFT_FLOAT
+#   define RSCALE(x) (x)
+#else
+#   define RSCALE(x) ((x) >> 1)
+#endif
+
 /**
  * init MDCT or IMDCT computation.
  */
@@ -70,8 +77,8 @@ av_cold int ff_mdct_init(FFTContext *s, int nbits, int inverse, double scale)
     scale = sqrt(fabs(scale));
     for(i=0;i<n4;i++) {
         alpha = 2 * M_PI * (i + theta) / n;
-        s->tcos[i*tstep] = -cos(alpha) * scale;
-        s->tsin[i*tstep] = -sin(alpha) * scale;
+        s->tcos[i*tstep] = FIX15(-cos(alpha) * scale);
+        s->tsin[i*tstep] = FIX15(-sin(alpha) * scale);
     }
     return 0;
  fail:
@@ -79,17 +86,6 @@ av_cold int ff_mdct_init(FFTContext *s, int nbits, int inverse, double scale)
     return -1;
 }
 
-/* complex multiplication: p = a * b */
-#define CMUL(pre, pim, are, aim, bre, bim) \
-{\
-    FFTSample _are = (are);\
-    FFTSample _aim = (aim);\
-    FFTSample _bre = (bre);\
-    FFTSample _bim = (bim);\
-    (pre) = _are * _bre - _aim * _bim;\
-    (pim) = _are * _bim + _aim * _bre;\
-}
-
 /**
  * Compute the middle half of the inverse MDCT of size N = 2^nbits,
  * thus excluding the parts that can be derived by symmetry
@@ -161,7 +157,7 @@ void ff_imdct_calc_c(FFTContext *s, FFTSample *output, const FFTSample *input)
 void ff_mdct_calc_c(FFTContext *s, FFTSample *out, const FFTSample *input)
 {
     int i, j, n, n8, n4, n2, n3;
-    FFTSample re, im;
+    FFTDouble re, im;
     const uint16_t *revtab = s->revtab;
     const FFTSample *tcos = s->tcos;
     const FFTSample *tsin = s->tsin;
@@ -175,13 +171,13 @@ void ff_mdct_calc_c(FFTContext *s, FFTSample *out, const FFTSample *input)
 
     /* pre rotation */
     for(i=0;i<n8;i++) {
-        re = -input[2*i+n3] - input[n3-1-2*i];
-        im = -input[n4+2*i] + input[n4-1-2*i];
+        re = RSCALE(-input[2*i+n3] - input[n3-1-2*i]);
+        im = RSCALE(-input[n4+2*i] + input[n4-1-2*i]);
         j = revtab[i];
         CMUL(x[j].re, x[j].im, re, im, -tcos[i], tsin[i]);
 
-        re = input[2*i] - input[n2-1-2*i];
-        im = -(input[n2+2*i] + input[n-1-2*i]);
+        re = RSCALE( input[2*i]    - input[n2-1-2*i]);
+        im = RSCALE(-input[n2+2*i] - input[ n-1-2*i]);
         j = revtab[n8 + i];
         CMUL(x[j].re, x[j].im, re, im, -tcos[n8 + i], tsin[n8 + i]);
     }
diff --git a/libavcodec/mdct_fixed.c b/libavcodec/mdct_fixed.c
new file mode 100644
index 0000000..19c8039
--- /dev/null
+++ b/libavcodec/mdct_fixed.c
@@ -0,0 +1,20 @@
+/*
+ * This file is part of Libav.
+ *
+ * Libav is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Lesser General Public
+ * License as published by the Free Software Foundation; either
+ * version 2.1 of the License, or (at your option) any later version.
+ *
+ * Libav is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with Libav; if not, write to the Free Software
+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
+ */
+
+#define CONFIG_FFT_FLOAT 0
+#include "mdct.c"
diff --git a/libavcodec/mdct_float.c b/libavcodec/mdct_float.c
new file mode 100644
index 0000000..e4f5549
--- /dev/null
+++ b/libavcodec/mdct_float.c
@@ -0,0 +1,20 @@
+/*
+ * This file is part of Libav.
+ *
+ * Libav is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Lesser General Public
+ * License as published by the Free Software Foundation; either
+ * version 2.1 of the License, or (at your option) any later version.
+ *
+ * Libav is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with Libav; if not, write to the Free Software
+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
+ */
+
+#define CONFIG_FFT_FLOAT 1
+#include "mdct.c"
-- 
1.7.4.1


From news@gmane.org Tue Mar 04 03:33:20 2003
From: Diego Biurrun <diego-NvuzD6AdJSiELgA04lAiVw@public.gmane.org>
Subject: Re: [PATCH] Add bwf muxer, wav file with bext chunk
Date: Wed, 23 Mar 2011 16:39:05 +0100
Lines: 65
Message-ID: <20110323153905.GE30842@pool.informatik.RWTH-Aachen.DE>
References: <1300410015-9471-1-git-send-email-banan@ludd.ltu.se>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 16:39:09 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2Q9M-0000CN-LN
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 16:39:08 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 4AC7E3B20D;
	Wed, 23 Mar 2011 16:39:08 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id D29793B20D
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 16:39:05 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id RJmzKuew9BL7 for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 16:39:05 +0100 (CET)
Received: from mta-1.ms.rz.rwth-aachen.de (mta-1.ms.rz.RWTH-Aachen.DE
	[134.130.7.72])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id B88483B20B
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 16:39:05 +0100 (CET)
Content-disposition: inline
Received: from ironport-out-1.rz.rwth-aachen.de ([134.130.5.40])
	by mta-1.ms.rz.RWTH-Aachen.de
	(Sun Java(tm) System Messaging Server 6.3-7.04 (built Sep 26 2008))
	with ESMTP id <0LII00D38OT5GSD0-VQAYY6A2+UYyMoKJnVKI7zLO/+Hfi/qahC4ANOJQIlc@public.gmane.org> for
	libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org; Wed, 23 Mar 2011 16:39:05 +0100 (CET)
X-IronPort-AV: E=Sophos;i="4.63,231,1299452400";   d="scan'208";a="102013883"
Received: from smarthost-2.ms.rz.rwth-aachen.de (HELO smarthost.rwth-aachen.de)
	([134.130.7.90]) by ironport-in-1.rz.rwth-aachen.de with ESMTP; Wed,
	23 Mar 2011 16:39:05 +0100
Received: from hutch.Informatik.RWTH-Aachen.DE
	(hutch.informatik.RWTH-Aachen.DE [137.226.116.30])	by
	smarthost.rwth-aachen.de
	(8.14.4+Sun/8.13.8/1) with ESMTP id p2NFd5vX005912	for
	<libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 16:39:05 +0100 (CET)
Received: from diego by hutch.Informatik.RWTH-Aachen.DE with local (Exim 4.69)
	(envelope-from <diego-C+EoYKesnrCVdxy9aTz+TbwNW4aj8/RQWV23jfQ1LcY@public.gmane.org>)
	id 1Q2Q9J-0001wg-Bi	for libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org;
	Wed, 23 Mar 2011 16:39:05 +0100
In-reply-to: <1300410015-9471-1-git-send-email-banan-LVe2Dp0Iy+4wFerOooGFRg@public.gmane.org>
User-Agent: Mutt/1.5.18 (2008-05-17)
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/91>

On Fri, Mar 18, 2011 at 02:00:15AM +0100, banan-LVe2Dp0Iy+4wFerOooGFRg@public.gmane.org wrote:
> From: Benjamin Larsson <benjamin-A9uVI2HLR7kOP4wsBPIw7w@public.gmane.org>
> 
> ---
>  libavformat/Makefile     |    1 +
>  libavformat/allformats.c |    1 +
>  libavformat/wav.c        |   83 +++++++++++++++++++++++++++++++++++++++++++++-
>  3 files changed, 84 insertions(+), 1 deletions(-)

This is missing a doc and changelog update

> --- a/libavformat/Makefile
> +++ b/libavformat/Makefile
> @@ -288,6 +288,7 @@ OBJS-$(CONFIG_VQF_DEMUXER)               += vqf.o
>  OBJS-$(CONFIG_WAV_DEMUXER)               += wav.o riff.o pcm.o
>  OBJS-$(CONFIG_WAV_MUXER)                 += wav.o riff.o
> +OBJS-$(CONFIG_BWF_MUXER)                 += wav.o riff.o
>  OBJS-$(CONFIG_WC3_DEMUXER)               += wc3movie.o

order

> --- a/libavformat/allformats.c
> +++ b/libavformat/allformats.c
> @@ -215,6 +215,7 @@ void av_register_all(void)
>      REGISTER_DEMUXER  (W64, w64);
>      REGISTER_MUXDEMUX (WAV, wav);
> +    REGISTER_MUXER    (BWF, bwf);
>      REGISTER_DEMUXER  (WC3, wc3);

ditto

> --- a/libavformat/wav.c
> +++ b/libavformat/wav.c
> @@ -35,7 +37,66 @@ typedef struct {
> +
> +static inline void bwf_write_bext_string(AVFormatContext *s, const char *key, int maxlen)

extra good karma for breaking this long line

> +        for (i=0 ; i<len/16 ; i++) {
> +            memcpy(umidpart_str, tmp_tag->value+2+(i*16), 16);
> +    } else
> +        ffio_fill(s->pb, 0, 64); // zero UMID

Whitespace around operators would make the above lines more readable.

> @@ -138,6 +206,19 @@ AVOutputFormat ff_wav_muxer = {
>  
> +#if CONFIG_BWF_MUXER
> +AVOutputFormat ff_bwf_muxer = {
> +    .name           = "bwf",
> +    .long_name      = NULL_IF_CONFIG_SMALL("Broadcast Wave format"),
> +    .extensions     = "wav,bwf",
> +    .priv_data_size = sizeof(WAVContext),
> +    .audio_codec    = CODEC_ID_PCM_S16LE,
> +    .write_header   = wav_write_header,
> +    .write_packet   = wav_write_packet,
> +    .write_trailer  = wav_write_trailer,
> +    .codec_tag      = (const AVCodecTag* const []){ff_codec_wav_tags, 0},
> +};
> +#endif /* CONFIG_BWF_MUXER */

Add this to the CONFIG_BWF_MUXER block above and save one #ifdef.

Diego


From news@gmane.org Tue Mar 04 03:33:20 2003
From: Manjunath Siddaiah <msiddaiah@rgbnetworks.com>
Subject: [PATCH] RTMP streaming crashes after some time with
 Flash Media Server (FMS), Issue 2236
Date: Wed, 23 Mar 2011 17:49:56 +0000
Lines: 66
Message-ID: <B15060CE1DBCC944910FD7BB5CD0DB7504B91C@msg10003.rgbnetworks.com>
Reply-To: FFmpeg development discussions and patches <ffmpeg-devel@ffmpeg.org>
Mime-Version: 1.0
Content-Type: multipart/mixed;
	boundary="_004_B15060CE1DBCC944910FD7BB5CD0DB7504B91Cmsg10003rgbnetwor_"
To: "ffmpeg-devel@ffmpeg.org" <ffmpeg-devel@ffmpeg.org>,
	"libav-devel@libav.org" <libav-devel@libav.org>
X-From: ffmpeg-devel-bounces@ffmpeg.org Wed Mar 23 18:50:04 2011
Return-path: <ffmpeg-devel-bounces@ffmpeg.org>
Envelope-to: gcvfd-ffmpeg-devel-853-2@m.gmane.org
Received: from avserver.banki.hu ([192.190.173.45])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <ffmpeg-devel-bounces@ffmpeg.org>)
	id 1Q2SC3-0002dR-0B
	for gcvfd-ffmpeg-devel-853-2@m.gmane.org; Wed, 23 Mar 2011 18:50:03 +0100
Received: from avserver.banki.hu (localhost [127.0.0.1])
	by avserver.banki.hu (Postfix) with ESMTP id A67484E76D;
	Wed, 23 Mar 2011 18:50:04 +0100 (CET)
X-Original-To: ffmpeg-devel@ffmpeg.org
Delivered-To: ffmpeg-devel@ffmpeg.org
Received: from access.rgbnetworks.com (access.rgbnetworks.com [157.22.246.59])
	by avserver.banki.hu (Postfix) with ESMTP id 9EE324E763
	for <ffmpeg-devel@ffmpeg.org>; Wed, 23 Mar 2011 18:50:02 +0100 (CET)
Received: from MSG10003.rgbnetworks.com ([fe80::9822:a293:b567:740c]) by
	msg10004.rgbnetworks.com ([fe80::9d5f:88b4:4a13:7d92%11]) with mapi id
	14.01.0270.001; Wed, 23 Mar 2011 10:49:57 -0700
Thread-Topic: [PATCH] RTMP streaming crashes after some time with Flash
	Media Server (FMS), Issue 2236
Thread-Index: AcvpgF3BO+ADMydqSSm/U1DT/6ewJg==
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: yes
X-MS-TNEF-Correlator: 
x-originating-ip: [10.10.100.45]
X-Content-Filtered-By: Mailman/MimeDel 2.1.14
X-BeenThere: ffmpeg-devel@ffmpeg.org
X-Mailman-Version: 2.1.14
Precedence: list
List-Id: FFmpeg development discussions and patches <ffmpeg-devel.ffmpeg.org>
List-Unsubscribe: <http://ffmpeg.org/mailman/options/ffmpeg-devel>,
	<mailto:ffmpeg-devel-request@ffmpeg.org?subject=unsubscribe>
List-Archive: <http://ffmpeg.org/pipermail/ffmpeg-devel>
List-Post: <mailto:ffmpeg-devel@ffmpeg.org>
List-Help: <mailto:ffmpeg-devel-request@ffmpeg.org?subject=help>
List-Subscribe: <http://ffmpeg.org/mailman/listinfo/ffmpeg-devel>,
	<mailto:ffmpeg-devel-request@ffmpeg.org?subject=subscribe>
Errors-To: ffmpeg-devel-bounces@ffmpeg.org
Sender: ffmpeg-devel-bounces@ffmpeg.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/92>

--_004_B15060CE1DBCC944910FD7BB5CD0DB7504B91Cmsg10003rgbnetwor_
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: quoted-printable

Hi,

Issue 2236 is reproducible for high bitrates more than 1 Mbps. Current RTMP=
 implementation assumes there will be one "rtmp packet" inside a "flv packe=
t".
This assumption is true for low bitrates and for high bitrates there will b=
e multiple "rtmp packets" inside a "flv packet". Current implementation has=
 not taken care of this situation.
The fix is done taking care off "multiple rtmp packets" in a "flv packet". =
 The patch has 3 line changes in "rtmp_write" function in "libavformat/rtmp=
proto.c" and is provided with suitable comments.

The patch is tested overnight for video bitrate at 10 Mbps without any cras=
hing.

-Manjunath H Siddaiah



--_004_B15060CE1DBCC944910FD7BB5CD0DB7504B91Cmsg10003rgbnetwor_
Content-Type: text/plain; name="PATCH_for_Issue_2236.txt"
Content-Description: PATCH_for_Issue_2236.txt
Content-Disposition: attachment; filename="PATCH_for_Issue_2236.txt";
	size=1175; creation-date="Wed, 23 Mar 2011 17:46:59 GMT";
	modification-date="Wed, 23 Mar 2011 17:20:06 GMT"
Content-Transfer-Encoding: base64

SW5kZXg6IGxpYmF2Zm9ybWF0L3J0bXBwcm90by5jCj09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLS0tIGxpYmF2Zm9ybWF0
L3J0bXBwcm90by5jCShyZXZpc2lvbiAyNjQwMikKKysrIGxpYmF2Zm9ybWF0L3J0bXBwcm90by5j
CSh3b3JraW5nIGNvcHkpCkBAIC05MzAsOCArOTMwLDggQEAKICAgICBpbnQgcGt0c2l6ZSwgcGt0
dHlwZTsKICAgICB1aW50MzJfdCB0czsKICAgICBjb25zdCB1aW50OF90ICpidWZfdGVtcCA9IGJ1
ZjsKLQotICAgIGlmIChzaXplIDwgMTEpIHsKKyAgICAvLyBydC0+Zmx2X29mZiB3aWxsIG5ldmVy
IGJlIGFsd2F5cyB6ZXJvIGlmIHRoZXJlIGFyZSBtdWx0aXBsZSBydG1wIHBhY2tldHMgaW5zaWRl
IG9uZSBmbHYgcGFja2V0CisgICAgaWYgKCFydC0+Zmx2X29mZiAmJiBzaXplIDwgMTEpIHsKICAg
ICAgICAgYXZfbG9nKExPR19DT05URVhULCBBVl9MT0dfREVCVUcsICJGTFYgcGFja2V0IHRvbyBz
bWFsbCAlZFxuIiwgc2l6ZSk7CiAgICAgICAgIHJldHVybiAwOwogICAgIH0KQEAgLTk3Miw4ICs5
NzIsMTIgQEAKICAgICAgICAgaWYgKHJ0LT5mbHZfc2l6ZSAtIHJ0LT5mbHZfb2ZmID4gc2l6ZV90
ZW1wKSB7CiAgICAgICAgICAgICBieXRlc3RyZWFtX2dldF9idWZmZXIoJmJ1Zl90ZW1wLCBydC0+
Zmx2X2RhdGEgKyBydC0+Zmx2X29mZiwgc2l6ZV90ZW1wKTsKICAgICAgICAgICAgIHJ0LT5mbHZf
b2ZmICs9IHNpemVfdGVtcDsKKyAgICAgICAgICAgIC8vIE1ha2luZyBzaXplX3RlbXAgPSAwIHdo
ZW4gaXQgcmVhZHMgZnVsbCBvZiBidWZmZXIKKyAgICAgICAgICAgIHNpemVfdGVtcCA9IDA7CiAg
ICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICBieXRlc3RyZWFtX2dldF9idWZmZXIoJmJ1Zl90
ZW1wLCBydC0+Zmx2X2RhdGEgKyBydC0+Zmx2X29mZiwgcnQtPmZsdl9zaXplIC0gcnQtPmZsdl9v
ZmYpOworICAgICAgICAgICAgLy8gUmVkdWNpbmcgc2l6ZV90ZW1wIGJ5IGFzIG1hbnkgYnl0ZXMg
YXMgcmVhZCBmcm9tIHRoZSBidWZmZXIKKyAgICAgICAgICAgIHNpemVfdGVtcCAtPSAocnQtPmZs
dl9zaXplIC0gcnQtPmZsdl9vZmYpOwogICAgICAgICAgICAgcnQtPmZsdl9vZmYgKz0gcnQtPmZs
dl9zaXplIC0gcnQtPmZsdl9vZmY7CiAgICAgICAgIH0KIAo=

--_004_B15060CE1DBCC944910FD7BB5CD0DB7504B91Cmsg10003rgbnetwor_
Content-Type: text/plain; charset="us-ascii"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
Content-Disposition: inline

_______________________________________________
ffmpeg-devel mailing list
ffmpeg-devel@ffmpeg.org
http://ffmpeg.org/mailman/listinfo/ffmpeg-devel

--_004_B15060CE1DBCC944910FD7BB5CD0DB7504B91Cmsg10003rgbnetwor_--



From news@gmane.org Tue Mar 04 03:33:20 2003
From: Vitor Sessak <vitor1001-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>
Subject: Re: [PATCH] Fix an infinite loop when RoQ encoded
Date: Wed, 23 Mar 2011 19:01:55 +0100
Lines: 14
Message-ID: <4D8A3593.7000106@gmail.com>
References: <4D863A58.8090706@gmail.com>	<4D8907C4.4010400@ludd.ltu.se>
	<AANLkTinR4GBC5-n9j-OsC2F0S7Uthwi2AbYgzuE9S_Rc@mail.gmail.com>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"; Format="flowed"
Content-Transfer-Encoding: 7bit
To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 19:02:07 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2SNg-0002J2-Qx
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 19:02:04 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 4A7643B1A2;
	Wed, 23 Mar 2011 19:02:04 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id D9F113B1A2
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 19:02:01 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id lQxZhyZvpUgd for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 19:02:01 +0100 (CET)
Received: from mail-bw0-f54.google.com (mail-bw0-f54.google.com
	[209.85.214.54])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id AF79C3B1A1
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 19:02:01 +0100 (CET)
Received: by bwz12 with SMTP id 12so11113267bwz.27
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 11:02:01 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=gamma;
	h=domainkey-signature:message-id:date:from:user-agent:mime-version:to
	:subject:references:in-reply-to:content-type
	:content-transfer-encoding;
	bh=hGmq6+1pfiW504/46B0OPYe+dGSQBDr1Fk4dZ1A1D3k=;
	b=OLFTu9vAKcpaueTd5DNZ+b+RKKVBKrXIZprIQpJsPVl+tcUIvjtJhqx2V9MWjCw1VH
	SOiRmAs1HY+pSS/zkZvFthTHnmXfDmakevnm3xpKuXXQ+DLLydQ5/DYgYP/0bzXf629D
	EN5zr0m36aumP+Zs8J8KUy1EyULgJgrX9HVoY=
DomainKey-Signature: a=rsa-sha1; c=nofws; d=gmail.com; s=gamma;
	h=message-id:date:from:user-agent:mime-version:to:subject:references
	:in-reply-to:content-type:content-transfer-encoding;
	b=eNYircY9XVgpwGGyorcjoqe5sZrr/K/w4UrJfdCkvHpgdKcNby5EYPGO/9nnbEUIrI
	6Q34n9XZHYXEoGDRPuZSNnCZzMDronPv/JlDCF/DlqFLZddzVGiYSvv9LPtzlF3I1tqq
	6UCAoIkR8L5inLRkVvbM0NRFYd5FYOuPl7BZQ=
Received: by 10.204.143.141 with SMTP id v13mr1693192bku.203.1300903321298;
	Wed, 23 Mar 2011 11:02:01 -0700 (PDT)
Received: from [192.168.1.60] (AMontsouris-755-1-12-27.w90-46.abo.wanadoo.fr
	[90.46.11.27])
	by mx.google.com with ESMTPS id v21sm2394391bkt.23.2011.03.23.11.01.56
	(version=SSLv3 cipher=OTHER); Wed, 23 Mar 2011 11:01:57 -0700 (PDT)
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US;
	rv:1.9.2.14) Gecko/20110223 Thunderbird/3.1.8
In-Reply-To: <AANLkTinR4GBC5-n9j-OsC2F0S7Uthwi2AbYgzuE9S_Rc-JsoAwUIsXosN+BqQ9rBEUg@public.gmane.org>
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/93>

On 03/22/2011 11:31 PM, Ronald S. Bultje wrote:
> Hi,
>
> On Tue, Mar 22, 2011 at 4:34 PM, Benjamin Larsson<banan-LVe2Dp0Iy+4wFerOooGFRg@public.gmane.org>  wrote:
>> On 03/20/2011 06:33 PM, Vitor Sessak wrote:
>>> $subj
>>
>> Patch ok.
>
> Pushed, sorry for the slight delay, Vitor.

No problem and thanks.

-Vitor


From news@gmane.org Tue Mar 04 03:33:20 2003
From: Vitor Sessak <vitor1001-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>
Subject: Re: [PATCH][RFC] Fixed-point FFT and MDCT
Date: Wed, 23 Mar 2011 19:09:40 +0100
Lines: 81
Message-ID: <4D8A3764.2070108@gmail.com>
References: <1300889055-14977-1-git-send-email-mans@mansr.com>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"; Format="flowed"
Content-Transfer-Encoding: 7bit
To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 19:12:11 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2SXT-0000fx-Lf
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 19:12:11 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 677553C093;
	Wed, 23 Mar 2011 19:12:11 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 21CB93C093
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 19:12:09 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id KKynJ5OJu+Y9 for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 19:12:09 +0100 (CET)
Received: from mail-fx0-f54.google.com (mail-fx0-f54.google.com
	[209.85.161.54])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 09F9F3B1C5
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 19:12:09 +0100 (CET)
Received: by fxm11 with SMTP id 11so12690161fxm.27
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 11:12:08 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=gamma;
	h=domainkey-signature:message-id:date:from:user-agent:mime-version:to
	:subject:references:in-reply-to:content-type
	:content-transfer-encoding;
	bh=BUiasidHbrbLrTsb+KLLoOEjFDkDxeher2m7zk/4FOA=;
	b=t2ppYLpPyDwLSvsRBNSoRP8HinhJP0QOg5SI171WLO6/4+Mowz7keOW0AS5u8vzTY1
	b6hBos8X7FvLqr8jxUINVdW6+NhUPma6I/xEAZ7Nh/ms4LTgQhywNDht8F+g5oDGquSm
	YPVNnPMf1iUtGdU36COUfujQmNOhDyZ+vDBLU=
DomainKey-Signature: a=rsa-sha1; c=nofws; d=gmail.com; s=gamma;
	h=message-id:date:from:user-agent:mime-version:to:subject:references
	:in-reply-to:content-type:content-transfer-encoding;
	b=ijmV6uhuLgXy1UHMVQrIwyuIFOydhlMMsCgYJrd1iQLwpDPzzyQ+Pn2f2e5hNF7Juk
	Oqwnr4+o7tW/oiT0ad6WurZVVlmbZ90M6uMdspPj5BEQRUiczAYUDnri2r3UW+qlv+uY
	9ng6UJWqDjiysorC0hZhCpM6AhAZ2gTO/yLTo=
Received: by 10.223.91.69 with SMTP id l5mr8393576fam.32.1300903786628;
	Wed, 23 Mar 2011 11:09:46 -0700 (PDT)
Received: from [192.168.1.60] (AMontsouris-755-1-12-27.w90-46.abo.wanadoo.fr
	[90.46.11.27])
	by mx.google.com with ESMTPS id p16sm1003201fax.21.2011.03.23.11.09.42
	(version=SSLv3 cipher=OTHER); Wed, 23 Mar 2011 11:09:43 -0700 (PDT)
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US;
	rv:1.9.2.14) Gecko/20110223 Thunderbird/3.1.8
In-Reply-To: <1300889055-14977-1-git-send-email-mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org>
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/94>

On 03/23/2011 03:04 PM, Mans Rullgard wrote:
> This creates fixed-point versions of the FFT and MDCT, as was promised
> "soon" back in 2002.  Some parts of the patch are a bit hackish, hence
> the RFC.  I have tested it with the AC3 encoder where it seems to work.
>
> The _fixed/float wrapper files could be removed and replaced with make
> trickery.  I'm not sure which is best there.  There is also some macro
> magic which could possibly be done differently.
>
> I have unfinished patches to make fft-test also test these fixed-point
> versions, but that's still too ugly to post.

Just a couple of comments:

> --- /dev/null
> +++ b/libavcodec/fft-internal.h
> @@ -0,0 +1,67 @@
> +/*
> + * This file is part of Libav.
> + *
> + * Libav is free software; you can redistribute it and/or
> + * modify it under the terms of the GNU Lesser General Public
> + * License as published by the Free Software Foundation; either
> + * version 2.1 of the License, or (at your option) any later version.
> + *
> + * Libav is distributed in the hope that it will be useful,
> + * but WITHOUT ANY WARRANTY; without even the implied warranty of
> + * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
> + * Lesser General Public License for more details.
> + *
> + * You should have received a copy of the GNU Lesser General Public
> + * License along with Libav; if not, write to the Free Software
> + * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
> + */
> +
> +#ifndef AVCODEC_FFT_INTERNAL_H
> +#define AVCODEC_FFT_INTERNAL_H
> +
> +#if CONFIG_FFT_FLOAT
> +
> +#define FIX15(v) (v)
> +#define sqrthalf (float)M_SQRT1_2
> +
> +#define BF(x, y, a, b) do {                     \
> +        x = a - b;                              \
> +        y = a + b;                              \
> +    } while (0)
> +
> +#define CMUL(dre, dim, are, aim, bre, bim) do { \
> +        (dre) = (are) * (bre) - (aim) * (bim);  \
> +        (dim) = (are) * (bim) + (bre) * (aim);  \
> +    } while (0)
> +
> +#else
> +
> +#include "libavutil/intmath.h"
> +#include "mathops.h"
> +
> +#define SCALE_FLOAT(a, bits) lrintf((a) * (float)(1<<  (bits)))

I'd use doubles here. This code is not performance-critical and it helps 
it to be bit-exact across arches, since only values which are close 
enough to a half integer might give a non-bitexact result (and what 
"close enough" means depends if it is a double or a float).

> +#define FIX15(a) av_clip(SCALE_FLOAT(a, 15), -32767, 32767)
> +
> +#define sqrthalf ((int16_t)((1<<15)*M_SQRT1_2))

#define sqrthalf ((int16_t)((1<<15)*M_SQRT1_2 + 0.5))

> +
> +#define BF(x, y, a, b) do {                     \
> +        x = (a - b)>>  1;                       \
> +        y = (a + b)>>  1;                       \
> +    } while (0)

Is it possible to avoid those shifts, even if losing some precision? 
This should have a pretty big impact in performance...

-Vitor


From news@gmane.org Tue Mar 04 03:33:20 2003
From: =?iso-8859-1?Q?M=E5ns_Rullg=E5rd?= <mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org>
Subject: Re: [PATCH][RFC] Fixed-point FFT and MDCT
Date: Wed, 23 Mar 2011 18:36:12 +0000
Lines: 76
Message-ID: <yw1xpqphptur.fsf@unicorn.mansr.com>
References: <1300889055-14977-1-git-send-email-mans@mansr.com>
	<4D8A3764.2070108@gmail.com>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 19:36:14 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2Suj-0008Ir-Qs
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 19:36:13 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 9FC363C0A0;
	Wed, 23 Mar 2011 19:36:13 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 7AC073C0A0
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 19:36:12 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id NoMdqRW8jXjh for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 19:36:12 +0100 (CET)
Received: from unicorn.mansr.com (unicorn.mansr.com [78.86.181.103])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 549EF3C09F
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 19:36:12 +0100 (CET)
Received: by unicorn.mansr.com (Postfix, from userid 51770)
	id 1B29417B41; Wed, 23 Mar 2011 18:36:12 +0000 (GMT)
In-Reply-To: <4D8A3764.2070108-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org> (Vitor Sessak's message of "Wed, 23
	Mar 2011 19:09:40 +0100")
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/23.2 (gnu/linux)
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/95>

Vitor Sessak <vitor1001-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org> writes:

> On 03/23/2011 03:04 PM, Mans Rullgard wrote:
>> This creates fixed-point versions of the FFT and MDCT, as was promised
>> "soon" back in 2002.  Some parts of the patch are a bit hackish, hence
>> the RFC.  I have tested it with the AC3 encoder where it seems to work.
>>
>> The _fixed/float wrapper files could be removed and replaced with make
>> trickery.  I'm not sure which is best there.  There is also some macro
>> magic which could possibly be done differently.
>>
>> I have unfinished patches to make fft-test also test these fixed-point
>> versions, but that's still too ugly to post.
>
> Just a couple of comments:
>
>> +#ifndef AVCODEC_FFT_INTERNAL_H
>> +#define AVCODEC_FFT_INTERNAL_H
>> +
>> +#if CONFIG_FFT_FLOAT
>> +
>> +#define FIX15(v) (v)
>> +#define sqrthalf (float)M_SQRT1_2
>> +
>> +#define BF(x, y, a, b) do {                     \
>> +        x =3D a - b;                              \
>> +        y =3D a + b;                              \
>> +    } while (0)
>> +
>> +#define CMUL(dre, dim, are, aim, bre, bim) do { \
>> +        (dre) =3D (are) * (bre) - (aim) * (bim);  \
>> +        (dim) =3D (are) * (bim) + (bre) * (aim);  \
>> +    } while (0)
>> +
>> +#else
>> +
>> +#include "libavutil/intmath.h"
>> +#include "mathops.h"
>> +
>> +#define SCALE_FLOAT(a, bits) lrintf((a) * (float)(1<<  (bits)))
>
> I'd use doubles here. This code is not performance-critical and it
> helps it to be bit-exact across arches, since only values which are
> close enough to a half integer might give a non-bitexact result (and
> what "close enough" means depends if it is a double or a float).

I stole that from the fixed-point code in ac3enc.  You're right though,
double is probably safer.

>> +#define FIX15(a) av_clip(SCALE_FLOAT(a, 15), -32767, 32767)
>> +
>> +#define sqrthalf ((int16_t)((1<<15)*M_SQRT1_2))
>
> #define sqrthalf ((int16_t)((1<<15)*M_SQRT1_2 + 0.5))
>
>> +
>> +#define BF(x, y, a, b) do {                     \
>> +        x =3D (a - b)>>  1;                       \
>> +        y =3D (a + b)>>  1;                       \
>> +    } while (0)
>
> Is it possible to avoid those shifts, even if losing some precision?

The shift loses precision but keeps the result 16-bit.

> This should have a pretty big impact in performance...

That depends on the CPU.  ARMv6 can do a butterfly like that in a single
instruction, and this is the kind of CPU we're targeting with a
fixed-point FFT in the first place.  I'd expect x86 to use the
floating-point implementation for better precision.

-- =

M=E5ns Rullg=E5rd
mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org


From news@gmane.org Tue Mar 04 03:33:20 2003
From: Vitor Sessak <vitor1001-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>
Subject: Re: [PATCH][RFC] Fixed-point FFT and MDCT
Date: Wed, 23 Mar 2011 20:35:29 +0100
Lines: 84
Message-ID: <4D8A4B81.4070101@gmail.com>
References: <1300889055-14977-1-git-send-email-mans@mansr.com>	<4D8A3764.2070108@gmail.com>
	<yw1xpqphptur.fsf@unicorn.mansr.com>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="iso-8859-1"; Format="flowed"
Content-Transfer-Encoding: quoted-printable
To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 20:35:36 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2TqC-0005Tn-4r
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 20:35:36 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 89BEF3B221;
	Wed, 23 Mar 2011 20:35:35 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 64E8B3B221
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 20:35:34 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id fAmIR1DgA1ev for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 20:35:34 +0100 (CET)
Received: from mail-bw0-f54.google.com (mail-bw0-f54.google.com
	[209.85.214.54])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 433293B1EC
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 20:35:34 +0100 (CET)
Received: by bwz12 with SMTP id 12so11232677bwz.27
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 12:35:33 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=gamma;
	h=domainkey-signature:message-id:date:from:user-agent:mime-version:to
	:subject:references:in-reply-to:content-type
	:content-transfer-encoding;
	bh=YDc0KrYJj69cduSZ51BUXARBd3Sn01/oky3NMgEk3P4=;
	b=JVuZe9XVnJ8zBr7e/pASZkJOvS2+jOWSDQjeuB4tEHXv9asickUHpkFsubjGdOFa9B
	Pm9w1+t4fxw8l6Teq1C5XysuqTFjbnhyoIEhEGfAn1BgJIUuV38924IV2LFqamU0l0Ny
	pdhmDWYa4AySOazrOv7FqEtQkv9NeKZYfU5kw=
DomainKey-Signature: a=rsa-sha1; c=nofws; d=gmail.com; s=gamma;
	h=message-id:date:from:user-agent:mime-version:to:subject:references
	:in-reply-to:content-type:content-transfer-encoding;
	b=lcmbYpSgHfgxkql61+I+jY2kc1rtekz++wxE/aRyIyVhjuH7GtWEvhz6nhtLDqjUJK
	8s8ekeWyMAAIU0mom6/Sy8ytxeRXhLyLh8TPpbV0u4GtmiShiCHLXyNevTq14oVJPCNp
	DPUxnH3R48MJOun70791MtlJSEXRrEQ9AdJq8=
Received: by 10.204.73.206 with SMTP id r14mr6418653bkj.181.1300908933764;
	Wed, 23 Mar 2011 12:35:33 -0700 (PDT)
Received: from [192.168.1.60] (AMontsouris-755-1-12-27.w90-46.abo.wanadoo.fr
	[90.46.11.27])
	by mx.google.com with ESMTPS id k5sm6183425bku.4.2011.03.23.12.35.31
	(version=SSLv3 cipher=OTHER); Wed, 23 Mar 2011 12:35:32 -0700 (PDT)
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US;
	rv:1.9.2.14) Gecko/20110223 Thunderbird/3.1.8
In-Reply-To: <yw1xpqphptur.fsf-OEaqT8BN2ezZK2NkWkPsZwC/G2K4zDHf@public.gmane.org>
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/96>

On 03/23/2011 07:36 PM, M=E5ns Rullg=E5rd wrote:
> Vitor Sessak<vitor1001-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>  writes:
>
>> On 03/23/2011 03:04 PM, Mans Rullgard wrote:
>>> This creates fixed-point versions of the FFT and MDCT, as was promised
>>> "soon" back in 2002.  Some parts of the patch are a bit hackish, hence
>>> the RFC.  I have tested it with the AC3 encoder where it seems to work.
>>>
>>> The _fixed/float wrapper files could be removed and replaced with make
>>> trickery.  I'm not sure which is best there.  There is also some macro
>>> magic which could possibly be done differently.
>>>
>>> I have unfinished patches to make fft-test also test these fixed-point
>>> versions, but that's still too ugly to post.
>>
>> Just a couple of comments:
>>
>>> +#ifndef AVCODEC_FFT_INTERNAL_H
>>> +#define AVCODEC_FFT_INTERNAL_H
>>> +
>>> +#if CONFIG_FFT_FLOAT
>>> +
>>> +#define FIX15(v) (v)
>>> +#define sqrthalf (float)M_SQRT1_2
>>> +
>>> +#define BF(x, y, a, b) do {                     \
>>> +        x =3D a - b;                              \
>>> +        y =3D a + b;                              \
>>> +    } while (0)
>>> +
>>> +#define CMUL(dre, dim, are, aim, bre, bim) do { \
>>> +        (dre) =3D (are) * (bre) - (aim) * (bim);  \
>>> +        (dim) =3D (are) * (bim) + (bre) * (aim);  \
>>> +    } while (0)
>>> +
>>> +#else
>>> +
>>> +#include "libavutil/intmath.h"
>>> +#include "mathops.h"
>>> +
>>> +#define SCALE_FLOAT(a, bits) lrintf((a) * (float)(1<<   (bits)))
>>
>> I'd use doubles here. This code is not performance-critical and it
>> helps it to be bit-exact across arches, since only values which are
>> close enough to a half integer might give a non-bitexact result (and
>> what "close enough" means depends if it is a double or a float).
>
> I stole that from the fixed-point code in ac3enc.  You're right though,
> double is probably safer.
>
>>> +#define FIX15(a) av_clip(SCALE_FLOAT(a, 15), -32767, 32767)
>>> +
>>> +#define sqrthalf ((int16_t)((1<<15)*M_SQRT1_2))
>>
>> #define sqrthalf ((int16_t)((1<<15)*M_SQRT1_2 + 0.5))
>>
>>> +
>>> +#define BF(x, y, a, b) do {                     \
>>> +        x =3D (a - b)>>   1;                       \
>>> +        y =3D (a + b)>>   1;                       \
>>> +    } while (0)
>>
>> Is it possible to avoid those shifts, even if losing some precision?
>
> The shift loses precision but keeps the result 16-bit.

I understand. But if you choose the input range to fit in 15-bit, you =

can do the sum (without shift) to give a 16-bit value and then, when =

doing the multiplication, downscale it again to 15-bit.

>> This should have a pretty big impact in performance...
>
> That depends on the CPU.  ARMv6 can do a butterfly like that in a single
> instruction, and this is the kind of CPU we're targeting with a
> fixed-point FFT in the first place.  I'd expect x86 to use the
> floating-point implementation for better precision.

That's a good point. This instruction takes as many cycles as the =

shift-less one?

-Vitor


From news@gmane.org Tue Mar 04 03:33:20 2003
From: =?iso-8859-1?Q?M=E5ns_Rullg=E5rd?= <mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org>
Subject: Re: [PATCH][RFC] Fixed-point FFT and MDCT
Date: Wed, 23 Mar 2011 19:39:26 +0000
Lines: 90
Message-ID: <yw1xlj05pqxd.fsf@unicorn.mansr.com>
References: <1300889055-14977-1-git-send-email-mans@mansr.com>
	<4D8A3764.2070108@gmail.com> <yw1xpqphptur.fsf@unicorn.mansr.com>
	<4D8A4B81.4070101@gmail.com>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 20:39:36 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2Ttx-0007qn-I8
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 20:39:29 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 45F8D3C080;
	Wed, 23 Mar 2011 20:39:29 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id CAA963C080
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 20:39:26 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id yBPKRchruo09 for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 20:39:26 +0100 (CET)
Received: from unicorn.mansr.com (unicorn.mansr.com [78.86.181.103])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 91AA83C07E
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 20:39:26 +0100 (CET)
Received: by unicorn.mansr.com (Postfix, from userid 51770)
	id 4C09A17B41; Wed, 23 Mar 2011 19:39:26 +0000 (GMT)
In-Reply-To: <4D8A4B81.4070101-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org> (Vitor Sessak's message of "Wed, 23
	Mar 2011 20:35:29 +0100")
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/23.2 (gnu/linux)
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/97>

Vitor Sessak <vitor1001-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org> writes:

> On 03/23/2011 07:36 PM, M=E5ns Rullg=E5rd wrote:
>> Vitor Sessak<vitor1001-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>  writes:
>>
>>> On 03/23/2011 03:04 PM, Mans Rullgard wrote:
>>>> This creates fixed-point versions of the FFT and MDCT, as was promised
>>>> "soon" back in 2002.  Some parts of the patch are a bit hackish, hence
>>>> the RFC.  I have tested it with the AC3 encoder where it seems to work.
>>>>
>>>> The _fixed/float wrapper files could be removed and replaced with make
>>>> trickery.  I'm not sure which is best there.  There is also some macro
>>>> magic which could possibly be done differently.
>>>>
>>>> I have unfinished patches to make fft-test also test these fixed-point
>>>> versions, but that's still too ugly to post.
>>>
>>> Just a couple of comments:
>>>
>>>> +#ifndef AVCODEC_FFT_INTERNAL_H
>>>> +#define AVCODEC_FFT_INTERNAL_H
>>>> +
>>>> +#if CONFIG_FFT_FLOAT
>>>> +
>>>> +#define FIX15(v) (v)
>>>> +#define sqrthalf (float)M_SQRT1_2
>>>> +
>>>> +#define BF(x, y, a, b) do {                     \
>>>> +        x =3D a - b;                              \
>>>> +        y =3D a + b;                              \
>>>> +    } while (0)
>>>> +
>>>> +#define CMUL(dre, dim, are, aim, bre, bim) do { \
>>>> +        (dre) =3D (are) * (bre) - (aim) * (bim);  \
>>>> +        (dim) =3D (are) * (bim) + (bre) * (aim);  \
>>>> +    } while (0)
>>>> +
>>>> +#else
>>>> +
>>>> +#include "libavutil/intmath.h"
>>>> +#include "mathops.h"
>>>> +
>>>> +#define SCALE_FLOAT(a, bits) lrintf((a) * (float)(1<<   (bits)))
>>>
>>> I'd use doubles here. This code is not performance-critical and it
>>> helps it to be bit-exact across arches, since only values which are
>>> close enough to a half integer might give a non-bitexact result (and
>>> what "close enough" means depends if it is a double or a float).
>>
>> I stole that from the fixed-point code in ac3enc.  You're right though,
>> double is probably safer.
>>
>>>> +#define FIX15(a) av_clip(SCALE_FLOAT(a, 15), -32767, 32767)
>>>> +
>>>> +#define sqrthalf ((int16_t)((1<<15)*M_SQRT1_2))
>>>
>>> #define sqrthalf ((int16_t)((1<<15)*M_SQRT1_2 + 0.5))
>>>
>>>> +
>>>> +#define BF(x, y, a, b) do {                     \
>>>> +        x =3D (a - b)>>   1;                       \
>>>> +        y =3D (a + b)>>   1;                       \
>>>> +    } while (0)
>>>
>>> Is it possible to avoid those shifts, even if losing some precision?
>>
>> The shift loses precision but keeps the result 16-bit.
>
> I understand. But if you choose the input range to fit in 15-bit, you
> can do the sum (without shift) to give a 16-bit value and then, when
> doing the multiplication, downscale it again to 15-bit.

These are signed values so that doesn't work.

>>> This should have a pretty big impact in performance...
>>
>> That depends on the CPU.  ARMv6 can do a butterfly like that in a single
>> instruction, and this is the kind of CPU we're targeting with a
>> fixed-point FFT in the first place.  I'd expect x86 to use the
>> floating-point implementation for better precision.
>
> That's a good point. This instruction takes as many cycles as the
> shift-less one?

One cycle on most cores.

-- =

M=E5ns Rullg=E5rd
mans-2StjZFpD7GcAvxtiuMwx3w@public.gmane.org


From news@gmane.org Tue Mar 04 03:33:20 2003
From: "Ronald S. Bultje" <rsbultje-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>
Subject: [PATCH] mpeg12.c: disable threading for mpeg2 field
	picture mode.
Date: Wed, 23 Mar 2011 16:41:51 -0400
Lines: 18
Message-ID: <1300912911-60249-1-git-send-email-rsbultje@gmail.com>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 21:42:41 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2Ut6-0005uD-H2
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 21:42:40 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 9B16F3B0E8;
	Wed, 23 Mar 2011 21:42:39 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 561C33B0E8
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 21:42:38 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id KBeERts1RJfc for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 21:42:38 +0100 (CET)
Received: from mail-qy0-f182.google.com (mail-qy0-f182.google.com
	[209.85.216.182])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 04CA03B0E5
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 21:42:37 +0100 (CET)
Received: by qyk27 with SMTP id 27so8011623qyk.6
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 13:42:36 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=gamma;
	h=domainkey-signature:from:to:cc:subject:date:message-id:x-mailer;
	bh=gei1Psix0aJoPjGxiA80i9dEgf58QsrgxCcY1QKaYsk=;
	b=Q+79Aqbfq7o6oqde632ZoLl9yx2k/wfzAnw0ORtJ84EBccrnMHTqf79U8hGrrD/A96
	J6ur/RpzFpQdJJBj8YcGmihcGR/Rh9Vlo4eMdxCAltsxD5nAFvsN/530wJiP445bbuwi
	fhcyTV9RyoFbi4UZqQymQ6MtN9s/9DRiMEYK4=
DomainKey-Signature: a=rsa-sha1; c=nofws; d=gmail.com; s=gamma;
	h=from:to:cc:subject:date:message-id:x-mailer;
	b=klpsdgXrTSzxyjeVfk0tgSql1F6RJ7EVMpr0xFBasYvKAWWWhrjDjwS52DJ8laLfVY
	GQ8nL6WPxnSdmWx1NrQWWGNubmXjRHo749AeLnHTUoBStrE5C5VFa/8BzJuvi5gFBIXj
	8Isv5aYgb6HY4VTYxoAUltFX48GU+C2dulY5g=
Received: by 10.224.104.3 with SMTP id m3mr32785qao.206.1300912956460;
	Wed, 23 Mar 2011 13:42:36 -0700 (PDT)
Received: from localhost.localdomain (cpe-74-68-112-85.nyc.res.rr.com
	[74.68.112.85])
	by mx.google.com with ESMTPS id l12sm6299364qcu.43.2011.03.23.13.42.35
	(version=TLSv1/SSLv3 cipher=OTHER);
	Wed, 23 Mar 2011 13:42:35 -0700 (PDT)
X-Mailer: git-send-email 1.7.2.1
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/98>

---
 libavcodec/mpeg12.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

diff --git a/libavcodec/mpeg12.c b/libavcodec/mpeg12.c
index c60826b..b77688c 100644
--- a/libavcodec/mpeg12.c
+++ b/libavcodec/mpeg12.c
@@ -2359,6 +2359,7 @@ static int decode_chunks(AVCodecContext *avctx,
             }
             break;
         default:
+            if (s2->picture_structure != PICT_FRAME) avctx->thread_count = 1;
             if (start_code >= SLICE_MIN_START_CODE &&
                 start_code <= SLICE_MAX_START_CODE && last_code!=0) {
                 const int field_pic= s2->picture_structure != PICT_FRAME;
-- 
1.7.2.1


From news@gmane.org Tue Mar 04 03:33:20 2003
From: "Ronald S. Bultje" <rsbultje-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>
Subject: [PATCH] mpeg12.c: disable threading for mpeg2 field
	picture mode.
Date: Wed, 23 Mar 2011 16:49:10 -0400
Lines: 19
Message-ID: <1300913350-60384-1-git-send-email-rsbultje@gmail.com>
References: <1300912911-60249-1-git-send-email-rsbultje@gmail.com>
Reply-To: libav development <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-From: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org Wed Mar 23 21:50:17 2011
Return-path: <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
Envelope-to: gcvld-libav-devel@m.gmane.org
Received: from natsuki.mplayerhq.hu ([213.144.138.186])
	by lo.gmane.org with esmtp (Exim 4.69)
	(envelope-from <libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>)
	id 1Q2V0S-0002he-T9
	for gcvld-libav-devel@m.gmane.org; Wed, 23 Mar 2011 21:50:17 +0100
Received: from natsuki.mplayerhq.hu (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id AE4713B0E1;
	Wed, 23 Mar 2011 21:50:16 +0100 (CET)
X-Original-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Delivered-To: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Received: from localhost (localhost.localdomain [127.0.0.1])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id CD6A13B0E1
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 21:50:14 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mplayerhq.hu
Received: from natsuki.mplayerhq.hu ([127.0.0.1])
	by localhost (natsuki.mplayerhq.hu [127.0.0.1]) (amavisd-new,
	port 10024) with LMTP id cLDUWqzDr3tl for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>;
	Wed, 23 Mar 2011 21:50:14 +0100 (CET)
Received: from mail-vx0-f182.google.com (mail-vx0-f182.google.com
	[209.85.220.182])
	by natsuki.mplayerhq.hu (Postfix) with ESMTP id 820583B0D0
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 21:50:14 +0100 (CET)
Received: by vxc34 with SMTP id 34so10765698vxc.27
	for <libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>; Wed, 23 Mar 2011 13:50:13 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=gamma;
	h=domainkey-signature:from:to:cc:subject:date:message-id:x-mailer
	:in-reply-to:references;
	bh=+qyjtwuv4k0N4w0Y4rUuPK6DqlhKRMCy+TMWPDFAyCE=;
	b=PEHgmcpsbP/igdy8uCNOrpyXCtByxMZ++Cz14wPjy++8Hsiv9f5UbCw6ehvQKyZdcD
	pA2RHsOpHdUPGTuP156aR8PQS6mbkYgJIbGfVek+0DuqX8F3u3pV6TlbW/lnGZdT+MJn
	6WW0QwziRQmWgpVECuS38vr5mnfPJFiZZKkd0=
DomainKey-Signature: a=rsa-sha1; c=nofws; d=gmail.com; s=gamma;
	h=from:to:cc:subject:date:message-id:x-mailer:in-reply-to:references;
	b=Wx3hhacg9PCW/vPB0xmzQxIvAwKUh9gQjteeZj6kUIG5GfbCgXITIEzWcX8uZAsNXS
	g47zOgS6JjM5094h4fWlefYLhT5z0Q6XKXSJwlkDb+dk3cSCWmQRTKyiCc0wUB/oJI38
	e+g6npROK5yQE76jJYgj7olb0crRkCNXwJG54=
Received: by 10.52.66.145 with SMTP id f17mr4023527vdt.106.1300913413406;
	Wed, 23 Mar 2011 13:50:13 -0700 (PDT)
Received: from localhost.localdomain (cpe-74-68-112-85.nyc.res.rr.com
	[74.68.112.85])
	by mx.google.com with ESMTPS id f17sm2586514vbv.18.2011.03.23.13.50.12
	(version=TLSv1/SSLv3 cipher=OTHER);
	Wed, 23 Mar 2011 13:50:12 -0700 (PDT)
X-Mailer: git-send-email 1.7.2.1
In-Reply-To: <1300912911-60249-1-git-send-email-rsbultje-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org>
X-BeenThere: libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: libav development <libav-devel.libav.org>
List-Unsubscribe: <https://lists.libav.org/mailman/options/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=unsubscribe>
List-Archive: <http://lists.libav.org/pipermail/libav-devel>
List-Post: <mailto:libav-devel-LOOeJiBropLYtjvyW6yDsg@public.gmane.org>
List-Help: <mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=help>
List-Subscribe: <https://lists.libav.org/mailman/listinfo/libav-devel>,
	<mailto:libav-devel-request-LOOeJiBropLYtjvyW6yDsg@public.gmane.org?subject=subscribe>
Sender: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Errors-To: libav-devel-bounces-LOOeJiBropLYtjvyW6yDsg@public.gmane.org
Archived-At: <http://permalink.gmane.org/gmane.comp.video.libav.devel/99>

Fixes "make THREADS=2 fate-mpeg2-field-enc".
---
 libavcodec/mpeg12.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

diff --git a/libavcodec/mpeg12.c b/libavcodec/mpeg12.c
index c60826b..b77688c 100644
--- a/libavcodec/mpeg12.c
+++ b/libavcodec/mpeg12.c
@@ -2359,6 +2359,7 @@ static int decode_chunks(AVCodecContext *avctx,
             }
             break;
         default:
+            if (s2->picture_structure != PICT_FRAME) avctx->thread_count = 1;
             if (start_code >= SLICE_MIN_START_CODE &&
                 start_code <= SLICE_MAX_START_CODE && last_code!=0) {
                 const int field_pic= s2->picture_structure != PICT_FRAME;
-- 
1.7.2.1


